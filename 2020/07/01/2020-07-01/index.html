<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">
  <script>
    (function () {
        if ('') {
            if (prompt('请输入文章密码') !== '') {
                alert('密码错误！');
                if (history.length === 1) {
                    location.replace("http://qianyouyou.cn"); // 这里替换成你的首页
                } else {
                    history.back();
                }
            }
        }
    })();
</script>







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "28d5c19f"
    });
  daovoice('update');
  </script>















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.2.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=5.2.0" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="浅悠悠的个人博客" type="application/atom+xml">






<meta name="description" content="毕 业 设 计   题目： 基于云存储的图像管理平台设计与实现                                                                        学    生：         王骏          学    号：     201606060129      学    院：电子信息与人工智能学院 专    业：   计算机科学与技术">
<meta property="og:type" content="article">
<meta property="og:title" content="基于云存储的图像管理平台设计与实现">
<meta property="og:url" content="http://qianyouyou.cn/2020/07/01/2020-07-01/index.html">
<meta property="og:site_name" content="浅悠悠的个人博客">
<meta property="og:description" content="毕 业 设 计   题目： 基于云存储的图像管理平台设计与实现                                                                        学    生：         王骏          学    号：     201606060129      学    院：电子信息与人工智能学院 专    业：   计算机科学与技术">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps1.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps2.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps3.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps4.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps5.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps6.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps7.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps8.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps9.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps10.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps11.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps12.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps13.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps14.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps15.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps16.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps17.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps18.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps19.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps20.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps21.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps22.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps23.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps24.png">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps25.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps26.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps27.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps28.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps29.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps30.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps31.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps32.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps33.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps34.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps35.jpg">
<meta property="og:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps36.jpg">
<meta property="og:updated_time" content="2020-07-26T15:54:25.165Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="基于云存储的图像管理平台设计与实现">
<meta name="twitter:description" content="毕 业 设 计   题目： 基于云存储的图像管理平台设计与实现                                                                        学    生：         王骏          学    号：     201606060129      学    院：电子信息与人工智能学院 专    业：   计算机科学与技术">
<meta name="twitter:image" content="file:///C:/Users/DELL/AppData/Local/Temp/ksohtml11024/wps1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.2.0',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://qianyouyou.cn/2020/07/01/2020-07-01/">





  <title>基于云存储的图像管理平台设计与实现 | 浅悠悠的个人博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

<a href="https://www.qianyouyou.cn" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>   
	<header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">浅悠悠的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">When there is no sunshine,talking to the moon.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-notes">
          <a href="/notes/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            随笔
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>


 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://qianyouyou.cn/2020/07/01/2020-07-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王骏">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/blog-logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浅悠悠的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">基于云存储的图像管理平台设计与实现</h1>
        

        <div class="post-meta">
		  
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-01T23:52:26+08:00">
                2020-07-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 热度
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>℃
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  26,201
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  96
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps1.jpg" alt="img"></p>
<p>毕 业 设 计</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps2.jpg" alt="img"> </p>
<p><strong>题目：</strong> <strong>基于云存储的图像管理平台设计与实现</strong>                                                                       </p>
<p><strong>学    生：</strong>         王骏         </p>
<p><strong>学    号：</strong>     201606060129     </p>
<p><strong>学    院：</strong>电子信息与人工智能学院</p>
<p><strong>专    业：</strong>   计算机科学与技术   </p>
<p><strong>指导教师：</strong>         齐勇         </p>
<p>2020<strong>年</strong> 6 <strong>月</strong> 30 <strong>日</strong></p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps3.jpg" alt="img"></p>
<p><strong>毕业设计（论文）任务书</strong></p>
<p>电子信息与人工智能 <strong>学院</strong> 计算机科学与技术 <strong>专业</strong> 163<strong>班级 学生：</strong>王骏</p>
<p><strong>题目：</strong>            基于云存储的图像管理平台设计与实现                                                 </p>
<p><strong>毕业设计（论文）从</strong> 2020 <strong>年</strong> 2 <strong>月</strong> 24 <strong>日起到</strong> 2020 <strong>年</strong> 6 <strong>月</strong>   15   <strong>日</strong></p>
<p><strong>课题的意义及培养目标：</strong></p>
<p>在本本次毕业设计中，将会综合运用本科所学计算机科学与技术专业相关知识，完成实际的应用开发。</p>
<p>传统的云存储系统采用集中的存储服务器存放所有数据，存储服务器成为系统性能的瓶颈，也是可靠性和安全性的焦点，不能满足大规模存储应用的需要。</p>
<p>分布式网络存储系统采用可扩展的系统结构，利用多台存储服务器分担存储负荷，利用位置服务器定位存储信息，它不但提高了系统的可靠性、可用性和存取效率，还易于扩展。因此，本项目利用多台服务器的存储资源来弥补传统云存储系统的不足，通过Nginx服务器作为负载均衡服务实现高负载的分布式云存储方案。</p>
<p><strong>设计（论文）所需收集的原始数据与资料：</strong></p>
<p>C++相关的开发软件工具，Qt客户端设计工具，Nginx服务器，Linux操作系统，MySQL数据库，Redis数据库，分布式文件系统，项目所需的图像数据，分布式文件系统相关资料。</p>
<p><strong>课题的主要任务（需附有技术指标分析）：</strong></p>
<p>本次设计主要为高负载高并发基于分布式的图像管理存储平台。主要实现用户注册，用户登陆，图像文件列表获取，文件上传，下载，分享，删除等基本功能。</p>
<p>本次设计采用C/S架构，分为客户端和服务端，客户端采用Qt进行界面设计。服务端的基本流程为，客户端请求经过反向代理后通过HTTP服务器请求进行相应分布式文件系统管理及数据库管理。以上传为例，首先客户端的请求通过Nginx反向迭代处理作为负载均衡方案，之后通过对应服务器请求先进行数据库信息校验，当该上传数据不存在时，通过追踪器将图像数据存储到相应的分布式文件系统中，再将存储信息存储至数据库以及缓存数据库中。</p>
<p>预计：并发量同步请求初步预计500人左右。本地测试上传速度：30MB/S ~ 50MB/S 客户端下载速度： 20MB/S ~ 40MB/S 服务器中上传速度： 5MB/S ~ 7MB/S 客户端下载速度： 0.1MB/S~ 0.15MB/S </p>
<p><strong>设计（论文）进度安排及完成的相关任务（以教学周为单位）：</strong></p>
<table>
<thead>
<tr>
<th><strong>周 次</strong></th>
<th><strong>设计（论文）任务及要求</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>1-3</td>
<td>相关资料的查阅与学习</td>
</tr>
<tr>
<td>4-5</td>
<td>整个方案的初步设计</td>
</tr>
<tr>
<td>6-10</td>
<td>代码的设计与实现</td>
</tr>
<tr>
<td>11-12</td>
<td>测试与bug修复</td>
</tr>
<tr>
<td>13-14</td>
<td>论文的梳理</td>
</tr>
<tr>
<td>15-16</td>
<td>论文的完善</td>
</tr>
</tbody>
</table>
<p>​                                    学生签名：             </p>
<p>​                                    指导教师：             </p>
<p>​                                  教研室主任：             </p>
<p>基于云存储的图像管理平台设计与实现</p>
<h1 id="摘-要"><a href="#摘-要" class="headerlink" title="摘 要"></a>摘 要</h1><p>随着计算机与网络的发展，国内外的图像存储已逐渐实现由传统图像向数字化图像转型。这意味着图像越来越多地以二进制信息保存在计算机中，这样不仅可以长期保存，而且还有方便复制、随意修改、便于传输等优点。而随着大数据与云计算的发展，图像的存储逐渐也向分布式存储方向发展，使得图像管理的物理存储资源不一定直接连接在本地节点上，而是通过计算机网络与节点相连。分布式文件系统的设计基于C/S模式。而且分布式文件系统也轻松解决了海量图像处理的难题。</p>
<p>利用大数据和云计算的优势，以云存储的方式进行图像数字化存储管理，可以解决常规对象存储所常见的海量图像存储效率低下且不安全、服务器无法承载多用户并发访问等问题。因此设计一套基于分布式文件系统的云存储图像管理平台，为用户提供高效且安全的图像上传、下载、分享、预览等对象存储与管理服务，解决常规物理存储所带来的数据易丢失难恢复、下载存储不方便、存储空间有限、需随身携带等问题，同时解决普通存储网盘用户并发量低下、数据共享性差等问题。</p>
<p>平台采用C/S模型，即客户端/服务端模式。客户端通过Qt可视化设计工具设计用户界面与文件管理界面，客户端语言通过使用Qt类库完成客户端逻辑。服务端框架首先采用Nginx服务器进行反向代理，解决负载均衡与高并发问题；数据对象存储通过分布式文件系统FastDFS进行数据存储；数据库通过持久化数据库MySQL与缓存数据库Redis的协调工作进行数据信息管理；服务端语言采用以C++语言为主的CGI程序完成服务端逻辑。</p>
<p>基于云存储的图像管理平台，最终为用户提供高效且安全的图像云存储与管理服务，包括用户的登录与注册、数据上传、数据下载、文件列表浏览、共享文件浏览、下载榜浏览、数据传输情况浏览、文件的共享与转存、数据删除、图像预览等功能，可作为图床进行图像存储，也可作为云盘进行对象存储，方便用户对图像数据进行数字化管理。</p>
<p>关键词：云存储，分布式文件系统，Nginx，MySQL，C++，Qt</p>
<p><strong>Design and</strong> <strong>I**</strong>mplementation of<strong> </strong>I<strong>**mage</strong> <strong>M**</strong>anagement<strong> </strong>P<strong>**latform based on</strong> <strong>C**</strong>loud<strong> </strong>S<strong>**torage</strong></p>
<h1 id="ABSTRACT"><a href="#ABSTRACT" class="headerlink" title="ABSTRACT"></a><strong>ABSTRACT</strong></h1><p>With the development of computer and network, image storage at home and abroad has gradually realized the transformation from traditional image to digital image. This means that the image is more and more stored in the computer with binary information, which not only can be saved for a long time, but also has the advantages of convenient replication, arbitrary modification, easy transmission and so on. With the development of big data and cloud computing, the storage of images is also gradually developing towards distributed storage. The design of distributed file system is based on C / S mode. Moreover, the distributed file system can easily solve the problem of massive image processing.</p>
<p>By using the advantages of big data and cloud computing, digital image storage management in the way of cloud storage can solve the common problems of mass image storage, such as low efficiency and insecurity, the server can not carry multi-user concurrent access and so on. Therefore, a set of cloud storage image management platform based on the distributed file system is designed to provide users with efficient and safe image upload, download, share, preview and other object storage and management services, to solve the problems brought by the conventional physical storage, such as easy loss and hard recovery of data, inconvenient Download and storage, limited storage space, need to carry around, and to solve the common storage network disk There are many problems such as low concurrent users and poor data sharing.</p>
<p>The platform adopts C / S model, namely client / server mode. The client uses QT visual design tool to design user interface and file management interface, and the client language uses QT class library to complete the client logic. The server framework first uses nginx server as the reverse proxy to solve the problem of load balance and high concurrency; the data object storage uses fastdfs as the distributed file system for data storage; the database uses MySQL as the persistent database to coordinate with redis as the cache database for data information management; the server language uses CGI program based on C + + to complete the server logic.</p>
<p>The image management platform based on cloud storage provides users with efficient and safe image cloud storage and management services, including user login and registration, data upload, data download, file list browsing, shared file browsing, download list browsing, data transmission browsing, file sharing and transfer, data deletion, image preview and other functions, which can be used as a drawing bed Image storage can also be used as cloud disk for object storage, which is convenient for users to digitize image data management.</p>
<p><strong>Key</strong> <strong>words:</strong> Cloud Storage, Distributed File System, Nginx, MySQL, C + +, QT</p>
<p>目 录</p>
<p><a href="#_Toc2488">摘 要    I</a></p>
<p><a href="#_Toc13379">ABSTRACT    II</a></p>
<p><a href="#_Toc24459">1 绪论    1</a></p>
<p><a href="#_Toc16618">1.1 课题背景    1</a></p>
<p><a href="#_Toc1878">1.2 发展趋势    1</a></p>
<p><a href="#_Toc30693">1.3 项目意义    2</a></p>
<p><a href="#_Toc4211">2 需求分析    4</a></p>
<p><a href="#_Toc9992">2.1 功能需求分析    4</a></p>
<p><a href="#_Toc9660">2.1.1 服务端功能需求分析    4</a></p>
<p><a href="#_Toc30903">2.1.2 客户端功能需求分析    4</a></p>
<p><a href="#_Toc3888">2.2 可行性分析    5</a></p>
<p><a href="#_Toc26488">2.2.1 经济可行性分析    5</a></p>
<p><a href="#_Toc28087">2.2.2 技术可行性分析    5</a></p>
<p><a href="#_Toc18212">2.2.3 运行可行性分析    5</a></p>
<p><a href="#_Toc27154">2.2.4 操作可行性分析    6</a></p>
<p><a href="#_Toc22683">3 技术支持    7</a></p>
<p><a href="#_Toc6199">3.1 FastDFS分布式文件系统    7</a></p>
<p><a href="#_Toc17449">3.2 Nginx服务器反向代理与负载均衡    8</a></p>
<p><a href="#_Toc6830">3.3 Qt客户端GUI界面设计    10</a></p>
<p><a href="#_Toc30717">4 设计方案    12</a></p>
<p><a href="#_Toc11686">4.1 设计原理    12</a></p>
<p><a href="#_Toc4956">4.2 总体设计方案    12</a></p>
<p><a href="#_Toc16343">4.2.1 客户端设计方案    13</a></p>
<p><a href="#_Toc3197">4.2.2 服务端设计方案    14</a></p>
<p><a href="#_Toc12152">4.3 功能模块方案    14</a></p>
<p><a href="#_Toc28206">4.3.1 用户注册与登录    14</a></p>
<p><a href="#_Toc13258">4.3.2 文件列表查询    16</a></p>
<p><a href="#_Toc13231">4.3.3 数据上传与秒传    16</a></p>
<p><a href="#_Toc4">4.3.4 文件删除    18</a></p>
<p><a href="#_Toc15469">4.3.5 文件共享与共享列表查询    19</a></p>
<p><a href="#_Toc21161">4.3.6 数据下载    20</a></p>
<p><a href="#_Toc24190">4.3.7 图像预览    21</a></p>
<p><a href="#_Toc31890">4.4 流程关系    22</a></p>
<p><a href="#_Toc5645">4.4.1 客户端流程    22</a></p>
<p><a href="#_Toc1323">4.4.2 服务端流程    23</a></p>
<p><a href="#_Toc278">5 具体实现    25</a></p>
<p><a href="#_Toc32181">5.1 服务端架构实现    25</a></p>
<p><a href="#_Toc4647">5.1.1 负载均衡    25</a></p>
<p><a href="#_Toc25489">5.1.2 数据库设计    25</a></p>
<p><a href="#_Toc1570">5.1.3 文件对象存储    28</a></p>
<p><a href="#_Toc8402">5.2 客户端架构实现    29</a></p>
<p><a href="#_Toc20029">5.2.1 用户界面设计    29</a></p>
<p><a href="#_Toc19068">5.2.2 文件界面设计    31</a></p>
<p><a href="#_Toc4461">5.2.3 基础功能模块    35</a></p>
<p><a href="#_Toc28158">5.3 功能模块实现    38</a></p>
<p><a href="#_Toc22221">5.3.1 数据封装与提取    38</a></p>
<p><a href="#_Toc10445">5.3.2 用户登录与注册    39</a></p>
<p><a href="#_Toc13752">5.3.3 数据上传模块（上传、秒传）    40</a></p>
<p><a href="#_Toc19878">5.3.4 文件查询模块（文件列表、共享列表、下载榜）    41</a></p>
<p><a href="#_Toc13182">5.3.5 文件处理模块（删除、共享、转存）    42</a></p>
<p><a href="#_Toc31739">5.3.6 数据下载模块    43</a></p>
<p><a href="#_Toc27560">5.3.7 图像预览模块    43</a></p>
<p><a href="#_Toc23461">6 测试    46</a></p>
<p><a href="#_Toc16209">6.1 程序调试    46</a></p>
<p><a href="#_Toc26451">6.2 工具测试    46</a></p>
<p><a href="#_Toc27750">6.2.1 测试的目的和意义    46</a></p>
<p><a href="#_Toc17235">6.2.2 测试框架    46</a></p>
<p><a href="#_Toc19357">6.2.3 测试步骤    46</a></p>
<p><a href="#_Toc11694">6.3 测试用例设计    47</a></p>
<p><a href="#_Toc6990">6.4 测试数据及结果    48</a></p>
<p><a href="#_Toc9634">6.4.1 功能测试数据及结果    48</a></p>
<p><a href="#_Toc25635">6.4.2 性能测试结果    52</a></p>
<p><a href="#_Toc11899">7 总结    53</a></p>
<p><a href="#_Toc14779">致 谢    54</a></p>
<p><a href="#_Toc10261">参 考 文 献    55</a></p>
<p><a href="#_Toc32742">附 录    57</a></p>
<h1 id="1-绪论"><a href="#1-绪论" class="headerlink" title="1 绪论"></a>1 绪论</h1><h2 id="1-1-课题背景"><a href="#1-1-课题背景" class="headerlink" title="1.1 课题背景"></a>1.1 课题背景</h2><p>由于大数据与云计算技术的普及，互联网已经与人们的生活越来越密切，人们无时无刻不产生着各种数据。同时伴随着直播、短视频、电子相册、数字影院等流媒体的发展，图像数据处理需求正急速增长，传统的物理存储由于共享性差、数据处理缓慢、不易于迁移与恢复等缺点，已渐渐不适用于业务发展需求。而随着云计算的发展，分布式存储的大容量存储、方便移植、快速存储、快速共享、快速备份等各种优点逐渐显现出来，图像存储已渐渐从传统的物理存储方式转变为云存储方式。</p>
<p>基于云存储的图像管理方式是大数据时代数据对象存储的重要方式之一，这种对象存储方式不仅应用于图像管理，更应用于大数据时代影视、文件、用户信息等各种数据存储之上。通过云存储的方式，可对数据随时上传下载，随时分享备份，使数据对象的管理更加方便方便，更加安全。项目尝试采用分布式文件系统对数据对象进行存储，同时采用Nginx服务器实现高并发与负载均衡，对海量用户的请求进行响应，为用户提供可靠、方便的图像管理平台。</p>
<h2 id="1-2-发展趋势"><a href="#1-2-发展趋势" class="headerlink" title="1.2 发展趋势"></a>1.2 发展趋势</h2><p>随着计算机与网络的发展，国内外的图像存储已逐渐实现由传统图像向数字化图像转型。这意味着图像越来越多地以二进制信息保存在计算机中，这样不仅可以长期保存，而且还有方便复制、随意修改、便于传输等优点。而随着大数据与云计算的发展，图像的存储方式逐渐向分布式存储方向发展，使得图像管理的物理存储资源不一定直接连接在本地服务器结点上，而是通过网络与存储结点连接[1]，因此衍生出了分布式文件系统。分布式文件系统即集群文件系统，是指物理存储资源通过网络与结点相连，支持大数量的节点以及PB级的数量存储[2]。因此，分布式文件系统解决了海量图像处理相关的难题。</p>
<p>国内自从2008到2009年间，以华为为代表的一些国内互联网企业开始踏足个人云存储业务，开发出国内第一批网盘产品。2010年以后，出于占领大数据时代入口的目的，国内互联网巨头也纷纷布局云存储业务，腾讯、百度、360、金山、华为等互联网企业也陆续推出了自己的云盘，并开始跑马圈地[3]。这意味着大数据不仅为国内开拓了广阔的市场，也使得国内已逐渐由传统存储向云存储转型[4]。而自从阿里云、腾讯云纷纷崛起，不仅推动了云计算在国内的发展，也在客观上对国内的市场进行了开拓，对云服务提供商们形成了刺激作用。2018年我国数字经济规模达到31.3万亿元，占当年GDP比重达34.8%[5]。</p>
<p>进入5G时代，5G将与AI智能、IoT物联网、Cloud云、Big Data大数据、Edge Cloud边缘云等技术交叉发展，共同构建智能化的基础设施。云已成为新型信息基础设施的重要组成部分，也是面向政企提供数字化服务的主入口，各行各业的数字化发展已经离不开云计算的支撑。中国云市场IaaS、PaaS、SaaS服务模式继续协同发展，市场规模随客户需求的变化而调整[6]。</p>
<p>国外云存储市场2017年为307亿美元，预计到2022年889.1亿美元，CAGR为23.7%[7]。中国云存储市场2017年规模为88.68亿人民币，同比增长71.8%，2018年同比增长率将上升至72.8%[8]，市场规模为158.5亿元人民币。Gartner在2019年的报告中显示：到2024年，40%的企业将实施至少一种混合云存储方式，高于2019年的10%[9]。存储如何更好的服务私有云，成为企业级存储的一个重要课题。除了存储自身的池化、自动化之外，向上提供API，方便私有云管理平台按需驱动存储资源的创建、调整、优化甚至回收，将逐渐成为必备配置。云化对接包含两大块，一是对接开源的云管理平台；二是对接商业的云管理平台，首当其冲的是能够被主流Hypervisor识别，如VMware ESXi、Microsoft Hyper-V[10]。</p>
<h2 id="1-3-项目意义"><a href="#1-3-项目意义" class="headerlink" title="1.3 项目意义"></a>1.3 项目意义</h2><p>如今数据处理需求飞速增长，稍不留神便会跟不上时代发展的步伐。传统的数据管理技术已逐渐不能满足互联网应用所提出的对大数据管理的要求。如何高效地存储和管理海量图像数据，已然成为当今时代的热门探讨话题。</p>
<p>而云存储、云服务、虚拟化等IT热词的不断盛行，已标志着云计算正引领着时代发展的趋势。相较于传统的物理存储，基于云存储的图像管理方式不仅解决了物理硬件易损坏、数据易丢失的问题，而且存储容量可弹性扩展，这意味着基于云存储的图像管理方式不仅扩容方便，而且在存储更新或者服务升级的过程中并不会引起服务中断，造成不必要的损失。</p>
<p>本着开源精神，借鉴传统数据存储与管理的方式，针对大数据与云计算的特点，设计了一套基于云存储的图像管理平台，方便管理图像数据。该平台采用分布式文件系统、缓存数据库、负载均衡等技术，具备弹性伸缩、弹性扩容、高并发等特点，支持海量图像数据的存储与管理。实践证明，该平台具备可行性，可满足空间信息服务的多种需求。</p>
<p>平台设计使用的服务器是基于FastDFS分布式文件系统以及Nginx服务器作为反向代理的Linux服务器，编程语言使用C++语言，图像存储于FastDFS中，数据信息存储于持久性数据库MySQL，Redis作为辅助提高访问效率。客户端使用Qt作为开发工具设计该平台。该平台客户端界面美观方便，功能齐全。数据采用Md5加密算法与Base64数据处理技术，保证数据传输的安全性[11]。该平台是一个简单实用的图像管理平台，具有以下功能：</p>
<p>用户注册与登录，文件的上传与下载，查询与删除，共享与转存。同时针对图像文件具备预览功能。</p>
<p>该平台重在为用户提供一套完整的图像管理与存储服务，解决常规物理存储所带来的数据易丢失难恢复、下载存储不方便、存储空间有限、需随身携带等问题，同时解决普通存储网盘用户并发量低下、数据共享性差等问题。</p>
<h1 id="2-需求分析"><a href="#2-需求分析" class="headerlink" title="2  需求分析"></a>2  需求分析</h1><h2 id="2-1-功能需求分析"><a href="#2-1-功能需求分析" class="headerlink" title="2.1 功能需求分析"></a>2.1 功能需求分析</h2><h3 id="2-1-1-服务端功能需求分析"><a href="#2-1-1-服务端功能需求分析" class="headerlink" title="2.1.1 服务端功能需求分析"></a>2.1.1 服务端功能需求分析</h3><p>传统的云存储方式将数据直接集中存储于某一台或多台服务器或者硬盘上，这样虽然方便服务端的查询，但是一旦服务器或硬盘损坏，便会造成数据丢失且无法恢复。而且由于数据无法直接共享，导致资源的浪费。如今随着时代的发展，无论软件还是硬件的更新速度越来越快，传统的存储方式由于更新麻烦，数据迁移或备份困难，因此已渐渐被分布式存储所替代。因此，对于服务端，应该满足以下需求：</p>
<p>(1) 功能需求</p>
<p>(a) 为用户提供云存储服务。</p>
<p>(b) 满足用户完备的图像管理功能需求。</p>
<p>(c) 对于用户的数据管理应具备快速响应。</p>
<p>(d) 针对多人访问服务器的情况应具备负载均衡的能力。</p>
<p>(e) 数据应具备快速备份与易迁移的特性，保证用户数据不会因服务器问题而丢失。</p>
<p>(2) 性能需求</p>
<p>(a) 多人同时访问服务器应具备高并发性。</p>
<p>(b) 并发不会带来内存泄露等安全问题。</p>
<p>(c) 对于高频数据访问应快速响应，而低频数据应不过多占用内存资源。</p>
<p>(d) 对于用户的信息例如密码等敏感信息应保证安全性。</p>
<p>(e) 程序执行流程合理，代码思路清晰，不会造成逻辑上的问题。</p>
<p>(3) 可靠、可用性需求</p>
<p>(a) 针对各类错误应有相应的提示或解决方案。</p>
<p>(b) 对于失败操作需要有一套完整的错误码进行失败原因提示与排查。</p>
<h3 id="2-1-2-客户端功能需求分析"><a href="#2-1-2-客户端功能需求分析" class="headerlink" title="2.1.2 客户端功能需求分析"></a>2.1.2 客户端功能需求分析</h3><p>客户端作为用户一系列操作的载体，对用户的使用体验起着最直接的决定作用。因此，客户端不仅需要具备齐全的功能服务，还需具备美观、操作简单、处理流畅等特性，这样才能避免用户的流失。因此，将客户端独立出来进行需求分析。以下从业务需求与性能需求两部分进行分析：</p>
<p>(1) 业务需求</p>
<p>(a) 为用户提供用户身份的载体，因此需包含用户登录与注册界面。</p>
<p>(b) 作为平台的核心，需具备上传图像与下载图像的功能按钮。</p>
<p>(c) 方便数据的交互，因此需具备共享文件的浏览界面。</p>
<p>(d) 提高用户数据获取的速度，为用户提供数据下载量的界面。</p>
<p>(e) 为节约用户空间，需为用户提供图像预览的功能。</p>
<p>(f) 为节约加载速度，可增加缓存机制。</p>
<p>(2) 性能需求</p>
<p>(a) 界面简约又不失美观。</p>
<p>(b) 任何操作不造成客户端界面交互无响应。</p>
<p>(c) 在数据交互的过程中需保证数据的安全性。</p>
<p>(d) 及时对服务端响应异常的情况进行处理。</p>
<h2 id="2-2-可行性分析"><a href="#2-2-可行性分析" class="headerlink" title="2.2 可行性分析"></a>2.2 可行性分析</h2><h3 id="2-2-1-经济可行性分析"><a href="#2-2-1-经济可行性分析" class="headerlink" title="2.2.1 经济可行性分析"></a>2.2.1 经济可行性分析</h3><p>对于该平台软件所需要的一系列相关资料均可以通过互联网和文献材料进行获取采集，由于开源软件的盛行，对于软件所依赖的各种库均可从GitHub网站获取。而国内云计算的发展，无论操作系统还是硬件设备均可从国内云计算公司获取，无需特殊的工具，且开发成本较低，软件程序简单易实现，从经济的角度来看，对于该平台软件的开发经济方面可行。</p>
<h3 id="2-2-2-技术可行性分析"><a href="#2-2-2-技术可行性分析" class="headerlink" title="2.2.2 技术可行性分析"></a>2.2.2 技术可行性分析</h3><p>由于开源软件的盛行，目前主流的分布式文件系统均具备备份与数据迁移功能，同时也能保证数据的安全性。而针对高并发问题，目前Nginx服务器可通过反向代理实现负载均衡，解决了高并发的问题[12]。而随着非关系型数据库的发展，针对高频访问的数据可直接存入非关系型数据库中，这样便显著提高了访问效率。对于客户端与服务端数据如何进行交互，这已经在互联网正式普及之时便已解决，而作为主流可靠的传输方式，HTTP协议已经成为TCP传输的典范。因此，从技术角度来看，通过HTTP协议将客户端数据传输服务端，服务端通过Nginx服务器进行反向代理，监听网络，通过CGI程序将接收到的数据加以处理，数据存储于FastDFS中，信息存储于MySQL，同时Redis加以辅助[13]，这种设计方式是可行的。</p>
<h3 id="2-2-3-运行可行性分析"><a href="#2-2-3-运行可行性分析" class="headerlink" title="2.2.3 运行可行性分析"></a>2.2.3 运行可行性分析</h3><p>运行性是对组织结构最直观的影响，它决定着用户的体验感。主要体现在客户端美观与流畅上。而该平台的设计界面通过Qt设计，简约而不失美观，操作十分简单，功能齐全，由于Qt各种动态库获取方便，因此只需要有相应的动态库文件，在Windows操作系统上安装便可运行。</p>
<h3 id="2-2-4-操作可行性分析"><a href="#2-2-4-操作可行性分析" class="headerlink" title="2.2.4 操作可行性分析"></a>2.2.4 操作可行性分析</h3><p>软件的设计开发分为客户端与服务端两部分，客户端主要所采用的工具是Qt 5.4.1，开发出的应用程序客户端在Windows操作系统的计算机上运行，分为用户界面与文件界面两部分，以UI界面窗口的方式呈现给用户，接收鼠标和键盘的输入，以显示器作为载体输出，符合新时代计算机操作系统用户的使用习惯，方便用户对图像数据进行存储和管理，包括用户的登录、注册以及图像的上传、下载、共享、预览、转存、秒传、删除等一系列操作，简单而且容易上手。而服务端作为用户数据的载体，必须保证数据的安全性与可靠性，因此服务端的操作均由服务端代码进行处理，不直接授予用户权限。所以此软件在操作上是可行的。</p>
<p>综上所述，该平台软件的开发与设计从经济、技术、运行、操作等各个方面完全可行。</p>
<h1 id="3-技术支持"><a href="#3-技术支持" class="headerlink" title="3  技术支持"></a>3  技术支持</h1><h2 id="3-1-FastDFS分布式文件系统"><a href="#3-1-FastDFS分布式文件系统" class="headerlink" title="3.1 FastDFS分布式文件系统"></a>3.1 FastDFS分布式文件系统</h2><p>传统的网络存储系统通过集中的存储方式将全部数据存放到服务器上[14]，因此服务器的性能成为数据安全性与可靠性的关键。而针对以数据为根本的大数据时代，显然传统的网络存储方式已不能满足时代的要求。因此，衍生出了分布式文件系统。</p>
<p>分布式文件系统可以简单理解为将对象数据离散地分布存储到许多台独立的存储设备上。分布式文件系统存储方式采用弹性扩展的结构，通过多态弹性服务器来分担数据存储的负荷，通过追踪器服务器来定位存储的结点，这种方式不仅提高了系统的执行效率，而且由于其本身易于扩展的特性，显著提高了系统的实用性与可靠性。</p>
<p>FastDFS分布式文件系统是一款轻量级开源项目，由C语言实现，支持Uinx、Linux等操作系统，为互联网应用开发定制。可用于管理不局限于图像的各种数据，包括对象存储、数据同步、上传、下载、删除等一系列操作[15]，解决了大空间存储和负载均衡等问题，追求高性能和弹性扩展。</p>
<p>FastDFS分布式文件系统分为三部分：追踪器Tracker，存储结点Storage，客户端Client。客户端Client和存储结点Storage请求连接追踪器Tracker，Storage主动向Tracker报告空闲存储空间、数据同步状况、上传下载次数等信息。每次启动时存储结点会启动单线程实现对追踪器的连接与汇报信息。FastDFS可划分多个组，每组所包含的存储结点由追踪器获取。整体架构如下图：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps4.png" alt="img"></p>
<p>图3-1 FastDFS分布式文件系统结构</p>
<p>FastDFS集群可分为追踪器集群与存储结点集群，追踪器集群之间是平等的关系，不存在单点故障的情况，Client访问追踪器通过轮回的方式请求。存储结点集群通过分组的方式集群，存储容量为每个存储结点容量之和[16]。</p>
<p>FastDFS集群的扩容分为横向扩容与纵向扩容，横向扩容可通过添加组的方式进行空间扩充，而纵向扩容用来实现备份，一组内的最大容量为当前组内存储结点中空间最小的服务器容量。集群整体结构如下：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps5.png" alt="img"></p>
<p>图3-2 FastDFS分布式文件系统集群</p>
<h2 id="3-2-Nginx服务器反向代理与负载均衡"><a href="#3-2-Nginx服务器反向代理与负载均衡" class="headerlink" title="3.2 Nginx服务器反向代理与负载均衡"></a>3.2 Nginx服务器反向代理与负载均衡</h2><p>Nginx是一款轻量级的Web 服务器/反向代理服务器及电子邮件代理服务器，采用C进行编写。不仅可以作为HTTP服务器相应Web请求，同时还可以作为反向代理服务器。其特点是占有内存少，并发能力强。Nginx 既可以直接支持Rails和PHP程序，也可以支持作为HTTP代理服务对外服务[17]。</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps6.png" alt="img"></p>
<p>图3-3 反向代理服务器原理</p>
<p>Nginx三个核心功能是静态服务器、反向代理和负载均衡[18]。这三个功能通过配置文件来实现，所有配置选项代码大致分为以下几部分：</p>
<p>main                                # 全局配置</p>
<p>events {                            # Nginx工作模式配置</p>
<p>}</p>
<p>HTTP {                                # HTTP设置</p>
<p>​    ….</p>
<p>​    server {                        # 服务器主机配置</p>
<p>​        ….</p>
<p>​        location {                    # 路由配置</p>
<p>​            ….</p>
<p>​        }</p>
<p>​        location path {</p>
<p>​            ….</p>
<p>​        }</p>
<p>​        location otherpath {</p>
<p>​            ….</p>
<p>​        }</p>
<p>​    }</p>
<p>​    server {</p>
<p>​        ….</p>
<p>​        location {</p>
<p>​            ….</p>
<p>​        }</p>
<p>​    }</p>
<p>​    upstream name {                    # 负载均衡配置</p>
<p>​        ….</p>
<p>​    }</p>
<p>}</p>
<p>如上述配置文件所示，主要由6个部分组成：</p>
<p>(a) main：用于全局信息的配置。</p>
<p>(b) events：用于Nginx工作模式的配置。</p>
<p>(c) HTTP：用于进行HTTP协议信息的一些配置。</p>
<p>(d) server：用于进行服务器访问信息的配置。</p>
<p>(e) location：用于进行访问路由的配置。</p>
<p>(f) upstream：用于进行负载均衡的配置。</p>
<p>upstream模块主要负责负载均衡的配置[19]。简单的配置方式如下：</p>
<p>upstream name {</p>
<p>​    ip_hash;</p>
<p>​    server 192.168.1.100:8000;</p>
<p>​    server 192.168.1.100:8001 down;</p>
<p>​    server 192.168.1.100:8002 max_fails=3;</p>
<p>​    server 192.168.1.100:8003 fail_timeout=20s;</p>
<p>​    server 192.168.1.100:8004 max_fails=3 fail_timeout=20s;</p>
<p>}</p>
<p>核心配置信息如下：</p>
<p>(a) ip_hash：指定请求调度算法。</p>
<p>(b) server host:port：分发服务器的列表配置。</p>
<p>(c) down：表示该主机暂停服务。</p>
<p>(d) max_fails：表示失败最大次数，超过失败最大次数暂停服务。</p>
<p>(e) fail_timeout：表示请求失败，指定的时间后重新请求。</p>
<h2 id="3-3-Qt客户端GUI界面设计"><a href="#3-3-Qt客户端GUI界面设计" class="headerlink" title="3.3 Qt客户端GUI界面设计"></a>3.3 Qt客户端GUI界面设计</h2><p>Qt作为一款开源的跨平台图形界面开发框架，既可以对GUI进行设计，同时由于其是基于C++的面向对象的框架，因此同样可以作为C++编译软件编写程序。Qt类库中的类大致分为两种类型：一种是独立的不从任何类集成的类；另一种直接继承自Qt类。</p>
<p>独立的类通常在Qt类库中用来实现独立的功能。继承自Qt的类主要分为QEvent类和QObject类。QEvent类是所有QT事件响应类的基类，QObject类是所有应用组件的基类[20]。</p>
<p>QWidget类是组件容器，所有能结合在一起的组件均继承自从该类。而QWidget类则继承自QObject基类[21]。</p>
<p>信号和槽是Qt引进的一种处理机制，信号可以被理解为一个对象发出的事件请求，槽是处理信号的函数。</p>
<p>信号和槽能完成回调函数的所有功能，并且信号和槽机制是类型安全的，而且还能完成其他许多复杂的功能。</p>
<p>信号和槽可以是单一或者多对多的关系。一个信号可以被连接到多个槽，一个槽也可以响应多个信号，此外，信号之间也可以被连接[22]。</p>
<h1 id="4-设计方案"><a href="#4-设计方案" class="headerlink" title="4  设计方案"></a>4  设计方案</h1><h2 id="4-1-设计原理"><a href="#4-1-设计原理" class="headerlink" title="4.1 设计原理"></a>4.1 设计原理</h2><p>该项目的设计采用C/S结构，即客户端/服务端模式。首先，客户端响应用户的请求，将用户的请求封装成Json格式，然后通过HTTP协议发送给服务端。对于密码等敏感信息可通过Md5加密后封装成Json格式发送[23]。在整个数据交互的过程中，客户端始终保证用户操作的合理性。</p>
<p>服务端通过指定端口接收到数据后，首先由Nginx服务器进行反向代理，将数据转发给Nginx配置文件中记录的Web服务器IP。Web服务器接收到数据后根据当前数据HTTP请求头的类型将不同类型数据，通过配置文件中对应的端口转发给服务器相应的CGI程序进行处理，端口对应的CGI程序首先对数据进行拆解，获取数据具体的请求，然后进行处理，并将处理结果转发给客户端。</p>
<p>对于数据对象本身，CGI程序通过分布式文件系统追踪器对存储结点的数据进行操作，对于信息类数据，CGI程序则将对持久性数据库MySQL进行一系列操作，同时缓存数据库Redis加以辅助提高效率。</p>
<p>整体结构如下：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps7.png" alt="img"></p>
<p>图4-1 总体设计框架</p>
<h2 id="4-2-总体设计方案"><a href="#4-2-总体设计方案" class="headerlink" title="4.2 总体设计方案"></a>4.2 总体设计方案</h2><p>该平台总体包括客户端与服务端两部分。二者之间数据以Json格式通过HTTP协议进行交互。同时对于特殊数据例如密码需进行Md5加密，然后封装Json格式传输。</p>
<p>客户端主要分为界面设计与功能模块两部分。界面设计分为用户界面和文件界面，其中用户界面包括登录界面、注册界面、设置界面；文件界面包括我的文件、共享文件、下载榜、传输列表。功能模块包括基础功能模块与特殊功能模块，其中基础功能统一封装在一个基础功能类中，用于实现包括数据封装与解析、HTTP传输、读取配置文件、加密等功能；特殊功能模块作为工具类，包括实现上传下载任务与进度、图像预览等功能。</p>
<p>服务端主要包括服务端框架搭建与功能模块两部分。服务端框架包括Nginx与负载均衡、MySQL数据库与Redis缓存数据库、分布式文件系统的搭建。功能模块用于实现包括用户注册与登录、文件上传与秒传、文件列表查询、文件共享与转存、文件删除、文件下载等功能[24]。</p>
<p>具体整体设计方案如下图：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps8.png" alt="img"></p>
<p>图4-2 总体方案结构</p>
<h3 id="4-2-1-客户端设计方案"><a href="#4-2-1-客户端设计方案" class="headerlink" title="4.2.1 客户端设计方案"></a>4.2.1 客户端设计方案</h3><p>由于客户端是用户直接进行数据交互的载体，因此客户端在达到美观简洁的同时需要有平台完整的功能。根据平台的需求，客户端采用Qt编译器进行客户端代码的编写与界面的设计。作为图像文件管理平台，需要为用户提供文件界面供用户进行管理操作；同时为方便用户信息的验证，客户端还需用户界面获取用户的信息。因此客户端包括用户界面与文件界面。</p>
<p>用户界面通过一个主QWidget，包含三个子QWidget，分别作为登录、注册、设置三个子界面，通过不同的按钮切换不同的子界面。登录注册用于用户的身份校验，设置用于设置代理服务器服务器的端口号和IP用于数据交互。</p>
<p>通过登录界面信息校验成功后会关闭用户界面，同时打开文件界面。文件界面包括头部和信息部两部分组成，头部包含多个文件功能切换按钮，信息部界面主要用于对文件信息的展示，因此在设计上，头部作为公共部分只需一个QWidget派生类，而信息部分展示界面通过不同的QWidget派生类与头部拼接成不同的文件界面。</p>
<h3 id="4-2-2-服务端设计方案"><a href="#4-2-2-服务端设计方案" class="headerlink" title="4.2.2 服务端设计方案"></a>4.2.2 服务端设计方案</h3><p>对于服务端，需要保障数据的高并发与流畅性，因此通过一个Nginx服务器配置使得客户端直接连接的服务器具备反向代理与负载均衡的功能。由于Nginx服务器不能直接处理动态数据，因此Web服务器需要借助CGI程序来处理动态响应。处理不同事件的CGI程序绑定Web服务器不同的端口，通过HTTP协议请求头来确定对应端口，供CGI程序处理。对于数据本身，CGI程序通过分布式文件系统提供的API对分布式文件系统进行操作。同时对于信息类数据存于MySQL，将访问量大的数据插入非关系型数据库，以便下次查找直接从非关系型数据库中提取数据。</p>
<p>对于分布式文件系统采用FastDFS，需要配置追踪器与存储节点，使得服务器构建成一个集群。同时对于每一台存储节点服务器，通过Storage与Nginx绑定，使得存储于存储节点服务器的数据可通过Url的方式直接访问，而不需重新下载。这样只需将文件对应的Url存储于数据库中，下载或者访问时直接通过访问数据库中的Url即可，不需再从存储节点中下载后发送给客户端，显著地提高了下载与访问效率。</p>
<p>对于数据库采用MySQL进行数据库设计以及增删改查，根据需求需建五张表，用户表用于用户登录的确认，文件表作为文件信息的保存，共享文件表用于共享文件信息的获取，用户文件表用于用户文件信息的获取，用户文件数量表用于辅助用户访问文件界面时文件的展示，同时为扩展功能提供预留空位。</p>
<p>缓存数据库通过Redis对访问频繁的数据进行存储。每次获取信息先查询Redis，如果没有需要的信息则访问MySQL，同时将查询数据存入Redis，提高数据获取效率。</p>
<h2 id="4-3-功能模块方案"><a href="#4-3-功能模块方案" class="headerlink" title="4.3 功能模块方案"></a>4.3 功能模块方案</h2><h3 id="4-3-1-用户注册与登录"><a href="#4-3-1-用户注册与登录" class="headerlink" title="4.3.1 用户注册与登录"></a>4.3.1 用户注册与登录</h3><p>对于用户模块可按功能具体划分为注册模块与登录模块。二者客户端为通过继承用户界面而派生的两个子界面。服务端主要对数据库进行操作。</p>
<p>注册的客户端逻辑为：用户通过进入注册界面的填写注册信息，客户端代码获取数据后进行逻辑判断，如果用户名或昵称不符合格式要求，则向客户端反馈用户名或昵称格式不符合要求的消息；如果密码不符合格式要求或两次输入密码不一致，则向客户端反馈密码相关操作失败的消息；如果电话或者邮箱不符合规范，则向客户端反馈电话或者邮箱格式不规范的消息。如果用户填写的注册信息均通过客户端校验格式的代码验证，则首先用Md5对密码加密，然后封装成Json格式以HTTP协议发送给服务端。如果服务端长时间未响应则反馈注册失败信息。Web服务端通过请求头为reg交给相应端口的CGI程序。服务端CGI程序的逻辑为：首先将Json数据提取出来，然后查询数据库用户表与通过Json解析的用户名进行比对，如果用户表存在该用户名，则反馈用户名重复的状态码，否则将该注册用户信息插入用户表中，反馈注册成功的状态码。客户端接收到状态码后，通过比对，如果不为成功状态码则根据状态码类型向用户反馈注册失败的原因，并提示用户重新注册；否则客户端会提示用户注册成功，同时会跳转至用户登录的界面，待用户进行登录操作。</p>
<p>注册流程如下：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps9.png" alt="img"></p>
<p>图4-3 用户注册流程图</p>
<p>登录的客户端逻辑为用户通过登录界面填写用户名与密码，如果选择记住密码则登录成功后会把用户以及用户密码的Md5值保存到缓存配置文件中[25]。用户通过登录界面填写登录信息，点击登录按钮，客户端会通过信号槽将登录信息向服务端发送，Web服务端根据请求头为login交给相应端口的CGI程序。服务端CGI程序的逻辑为首先将Json数据提取出来，然后查询数据库用户表与解析后的用户名与密码进行比对，如果存在该用户名，并且密码Md5值跟数据库中密码存储信息一致则反馈注册成功状态码，否则反馈根据情况反馈登录失败状态码。客户端接收到状态码后，如果不为登录成功状态码则提示用户登录失败，否则客户端跳转至我的文件界面。</p>
<p>登录流程如下：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps10.png" alt="img"></p>
<p>图4-4 用户登录流程图</p>
<h3 id="4-3-2-文件列表查询"><a href="#4-3-2-文件列表查询" class="headerlink" title="4.3.2 文件列表查询"></a>4.3.2 文件列表查询</h3><p>当用户进入文件界面后，客户端需要保存当前用户的所有文件信息，因此会向服务端发起当前用户的文件查询请求。当服务端通过请求头myfile将用户信息交给相应端口的CGI程序。CGI程序逻辑为通过以用户名查询数据库user_file_list表将所有文件信息传给客户端，客户端获取到所有信息后，通过QWigitList将文件信息按图标的形式排列到界面，同时在排列过程中对于文件为图像类型的文件进行判断，如果该图像文件在缓存中有缩略图，则显示缩略图，否则显示默认图片。</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps11.png" alt="img"></p>
<p>图4-5 文件列表查询流程图</p>
<h3 id="4-3-3-数据上传与秒传"><a href="#4-3-3-数据上传与秒传" class="headerlink" title="4.3.3 数据上传与秒传"></a>4.3.3 数据上传与秒传</h3><p>当用户进行上传操作时，首先是采取秒传的方式，将待上传文件的信息通过Md5加密，然后封装好数据后通过HTTP传输，服务端通过Md5请求头交给负责秒传的CGI程序。CGI程序通过文件信息表中Md5值的比较，判断当前文件信息是否存在于数据库中，如果存在则将该文件信息与该用户通过user_file_list表进行关联，否则返回数据库无该文件信息的状态码。客户端接受到状态码后进行判断，成功则不需再进行上传操作，即实现了秒传，否则需要进一步进行上传操作。</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps12.png" alt="img"></p>
<p>图4-6 数据秒传流程图</p>
<p>上传过程需要客户端维护一个上传队列。客户端选择文件路径后，每次对于确定无法秒传需要上传的文件信息假如到上传队列中。上传时每次从队列中提取队首元素进行请求，上传完成时将该任务从队列中移除。该过程客户端会时时跟进上传进度，并且将进度按进度条的形式更新在数据传输列表界面。</p>
<p>开始上传时，客户端获取到该文件后将文件以二进制流的形式进行HTTP传输。服务端通过请求头upload将用户信息与数据交给相应端口的CGI程序。CGI程序逻辑为首先通过数据库file_info表判断该文件是否存在，若存在则判断该用户是否拥有，是则反馈已拥有状态码，负责对user_file_list与user_file_count表进行修改操作。否则会通过fork创建子进程，子进程将数据上传到分布式文件系统，通过fdfs_upload_file的API将提取出的二进制流文件上传到分布式文件系统，同时获取到分布式文件系统反馈的文件id，让id传给父进程。父进程用于处理数据信息，将文件生成后的信息插入到file_info表中，同时将用户与文件但关联信息插入到user_file_list中，同时对user_file_count表进行更新。文件信息处理好后，给用户反馈成功状态码。在父子进程的过程中任意一步出现问题均反馈失败状态码。客户端接收到状态码后，通过状态码比对，如果是成功状态码则向用户反馈上传成功的信息，否则给用户反馈上传失败的信息。</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps13.png" alt="img"></p>
<p>图4-7 数据上传流程图</p>
<h3 id="4-3-4-文件删除"><a href="#4-3-4-文件删除" class="headerlink" title="4.3.4 文件删除"></a>4.3.4 文件删除</h3><p>当用户请求删除操作时，客户端首先需要进行判断用户请求的文件拥有者是否为该用户，如果不是则提示文件不属于该用户的错误信息；否则向服务端发起请求。服务端接收到请求后，通过请求头dealfile或者dealsharefile将用户信息与数据交给相应端口用于文件操作的CGI程序，CGI程序进行处理。CGI程序的逻辑为首先进行数据库查询，首先对user_file_count表进行减一操作，对user_file_list中该用户与该文件的关联进行删除。最后需要通过file_info表的数量属性进行判断，如果大于1，则将该属性减1，否则将该信息从数据库file_info表中删除。同时子进程需通过分布式文件系统提供的fdfs_delete_file相关API对通过该文件Id删除分布式文件系统中该文件的数据。一切成功后向客户端反馈状态码。客户端收到反馈后刷新界面。</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps14.png" alt="img"></p>
<p>图4-8 文件删除流程图</p>
<h3 id="4-3-5-文件共享与共享列表查询"><a href="#4-3-5-文件共享与共享列表查询" class="headerlink" title="4.3.5 文件共享与共享列表查询"></a>4.3.5 文件共享与共享列表查询</h3><p>当用户切换到共享文件界面时，会向服务端发起共享文件列表获取的请求，通过share_file_list表进行共享文件信息的查询，然后将查询到的列表信息发送给客户端。客户端接收到数据后对界面按照图标显示的方式进行刷新。对下载榜界面，服务端会将文件按下载量进行排序，然后发给客户端，客户端通过信息列表的形式进行显示。</p>
<p>当用户发起共享或者取消共享操作后，客户端逻辑首先进行判断用户发起的请求文件是否属于该用户，不是的话反馈错误信息；是的话需要根据该文件信息判断该文件分享状态，如果已是该状态则不需操作，否则会向服务端发起请求。当服务端接收到请求后，通过请求头dealfile或者dealsharefile将用户信息与数据交给相应端口用于文件操作的CGI程序，CGI程序的逻辑为首先提取数据，对数据库share_file_list表进行插入，然后对file_info表等文件相关的表进行更新。最后反馈状态码。</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps15.png" alt="img"></p>
<p>图4-9 文件共享流程图</p>
<h3 id="4-3-6-数据下载"><a href="#4-3-6-数据下载" class="headerlink" title="4.3.6 数据下载"></a>4.3.6 数据下载</h3><p>下载模块首先需保证服务端存储结点Storage与Web处理服务器Nginx相关联，关联后对于存储结点上的数据可直接通过Url进行下载。客户端维护一个下载队列。而下载的流程主要是用户发起下载请求后，客户端会向服务器请求该文件Url信息，收到文件Url后，客户端将下载信息插入下载队列。客户端每次执行队首任务，根据下载信息向相应Url进行Get请求，请求成功后便开始数据下载，同时对于下载进度通过进度条时时更新在数据传输列表界面上。当下载完成时，将该任务从下载队列中移除，然后进行下一个文件下载。</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps16.png" alt="img"></p>
<p>图4-10 文件下载流程图</p>
<h3 id="4-3-7-图像预览"><a href="#4-3-7-图像预览" class="headerlink" title="4.3.7 图像预览"></a>4.3.7 图像预览</h3><p>由于用户进入文件界面后，客户端代码会将当前缓存中的文件数据保存起来，因此当用户点击预览按钮时，首先客户端会判断该文件信息的类型，如果为图像文件方可进行预览操作，否则反馈失败信息。客户端根据当前保存的文件信息进行Url获取，同时通过HTTP协议对该Url进行请求，获取到响应后客户端会通过QLable进行图像的绘制，为用户呈现该图像的完整状态。同时客户端会将该图像文件缓存起来，以便下次再次访问该图像文件时直接对缓存中的数据进行绘制，而不需在向服务器进行请求。</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps17.png" alt="img"></p>
<p>图4-11 图像预览流程图</p>
<h2 id="4-4-流程关系"><a href="#4-4-流程关系" class="headerlink" title="4.4 流程关系"></a>4.4 流程关系</h2><p>本项目的流程并不是很复杂，但是由于涉及到的东西较多，因此整个项目流程的清晰度决定了项目实现的难易。</p>
<h3 id="4-4-1-客户端流程"><a href="#4-4-1-客户端流程" class="headerlink" title="4.4.1 客户端流程"></a>4.4.1 客户端流程</h3><p>客户端流程分为用户界面流程与文件界面流程两部分。用户通过可执行文件首先加载的是用户界面，通过用户界面的设置栏设置反向代理服务器的IP与端口号，客户端程序保存IP与端口号，之后将所有相关数据发送对于发现代理服务器IP。设置完成后，用户可选择性通过注册栏发送注册信息给服务端，收到服务端注册成功的反馈后跳转至登录界面。用户通过登录界面填写用户名及密码，点击登录后，获取服务端的反馈信息，校验成功则跳转文件界面，否则提示登录失败。</p>
<p>进入文件界面后，默认在我的文件界面，客户端会向服务端发送当前用户信息以及获取当前用户拥有文件信息，得到服务端反馈的信息后，客户端代码将其文件信息绘制到UI界面上，同时如果本地缓存中有相应文件的缓存缩略图，则将默认显示图像替换为缩略图图像，实现预览效果。</p>
<p>文件界面默认主界面有上传按钮，点击后可选择指定文件夹下的一个或多个图像文件进行上传操作，然后会切换到文件界面的传输列表界面。文件主界面空白域右键点击事件包括文件重新排序与上传等操作，其中上传操作与点击上传按钮事件一样。文件默认展示文件类型图像，如果该文件为图像文件且缓存中有该文件的缩略图，则以缩略图的方式显示。文件右键点击事件包括下载、共享、预览、删除、属性等点击事件，对应下载、共享、预览、删除、属性操作。</p>
<p>文件界面包含主界面、共享文件界面、下载榜界面、传输列表界面四部分，在UI头部有相应切换事件响应的按钮。</p>
<p>共享文件界面与下载榜界面的流程与主界面的流程相似，唯一不同的是向服务端请求的是共享文件信息而不是用户文件信息。共享文件界面与下载榜界面的不同在于排列方式不同以及文件信息显示方式不同，共享文件界面的排列方式为按共享时间顺序排列，同时以图标的形势显示文件；而下载榜是以文件下载量的方式进行排序，以详细信息的方式进行显示。</p>
<p>传输列表包含上传列表、下载列表、传输记录三部分，对应上传进度、下载进度、上传下载记录三部分的展示。</p>
<p>主界面同时包含切换用户按钮，点击后跳转登录界面。</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps18.png" alt="img"></p>
<p>图4-12 客户端总体流程图</p>
<h3 id="4-4-2-服务端流程"><a href="#4-4-2-服务端流程" class="headerlink" title="4.4.2 服务端流程"></a>4.4.2 服务端流程</h3><p>服务端整体的流程包括数据转发、数据提取、分布式文件系统操作、数据库操作四部分。</p>
<p>首先数据转发部分主要流程是反向代理服务器接收到数据后根据并发权重将数据转发给Web服务器，Web服务器通过配置文件与HTTP请求头信息进行类型解析，根据不同的类型将数据发送给不同的端口所绑定的CGI程序。</p>
<p>数据提取主要为服务端公共代码的任务，将Json数据中的信息提取出来，然后供CGI程序进行响应一系列执行操作。</p>
<p>分布式文件系统通过FastDFS提供的API对数据对象进行上传、下载、删除操作。在此之前需要服务器先搭建好分布式文件系统的集群。由于FastDFS为C语言所写，因此安装后的API直接可以用到服务端C++程序中。</p>
<p>数据库操作主要分为两部分，一部分是通过MySQL进行数据的增删改查，另一部分是对访问量较多的数据储存于Redis[26]。所有程序在对数据库进行操作时，首先会从缓存数据库Redis中查询，如果缓存数据库中已有该数据，则直接获取，否则会从MySQL中进行查询，然后在处理数据的过程中将数据同时插入缓存数据库中。</p>
<p>服务端从功能部分大致分为用户登录与注册、文件上传或删除、文件共享与转存、文件下载与预览几部分。这些功能模块均首先通过数据转发后进行数据提取，然后进行各类型的一系列操作。</p>
<p>用户登录与注册部分主要为数据库操作；文件上传或删除包括分布式文件系统操作与数据库操作两部分；文件的共享与转存操作并未涉及到分布式文件系统操作，主要为数据库操作。</p>
<p>文件下载与预览部分有两种实现方式，第一种也是常规的方式包括分布式文件操作与数据库操作，但这样每次会造成效率的低下，因此通过第三方软件将存储结点Storage与Nginx连接，使得存储结点的数据可直接以Url的方式进行获取，这样只需要进行数据库操作即可，即将Url保存至数据库中，而数据的获取直接通过Url便可下载，而不需经过分布式文件系统追踪器等一系列过程。</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps19.png" alt="img"></p>
<p>图4-13 服务端总体流程图</p>
<h1 id="5-具体实现"><a href="#5-具体实现" class="headerlink" title="5  具体实现"></a>5  具体实现</h1><h2 id="5-1-服务端架构实现"><a href="#5-1-服务端架构实现" class="headerlink" title="5.1 服务端架构实现"></a>5.1 服务端架构实现</h2><h3 id="5-1-1-负载均衡"><a href="#5-1-1-负载均衡" class="headerlink" title="5.1.1 负载均衡"></a>5.1.1 负载均衡</h3><p>Nginx负载均衡是在反向代理的基础上完成的，首先用户通过浏览器或者客户端连接到Nginx反向代理服务器，Nginx通过配置文件中的server模块找到server_name映射的域名，通过proxy_pass+Url找到upstream模块，然后访问server相应的地址。upstream模块中可设置多个IP，同时赋予权重，每次用户访问服务器时，Nginx都会按权重将用户请求分配到upstream模块中对应的IP，这样便实现了负载均衡。</p>
<p>负载均衡通过配置Nginx.conf实现[27]。具体负载均衡部分配置样例如下：</p>
<p>upstream test.com{</p>
<p>server 39.96.209.253:80; #服务器1</p>
<p>server 172.17.49.222:80; #服务器2</p>
<p>}</p>
<p>server{</p>
<p>listen 80;</p>
<p>server_name localhost;</p>
<p>Location /{</p>
<p>proxy_pass HTTP://test.com;</p>
<p>}</p>
<p>}</p>
<h3 id="5-1-2-数据库设计"><a href="#5-1-2-数据库设计" class="headerlink" title="5.1.2 数据库设计"></a>5.1.2 数据库设计</h3><p>数据库主要用于存储用户与文件的信息，数据信息存于MySQL中。数据库表主要分为五张表，具体表结构如下图所示：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps20.jpg" alt="img"> </p>
<p>图5-1 数据库表结构</p>
<p>user表用于储存用户相关信息。当用户注册时将信息插入该表中；当用户登录时通过查询该表进行用户身份校验，校验成功方能进入文件界面对图像进行管理。user表中包含name、nickname、password、phone、createtime、email六个栏位，其中name作为用户名，password作为密码，用于登录时校验，其余作为用户信息储存栏位。</p>
<p>表5-1 user表</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>列名</th>
<th>数据类型</th>
<th>长度</th>
<th>主键</th>
<th>允许空</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>name</td>
<td>varchar</td>
<td>20</td>
<td>是</td>
<td>否</td>
<td>用户id</td>
</tr>
<tr>
<td>2</td>
<td>nickname</td>
<td>varchar</td>
<td>20</td>
<td></td>
<td>是</td>
<td>用户昵称</td>
</tr>
<tr>
<td>3</td>
<td>password</td>
<td>varchar</td>
<td>65</td>
<td></td>
<td>是</td>
<td>用户密码</td>
</tr>
<tr>
<td>4</td>
<td>phone</td>
<td>varchar</td>
<td>12</td>
<td></td>
<td>是</td>
<td>电话</td>
</tr>
<tr>
<td>5</td>
<td>createtime</td>
<td>datetime</td>
<td>0</td>
<td></td>
<td>是</td>
<td>注册时间</td>
</tr>
<tr>
<td>6</td>
<td>email</td>
<td>varchar</td>
<td>30</td>
<td></td>
<td>是</td>
<td>邮箱</td>
</tr>
</tbody>
</table>
<p>file_info表用于储存文件信息。该表包括md5、file_id、url、size、type、count六个栏位。md5作为文件的唯一标识，也可认为是文件的唯一id标识；file_id用于储存文件在分布式文件系统中对应的id即文件名，可通过该id从分布式文件系统中下载文件；url用于储存该文件的获取网址；size用于记录文件的大小；type代表该文件类型；count用于统计有多少用户拥有该文件，主要用于文件删除。</p>
<p>表5-2 file_info表</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>列名</th>
<th>数据类型</th>
<th>长度</th>
<th>主键</th>
<th>允许空</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>md5</td>
<td>varchar</td>
<td>65</td>
<td>是</td>
<td>否</td>
<td>文件id</td>
</tr>
<tr>
<td>2</td>
<td>file_id</td>
<td>varchar</td>
<td>100</td>
<td></td>
<td>是</td>
<td>对象存储id</td>
</tr>
<tr>
<td>3</td>
<td>url</td>
<td>varchar</td>
<td>100</td>
<td></td>
<td>是</td>
<td>文件url</td>
</tr>
<tr>
<td>4</td>
<td>size</td>
<td>bigint</td>
<td>20</td>
<td></td>
<td>是</td>
<td>文件大小</td>
</tr>
<tr>
<td>5</td>
<td>type</td>
<td>varchar</td>
<td>10</td>
<td></td>
<td>是</td>
<td>文件类型</td>
</tr>
<tr>
<td>6</td>
<td>count</td>
<td>int</td>
<td>11</td>
<td></td>
<td>是</td>
<td>拥有者数量</td>
</tr>
</tbody>
</table>
<p>user_file_list作为用户与文件的关系桥梁而存在。表共包含user、md5、createtime、filename、shared_status、pv六栏。user代表用户id；md5代表文件id；createtime代表用户拥有该文件的时间；filename代表用户拥有该文件时的文件名；share_status用于表示该文件的分享状态；pv表示该用户对该文件的下载次数。</p>
<p>表5-3 user_file_list表</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>列名</th>
<th>数据类型</th>
<th>长度</th>
<th>主键</th>
<th>允许空</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>user</td>
<td>varchar</td>
<td>20</td>
<td></td>
<td>否</td>
<td>用户id</td>
</tr>
<tr>
<td>2</td>
<td>md5</td>
<td>varchar</td>
<td>65</td>
<td></td>
<td>否</td>
<td>文件id</td>
</tr>
<tr>
<td>3</td>
<td>createtime</td>
<td>datetime</td>
<td>0</td>
<td></td>
<td>是</td>
<td>关联时间</td>
</tr>
<tr>
<td>4</td>
<td>filename</td>
<td>varchar</td>
<td>100</td>
<td></td>
<td>是</td>
<td>文件名称</td>
</tr>
<tr>
<td>5</td>
<td>shared_status</td>
<td>int</td>
<td>11</td>
<td></td>
<td>是</td>
<td>分享状态</td>
</tr>
<tr>
<td>6</td>
<td>pv</td>
<td>int</td>
<td>11</td>
<td></td>
<td>是</td>
<td>下载量</td>
</tr>
</tbody>
</table>
<p>share_file_list表记录共享文件的信息。包括user、md5、createtime、filename、pv五个栏位。user代表该文件的分享者；md5代表该文件id；createtime代表分享时间；filename代表该文件被分享时的文件名；pv代表该文件全部的下载次数。</p>
<p>表5-4 share_file_list表</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>列名</th>
<th>数据类型</th>
<th>长度</th>
<th>主键</th>
<th>允许空</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>user</td>
<td>varchar</td>
<td>65</td>
<td></td>
<td>否</td>
<td>分享用户id</td>
</tr>
<tr>
<td>2</td>
<td>md5</td>
<td>varchar</td>
<td>65</td>
<td></td>
<td>否</td>
<td>分享文件id</td>
</tr>
<tr>
<td>3</td>
<td>createtime</td>
<td>datetime</td>
<td>0</td>
<td></td>
<td>是</td>
<td>分享时间</td>
</tr>
<tr>
<td>4</td>
<td>filename</td>
<td>varchar</td>
<td>100</td>
<td></td>
<td>是</td>
<td>文件名称</td>
</tr>
<tr>
<td>5</td>
<td>pv</td>
<td>int</td>
<td>11</td>
<td></td>
<td>是</td>
<td>下载量</td>
</tr>
</tbody>
</table>
<p>user_file_count表主要记录用户当前拥有多少个文件。其主要用于文件列表获取前访问，如果文件列表数量庞大，需先访问用户文件数目，再分批访问。该表共user、count两个栏位。user代表用户id；count代表该用户拥有文件数量。</p>
<p>表5-5 user_file_count表</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>列名</th>
<th>数据类型</th>
<th>长度</th>
<th>主键</th>
<th>允许空</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>user</td>
<td>varchar</td>
<td>20</td>
<td>是</td>
<td>否</td>
<td>用户id</td>
</tr>
<tr>
<td>2</td>
<td>count</td>
<td>int</td>
<td>11</td>
<td></td>
<td>是</td>
<td>用户文件数</td>
</tr>
</tbody>
</table>
<h3 id="5-1-3-文件对象存储"><a href="#5-1-3-文件对象存储" class="headerlink" title="5.1.3 文件对象存储"></a>5.1.3 文件对象存储</h3><p>数据对象本身存储与分布式文件系统中。在服务器上安装好FastDFS分布式文件系统后，需要修改配置文件。由于FastDFS分布式文件系统包括追踪器、存储节点、客户端三部分，因此需要修改tracker.conf、storage.conf、client.conf三个配置文件。</p>
<p>先配置Tracker，再添加一个Storage，每添加添加一个Storage，实际上是Storage连接Tracker，Tracker必须存在，否则Storage无法加进来，Client主要用于测试上传、下载文件。</p>
<p>假如有3台以上的服务器或者虚拟机，一台用来作为Tracker、一台用来作为Client、其他多台用来作为Storage，不过前提需要保证这些服务器之间的网络均可以互相PING通。如果并没有足够多的设备，一台服务器可以同时作为Tracker、Storage、Client使用。</p>
<p>首先是tracker.conf的配置，追踪器服务器需要修改，其他服务器可以不用配置。bind_addr需要修改为追踪器服务器所在的IP，port修改为绑定的端口， base_path为日志目录，配置样例如下：</p>
<p>bind_addr=39.96.209.253</p>
<p>port=22122</p>
<p>base_path=/home/fastdfs/tracker</p>
<p>作为存储节点的服务器需要修改storage.conf，主要修改以下部分。group_name表示存储节点所属的组；bind_addr表示存储节点绑定的IP；port为存储节点绑定的端口；base_path表示存储日志目录；store_path_count配置存储目录的个数；store_path0配置具体的存储目录；tracker_server用于配置连接Tracker的时候使用的IP和端口；配置样例如下：</p>
<p>group_name=group1 </p>
<p>bind_addr=39.96.209.253</p>
<p>port=23000 </p>
<p>base_path=/home/fastdfs/storage  </p>
<p>store_path_count=1 </p>
<p>store_path0=/home/fastdfs/storage</p>
<p>tracker_server=39.96.209.253:22122</p>
<p>客户端服务器主要通过API请求上传、下载等操作。因此所有用于响应用户请求的HTTP服务器均需对文件client.conf进行配置。主要需要修改两部分：base_path配置日志目录；tracker_server配置连接Tracker服务器时使用的IP和端口。Client配置样例如下：</p>
<p>base_path=/home/fastdfs/client </p>
<p>tracker_server=39.96.209.253:22122</p>
<p>配置文件配置完成后，所有响应请求的HTTP服务器通过Client调用API向Tracker请求上传、下载等操作[28]。对于常用的API，可通过源码的方式获取。文件上传调用fdfs_upload_file，下载调用fdfs_download_file，删除调用fdfs_delete_file[29]。因此对于数据上传、下载或删除请求，我们可以通过加载fdfs_upload_file.c，fdfs_download_file.c，fdfs_delete_file.c获取对应操作的API。</p>
<h2 id="5-2-客户端架构实现"><a href="#5-2-客户端架构实现" class="headerlink" title="5.2 客户端架构实现"></a>5.2 客户端架构实现</h2><h3 id="5-2-1-用户界面设计"><a href="#5-2-1-用户界面设计" class="headerlink" title="5.2.1 用户界面设计"></a>5.2.1 用户界面设计</h3><p>客户端界面分为两部分，用户界面与文件界面。其中用户界面为一个主界面包含注册、登录、设置三个子界面。而文件界面由按钮栏和文件列表栏两部分拼凑而成，文件列表栏作为父类有我的文件界面、共享列表界面、下载榜列表界面和传输列表界面四个派生类，通过按钮栏的点击事件通过信号槽触发回调函数，创建不同的文件列表栏派生类。</p>
<p>用户界面由一个主界面Login类构成，该类由信息栏title_widget与表单栏stackedWidget两部分组成。信息栏主要用于图标、标题等固定信息的展示；表单栏包含三个QWidget子界面login_page、register_page与set_page，分别用于登录、注册与设置。具体结构如下图：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps21.png" alt="img"></p>
<p>图 5-2 用户界面结构</p>
<p>当触发切换界面按钮事件时，通过信号槽触发回调函数，通过回调函数调用setCurrentWidget(…)方法根据传参子界面参数进行不同界面的切换。用户界面类的声明如下：</p>
<p>class Login : public QDialog{</p>
<p>​    Q_OBJECT</p>
<p>public:</p>
<p>​    explicit Login(QWidget *parent = 0);</p>
<p>​    ~Login();</p>
<p>​    // 设置登陆用户信息的Json包</p>
<p>​    QByteArray setLoginJson(QString user, QString pwd);</p>
<p>​    // 设置注册用户信息的Json包</p>
<p>​    QByteArray setRegisterJson(QString userName, QString nickName, QString firstPwd, QString phone, QString email);</p>
<p>​    // 得到服务器回复的登陆状态， 状态码返回值为 “000”, 或 “001”，还有登陆section</p>
<p>​    QStringList getLoginStatus(QByteArray json);</p>
<p>protected:</p>
<p>​    void paintEvent(QPaintEvent *);</p>
<p>private slots:</p>
<p>​    void on_register_btn_clicked();</p>
<p>​    void on_login_btn_clicked();</p>
<p>​    void on_set_ok_btn_clicked();</p>
<p>private:</p>
<p>​    // 读取配置信息，设置默认登录状态，默认设置信息</p>
<p>​    void readCfg();</p>
<p>private:</p>
<p>​    Ui::Login *ui;</p>
<p>​    // 处理网络请求类对象</p>
<p>​    QNetworkAccessManager* m_manager;</p>
<p>​    // 主窗口指针</p>
<p>​    MainWindow* m_mainWin;</p>
<p>​    Common m_cm;</p>
<p>};</p>
<p>其登录主界面效果展示如下：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps22.jpg" alt="img"> </p>
<p>图5-3 登录界面效果图</p>
<p>用户进入登录界面后，通过点击注册，进入注册界面，点击关闭会返回登录界面。其注册界面效果展示如下：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps23.jpg" alt="img"> </p>
<p>图5-4 注册界面效果图</p>
<h3 id="5-2-2-文件界面设计"><a href="#5-2-2-文件界面设计" class="headerlink" title="5.2.2 文件界面设计"></a>5.2.2 文件界面设计</h3><p>文件界面作为文件基础界面，在用户点击登录按钮后启动。文件界面分为导航栏ButtonGroup类与文件列表界面MainWindow类两部分组成。结构如下：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps24.png" alt="img"></p>
<p>图5-5 文件界面结构</p>
<p>文件列表界面MainWindow中包含ButtonGroup指针，在启动界面时会通过指针先加载导航栏ButtonGroup类。导航栏由我的文件、共享列表、下载榜、传输列表、切换用户5个界面切换按钮以及关闭之类的基础按钮组成，通过信号槽分别对应不同回调函数。其回调函数声明在signals中。ButtonGroup类声明代码声明如下：</p>
<p>class ButtonGroup : public QWidget{</p>
<p>​    Q_OBJECT</p>
<p>public:</p>
<p>​    explicit ButtonGroup(QWidget *parent = 0);</p>
<p>​    ~ButtonGroup();</p>
<p>public slots:</p>
<p>​    // 按钮处理函数</p>
<p>​    void slotButtonClick(Page cur);</p>
<p>​    void slotButtonClick(QString text);</p>
<p>​    void setParent(QWidget *parent);</p>
<p>….</p>
<p>signals:</p>
<p>​    void sigMyFile();        //我的文件信号</p>
<p>​    void sigShareList();        //共享文件信号</p>
<p>​    void sigDownload();    //下载榜信号</p>
<p>​    void sigTransform();    //传输列表信号</p>
<p>​    void sigSwitchUser();    //切换用户信号</p>
<p>​    void closeWindow();    //关闭信号</p>
<p>​    void minWindow();        //最小化信号</p>
<p>​    void maxWindow();        //最大化信号</p>
<p>private:</p>
<p>​    Ui::ButtonGroup *ui;</p>
<p>​    QPoint m_pos;</p>
<p>​    QWidget* m_parent;</p>
<p>​    QSignalMapper* m_mapper;</p>
<p>​    QToolButton* m_curBtn;</p>
<p>​    QMap&lt;QString, QToolButton*&gt; m_btns;</p>
<p>​    QMap&lt;Page, QString&gt; m_pages;        //文件列表界面及名称</p>
<p>};</p>
<p>导航栏ButtonGroup 效果界面展示图如下：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps25.jpg" alt="img"> </p>
<p>图5-6 文件界面导航栏</p>
<p>文件列表MainWindow作为父类共包含我的文件界面MyFileWg类、共享列表界面ShareList类、下载榜界面RankingList类和传输列表界面Transfer类四个派生类，这四个界面均继承自MainWindow类。通过不同的按钮触发信号槽对应的回调函数绘制不同的子界面。</p>
<p>文件列表界面父类MainWindow具体声明代码如下：</p>
<p>class MainWindow : public QMainWindow{</p>
<p>​    Q_OBJECT</p>
<p>public:</p>
<p>​    explicit MainWindow(QWidget *parent = 0);</p>
<p>​    void showMainWindow();    // 显示主窗口</p>
<p>​    void managerSignals();        // 处理信号</p>
<p>​    void loginAgain();            // 重新登陆</p>
<p>signals:</p>
<p>​    void changeUser();            // 切换用户按钮信号</p>
<p>protected:</p>
<p>​    void paintEvent(QPaintEvent *event);</p>
<p>private:</p>
<p>​    Ui::MainWindow *ui;        //文件界面指针</p>
<p>​    Common m_common;        //工具类</p>
<p>};</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps26.jpg" alt="img"> </p>
<p>图5-7 我的文件效果图</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps27.jpg" alt="img"> </p>
<p>图5-8 共享列表效果图</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps28.jpg" alt="img"> </p>
<p>图5-9 下载榜效果图</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps29.jpg" alt="img"> </p>
<p>图5-10 传输列表效果图</p>
<h3 id="5-2-3-基础功能模块"><a href="#5-2-3-基础功能模块" class="headerlink" title="5.2.3 基础功能模块"></a>5.2.3 基础功能模块</h3><p>客户端在进行界面设计的同时为了避免代码冗余，需要对一些比较常用的方法进行抽离，实现高内聚低耦合。因此将这些常用的方法封装成工具类，放在Common文件夹里。该文件夹包含基础类文件和工具类文件。基础类汇集在common.cpp，工具类包括Md5加密算法des.c、用户信息保存logininfoinstance.cpp、下载任务列表downloadtask.cpp、下载进度界面downloadlayout.cpp、上传任务列表uploadtask.cpp、上传进度界面uploadlayout.cpp。</p>
<p>基础类头文件common.h包含宏定义配置，包括配置文件的宏定义与正则表达式的宏定义，同时包括文件类的属性声明。基础类Common包括读写配置文件、读写日志、文件类型判断、Md5加密、HTTP通信、获取状态码等方法的实现。具体声明如下：</p>
<p>class Common : public QObject{</p>
<p>​    Q_OBJECT</p>
<p>public:</p>
<p>​    Common(QObject* parent = 0);</p>
<p>​    ~Common();</p>
<p>​    // 窗口在屏幕中央显示</p>
<p>​    void moveToCenter(QWidget *tmp);</p>
<p>​    // 从配置文件中得到相对应的参数</p>
<p>​    QString getCfgValue(QString title, QString key, QString path = CONFFILE);</p>
<p>​    // 通过读取文件, 得到文件类型, 存放在typeList</p>
<p>​    void getFileTypeList();</p>
<p>​    // 得到文件后缀，参数为文件类型，函数内部判断是否有此类型，如果有，使用此类型，没有，使用other.png</p>
<p>​    QString getFileType(QString type);</p>
<p>​    // 登录信息，写入配置文件</p>
<p>​    void writeLoginInfo(QString user, QString pwd, bool isRemeber, QString path = CONFFILE);</p>
<p>​    // 服务器信息，写入配置文件</p>
<p>​    void writeWebInfo(QString ip, QString port, QString path=CONFFILE);</p>
<p>​    // 获取某个文件的Md5码</p>
<p>​    QString getFileMd5(QString filePath);</p>
<p>​    // 将某个字符串加密成Md5码</p>
<p>​    QString getStrMd5(QString str = “”);</p>
<p>​    // 产生分隔线</p>
<p>​    QString getBoundary();</p>
<p>​    // 得到服务器回复的状态码， 返回值为 “000”, 或 “001”</p>
<p>​    QString getCode(QByteArray json);</p>
<p>​    // 传输数据记录到本地文件，user：操作用户，name：操作的文件, code: 操作码， path: 文件保存的路径</p>
<p>​    void writeRecord(QString user, QString name, QString code, QString path = RECORDDIR);</p>
<p>​    // 得到HTTP通信类对象</p>
<p>​    static QNetworkAccessManager* getNetManager();</p>
<p>public:</p>
<p>​    static QStringList  m_typeList;</p>
<p>private:</p>
<p>​    // 文件类型路径</p>
<p>​    static QString      m_typePath;</p>
<p>​    static QNetworkAccessManager *m_netManager;</p>
<p>};</p>
<p>其配置反向代理服务器IP与端口的设置界面如下：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps30.jpg" alt="img"> </p>
<p>图5-11 配置设置效果图</p>
<p>工具类LoginInfoInstance为单例模式，当用户信息确认后会将当前用户信息与服务器信息保存到堆中，每次当需要获取用户信息或服务器信息时直接从堆中获取。</p>
<p>工具类中下载任务列表DownloadTask、下载进度界面DownloadLayout、上传任务列表UploadTask、上传进度界面UploadLayout均采用单例设计模式。</p>
<p>Layout作为客户端界面，当客户端访问数据传输列表界面时会加载该单例模式界面。其界面如下：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps31.jpg" alt="img"> </p>
<p>图5-12 任务进度图</p>
<p>Task作为任务，维护一个队列，当有任务时会将任务插入队列中，每次提取队首任务进行上传、下载操作。当任务完成时从队列中删除该任务。以上传任务为例，其界面效果图如下：</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps32.jpg" alt="img"> </p>
<p>图5-13上传任务界面效果图</p>
<h2 id="5-3-功能模块实现"><a href="#5-3-功能模块实现" class="headerlink" title="5.3 功能模块实现"></a>5.3 功能模块实现</h2><h3 id="5-3-1-数据封装与提取"><a href="#5-3-1-数据封装与提取" class="headerlink" title="5.3.1 数据封装与提取"></a>5.3.1 数据封装与提取</h3><p>由于客户端跟服务端数据之间需要不断交互，但客户端和服务端无论在操作系统还是开发工具上都截然不同，因此数据需要采用统一的格式去存储。而Json作为跨平台的数据交互方式，因此可以将数据封装成Json格式，进行交互。</p>
<p>封装与提取的过程由于客户端与服务端的开发工具不同因此实现方式也不同。首先对于服务端，cJSON是由纯C实现的，跨平台性较好。cJSON是采用链表存储的。</p>
<p>cJSON库在使用时只需两步：将cJSON.c和cJSON.h添加到项目即可；如果在命令行进行链接还需加上-lm表示链接math库[30]。</p>
<p>对于客户端，由于Qt将C++封装成了一套专属于Qt的语言，同时有一套自己的框架，因此对于Json的处理Qt有操作Json数据的中心类QJsonDocument。因此对于解析Json数据只需调用API即可，而对于封装Json数据的方法代码如下：</p>
<p>void Common::writeWebInfo(QString ip, QString port, QString path){</p>
<p>​    // Web_server信息</p>
<p>​    QMap&lt;QString, QVariant&gt; web_server;</p>
<p>​    web_server.insert(“ip”, ip);</p>
<p>​    web_server.insert(“port”, port);</p>
<p>​    // type_path信息</p>
<p>​    QMap&lt;QString, QVariant&gt; type_path;</p>
<p>​    type_path.insert(“path”, m_typePath);</p>
<p>​    // login信息</p>
<p>​    QString user = getCfgValue(“login”, “user”);</p>
<p>​    QString pwd = getCfgValue(“login”, “pwd”);</p>
<p>​    QString remember = getCfgValue(“login”, “remember”);</p>
<p>​    QMap&lt;QString, QVariant&gt; login;</p>
<p>​    login.insert(“user”, user);</p>
<p>​    login.insert(“pwd”, pwd);</p>
<p>​    login.insert(“remember”, remember);</p>
<p>​    QMap&lt;QString, QVariant&gt; json;</p>
<p>​    json.insert(“web_server”, web_server);</p>
<p>​    json.insert(“type_path”, type_path);</p>
<p>​    json.insert(“login”, login);</p>
<p>​    QJsonDocument jsonDocument = QJsonDocument::fromVariant(json);</p>
<p>​    file.write(jsonDocument.toJson());</p>
<p>​    file.close();</p>
<p>}</p>
<h3 id="5-3-2-用户登录与注册"><a href="#5-3-2-用户登录与注册" class="headerlink" title="5.3.2 用户登录与注册"></a>5.3.2 用户登录与注册</h3><p>对于用户部分，除了客户端界面以外，服务端的实现主要是对于数据库的操作，首先Web服务器Nginx将登录请求交由10000端口CGI程序进行处理，将注册请求交由10001端口CGI程序进行处理，需要配置如下：</p>
<p>location /login{</p>
<p>fastcgi_pass 127.0.0.1:10000;</p>
<p>include fastcgi.conf;</p>
<p>}</p>
<p>location /reg{</p>
<p>fastcgi_pass 127.0.0.1:10001;</p>
<p>include fastcgi.conf;</p>
<p>}</p>
<p>Shell命令需要将端口与CGI程序绑定，脚本如下：</p>
<p>spawn-fcgi -a 127.0.0.1 -p 10000 -f ./bin_cgi/login</p>
<p>spawn-fcgi -a 127.0.0.1 -p 10001 -f ./bin_cgi/register</p>
<p>通过配置文件将数据传递给对应端口的CGI程序，登录模块的核心部分是数据库信息的比对与结果的封装，数据封装通过数据处理模块完成，而核心的SQL操作语句如下：</p>
<p>sprintf(sql_cmd, “select password from user where name=\”%s\””, user);</p>
<p>注册部分对于数据库操作的核心代码如下：</p>
<p>sprintf(sql_cmd, “insert into user (name, nickname, password, phone, createtime, email) values (‘%s’, ‘%s’, ‘%s’, ‘%s’, ‘%s’, ‘%s’)”, user, nick_name, pwd, tel, time_str ,email);</p>
<h3 id="5-3-3-数据上传模块（上传、秒传）"><a href="#5-3-3-数据上传模块（上传、秒传）" class="headerlink" title="5.3.3 数据上传模块（上传、秒传）"></a>5.3.3 数据上传模块（上传、秒传）</h3><p>文件上传分为秒传与上传，秒传是对于服务端已有该文件的情况下无需再对文件进行分布式文件系统存储，而直接更改数据库，上传则需要将文件上传到分布式文件系统，</p>
<p>对于客户端的上传请求，首先客户端将上传请求插入到上传队列里，对于完成的请求从队列中删除。</p>
<p>当第0号任务开始进行上传工作时，客户端将文件信息封装后向服务器发起秒传请求，服务端接收到请求后对请求头进行判断，如果是Md5，则将数据信息传给10003端口绑定的CGI程序。CGI程序对数据库进行查询，如果有该文件信息，则直接更改数据库，通过file_info表将文件信息和该用户信息相关联，然后反馈成功状态码。否则反馈失败状态码。Web服务器Nginx需要配置如下：</p>
<p>location /Md5{</p>
<p>​    fastcgi_pass 127.0.0.1:10003;</p>
<p>​    include fastcgi.conf;</p>
<p>}</p>
<p>Shell命令需要将端口与CGI程序绑定，脚本如下：</p>
<p>spawn-fcgi -a 127.0.0.1 -p 10003 -f ./bin_cgi/Md5</p>
<p>客户端接收到服务端的反馈信息后，如果状态码提示服务器没有该文件，则意味着无法秒传，需继续进行数据上传操作。客户端向服务端发送请求：</p>
<p>QNetworkReply * reply = m_manager-&gt;post( request, data );</p>
<p>if(reply == NULL){</p>
<p>​    cout &lt;&lt; “reply == NULL”;</p>
<p>​    return;</p>
<p>}</p>
<p>服务端接收到Post请求后对请求头进行判断是否为upload，将数据信息传给10002端口绑定的CGI程序。CGI程序对数据库进行添加文件信息操作，同时通过fdfs_upload_file提供的API将数据信息上传到服务器分布式文件系统中。Web服务器Nginx需要配置如下：</p>
<p>location /upload{</p>
<p>fastcgi_pass 127.0.0.1:10002;</p>
<p>include fastcgi.conf;</p>
<p>}</p>
<p>Shell命令需要将端口与CGI程序绑定，脚本如下：</p>
<p>spawn-fcgi -a 127.0.0.1 -p 10002 -f ./bin_cgi/upload</p>
<p>客户端的数据传输列表界面时时跟进当前的上传进度，当有可用数据更新时，会刷新界面。跟进的信号槽代码如下：</p>
<p>connect(reply, &amp;QNetworkReply::uploadProgress, <a href="qint64 bytesRead, qint64 totalBytes">=</a>{</p>
<p>​    if(totalBytes != 0) {</p>
<p>​        dp-&gt;setProgress(bytesRead/1024, totalBytes/1024); //设置进度条</p>
<p>​    }</p>
<p>});</p>
<h3 id="5-3-4-文件查询模块（文件列表、共享列表、下载榜）"><a href="#5-3-4-文件查询模块（文件列表、共享列表、下载榜）" class="headerlink" title="5.3.4 文件查询模块（文件列表、共享列表、下载榜）"></a>5.3.4 文件查询模块（文件列表、共享列表、下载榜）</h3><p>对于客户端的请求，首先Web服务器Nginx将文件信息请求交由10004端口CGI程序进行处理，将共享列表请求交由10006端口CGI程序进行处理，需要配置如下：</p>
<p>location /myfiles{</p>
<p>fastcgi_pass 127.0.0.1:10004;</p>
<p>include fastcgi.conf;</p>
<p>}</p>
<p>location /sharefiles{</p>
<p>fastcgi_pass 127.0.0.1:10006;</p>
<p>include fastcgi.conf;</p>
<p>}</p>
<p>Shell命令需要将端口与CGI程序绑定，脚本如下：</p>
<p>spawn-fcgi -a 127.0.0.1 -p 10004 -f ./bin_cgi/myfiles</p>
<p>spawn-fcgi -a 127.0.0.1 -p 10006 -f ./bin_cgi/sharefiles</p>
<p>对于CGI程序，文件信息与共享文件分别交给myfiles.c与sharefiles.c处理。以myfiles.c为例，首先会对数据提取的信息状态进行比对，判断具体请求，比如下载榜需将请求数据排序。对于文件信息列表请求的数据库核心代码如下：</p>
<p>sprintf(sql_cmd, “select user_file_list.*, file_info.Url, file_info.size, file_info.type from file_info, user_file_list where user = ‘%s’ and file_info.Md5 = user_file_list.Md5 limit %d, %d”, user, start, count);</p>
<h3 id="5-3-5-文件处理模块（删除、共享、转存）"><a href="#5-3-5-文件处理模块（删除、共享、转存）" class="headerlink" title="5.3.5 文件处理模块（删除、共享、转存）"></a>5.3.5 文件处理模块（删除、共享、转存）</h3><p>对于客户端的删除、共享、取消共享、转存等请求，首先Web服务器Nginx将文件信息请求交由10004端口CGI程序进行处理，将共享列表请求交由10006端口CGI程序进行处理，需要配置如下：</p>
<p>location //dealfile{</p>
<p>fastcgi_pass 127.0.0.1:10005;</p>
<p>include fastcgi.conf;</p>
<p>}</p>
<p>location //dealsharefile{</p>
<p>fastcgi_pass 127.0.0.1:10007;</p>
<p>include fastcgi.conf;</p>
<p>}</p>
<p>Shell命令需要将端口与CGI程序绑定，脚本如下：</p>
<p>spawn-fcgi -a 127.0.0.1 -p 10005 -f ./bin_cgi/dealfile</p>
<p>spawn-fcgi -a 127.0.0.1 -p 10007 -f ./bin_cgi/sharefiles</p>
<p>对于CGI程序，需要将文件划分为普通文件与共享文件，普通文件可直接操作，而共享文件需要进行判断共享文件拥有者。普通文件与共享文件的处理分别交给dealfile.c与sharefiles.c处理。以dealfile.c为例，首先会对数据请求类型进行判断，请求类型具体分为删除、分享、取消分享、转存等类型，四者均对数据库进行增删改查操作，只有删除操作在确认该文件拥有者为0时会对分布式文件系统中的文件进行删除，具体删除FastDFS中文件的核心代码如下：</p>
<p>int remove_file_from_storage(char *fileid){</p>
<p>​    int ret = 0;</p>
<p>​    //读取fdfs client 配置文件的路径</p>
<p>​    char fdfs_cli_conf_path[256] = {0};</p>
<p>​    get_cfg_value(CFG_PATH, “dfs_path”, “client”, fdfs_cli_conf_path);</p>
<p>​    char cmd[1024*2] = {0};</p>
<p>​    sprintf(cmd, “fdfs_delete_file %s %s”, fdfs_cli_conf_path, fileid);</p>
<p>​    ret = system(cmd);</p>
<p>​    return ret;</p>
<p>}</p>
<h3 id="5-3-6-数据下载模块"><a href="#5-3-6-数据下载模块" class="headerlink" title="5.3.6 数据下载模块"></a>5.3.6 数据下载模块</h3><p>由于服务器端存储结点Storage与Nginx关联，因此存储在存储结点的数据可直接通过Url的方式进行获取，提高了服务端下载的效率。对于客户端，维护一个静态队列，队列中存储需要下载的任务信息。每次移除已经下载完成的任务，将最新下载请求进行数据封装后插入下载队列。当队列第0个任务元素需要下载时，首先通过该文件Url发起HTTP请求，具体Get请求代码如下：</p>
<p>QNetworkReply * reply = m_manager-&gt;get( QNetworkRequest(Url) );</p>
<p>if(reply == NULL){</p>
<p>​    p-&gt;dealDownloadTask(); //删除任务</p>
<p>​    cout &lt;&lt; “get err”;</p>
<p>​    return;</p>
<p>}</p>
<p>获取请求的数据完成时，就会发送信号SIGNAL(finished())，代码如下：</p>
<p>connect(reply, &amp;QNetworkReply::finished, <a href>=</a>{</p>
<p>​    cout &lt;&lt; “下载完成”;</p>
<p>​    reply-&gt;deleteLater();</p>
<p>p-&gt;dealDownloadTask();//删除下载任务</p>
<p>m_cm.writeRecord(user, filename, “010”); //下载文件成功，记录</p>
<p>dealFilePv(Md5, filename); //下载文件pv字段处理</p>
<p>});</p>
<p>reply在有数据时发出readyRead信号，我们便可保存数据。具体代码如下：</p>
<p>connect(reply, &amp;QNetworkReply::readyRead, <a href>=</a>{</p>
<p>​    if (file != NULL){</p>
<p>​        file-&gt;write(reply-&gt;readAll());</p>
<p>​    }</p>
<p>});</p>
<p>有可用数据更新时，会通过信号槽刷新进度界面，代码如下：</p>
<p>connect(reply, &amp;QNetworkReply::downloadProgress, <a href="qint64 bytesRead, qint64 totalBytes">=</a>{</p>
<p>​    dp-&gt;setProgress(bytesRead, totalBytes);//设置进度</p>
<p>});</p>
<h3 id="5-3-7-图像预览模块"><a href="#5-3-7-图像预览模块" class="headerlink" title="5.3.7 图像预览模块"></a>5.3.7 图像预览模块</h3><p>由于图像Url信息保存在数据库中，而在文件列表请求的过程中会默认将Url保存到文件信息中，因此对于图像预览，需要根据传进来不同的Url参数进行请求。首先创建QNetworkAccessManager进行HTTP通信，然后建立信号连接槽，通过Get的方式向Url发起请求。流程如下：</p>
<p>void PreviewImg::load_network_img(QString Url){</p>
<p>​    currentPicture = new QPixmap;</p>
<p>​    //获取网络图片</p>
<p>​    QNetworkAccessManager *manager;</p>
<p>​    manager = new QNetworkAccessManager(this);</p>
<p>​    connect(manager, SIGNAL(finished(QNetworkReply*)),</p>
<p>​        this, SLOT(replyFinished(QNetworkReply*)));</p>
<p>​    manager-&gt;get(QNetworkRequest(QUrl( Url )));</p>
<p>}</p>
<p>当请求完成时会调用完成回调函数，绘制预览图像界面，同时如果用户选择缓存图片，则会对缩略图及缓存图片进行本地缓存，之后访问直接先通过缓存加载图像，加快下一次访问时的效率。回调函数如下：</p>
<p>void PreviewImg::replyFinished(QNetworkReply *reply){</p>
<p>​    if (reply-&gt;error() == QNetworkReply::NoError){</p>
<p>​        currentPicture-&gt;loadFromData(reply-&gt;readAll());//获取字节流QPixmap对象</p>
<p>​        QString filename = cachePathFile;</p>
<p>​        currentFileName = filename;</p>
<p>​        if(flag){//true预览图片，false加载缩略图</p>
<p>​            showImgFile(currentPicture);//加载预览界面</p>
<p>​        }else{</p>
<p>​            PreviewImg::isTask = false;//缩略图请求任务结束</p>
<p>​        }</p>
<p>​        if(isCache){    //是否缓存图片</p>
<p>​            currentPicture-&gt;save(cachePathFile);//保存图片</p>
<p>​            saveIcoFile(currentPicture);//保存缩略图</p>
<p>​        }</p>
<p>​    }</p>
<p>}</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps33.jpg" alt="img"> </p>
<p>图5-14 图像预览列表图</p>
<h1 id="6-测试"><a href="#6-测试" class="headerlink" title="6  测试"></a>6  测试</h1><h2 id="6-1-程序调试"><a href="#6-1-程序调试" class="headerlink" title="6.1 程序调试"></a>6.1 程序调试</h2><p>任何项目在开发过程中均或多或少会遇到各种各样的错误，除了比较基础的配置环境问题或语法错误以外，还有很多问题是在程序运行的过程中才能发现的。因此在程序设计的同时，尽量使每个模块独立，减少文件之间因耦合度过高而出现错误的几率，达到高内聚低耦合的效果，这样在每个模块设计完成的同时可以独立测试，方便排查错误，提高修复错误的效率。</p>
<p>在程序调试的程序的过程中，服务端主要通过Linux自带的GDB工具进行断点调试，排查错误语法；客户端主要通过Qt Creator语法错误提示和Debug断点单步调试，迅速定位错误代码并显示错误信息。</p>
<h2 id="6-2-工具测试"><a href="#6-2-工具测试" class="headerlink" title="6.2 工具测试"></a>6.2 工具测试</h2><h3 id="6-2-1-测试的目的和意义"><a href="#6-2-1-测试的目的和意义" class="headerlink" title="6.2.1 测试的目的和意义"></a>6.2.1 测试的目的和意义</h3><p>软件测试重点在于在真实的软件运行环境下通过与软件需求进行比较，发现软件与需求有所偏差的地方。</p>
<p>此次软件测试的目的在于检查基于云存储的图像管理平台已完成的功能，发现软件在运行过程中出现的错误并及时解决，使软件能正常运行，确保每个功能可以正常使用，同时尽量保证软件的功能基本符合软件需求。</p>
<h3 id="6-2-2-测试框架"><a href="#6-2-2-测试框架" class="headerlink" title="6.2.2 测试框架"></a>6.2.2 测试框架</h3><p>QTestLib为用户提供了一个操作简便的单元测试框架，因此本次测试使用Qt Creator 自带的单元测试框架QTestlib进行测试。</p>
<h3 id="6-2-3-测试步骤"><a href="#6-2-3-测试步骤" class="headerlink" title="6.2.3 测试步骤"></a>6.2.3 测试步骤</h3><p>本平台的设计步骤通过断点调试、单元测试、集成测试、系统测试四部分对系统的功能和性能进行检查和完善[31]。</p>
<p>首先是单元测试，单元测试以功能模块或函数作为对象，通常采用白盒测试技术，辅以黑盒技术，集中地对程序所实现的每个功能模块进行测试，竭力覆盖每个函数，检验各个程序模块是否存在问题，与所描述的功能是否相符合。</p>
<p>其次是集成测试，把已通过单元测试完成的模块进行组合，最终组成所预期的平台系统。其作用主要是检验软件体系的结构是否合理，检查接口之间的问题。</p>
<p>最后是系统测试，把已经集成测试的软件纳入实际运行环境中，与硬件、外设等支持软件运行的系统因素组合，进行环境相关的测试。</p>
<h2 id="6-3-测试用例设计"><a href="#6-3-测试用例设计" class="headerlink" title="6.3 测试用例设计"></a>6.3 测试用例设计</h2><p>QTestLib为用户提供了一个操作简便的单元测试框架，使用时可以通过在新建项目栏点击其他项目-Qt单元测试，也可以直接在工程文件里加入语句Qt+=testlib。其基本操作代码如下：</p>
<p>class Untitled2Test : public QObject {</p>
<p>Q_OBJECT</p>
<p>public:</p>
<p>Untitled2Test();</p>
<p>private Q_SLOTS:</p>
<p>void initTestCase();</p>
<p>void cleanupTestCase();</p>
<p>void testCase1();</p>
<p>};</p>
<p>Untitled2Test::Untitled2Test() {</p>
<p>…</p>
<p>}</p>
<p>void Untitled2Test::initTestCase() {</p>
<p>…</p>
<p>}</p>
<p>void Untitled2Test::cleanupTestCase() {</p>
<p>…</p>
<p>}</p>
<p>void Untitled2Test::testCase1() {</p>
<p>QVERIFY2(true, “Failure”);</p>
<p>}</p>
<p>QTEST_APPLESS_MAIN(Untitled2Test)</p>
<p>#include “tst_untitled2test.moc”</p>
<p>其中，首个测试函数执行前调用initTestCase()；最后一个测试函数执行后调用cleanupTestCase()；每个测试函数执行前调用init()；每个测试函数执行后调用cleanup()[32]。</p>
<p>对于GUI相关的操作，Qtestlib同样提供了接口。通过对控件传递信息来检查结果。常用的操作函数例如鼠标的点击事件QTest::mouseClick()，以及键盘的点击事件QTest::keyClick()[33]。</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps34.jpg" alt="img"> </p>
<p>图6-1 GUI单元测试部分结果</p>
<h2 id="6-4-测试数据及结果"><a href="#6-4-测试数据及结果" class="headerlink" title="6.4 测试数据及结果"></a>6.4 测试数据及结果</h2><h3 id="6-4-1-功能测试数据及结果"><a href="#6-4-1-功能测试数据及结果" class="headerlink" title="6.4.1 功能测试数据及结果"></a>6.4.1 功能测试数据及结果</h3><p>功能测试通过对平台已实现的功能进行单元测试与集成测试，查看功能在运行状况下是否与预期的功能效果相符，同时查找在单步调试中未发现而在程序运行中会出现的潜在错误。以下是功能测试数据及结果。</p>
<p>表6-1 功能测试结果</p>
<table>
<thead>
<tr>
<th>功能模块</th>
<th>前置条件</th>
<th>测试步骤</th>
<th>预期结果</th>
<th>实测结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>设置测试-IP</td>
<td>进入设置界面</td>
<td>IP输入不规范</td>
<td>提示IP不正确</td>
<td>提示IP不正确</td>
</tr>
<tr>
<td>设置测试-端口</td>
<td>进入设置界面</td>
<td>端口输入不规范</td>
<td>提示端口不正确</td>
<td>提示端口不正确</td>
</tr>
<tr>
<td>设置测试-集成测试</td>
<td>进入设置界面</td>
<td>IP与端口输入均符合规范</td>
<td>自动跳转至登录界面</td>
<td>自动跳转至登录界面</td>
</tr>
<tr>
<td>设置测试-集成测试</td>
<td>进入注册界面，信息输入正确</td>
<td>未设置端口和IP</td>
<td>提示注册连接失败</td>
<td>提示注册连接失败</td>
</tr>
<tr>
<td>设置测试-集成测试</td>
<td>进入登录界面，信息输入正确</td>
<td>未设置端口和IP</td>
<td>提示登录连接失败</td>
<td>提示登录连接失败</td>
</tr>
<tr>
<td>用户注册测试-必填项</td>
<td>进入用户注册页面</td>
<td>信息栏为空，点击注册</td>
<td>提示用户注册信息为空</td>
<td>提示用户注册信息为空</td>
</tr>
<tr>
<td>用户注册测试-边界值</td>
<td>进入用户注册页面</td>
<td>输入用户名不规范，其他信息规范</td>
<td>提示注册失败</td>
<td>提示用户名不正确</td>
</tr>
<tr>
<td>用户注册测试-边界值</td>
<td>进入用户注册页面</td>
<td>输入昵称不规范，其他信息规范</td>
<td>提示注册失败</td>
<td>提示昵称不正确</td>
</tr>
<tr>
<td>用户注册测试-边界值</td>
<td>进入用户注册页面</td>
<td>输入密码不规范，其他信息规范</td>
<td>提示注册失败</td>
<td>提示密码不正确</td>
</tr>
<tr>
<td>用户注册测试-边界值</td>
<td>进入用户注册页面</td>
<td>输入两次密码不同，其他信息规范</td>
<td>提示注册失败</td>
<td>提示两次密码不同</td>
</tr>
</tbody>
</table>
<p>续表 6-1</p>
<table>
<thead>
<tr>
<th>功能模块</th>
<th>前置条件</th>
<th>测试步骤</th>
<th>预期结果</th>
<th>实测结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>用户注册测试-边界值</td>
<td>进入用户注册页面</td>
<td>输入电话不规范，其他信息规范</td>
<td>提示注册失败</td>
<td>提示电话不正确</td>
</tr>
<tr>
<td>用户注册测试-边界值</td>
<td>进入用户注册页面</td>
<td>输入邮箱不规范，其他信息规范</td>
<td>提示注册失败</td>
<td>提示邮箱格式不正确</td>
</tr>
<tr>
<td>用户注册测试-集成测试</td>
<td>进入用户注册页面，IP与端口可用</td>
<td>填写用户名存在，其他信息填写正确</td>
<td>提示注册失败</td>
<td>提示用户已存在</td>
</tr>
<tr>
<td>用户注册测试-集成测试</td>
<td>进入用户注册页面，IP与端口可用</td>
<td>填写注册均信息规范且用户名不存在</td>
<td>提示注册成功，跳转登录界面</td>
<td>提示注册成功，跳转登录界面</td>
</tr>
<tr>
<td>用户登录测试-必填项</td>
<td>用户已经注册并激活账户</td>
<td>用户名为空，密码规范，点击登录</td>
<td>提示用户名为空</td>
<td>提示用户名为空</td>
</tr>
<tr>
<td>用户登录测试-必填项</td>
<td>用户已经注册并激活账户</td>
<td>密码为空，用户名规范，点击登录</td>
<td>提示密码为空</td>
<td>提示密码为空</td>
</tr>
<tr>
<td>用户登录测试-边界值</td>
<td>用户已经注册并激活账户</td>
<td>用户名规范，密码不规范，点击登录</td>
<td>登陆失败</td>
<td>登陆失败</td>
</tr>
<tr>
<td>用户登录测试-边界值</td>
<td>用户已经注册并激活账户</td>
<td>密码规范，用户名不规范，点击登录</td>
<td>登陆失败</td>
<td>登陆失败</td>
</tr>
<tr>
<td>用户登录测试-边界值</td>
<td>用户已经注册并激活账户</td>
<td>密码与用户名均不规范，点击登录</td>
<td>登陆失败</td>
<td>登陆失败</td>
</tr>
<tr>
<td>用户登录测试-集成测试</td>
<td>用户已经注册账户</td>
<td>用户名和密码输入正确，点击登录</td>
<td>登录成功，跳转至我的文件界面</td>
<td>登录成功，跳转至我的文件界面</td>
</tr>
<tr>
<td>用户登录测试-缓存测试</td>
<td>用户已经注册账户</td>
<td>选择记住密码登录，再进登录界面</td>
<td>登录栏有上次用户输入的信息</td>
<td>登录栏有上次用户输入的信息</td>
</tr>
<tr>
<td>文件上传测试-文件类型</td>
<td>1.用户已登录，并进入文件页面；2.准备1个非图像文件</td>
<td>1.选择非图像文件文件；2.确认上传</td>
<td>提示上传成功，文件信息保存至数据库中</td>
<td>提示上传成功，文件信息保存至数据库中</td>
</tr>
<tr>
<td>文件上传测试-文件类型</td>
<td>1.用户已登录，并进入文件页面；2.准备1个图像文件</td>
<td>1.选择图像文件；2.确认上传</td>
<td>提示上传成功，文件信息保存至数据库中</td>
<td>提示上传成功，文件信息保存至数据库中</td>
</tr>
<tr>
<td>文件上传测试-性能测试</td>
<td>1.用户已登录，并进入文件页面；2.准备10个文件</td>
<td>1.选择准备好的文件；2.确认上传</td>
<td>10个文件加入到上传队列</td>
<td>10个文件加入到上传队列</td>
</tr>
</tbody>
</table>
<p>续表 6-1</p>
<table>
<thead>
<tr>
<th>功能模块</th>
<th>前置条件</th>
<th>测试步骤</th>
<th>预期结果</th>
<th>实测结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>文件上传测试-性能测试</td>
<td>用户已登录，并进入文件页面</td>
<td>1.选择1KB文件；2.确认上传</td>
<td>成功上传</td>
<td>成功上传</td>
</tr>
<tr>
<td>文件上传测试-性能测试</td>
<td>用户已登录，并进入文件页面</td>
<td>选择准备的100MB文件；确认上传</td>
<td>成功上传</td>
<td>成功上传</td>
</tr>
<tr>
<td>文件秒传测试-性能测试</td>
<td>1.用户已登录，并进入文件页面；2.准备已上传过的文件</td>
<td>1.选择准备好的文件；2.确认上传</td>
<td>直接提示上传成功，文件信息保存至数据库中</td>
<td>直接提示上传成功，文件信息保存至数据库中</td>
</tr>
<tr>
<td>文件下载测试</td>
<td>1.用户已经登陆；2.已经有上传好的文件</td>
<td>1.选择一个自己文件点击下载；2.在本地打开文件</td>
<td>文件成功打开，且格式正确</td>
<td>文件成功打开，且格式正确</td>
</tr>
<tr>
<td>文件下载测试-共享文件</td>
<td>1.用户已经登陆；2.系统中有共享文件存在</td>
<td>在共享文件界面点击一个文件下载，然后打开下载文件</td>
<td>文件成功打开，且格式正确</td>
<td>文件成功打开，且格式正确</td>
</tr>
<tr>
<td>文件下载测试-共享文件</td>
<td>1.用户已经登陆；3.系统中有共享文件存在</td>
<td>在共享文件界面点击一个文件下载，然后再上传该文件</td>
<td>文件采用秒传方式上传成功</td>
<td>文件采用秒传方式上传成功</td>
</tr>
<tr>
<td>文件共享测试</td>
<td>1.用户已经登陆；2.文件列表存在文件</td>
<td>用户选择文件设为共享并进共享页面</td>
<td>用户1可以查找到该文件</td>
<td>用户1可以查找到该文件</td>
</tr>
<tr>
<td>文件共享测试</td>
<td>1.准备两个用户，且已经登陆；2.文件列表存在文件</td>
<td>1.用户1选择一个文件共享；2.用户2转存该文件</td>
<td>用户2可以在共享界面转存该文件</td>
<td>用户2可以在共享界面转存该文件</td>
</tr>
<tr>
<td>文件共享测试</td>
<td>1.准备两个用户，且已经登陆；2.文件列表存在文件</td>
<td>1.用户1选择一个文件共享；2.用户2取消共享该文件</td>
<td>用户2不可以在共享界面取消共享该文件</td>
<td>用户2不可以在共享界面取消共享该文件</td>
</tr>
<tr>
<td>文件共享测试</td>
<td>1.准备两个用户，且已经登陆；2.文件列表存在文件</td>
<td>1.用户1选择文件取消共享；2.用户2前往共享页面</td>
<td>用户2不可以找到该文件</td>
<td>用户2不可以找到该文件</td>
</tr>
<tr>
<td>文件共享测试</td>
<td>1.用户已经登陆；2.文件列表存在文件</td>
<td>用户将转存文件共享</td>
<td>用户不可以共享该文件</td>
<td>用户不可以共享该文件</td>
</tr>
<tr>
<td>文件列表测试-我的文件</td>
<td>1.用户已经登录；2.该存在文件</td>
<td>进入我的文件</td>
<td>图标形式显示用户所有文件</td>
<td>图标形式显示用户所有文件</td>
</tr>
</tbody>
</table>
<p>续表 6-1</p>
<table>
<thead>
<tr>
<th>功能模块</th>
<th>前置条件</th>
<th>测试步骤</th>
<th>预期结果</th>
<th>实测结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>文件列表测试-共享文件</td>
<td>1.用户已经登录；2.存在共享文件</td>
<td>进入共享文件</td>
<td>图标形式显示所有共享文件</td>
<td>图标形式显示所有共享文件</td>
</tr>
<tr>
<td>文件列表测试-下载榜</td>
<td>1.用户已经登录；2.存在共享文件</td>
<td>进入下载榜</td>
<td>以下载量排序共享文件信息</td>
<td>以下载量排序共享文件信息</td>
</tr>
<tr>
<td>文件删除测试-删除普通文件</td>
<td>1.用户已经登录；2.系统中存在文件</td>
<td>1.用户选择一个文件删除</td>
<td>用户文件列表中没有该文件</td>
<td>用户文件列表中没有该文件</td>
</tr>
<tr>
<td>文件删除测试-删除共享文件</td>
<td>1.准备两个用户，且已经登录；2.系统中存在文件</td>
<td>1.用户1删除自己的共享文件；2.用户2进入共享页面</td>
<td>用户2不可以找到该文件</td>
<td>用户2不可以找到该文件</td>
</tr>
<tr>
<td>文件删除测试-删除共享文件</td>
<td>1.用户已经登录；2.系统中存在文件</td>
<td>用户选择非自己的共享文件点击删除</td>
<td>删除失败</td>
<td>删除失败</td>
</tr>
<tr>
<td>文件删除测试-删除共享文件</td>
<td>用户1用户2均拥有该共享文件，且用户1为共享者</td>
<td>1.用户1删除该文件2.用户2进入共享文件界面查找</td>
<td>用户2不可以查找到该文件</td>
<td>用户2不可以查找到该文件</td>
</tr>
<tr>
<td>文件删除测试-删除共享文件</td>
<td>用户1用户2均拥有该共享文件，且用户2为共享者</td>
<td>1.用户1删除该文件2.用户2进入共享文件界面查找</td>
<td>用户2可以查找到该文件</td>
<td>用户2可以查找到该文件</td>
</tr>
<tr>
<td>图像预览测试</td>
<td>用户拥有已上传非图像文件</td>
<td>选中非图像文件右键点击预览</td>
<td>提示该文件非图像，无法预览</td>
<td>提示该文件非图像，无法预览</td>
</tr>
<tr>
<td>图像预览测试</td>
<td>用户拥有已上传图像文件并点击预览</td>
<td>选中图像文件右键点击预览</td>
<td>显示预览效果</td>
<td>显示预览效果</td>
</tr>
<tr>
<td>图像预览测试-缩略图</td>
<td>进入文件列表界面，缓存没有预览图</td>
<td>无</td>
<td>先显示默认图像，一段时间后部分图像逐渐显现缩略图</td>
<td>先显示默认图像，一段时间后部分图像逐渐显现缩略图</td>
</tr>
<tr>
<td>图像预览测试-缩略图</td>
<td>进入文件列表界面，缓存有预览图</td>
<td>无</td>
<td>显示图像缩略图</td>
<td>显示图像缩略图</td>
</tr>
<tr>
<td>图像预览测试-缩略图</td>
<td>进入文件列表界面</td>
<td>1.预览图像文件2.刷新文件列表</td>
<td>预览过的图像文件显示图像缩略图</td>
<td>预览过的图像文件显示图像缩略图</td>
</tr>
<tr>
<td>图像预览测试-缓存</td>
<td>进入文件列表界面</td>
<td>右键取消缓存，刷新界面</td>
<td>未在缓存中的缩略图不会自动加载</td>
<td>未在缓存中的缩略图不会自动加载</td>
</tr>
<tr>
<td>图像预览测试-缓存</td>
<td>进入文件列表界面</td>
<td>右键点击清理缓存</td>
<td>缓存文件清空</td>
<td>缓存文件清空</td>
</tr>
<tr>
<td>用户切换测试</td>
<td>进入文件界面</td>
<td>点击切换用户</td>
<td>切换到登录界面</td>
<td>切换到登录界面</td>
</tr>
</tbody>
</table>
<h3 id="6-4-2-性能测试结果"><a href="#6-4-2-性能测试结果" class="headerlink" title="6.4.2 性能测试结果"></a>6.4.2 性能测试结果</h3><p>在性能测试中主要通过SpeedTest性能测试工具监控指定进程，通过上传或下载指定大小的数据来测试上传与下载过程中数据接收的速度。在文件上传或下载的速度测试过程中以采样时间段速度的形式进行平均速度的计算。以下是采样测试结果。</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps35.jpg" alt="img"> </p>
<p>图6-2 虚拟机服务端环境性能测试</p>
<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps36.jpg" alt="img"> </p>
<p>图6-3 阿里云服务端环境性能测试</p>
<h1 id="7-总结"><a href="#7-总结" class="headerlink" title="7  总结"></a>7  总结</h1><p>作为大学四年知识汇聚的结晶，基于云存储的图像管理平台的设计与实现最终顺利完成。该平台尽管采用C++设计，但所包含的技术点却很多。</p>
<p>首先服务端的架构就包含分布式文件系统、持久化数据库、非关系型数据库、负载均衡等比较新但应用很广的技术，这些技术原本只能通过书籍或课堂接触，而通过本平台的设计均得到了实践，因此对今后应用的开发有着启迪性的作用；同时，对于目前服务端主流的分布式文件系统、Redis、MySQL、Nginx等应用较广的技术的使用越来越熟练。由于服务端部署在Linux操作系统上，同时用到很多云计算相关技术，为之后无论是应用开发还是大数据开发均提供了宝贵的经验。</p>
<p>客户端通过Qt设计，而Qt作为C++跨平台界面开发的工具，里面支持包括Lambda表达式等一系列C++11特性，同时包含很多通过C++实现的比较新的技术。在设计客户端的同时，不仅巩固了C++基础，同时也为客户端相关的开发积累了丰富的经验。</p>
<p>刚开始设计该平台时，我还没有多少项目开发经验，但由于该应用的功能正好用处很广，不仅可以用来作为文件存储的云盘，同时还可以作为图床供博客使用，因此满怀兴趣的我开始查阅云存储相关的资料。在学习的过程中，不仅掌握了目前时代较前沿的技术，同时也拓展了视野，认识到纸上得来终觉浅，作为开发者不仅需要不断学习，更重要的是进行实践，有了足够的设计经验，对于新的技术学起来会非常快，这样才能跟随时代发展而不被时代所甩掉。</p>
<p>该平台作为较完整的项目，我将会通过GitHub将该平台开源化，供其他开发者使用的同时进行学习与交流，为开源软件贡献一份尽管微不足道但充满诚意的力量。</p>
<h1 id="致-谢"><a href="#致-谢" class="headerlink" title="致 谢"></a>致 谢</h1><p>首先，我要感谢我的指导老师——齐勇老师。此次基于云存储的图像管理平台设计与实现以及毕业论文的撰写与完善均是在齐勇老师的耐心辅导下完成的，从毕业设计开题到毕业论文的完善，齐老师都定期查看，悉心辅导，同时推荐了许多有用的材料，给予我很多有价值的建议。尽管由于一系列不可控因素的存在，导致此次毕业设计齐老师只能通过线上的方式指导，但齐老师那对于学术的严谨态度、对于项目的精益求精品质都使我受益匪浅。正因为齐老师这种认真负责的责任感以及对学生细致入微的关爱，让我一次次在面对压力与困难时从未妥协，也正因为有齐老师的指导我才可以顺顺利利地完成这次毕业设计。</p>
<p>其次，我还要感谢和同一毕业小组的同学们，在完成毕业设计的时光里我们互相勉励，一起解决了毕业设计中的一个个问题，一起进步与成长。纵使日后各奔东西，曾经的这份共情仍在。</p>
<p>在我们即将踏出校门步入社会之际，我的思绪万千，曾几何时懵懵懂懂地踏入大学校门，连最基本的编程都还没学，而现在已经能够独立自主设计一个完整的项目，这背后不仅包含自身的努力与付出，更映射着学校的栽培、老师的关爱、辅导员的呵护以及同学们的互助。因此我向你们致以我最真挚的感激，感谢一路有你们伴我度过这段有欢笑、有快乐、有付出、有收获的大学时光。</p>
<h1 id="参-考-文-献"><a href="#参-考-文-献" class="headerlink" title="参 考 文 献"></a>参 考 文 献</h1><p>[1]  张雨, 蔡鑫, 李爱民, 等. 分布式文件系统与 MPP 数据库的混搭架构在电信大数据平台中的应用[J]. 电信科学, 2013, 29(11): 12-16.</p>
<p>[2]  王波. 基于FastDFS的轻量级分布式文件系统的设计与实现[D]. 东北大学,2013.</p>
<p>[3]  巨头的云计算,谁将是下一个霸主?[J]. 软件, 2018, 39(06): 224-227.</p>
<p>[4]  杨正洪. 智慧城市: 大数据, 物联网和云计算之应用[M]. 清华大学出版社, 2017.</p>
<p>[5]  陈肇雄. 推进工业和信息化高质量发展[J]. 网信军民融合,2019(07):5-7.</p>
<p>[6]  徐为成. 5G时代 云计算发展的五大新趋势[J]. 通信世界,2019(20):46.</p>
<p>[7]  Li S, Da Xu L, Zhao S. 5G Internet of Things: A survey[J]. Journal of Industrial Information Integration, 2018, 10: 1-9.</p>
<p>[8]  本刊讯. 工信部印发《云计算发展三年行动计划(2017-2019年)》[J]. 中国公共安全, 2017(05): 20.</p>
<p>[9]  Singh J. Study on challenges, opportunities and predictions in cloud computing[J]. International Journal of Modern Education and Computer Science, 2017, 9(3): 17.</p>
<p>[10]  Jiang C, Wang Y, Ou D, et al. Energy efficiency comparison of hypervisors[J]. Sustainable Computing: Informatics and Systems, 2019, 22: 311-321.</p>
<p>[11]  Mesran M, Abdullah D, Hartama D, et al. Combination Base64 and Hashing Variable Length for Securing Data[C]//Journal of Physics: Conference Series. 2018, 1028: 012056.</p>
<p>[12]  刘佳祎,崔建明,智春. 基于Nginx服务器的动态负载均衡策略研究[J/OL]. 桂林理工大学学报:1-11[2020-06-22].</p>
<p>[13]  Hallberg J. Memcached och Redis cachning på lokalt system i en dator[J]. 2019.</p>
<p>[14]  张兰. 基于云计算的电子商务数据缓存处理的研究[J]. 电脑知识与技术,2016,12(23):249-250.</p>
<p>[15]  余庆. 分布式文件系统 FastDFS 架构剖析[J]. 程序员, 2010 (11): 63-65.</p>
<p>[16]  阮光耀. 基于负载均衡的FastDFS新存储节点的同步任务分配策略研究[D]. 武汉纺织大学,2019.</p>
<p>[17]  赵晔. 基于Nginx的Web后端服务器集群负载均衡技术的研究与改进[D]. 昆明理工大学,2017.</p>
<p>[18]  Chen X, Song Y, Ye H, et al. Research and Implementation of Digital Ancient Book Library Based on Solr/Lucene[J]. 2018.</p>
<p>[19]  许红军. 灵活配置,强化Nginx安全管理[J]. 网络安全和信息化,2018(06):132-135.</p>
<p>[20]  Eng L Z. Qt5 C++ GUI programming cookbook[M]. Packt Publishing Ltd, 2016.</p>
<p>[21]  Pospelov G. Developing BornAgain graphical user interface: lessons learned[C]//Workshop on Neutron Scattering Data Analysis Software. 2018, 6: 8.</p>
<p>[22]  陶文玲,侯冬青. PyQt5与Qt设计师在GUI开发中的应用[J]. 湖南邮电职业技术学院学报,2020,19(01):19-21.</p>
<p>[23]  李飞. 基于C/S模式的图件管理系统的构建[J]. 科技视界,2019(27):39-41.</p>
<p>[24]  石珊. 云平台下基于FastDFS的文件管理系统的研究与实现[D]. 电子科技大学,2019.</p>
<p>[25]  Bhandari A, Bhuiyan M, Prasad P W C. Enhancement of MD5 Algorithm for Secured Web Development[J]. JSW, 2017, 12(4): 240-252.</p>
<p>[26]  Carlson J L. Redis in action[M]. Manning Publications Co., 2013.</p>
<p>[27]  张云, 许江淳, 李玉惠, 等. 基于 Nginx 服务器负载均衡技术的研究与改进[J]. 软件, 2017, 38(8): 6-12.</p>
<p>[28]  王宁. 基于分布式云平台视频存储及管理[D]. 中国石油大学(华东),2016.</p>
<p>[29]  孔德云. 基于FastDFS的大并发问题的研究与应用[D]. 中北大学,2017.</p>
<p>[30]  Bourhis P, Reutter J L, Suárez F, et al. JSON: data model, query languages and schema specification[C]//Proceedings of the 36th ACM SIGMOD-SIGACT-SIGAI symposium on principles of database systems. 2017: 123-135.</p>
<p>[31]  杨丽波. 浅析集成测试和系统测试的关系[J]. 电子测试,2017(20):109-110.</p>
<p>[32]  范方政. 软件测试技术与缺陷跟踪管理的应用研究[D]. 吉林大学,2014.</p>
<p>[33]  朱健. 基于Qt Test的自动化单元测试[J]. 价值工程,2017,36(14):216-219.</p>
<h1 id="附-录"><a href="#附-录" class="headerlink" title="附 录"></a>附 录</h1><p><a href="#_Toc30457">图3-1  FastDFS分布式文件系统结构    7</a></p>
<p><a href="#_Toc2862">图3-2  FastDFS分布式文件系统集群    8</a></p>
<p><a href="#_Toc4893">图3-3  反向代理服务器原理    9</a></p>
<p><a href="#_Toc32637">图4-1  总体设计框架    12</a></p>
<p><a href="#_Toc29224">图4-2  总体方案结构    13</a></p>
<p><a href="#_Toc16969">图4-3  用户注册流程图    15</a></p>
<p><a href="#_Toc31498">图4-4  用户登录流程图    16</a></p>
<p><a href="#_Toc28835">图4-5  文件列表查询流程图    16</a></p>
<p><a href="#_Toc9982">图4-6  数据秒传流程图    17</a></p>
<p><a href="#_Toc24130">图4-7  数据上传流程图    18</a></p>
<p><a href="#_Toc32014">图4-8  文件删除流程图    19</a></p>
<p><a href="#_Toc3366">图4-9  文件共享流程图    20</a></p>
<p><a href="#_Toc26329">图4-10  文件下载流程图    21</a></p>
<p><a href="#_Toc18554">图4-11  图像预览流程图    21</a></p>
<p><a href="#_Toc17044">图4-12  客户端总体流程图    23</a></p>
<p><a href="#_Toc26303">图4-13  服务端总体流程图    24</a></p>
<p><a href="#_Toc22095">图5-1  数据库表结构    26</a></p>
<p><a href="#_Toc30503">图 5-2  用户界面结构    29</a></p>
<p><a href="#_Toc2169">图5-3  登录界面效果图    31</a></p>
<p><a href="#_Toc24127">图5-4  注册界面效果图    31</a></p>
<p><a href="#_Toc423">图5-5  文件界面结构    32</a></p>
<p><a href="#_Toc9681">图5-6  文件界面导航栏    33</a></p>
<p><a href="#_Toc7057">图5-7  我的文件效果图    34</a></p>
<p><a href="#_Toc1033">图5-8  共享列表效果图    34</a></p>
<p><a href="#_Toc16733">图5-9  下载榜效果图    35</a></p>
<p><a href="#_Toc24022">图5-10  传输列表效果图    35</a></p>
<p><a href="#_Toc9505">图5-11  配置设置效果图    37</a></p>
<p><a href="#_Toc18579">图5-12  任务进度图    38</a></p>
<p><a href="#_Toc28323">图5-13 上传任务界面效果图    38</a></p>
<p><a href="#_Toc20199">图5-14  图像预览列表图    45</a></p>
<p><a href="#_Toc18275">图6-1  GUI单元测试部分结果    48</a></p>
<p><a href="#_Toc31978">图6-2  虚拟机服务端环境性能测试    52</a></p>
<p><a href="#_Toc26587">图6-3  阿里云服务端环境性能测试    52</a></p>

      
    </div>
    
    
    
	
	  <div>
    
      <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;"><hr>文章结束了，但我们的故事还在继续</div>
    
</div>
    
	  </div>

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechat-reward-image.png" alt="王骏 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay-reward-image.jpg" alt="王骏 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/05/14/2020-05-14/" rel="next" title="请逗留一刻吧，是那样美丽">
                <i class="fa fa-chevron-left"></i> 请逗留一刻吧，是那样美丽
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/11/14/2020-11-14/" rel="prev" title="【性格篇】自称尼古拉的马迪奥——由性格所决定不同的《灿烂人生》">
                【性格篇】自称尼古拉的马迪奥——由性格所决定不同的《灿烂人生》 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNjA4NC8xMjYxOQ=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/blog-logo.jpg" alt="王骏">
            
              <p class="site-author-name" itemprop="name">王骏</p>
              <p class="site-description motion-element" itemprop="description">浪打浮沉惊白昼，沧海一笑浅悠悠。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">181</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">39</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">151</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/qian-youyou" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.15249144478@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://vjudge.net/user/15249144478" target="_blank" title="vjduge">
                      
                        <i class="fa fa-fw fa-globe"></i>vjduge</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/5264080143/profile?topnav=1&wvr=6&is_all=1" target="_blank" title="weibo">
                      
                        <i class="fa fa-fw fa-globe"></i>weibo</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.baidu.com/" target="_blank" title="baidu">
                      
                        <i class="fa fa-fw fa-globe"></i>baidu</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/qian_youyou" target="_blank" title="csdn">
                      
                        <i class="fa fa-fw fa-globe"></i>csdn</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.csdn.net/qian_youyou" title="浅悠悠CSDN" target="_blank">浅悠悠CSDN</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://my.csdn.net/por_una_cabze" title="渣渣灰CSDN" target="_blank">渣渣灰CSDN</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://my.csdn.net/messhiro" title="赵神CSDN" target="_blank">赵神CSDN</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.matrix67.com/" title="matrix67博客" target="_blank">matrix67博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://amon1997.com/" title="曹静的博客" target="_blank">曹静的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.csdn.net/sophia__yu" title="杨祥钰CSDN" target="_blank">杨祥钰CSDN</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>
	  <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=38592976&auto=1&height=66"></iframe>
	  
      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#摘-要"><span class="nav-number">1.</span> <span class="nav-text">摘 要</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ABSTRACT"><span class="nav-number">2.</span> <span class="nav-text">ABSTRACT</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-绪论"><span class="nav-number">3.</span> <span class="nav-text">1 绪论</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-课题背景"><span class="nav-number">3.1.</span> <span class="nav-text">1.1 课题背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-发展趋势"><span class="nav-number">3.2.</span> <span class="nav-text">1.2 发展趋势</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-项目意义"><span class="nav-number">3.3.</span> <span class="nav-text">1.3 项目意义</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-需求分析"><span class="nav-number">4.</span> <span class="nav-text">2  需求分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-功能需求分析"><span class="nav-number">4.1.</span> <span class="nav-text">2.1 功能需求分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1-服务端功能需求分析"><span class="nav-number">4.1.1.</span> <span class="nav-text">2.1.1 服务端功能需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-2-客户端功能需求分析"><span class="nav-number">4.1.2.</span> <span class="nav-text">2.1.2 客户端功能需求分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-可行性分析"><span class="nav-number">4.2.</span> <span class="nav-text">2.2 可行性分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-经济可行性分析"><span class="nav-number">4.2.1.</span> <span class="nav-text">2.2.1 经济可行性分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-技术可行性分析"><span class="nav-number">4.2.2.</span> <span class="nav-text">2.2.2 技术可行性分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-3-运行可行性分析"><span class="nav-number">4.2.3.</span> <span class="nav-text">2.2.3 运行可行性分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-4-操作可行性分析"><span class="nav-number">4.2.4.</span> <span class="nav-text">2.2.4 操作可行性分析</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-技术支持"><span class="nav-number">5.</span> <span class="nav-text">3  技术支持</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-FastDFS分布式文件系统"><span class="nav-number">5.1.</span> <span class="nav-text">3.1 FastDFS分布式文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-Nginx服务器反向代理与负载均衡"><span class="nav-number">5.2.</span> <span class="nav-text">3.2 Nginx服务器反向代理与负载均衡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-Qt客户端GUI界面设计"><span class="nav-number">5.3.</span> <span class="nav-text">3.3 Qt客户端GUI界面设计</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-设计方案"><span class="nav-number">6.</span> <span class="nav-text">4  设计方案</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-设计原理"><span class="nav-number">6.1.</span> <span class="nav-text">4.1 设计原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-总体设计方案"><span class="nav-number">6.2.</span> <span class="nav-text">4.2 总体设计方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-客户端设计方案"><span class="nav-number">6.2.1.</span> <span class="nav-text">4.2.1 客户端设计方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-服务端设计方案"><span class="nav-number">6.2.2.</span> <span class="nav-text">4.2.2 服务端设计方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-功能模块方案"><span class="nav-number">6.3.</span> <span class="nav-text">4.3 功能模块方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-1-用户注册与登录"><span class="nav-number">6.3.1.</span> <span class="nav-text">4.3.1 用户注册与登录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-2-文件列表查询"><span class="nav-number">6.3.2.</span> <span class="nav-text">4.3.2 文件列表查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-3-数据上传与秒传"><span class="nav-number">6.3.3.</span> <span class="nav-text">4.3.3 数据上传与秒传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-4-文件删除"><span class="nav-number">6.3.4.</span> <span class="nav-text">4.3.4 文件删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-5-文件共享与共享列表查询"><span class="nav-number">6.3.5.</span> <span class="nav-text">4.3.5 文件共享与共享列表查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-6-数据下载"><span class="nav-number">6.3.6.</span> <span class="nav-text">4.3.6 数据下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-7-图像预览"><span class="nav-number">6.3.7.</span> <span class="nav-text">4.3.7 图像预览</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-流程关系"><span class="nav-number">6.4.</span> <span class="nav-text">4.4 流程关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-1-客户端流程"><span class="nav-number">6.4.1.</span> <span class="nav-text">4.4.1 客户端流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-2-服务端流程"><span class="nav-number">6.4.2.</span> <span class="nav-text">4.4.2 服务端流程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-具体实现"><span class="nav-number">7.</span> <span class="nav-text">5  具体实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-服务端架构实现"><span class="nav-number">7.1.</span> <span class="nav-text">5.1 服务端架构实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-1-负载均衡"><span class="nav-number">7.1.1.</span> <span class="nav-text">5.1.1 负载均衡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-2-数据库设计"><span class="nav-number">7.1.2.</span> <span class="nav-text">5.1.2 数据库设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-3-文件对象存储"><span class="nav-number">7.1.3.</span> <span class="nav-text">5.1.3 文件对象存储</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-客户端架构实现"><span class="nav-number">7.2.</span> <span class="nav-text">5.2 客户端架构实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-1-用户界面设计"><span class="nav-number">7.2.1.</span> <span class="nav-text">5.2.1 用户界面设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-2-文件界面设计"><span class="nav-number">7.2.2.</span> <span class="nav-text">5.2.2 文件界面设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-3-基础功能模块"><span class="nav-number">7.2.3.</span> <span class="nav-text">5.2.3 基础功能模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-功能模块实现"><span class="nav-number">7.3.</span> <span class="nav-text">5.3 功能模块实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-1-数据封装与提取"><span class="nav-number">7.3.1.</span> <span class="nav-text">5.3.1 数据封装与提取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-2-用户登录与注册"><span class="nav-number">7.3.2.</span> <span class="nav-text">5.3.2 用户登录与注册</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-3-数据上传模块（上传、秒传）"><span class="nav-number">7.3.3.</span> <span class="nav-text">5.3.3 数据上传模块（上传、秒传）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-4-文件查询模块（文件列表、共享列表、下载榜）"><span class="nav-number">7.3.4.</span> <span class="nav-text">5.3.4 文件查询模块（文件列表、共享列表、下载榜）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-5-文件处理模块（删除、共享、转存）"><span class="nav-number">7.3.5.</span> <span class="nav-text">5.3.5 文件处理模块（删除、共享、转存）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-6-数据下载模块"><span class="nav-number">7.3.6.</span> <span class="nav-text">5.3.6 数据下载模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-7-图像预览模块"><span class="nav-number">7.3.7.</span> <span class="nav-text">5.3.7 图像预览模块</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-测试"><span class="nav-number">8.</span> <span class="nav-text">6  测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-程序调试"><span class="nav-number">8.1.</span> <span class="nav-text">6.1 程序调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-工具测试"><span class="nav-number">8.2.</span> <span class="nav-text">6.2 工具测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-1-测试的目的和意义"><span class="nav-number">8.2.1.</span> <span class="nav-text">6.2.1 测试的目的和意义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-2-测试框架"><span class="nav-number">8.2.2.</span> <span class="nav-text">6.2.2 测试框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-3-测试步骤"><span class="nav-number">8.2.3.</span> <span class="nav-text">6.2.3 测试步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-测试用例设计"><span class="nav-number">8.3.</span> <span class="nav-text">6.3 测试用例设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-4-测试数据及结果"><span class="nav-number">8.4.</span> <span class="nav-text">6.4 测试数据及结果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-1-功能测试数据及结果"><span class="nav-number">8.4.1.</span> <span class="nav-text">6.4.1 功能测试数据及结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-2-性能测试结果"><span class="nav-number">8.4.2.</span> <span class="nav-text">6.4.2 性能测试结果</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-总结"><span class="nav-number">9.</span> <span class="nav-text">7  总结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#致-谢"><span class="nav-number">10.</span> <span class="nav-text">致 谢</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参-考-文-献"><span class="nav-number">11.</span> <span class="nav-text">参 考 文 献</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#附-录"><span class="nav-number">12.</span> <span class="nav-text">附 录</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">王骏</span>

  
</div>


  <div class="powered-by">
版权由 <a class="theme-link" target="_blank" href="https://qian-youyou.github.io">王骏</a> 所有</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/qian-youyou">wj.Mist.5.2.0</a></div>



<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 光顾人数：前世
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      次邂逅
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 浏览次数：今生
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次回眸
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.2.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.2.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.2.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.2.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.2.0"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
    
      flOptions = {};
      
          flOptions.iconStyle = "box";
      
          flOptions.boxForm = "horizontal";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>

  

  

  

  

  
  
   <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;"></canvas> 
   <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
   <script type="text/javascript" src="/js/src/fireworks.js"></script>


</body>
</html>
<script type="text/javascript" src="/js/src/love.js"></script>