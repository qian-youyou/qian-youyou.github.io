<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>浅悠悠的个人博客</title>
  
  <subtitle>When there is no sunshine,talking to the moon.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://qianyouyou.cn/"/>
  <updated>2025-06-07T23:39:39.398Z</updated>
  <id>http://qianyouyou.cn/</id>
  
  <author>
    <name>王骏</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title></title>
    <link href="http://qianyouyou.cn/2025/06/08/2025-06-08/"/>
    <id>http://qianyouyou.cn/2025/06/08/2025-06-08/</id>
    <published>2025-06-07T21:30:48.075Z</published>
    <updated>2025-06-07T23:39:39.398Z</updated>
    
    <content type="html"><![CDATA[<p>梦的破壁者：输出型爱好  ——论白日梦的因果重塑</p><h3 id="第一幕：白日梦的甜蜜沼泽——当因果链断裂时"><a href="#第一幕：白日梦的甜蜜沼泽——当因果链断裂时" class="headerlink" title="第一幕：白日梦的甜蜜沼泽——当因果链断裂时"></a><strong>第一幕：白日梦的甜蜜沼泽——当因果链断裂时</strong></h3><p>晨光斜照书案时，我常盯着茶杯里浮沉的叶片怔忡——倘若此刻突然继承一笔神秘遗产，该购置林间木屋还是环球船票？这般念头如露水般在脑际闪烁，又随水汽蒸发无踪。这便是典型的白日梦境：<strong>愿望如烟花盛放于高空（果），却因行动之引信从未点燃（因），构成典型的”断桥式幻想”，终成虚妄的因果悖论。</strong></p><p>人总是痴迷于果，却怠慢于因。譬如幻想中彩票的狂喜，却从不踏足彩票站；渴慕登台领奖的荣光，却拒绝伏案磨砺的孤寂。白日梦便在这因果的裂隙中滋生，它悬于现实之上，如海市蜃楼般诱人，脚下却无寸土可依。它是一场颅内盛宴，以虚妄的甘霖浇灌干涸的渴望，却终究结不出可摘的果实。无用之用，固有其玄妙——庄子观鱼之乐，嵇康锻铁之闲，皆在功利之外开辟精神的自留地。然今日之”白日梦”，常沦为逃避行动的精致借口，沉溺于虚幻的”果”，而主动割裂了耕耘的”因”。此等梦境，终究是镜花水月，徒耗心神。 </p><p>古人称其为”黄粱美梦”，书生卢生枕青瓷入眠，梦中登科拜相，醒时灶上黍米未熟。现代心理学却揭示其本质：<strong>白日梦是欲望的镜像迷宫，我们在其中反复推演”倘若…就…”的虚拟剧本</strong>，却吝于在现实舞台迈出第一步。恰似渴盼中彩票者从不购彩，向往琴艺者永不触弦——当”因”的土壤始终荒芜，”果”的枝桠便只能寄生在意识的云端。</p><p>这种断裂在当代生活比比皆是：</p><ul><li>书架囤积三百本写作教程却从未提笔的”知识收藏家”</li><li>深夜收藏健身视频却在晨光中点击”稍后再练”的都市人</li><li>孩子能背诵课文却无法讲解错题的”沉默优等生”</li></ul><p>当”因”的土壤持续荒芜，”果”的枝桠只能寄生在意识的云端。心理学实验显示，长期沉溺此类幻想者，大脑会分泌大量多巴胺制造虚假满足，而前额叶皮层（负责执行功能的区域）活跃度持续降低——这正是行动力瘫痪的神经学根源。正如中国古代”黄粱美梦”的寓言 ，<strong>虚幻的因果演绎越是华丽，现实的行动根基越是脆弱</strong>。 </p><h3 id="第二幕：断桥修复术——无用之用的哲学启示"><a href="#第二幕：断桥修复术——无用之用的哲学启示" class="headerlink" title="第二幕：断桥修复术——无用之用的哲学启示"></a><strong>第二幕：断桥修复术——无用之用的哲学启示</strong></h3><p>要破解这一困局，需重返庄周梦蝶的哲学现场。当庄子质疑”不知周之梦为胡蝶与？胡蝶之梦为周与？”时，他揭示的不仅是认知相对论，更暗含存在转化的密钥：梦与醒的辩证统一，需通过”物证”实现连接。</p><ul><li><p><strong>物证转化案例</strong></p><p>19世纪巴黎的阁楼里，巴尔扎克将暴富妄想转化为《人间喜剧》的青铜群像；史铁生把”健康幻想”转化为对生死界限的勘探因而写成《务虚笔记》与《病隙碎笔》；罗翔将“完美法治”的执念解构为“圆圈正义”的谦卑认知而著成《法律的悖论》。这些实践印证了萨特的存在主义哲学：”人不是其所是，而是其所成”。当我们把彩票幻想转化为一张手绘彩票设计图，把环球旅行空想拆解为异国文化研究笔记——虚幻之果（what if）便倒逼实在之因（to do）。</p></li><li><p><strong>无用之用的现代显影</strong></p><p>日本匠人秋山利辉要求学徒每日绘制”器物灵魂草图”——这些看似与家具制作无关的线条练习（无用之果），需持续八年方准入技术研修（实在之因）。当草图积累逾万张时，学徒对木材肌理的感知力已融入血脉。 时间给他的复利回报，秋山工坊的学徒中，37%自立门户成为国宝级匠人，其作品被大英博物馆永久收藏。这种”以无用手训育有用之技”的模式，恰是庄子”无用之大用”的当代诠释——看似务虚的幻想，恰是创造的胚胎。</p></li></ul><p>庄周梦蝶的”物化”哲学在此显出新解：<strong>梦与醒的边界本是流动的，致命分野在于是否留下”物证”。</strong>蝶舞翩跹终随晨光消散，但若将蝶影绘于绢帛、谱入琴曲，虚幻的振翅便化作可触摸的翅痕。此谓”无用之用”的大用：看似务虚的幻想，恰是创造的胚胎。</p><p>此刻我们触及核心命题：<strong>所有可持续的创造，本质是因果链的重构工程。</strong>当陀思妥耶夫斯基赌轮盘还清债务的妄想（果）催生《赌徒》小说创作（因），当稿纸堆积（因）成就文学巨匠（果）——新的因果闭环便取代了断裂的幻想链。</p><h3 id="第三幕：输出型爱好——为幻想铸造青铜骨骼"><a href="#第三幕：输出型爱好——为幻想铸造青铜骨骼" class="headerlink" title="第三幕：输出型爱好——为幻想铸造青铜骨骼"></a>第三幕：输出型爱好——为幻想铸造青铜骨骼</h3><p>经济学中有道残酷公式：<strong>回报率 = 本金 × 收益率 × 时间</strong>。若输出值为零，整个等式即刻崩塌。至此我们看清核心公式：<strong>生命效能=（输入×转化率）×输出频次</strong>。当转化率趋近于零时，百万字的阅读量也不过是意识的泥石流。 这解释了为何囤积千本书籍的脑库不如撰写三篇笔记的心灵丰盈——前者如雨水积于死潭，后者似溪流催动水车。</p><p>我们常误将消费当创作：刷百条短视频称”学习影像叙事”，听万首歌曲谓”钻研乐理”。然则梭罗在《瓦尔登湖》中早有点破：”我步入丛林，因为我希望生活得有意义，我希望活的深刻，并汲取生命中所有的精华。然后从中学习，以免让我在生命终结时，却发现自己从来没有活过。”真正有效的阅读，是文字与生命经验发生的化合反应。</p><p>那些被浪漫化的”白日梦想家”，若只耽于颅内风暴而手无一物，其梦想不过是精致的废墟。真正的梦想家如凡尔纳笔下的尼摩船长，其海底两万里的瑰丽幻想，根植于对海洋学、工程学的深厚输入，更在小说这一载体中实现了磅礴的输出。幻想若不能借由某种形式显影于世，终究是幽闭密室里的独舞，其光不耀，其热不传。当输入如江河奔涌，却无一道闸门引导其倾泻，这丰沛的积累便只能在体内淤积、腐化，最终回报率为零。我们消费海量信息，聆听万千道理，若止步于此，不过是在意识的仓库里囤积了一堆未曾拆封的珍宝，蒙尘且无用。 </p><p>输入是采撷星光，输出才是铸造星座。此时，”输出型爱好”便显现其非凡价值。它非为换取世俗功利的工具，而是为奔涌的思绪开凿河道，让无形的精神能量获得具象的骨相。写作、绘画、摄影、手工、编程、演讲……凡此种种，皆是将灵魂印记拓印于世的技艺。此般爱好，本质上是主动与世界建立深度联结的管道——它迫使混沌的思绪在输出中澄澈，让私密的感动在分享中共振。如木工大师经年累月的敲打，从爱好者蜕变为传承者；如咖啡师荣姐由分享早餐美学而衍生出产品变现与商拍邀约；如设计师春春通过朋友圈输出作品，倒逼输入精进，终成独特风格的开创者。输出，赋予热爱以复利的翅膀。</p><p>《白日梦想家》更擅此道：沃尔特·米蒂（电影《白日梦想家》主角）从直升机跃入冰海追摄雪豹的瞬间，正是将脑海冒险投射为胶片的因果渡越。当幻想不再是思维的蒲公英，而是扎根于输出行为的种子——摄影机是锹，暗房是沃土，展览馆便是破土的苗圃。</p><h3 id="第四幕：破壁法则——在因果链上播种的农艺"><a href="#第四幕：破壁法则——在因果链上播种的农艺" class="headerlink" title="第四幕：破壁法则——在因果链上播种的农艺"></a>第四幕：破壁法则——在因果链上播种的农艺</h3><p>如何将飘渺的白日梦锻造成可触的输出？不妨借科学之刃雕琢幻想之玉：</p><ol><li><strong>以WOOP之法锚定虚幻</strong>： 德国心理学家Oettingen的”心理对照”（Mental Contrasting）提供路径——Wish（明确愿望）、Outcome（想象结果）、Obstacle（预见障碍）、Plan（制定对策）。幻想中彩票者，若用此法，必先自问：阻碍何在？是未曾购买？是选号无方？对策为何？是每周定额投入？是研究概率策略？此法在幻想与现实间架设理性之桥，让白日梦成为行动蓝图而非麻醉剂。</li><li><strong>择一事深耕，为输出赋形</strong>： 兴趣是火种，输出是燃炉。内向者可执笔为矛（写作、编程），外向者能发声为剑（演讲、视频）。不必贪多，择一契合天赋与热情之事：善思者写作，善察者摄影，善言者播客，善工者手作。如范范所倡：确定领域、制定计划、多渠道分享。写作不必鸿篇巨制，从百字日记开始；摄影无需昂贵器材，手机镜头亦能捕捉光影真意。工具仅为载体，核心在表达的冲动与持续的实践。</li><li><strong>以行动为针，缝合因果裂隙</strong>： 吸引力法则非玄学空想，其核心在于”量子行动”——幻想触发灵感，灵感催生最小行动，行动收获反馈，反馈驱动修正。白日梦若仅止步于”想”，便是无根之萍；唯有”做”，才能将”因”植入现实土壤。如陶艺家揉捏第一块陶土，程序员敲下第一行代码，写作者写出第一个句子——微小的行动，是打破虚幻与现实壁垒的锤击。行动中自会遭遇瓶颈，此时反馈如明镜：读者评论、观众反应、作品滞销皆是指路牌。调整非失败，而是路径的优化，如演讲者从听众眼神中调整节奏，写作者从退稿信中磨砺笔锋。</li><li><strong>在时间的长河中淘洗真金</strong>： 输出型爱好的回报，非即时兑现的快钱，而是”复制类职业”的长期复利。转换类职业（如按件计酬的工人）以时间换生存资料；复制类职业（如作家、程序员）则以一次高质量输出，撬动时间的杠杆，让作品在流通中持续增值。当写作凝结成书，代码封装为软件，摄影汇聚成集，手艺沉淀为品牌，其能量便能超越个体生命的时限，在更广阔的空间与时间里回响。此过程需如匠人般的沉潜与耐心，”事缓则圆，静待花开”。</li></ol><h3 id="终幕：在现实的砧板上锻打星辰"><a href="#终幕：在现实的砧板上锻打星辰" class="headerlink" title="终幕：在现实的砧板上锻打星辰"></a>终幕：在现实的砧板上锻打星辰</h3><p>每个孩童都曾是白日梦的富矿者，直到成人世界为其贴上”不切实”的封条。然纵观文明长河：凡·高在阿尔勒的艳阳下幻想旋涡星空，却以油彩将其凝成《星月夜》；曹雪芹于”举家食粥”间追忆旧日繁华，终将幻梦淬炼为《红楼梦》的玉璧。</p><p>白日梦本无罪，它是人类心智对庸常的温柔叛离，对可能性的诗意勘探。然若任其飘荡于虚空中，终将耗散于无形。唯有以”输出”为引信，才能点燃幻想深处的能量，将飘渺的蜃楼锻造成可栖居的精神家园。当我们提笔、举镜、运刀、编码、发声——每一次输出的动作，都是对虚无的抵抗，对存在的确证。那些在时间里埋下的种子，终将在专注的汗水中破土，将个体的微光，汇聚成照亮人间角落的星辰。无用之用，至此方为大用；白日梦想家，至此才真正拥有了大地上的居所。 </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;梦的破壁者：输出型爱好  ——论白日梦的因果重塑&lt;/p&gt;
&lt;h3 id=&quot;第一幕：白日梦的甜蜜沼泽——当因果链断裂时&quot;&gt;&lt;a href=&quot;#第一幕：白日梦的甜蜜沼泽——当因果链断裂时&quot; class=&quot;headerlink&quot; title=&quot;第一幕：白日梦的甜蜜沼泽——当因果链
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://qianyouyou.cn/2025/06/07/2025-06-07/"/>
    <id>http://qianyouyou.cn/2025/06/07/2025-06-07/</id>
    <published>2025-06-06T19:44:36.160Z</published>
    <updated>2025-06-22T10:16:56.264Z</updated>
    
    <content type="html"><![CDATA[<h2 id="递归梦境：在熵增深渊里焊接银河渡船"><a href="#递归梦境：在熵增深渊里焊接银河渡船" class="headerlink" title="递归梦境：在熵增深渊里焊接银河渡船"></a><strong>递归梦境：在熵增深渊里焊接银河渡船</strong></h2><p>空调外机的低鸣在子夜涨潮，忽被一阵急促的键盘敲击声刺破——我的手指在梦醒后敲打着虚空。</p><p>今夜梦境是台越狱的虚拟机： 高考卷面的沙沙声竟编译成工位键盘的疾雨，出租屋上铺床架的呻吟突变为经理破门的训斥。两个时空的钢索绞紧胸腔，勒紧每个正在逃逸的梦境。</p><hr><h3 id="一、叩问：梦为何总在旧代码里编译？"><a href="#一、叩问：梦为何总在旧代码里编译？" class="headerlink" title="一、叩问：梦为何总在旧代码里编译？"></a><strong>一、叩问：梦为何总在旧代码里编译？</strong></h3><p>最近梦境如顽固的递归函数，今夜意识流溢出核心栈：</p><ul><li><p><strong>场景A</strong>：高考在即，然而放学时校门口油锅里滋啦作响的油条，香味漫过十年光阴直抵今晨的舌根。突然，油条香气刺穿时空防火墙 ，物理公式在演算纸上坍缩成乱码，同桌突然将纸团抛过楚河汉界。  而校门口油锅滋啦作响的爆鸣，竟在十年后编译成唤醒胃囊的<code>SystemCall</code>。</p><p>——  <em>弗洛伊德注：味觉记忆是埋入海马体的Hook函数，当现实感官带宽不足时，触发童年补偿性回滚</em>  </p></li><li><p><strong>场景B</strong>：即将奔赴职场，城中村出租屋里，中介甩来的电子合同在手机屏闪烁，<code>rm -rf youth</code>（删除青春）的代码幻影在条款间游走。 出租屋的日光灯管焊入视觉暂留区，睡在上铺的我，鼾声沿双层床架垂直坠落，在耳蜗里堆叠成<code>ERROR</code>日志瀑布。 眼皮烙着青白灼痕，如<code>BIOS</code>启动失败的报错光标。</p><p>—— <em>荣格注：过度劳累时，集体潜意识将压力具象为「光污染废墟」，提醒主体平衡阴阳能量场</em> </p></li><li><p><strong>场景C</strong>：通宵加班，室友的抱怨声悬浮在宿舍暖光里：“本月宽带费暖气费均摊。” 声波未抵达听觉皮层，经理推门的震波震落了墙灰，墙灰粒子在经理的训斥声中完成量子跃迁。那被震落的尘埃， 竟在晨光衍射中重组为浮动的金粉矩阵。</p><p>—— <em>量子梦境假说：观察者效应使创伤记忆发生波函数坍缩，痛苦被意识渲染为勋章</em> </p></li></ul><p>醒时指尖残留着薄膜键盘的塑胶触感，鼻腔却灌满此刻卧室的香薰机水雾。那些被deadline追杀、被ERROR日志与线上问题逼至深渊的日夜，竟在回望时镀上了蜜色光晕。而此刻人体工学椅托着腰椎，4K屏流淌着护眼光谱，灵魂却像被抽走核心线程的进程，悬停在静默的等待队列。</p><hr><h3 id="二、辩证：怀旧是记忆的编译谬误吗？"><a href="#二、辩证：怀旧是记忆的编译谬误吗？" class="headerlink" title="二、辩证：怀旧是记忆的编译谬误吗？"></a><strong>二、辩证：怀旧是记忆的编译谬误吗？</strong></h3><h4 id="假说1：怀旧是懦弱的返祖现象"><a href="#假说1：怀旧是懦弱的返祖现象" class="headerlink" title="假说1：怀旧是懦弱的返祖现象"></a>假说1：怀旧是懦弱的返祖现象</h4><p>如同过时的API接口强行调用废弃库函数，在舒适区的沙箱里反复执行<code>nostalgia.exe</code>。当现实CPU满载运行时，意识却将线程切换至ROM只读存储器——那些高考油条的焦香、双层床架的震颤，不过是刻录在神经突触里的只读扇区。我们像被困在死循环的进程，用昨日残片构建今日的虚拟内存，实则是畏惧为未来分配新的堆栈空间。 </p><h4 id="假说2：梦境是现实的镜像溢出"><a href="#假说2：梦境是现实的镜像溢出" class="headerlink" title="假说2：梦境是现实的镜像溢出"></a>假说2：梦境是现实的镜像溢出</h4><p>当现实进入低功耗模式（安逸生活），被压抑的匮乏体验便激活海马体的Hook函数。那些被<code>kill -9</code>强制终止的奋斗进程（高考冲刺/职场求生），在睡眠态获得root权限后开始疯狂回滚。记忆熔断保护器被击穿，十年陈的油锅爆鸣与经理训斥声在脑皮层混音播放——这是精神熵增的必然：系统必须调用高负载记忆（奋斗岁月）维持能量守恒，否则安逸的温水将彻底溶解灵魂的晶体振荡器。 </p><h4 id="假说3：幻象是未来的加密信函"><a href="#假说3：幻象是未来的加密信函" class="headerlink" title="假说3：幻象是未来的加密信函"></a>假说3：幻象是未来的加密信函</h4><p>当晨光中的墙灰坍缩为金粉矩阵时，我听见量子比特在耳蜗低语：所有创伤都是被折叠的虫洞入口。高考演算纸上的乱码实则是自解压程序，正将物理公式重组为职场危机的补丁包；经理破门的震波在时空连续体上激发的涟漪，此刻正推动我的指尖敲下这行代码。正如量子纠缠无视光锥约束，那些在ERROR日志里垂直坠落的鼾声，终将在某次波函数坍缩中重组为超导量子比特。</p><hr><h3 id="三、顿悟：光在裂隙处显形"><a href="#三、顿悟：光在裂隙处显形" class="headerlink" title="三、顿悟：光在裂隙处显形"></a><strong>三、顿悟：光在裂隙处显形</strong></h3><p>我抽出大学时买的已落灰的《庄子》，指尖在“与时俱化”旁按出指纹。那时不懂何谓“安时而处顺”，只觉每个字都是砸向铁屋的陨石。</p><p>落灰的《庄子》突然释放电磁脉冲。当指纹激活”与时俱化”的古老字节，所有递归梦境瞬间终止core dump。我意识到：高考考场上抛来的橡皮擦、出租屋墙灰震荡成的金粉、甚至经理训斥声在听觉神经激发的量子纠缠——这些从来不是需要修复的bug，而是宇宙编译器预埋的<code>#pragma</code>优化指令。 油条香气穿透的何止时空防火墙？它早已将海马体改造成冯诺依曼架构的奇点：童年滋啦作响的油锅是L1缓存，职场键盘疾雨是L2预取器，而此刻卧室香薰机的氤氲水雾，正通过嗅觉总线将整个记忆体系升级为存算一体架构。原来光从未消失，它只是被压缩在人生.bin文件的间隙里，等待<code>dd</code>命令的按位读取。 </p><hr><blockquote><p><strong>终章：向熵增宣战的生灵</strong></p><p>机箱风扇的尘埃在4K护眼光谱中跳起玻色-爱因斯坦凝聚之舞。那些被Deadline追杀的日夜、被线上问题逼至悬崖的瞬间，此刻正以反物质态注入我的脊髓——它们不再是需要GC回收的堆内存，而是驱动量子隧穿的势垒。  人体工学椅托举的何止腰椎？它承载着正进行实时无损压缩的时空连续性。当十年前的油条香与今日的键盘声在哈希表中碰撞出希格斯玻色子，我终于编译出对抗热寂的终极算法：将高考答卷的演算纸折成哥德尔宇宙船，让经理训斥声的震波转换为曲率引擎的初始动能。机箱风扇卷起尘埃起舞。<br>此身此夜，且以残存指骨为焊枪，熔铸断点成银河渡船。那些曾经日夜敲打我的ERROR日志，此刻正以超流体形态托举船体，驶向记忆奇点的事件视界。 </p><p>蓦然读懂《齐物论》页脚的指纹：<br><strong>与时俱化者，非弃旧也——昨日之我凿穿的岩层，恰是今日之光抵达的甬道</strong></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;递归梦境：在熵增深渊里焊接银河渡船&quot;&gt;&lt;a href=&quot;#递归梦境：在熵增深渊里焊接银河渡船&quot; class=&quot;headerlink&quot; title=&quot;递归梦境：在熵增深渊里焊接银河渡船&quot;&gt;&lt;/a&gt;&lt;strong&gt;递归梦境：在熵增深渊里焊接银河渡船&lt;/strong&gt;&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>一句话影评，剧荒时可以捞捞</title>
    <link href="http://qianyouyou.cn/2020/12/06/2020-12-06/"/>
    <id>http://qianyouyou.cn/2020/12/06/2020-12-06/</id>
    <published>2020-12-06T12:24:34.000Z</published>
    <updated>2020-12-06T13:26:18.313Z</updated>
    
    <content type="html"><![CDATA[<h1 id="电影"><a href="#电影" class="headerlink" title="电影"></a>电影</h1><h2 id="内地"><a href="#内地" class="headerlink" title="内地"></a>内地</h2><h3 id="姜文"><a href="#姜文" class="headerlink" title="姜文"></a>姜文</h3><h4 id="执导"><a href="#执导" class="headerlink" title="执导"></a>执导</h4><h5 id="《阳光灿烂的日子》"><a href="#《阳光灿烂的日子》" class="headerlink" title="《阳光灿烂的日子》"></a>《阳光灿烂的日子》</h5><p>一句话影评：</p><p>综合评分（个人）：★★★★☆</p><p>编剧：★★★★★</p><p>镜头：★★★★☆</p><p>配乐：★★☆</p><p>立意：★★★★★</p><p>故事结构：★★★★★</p><p>电影影响力：★★★★☆</p><p>分类：剧情</p><p>标签：青春</p><h5 id="《让子弹飞》"><a href="#《让子弹飞》" class="headerlink" title="《让子弹飞》"></a>《让子弹飞》</h5><p>一句话影评：</p><p>综合评分（个人）：★★★★☆</p><p>编剧：★★★★★</p><p>镜头：★★★☆</p><p>配乐：★★★★☆</p><p>立意：★★★</p><p>故事结构：★★★★★</p><p>电影影响力：★★★★☆</p><p>分类：</p><p>标签：</p><h5 id="《太阳照常升起》"><a href="#《太阳照常升起》" class="headerlink" title="《太阳照常升起》"></a>《太阳照常升起》</h5><p>一句话影评：</p><p>综合评分（个人）：★★★★☆</p><p>编剧：★★★★★</p><p>镜头：★★★★</p><p>配乐：★★★★☆</p><p>立意：★★★</p><p>故事结构：★★★★★</p><p>电影影响力：★★★</p><p>分类：</p><p>标签：</p><h5 id="《鬼子来了》"><a href="#《鬼子来了》" class="headerlink" title="《鬼子来了》"></a>《鬼子来了》</h5><p>一句话影评：</p><p>综合评分（个人）：★★★★☆</p><p>编剧：★★★★★</p><p>镜头：★★★★</p><p>配乐：★★★</p><p>立意：★★★★★</p><p>故事结构：★★★★★</p><p>电影影响力：★★★★☆</p><p>分类：</p><p>标签：</p><h5 id="《一步之遥》"><a href="#《一步之遥》" class="headerlink" title="《一步之遥》"></a>《一步之遥》</h5><p>一句话影评：</p><p>综合评分（个人）：★★★☆</p><p>编剧：★★★★★</p><p>镜头：★★★★</p><p>配乐：★★★★☆</p><p>立意：★★★</p><p>故事结构：★★★☆</p><p>电影影响力：★★★</p><p>分类：</p><p>标签：</p><h5 id="《邪不压正》"><a href="#《邪不压正》" class="headerlink" title="《邪不压正》"></a>《邪不压正》</h5><p>一句话影评：</p><p>综合评分（个人）：★★★☆</p><p>编剧：★★★☆</p><p>镜头：★★★★</p><p>配乐：★★★★☆</p><p>立意：★★★</p><p>故事结构：★★★★★</p><p>电影影响力：★★★</p><p>分类：</p><p>标签：</p><h4 id="主演"><a href="#主演" class="headerlink" title="主演"></a>主演</h4><h5 id="《有话好好说》"><a href="#《有话好好说》" class="headerlink" title="《有话好好说》"></a>《有话好好说》</h5><p>一句话影评：</p><p>综合评分（个人）：★★★★</p><p>编剧：★★★☆</p><p>镜头：★★★★</p><p>配乐：★★★★☆</p><p>立意：★★★</p><p>故事结构：★★★★★</p><p>电影影响力：★★★</p><p>分类：</p><p>标签：</p><h5 id="《芙蓉镇》"><a href="#《芙蓉镇》" class="headerlink" title="《芙蓉镇》"></a>《芙蓉镇》</h5><h3 id="张艺谋"><a href="#张艺谋" class="headerlink" title="张艺谋"></a>张艺谋</h3><h3 id="冯小刚"><a href="#冯小刚" class="headerlink" title="冯小刚"></a>冯小刚</h3><h5 id="《天下无贼》"><a href="#《天下无贼》" class="headerlink" title="《天下无贼》"></a>《天下无贼》</h5><h3 id="徐峥"><a href="#徐峥" class="headerlink" title="徐峥"></a>徐峥</h3><h3 id="沈腾"><a href="#沈腾" class="headerlink" title="沈腾"></a>沈腾</h3><h3 id="黄渤"><a href="#黄渤" class="headerlink" title="黄渤"></a>黄渤</h3><h2 id="港台"><a href="#港台" class="headerlink" title="港台"></a>港台</h2><h3 id="王家卫"><a href="#王家卫" class="headerlink" title="王家卫"></a>王家卫</h3><p>《东邪西毒》</p><p>《重庆森林》</p><p>《阿飞正传》</p><p>《花样年华》</p><p>《2046》</p><p>《堕落天使》</p><p>《一代宗师》</p><h3 id="周星驰"><a href="#周星驰" class="headerlink" title="周星驰"></a>周星驰</h3><p>《功夫》</p><p>《少林足球》</p><p>《大话西游1-2》</p><p>《食神》</p><p>《国产凌凌漆》</p><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h2 id="欧美"><a href="#欧美" class="headerlink" title="欧美"></a>欧美</h2><h3 id="时光三部曲"><a href="#时光三部曲" class="headerlink" title="时光三部曲"></a>时光三部曲</h3><p>《海上钢琴师》</p><p>《天堂电影院》</p><p>《西西里的美丽传说》</p><h3 id="人生篇"><a href="#人生篇" class="headerlink" title="人生篇"></a>人生篇</h3><p>《教父1-3》</p><p>《美国往事》</p><p>《灿烂人生1-3》</p><h2 id="日韩"><a href="#日韩" class="headerlink" title="日韩"></a>日韩</h2><h2 id="其他-1"><a href="#其他-1" class="headerlink" title="其他"></a>其他</h2><h1 id="动漫"><a href="#动漫" class="headerlink" title="动漫"></a>动漫</h1><h2 id="欧美-1"><a href="#欧美-1" class="headerlink" title="欧美"></a>欧美</h2><p>《飞屋环游记》</p><p>《疯狂动物城》</p><p>《头脑特工队》</p><p>《玩具总动员1-4》</p><p>《无敌破坏王》</p><p>《疯狂原始人》</p><h2 id="日韩-1"><a href="#日韩-1" class="headerlink" title="日韩"></a>日韩</h2><h3 id="今敏"><a href="#今敏" class="headerlink" title="今敏"></a>今敏</h3><p>《红辣椒》</p><p>《未麻的部屋》</p><p>《千年女优》</p><h3 id="宫崎骏"><a href="#宫崎骏" class="headerlink" title="宫崎骏"></a>宫崎骏</h3><p>《千与千寻》</p><p>《红猪》</p><p>《龙猫》</p><p>《侧耳倾听》</p><p>《哈尔的移动城堡》</p><p>《魔女宅急便》</p><p>《幽灵公主》</p><p>《风之谷》</p><p>《天空之城》</p><p>《百变狸猫》</p><p>《起风了》</p><h3 id="新海诚"><a href="#新海诚" class="headerlink" title="新海诚"></a>新海诚</h3><p>《秒速五厘米》</p><p>《你的名字。》</p><p>《天气之子》</p><p>《言叶之庭》</p><h3 id="其他-2"><a href="#其他-2" class="headerlink" title="其他"></a>其他</h3><p>《声之形》</p><p>《穿越时空的少女》</p><p>《我想吃掉你的胰脏》</p><p>《烟花》</p><h2 id="内地-1"><a href="#内地-1" class="headerlink" title="内地"></a>内地</h2><p>《白蛇：缘起》</p><p>《大圣归来》</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;电影&quot;&gt;&lt;a href=&quot;#电影&quot; class=&quot;headerlink&quot; title=&quot;电影&quot;&gt;&lt;/a&gt;电影&lt;/h1&gt;&lt;h2 id=&quot;内地&quot;&gt;&lt;a href=&quot;#内地&quot; class=&quot;headerlink&quot; title=&quot;内地&quot;&gt;&lt;/a&gt;内地&lt;/h2&gt;&lt;h3 id
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>【性格篇】自称尼古拉的马迪奥——由性格所决定不同的《灿烂人生》</title>
    <link href="http://qianyouyou.cn/2020/11/14/2020-11-14/"/>
    <id>http://qianyouyou.cn/2020/11/14/2020-11-14/</id>
    <published>2020-11-14T11:22:06.000Z</published>
    <updated>2020-11-21T04:16:11.850Z</updated>
    
    <content type="html"><![CDATA[<p>一直以来都想写一些关于对性格思考方面的文字。今天正好有空以《灿烂人生》这部电影对性格进行一番探讨。首先我先以两个主人公尼古拉和马迪奥为切入点梳理一下剧情。</p><p>1966年的罗马，社会动荡，经济萧条。马迪奥与尼古拉两兄弟的故事便从这座历史悠久而又命运坎坷的城市展开。</p><p>故事开始，两兄弟都在罗马大学学习，马迪奥学习文学，向来聪明，成绩优秀，但性格有点孤立，和父母之间很少沟通。在一次期末考试中，由于推崇一位辱骂父辈的诗人而遭到老师的责备，由于无法忍受老师对诗歌的浅薄见解而拂袖而去。这是电影中第一次表现他性格的镜头，简单粗暴地对抗着自己所认为的黑暗，尽管电影已预见他未来注定悲剧的命运，仍义无反顾。</p><p>尼古拉攻读医学，一直敬仰马迪奥，虽然成绩没有马迪奥好，但为人友善亲切，深受父母的赞赏。在期末考试中，虽然成绩不是很优异，但凭借宽仁之心博得考官赞赏，获得了考官给出的最高分。考官建议他游历四方，因为意大利没有希望。</p><p>马迪奥在精神病院帮工时，陪一个叫佐珍的患者做病理分析。佐珍一头金发，美丽的外表却掩饰不住对世界充满警觉的眼神。马迪奥很快被佐珍吸引，然而在相处的过程中佐珍喜怒无常的脾气让两人相处并不愉快。经询问马迪奥得知，年少时佐珍与常人无异，由于母亲的去世渐渐封闭了自我，成为了被社会判为有“缺陷”的人。一次马迪奥给佐珍拍照时偶然间发现了佐珍额头上的伤痕，经询问尼古拉得知这是长时间受点击留下的伤痕。马迪奥恍然大悟，那些道貌岸然的医生背地里经常折磨着佐珍。二人原本计划与朋友巴图和卡洛一起出国旅行，但不忍看佐珍在医院受折磨，于是决定先帮佐珍回家，然后再旅行。</p><p>途中，三人露宿在一家破旧的房屋里，马迪奥久久难免。他起身发现了一个佐珍笔记本，里面写着马迪奥的名字，马迪奥感慨万千，就在这时佐珍忽然醒了，看见自己的笔记本在马迪奥手上，愤怒地抢夺着笔记本，马迪奥连忙解释，但面对佐珍的大喊大叫却束手无策。尼古拉被惊醒后，从容的支开马迪奥，说一切由他处理。友善地为佐珍系着纽扣，佐珍平息下来，默默看着尼古拉做的一切。远处马迪奥也看在眼里。</p><p>早上，三人来到佐珍的家里，他父亲见到佐珍后却不愿接纳佐珍，想着已经支付了医院的费用，不管兄弟两人的解释，要求佐珍回去。此时马迪奥愤怒地跟她父亲扭打一起，最终无果而归。兄弟二人只好商定将佐珍送到意大利最好的精神病医院。</p><p>三人来到一家杂货店，马迪奥为了弥补佐珍，为她点了一首歌，佐珍比划着喜欢的曲名。此刻二人的心走到了一生中最近的时刻。尼古拉建议佐珍多与人交流，让她去买三个冰淇淋，但佐珍再买冰淇淋时异常的行为引起了警察的注意，由于没有身份证而被警察带走。兄弟二人看在眼里却没有办法，因为私自把精神病人带出医院属于犯法。</p><p>晚上，二人露宿车站，马迪奥彻夜难眠，他看着这眼前世界的不公自己却无能为力。终于他起身拎起行李踏上了返回罗马的列车。闻到动静的尼古拉起身询问马迪奥为什么丢下自己和朋友独自回去罗马，马迪奥只说那次重要的考试他没有通过。尼古拉愤然关上了列车的门，二人分道扬镳，自此两人截然不同的命运从这趟列车展开。</p><p>未完待续，，，，，，</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;一直以来都想写一些关于对性格思考方面的文字。今天正好有空以《灿烂人生》这部电影对性格进行一番探讨。首先我先以两个主人公尼古拉和马迪奥为切入点梳理一下剧情。&lt;/p&gt;
&lt;p&gt;1966年的罗马，社会动荡，经济萧条。马迪奥与尼古拉两兄弟的故事便从这座历史悠久而又命运坎坷的城市展开。
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>基于云存储的图像管理平台设计与实现</title>
    <link href="http://qianyouyou.cn/2020/07/01/2020-07-01/"/>
    <id>http://qianyouyou.cn/2020/07/01/2020-07-01/</id>
    <published>2020-07-01T15:52:26.000Z</published>
    <updated>2020-07-26T15:54:25.165Z</updated>
    
    <content type="html"><![CDATA[<p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps1.jpg" alt="img"></p><p>毕 业 设 计</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps2.jpg" alt="img"> </p><p><strong>题目：</strong> <strong>基于云存储的图像管理平台设计与实现</strong>                                                                       </p><p><strong>学    生：</strong>         王骏         </p><p><strong>学    号：</strong>     201606060129     </p><p><strong>学    院：</strong>电子信息与人工智能学院</p><p><strong>专    业：</strong>   计算机科学与技术   </p><p><strong>指导教师：</strong>         齐勇         </p><p>2020<strong>年</strong> 6 <strong>月</strong> 30 <strong>日</strong></p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps3.jpg" alt="img"></p><p><strong>毕业设计（论文）任务书</strong></p><p>电子信息与人工智能 <strong>学院</strong> 计算机科学与技术 <strong>专业</strong> 163<strong>班级 学生：</strong>王骏</p><p><strong>题目：</strong>            基于云存储的图像管理平台设计与实现                                                 </p><p><strong>毕业设计（论文）从</strong> 2020 <strong>年</strong> 2 <strong>月</strong> 24 <strong>日起到</strong> 2020 <strong>年</strong> 6 <strong>月</strong>   15   <strong>日</strong></p><p><strong>课题的意义及培养目标：</strong></p><p>在本本次毕业设计中，将会综合运用本科所学计算机科学与技术专业相关知识，完成实际的应用开发。</p><p>传统的云存储系统采用集中的存储服务器存放所有数据，存储服务器成为系统性能的瓶颈，也是可靠性和安全性的焦点，不能满足大规模存储应用的需要。</p><p>分布式网络存储系统采用可扩展的系统结构，利用多台存储服务器分担存储负荷，利用位置服务器定位存储信息，它不但提高了系统的可靠性、可用性和存取效率，还易于扩展。因此，本项目利用多台服务器的存储资源来弥补传统云存储系统的不足，通过Nginx服务器作为负载均衡服务实现高负载的分布式云存储方案。</p><p><strong>设计（论文）所需收集的原始数据与资料：</strong></p><p>C++相关的开发软件工具，Qt客户端设计工具，Nginx服务器，Linux操作系统，MySQL数据库，Redis数据库，分布式文件系统，项目所需的图像数据，分布式文件系统相关资料。</p><p><strong>课题的主要任务（需附有技术指标分析）：</strong></p><p>本次设计主要为高负载高并发基于分布式的图像管理存储平台。主要实现用户注册，用户登陆，图像文件列表获取，文件上传，下载，分享，删除等基本功能。</p><p>本次设计采用C/S架构，分为客户端和服务端，客户端采用Qt进行界面设计。服务端的基本流程为，客户端请求经过反向代理后通过HTTP服务器请求进行相应分布式文件系统管理及数据库管理。以上传为例，首先客户端的请求通过Nginx反向迭代处理作为负载均衡方案，之后通过对应服务器请求先进行数据库信息校验，当该上传数据不存在时，通过追踪器将图像数据存储到相应的分布式文件系统中，再将存储信息存储至数据库以及缓存数据库中。</p><p>预计：并发量同步请求初步预计500人左右。本地测试上传速度：30MB/S ~ 50MB/S 客户端下载速度： 20MB/S ~ 40MB/S 服务器中上传速度： 5MB/S ~ 7MB/S 客户端下载速度： 0.1MB/S~ 0.15MB/S </p><p><strong>设计（论文）进度安排及完成的相关任务（以教学周为单位）：</strong></p><table><thead><tr><th><strong>周 次</strong></th><th><strong>设计（论文）任务及要求</strong></th></tr></thead><tbody><tr><td>1-3</td><td>相关资料的查阅与学习</td></tr><tr><td>4-5</td><td>整个方案的初步设计</td></tr><tr><td>6-10</td><td>代码的设计与实现</td></tr><tr><td>11-12</td><td>测试与bug修复</td></tr><tr><td>13-14</td><td>论文的梳理</td></tr><tr><td>15-16</td><td>论文的完善</td></tr></tbody></table><p>​                                    学生签名：             </p><p>​                                    指导教师：             </p><p>​                                  教研室主任：             </p><p>基于云存储的图像管理平台设计与实现</p><h1 id="摘-要"><a href="#摘-要" class="headerlink" title="摘 要"></a>摘 要</h1><p>随着计算机与网络的发展，国内外的图像存储已逐渐实现由传统图像向数字化图像转型。这意味着图像越来越多地以二进制信息保存在计算机中，这样不仅可以长期保存，而且还有方便复制、随意修改、便于传输等优点。而随着大数据与云计算的发展，图像的存储逐渐也向分布式存储方向发展，使得图像管理的物理存储资源不一定直接连接在本地节点上，而是通过计算机网络与节点相连。分布式文件系统的设计基于C/S模式。而且分布式文件系统也轻松解决了海量图像处理的难题。</p><p>利用大数据和云计算的优势，以云存储的方式进行图像数字化存储管理，可以解决常规对象存储所常见的海量图像存储效率低下且不安全、服务器无法承载多用户并发访问等问题。因此设计一套基于分布式文件系统的云存储图像管理平台，为用户提供高效且安全的图像上传、下载、分享、预览等对象存储与管理服务，解决常规物理存储所带来的数据易丢失难恢复、下载存储不方便、存储空间有限、需随身携带等问题，同时解决普通存储网盘用户并发量低下、数据共享性差等问题。</p><p>平台采用C/S模型，即客户端/服务端模式。客户端通过Qt可视化设计工具设计用户界面与文件管理界面，客户端语言通过使用Qt类库完成客户端逻辑。服务端框架首先采用Nginx服务器进行反向代理，解决负载均衡与高并发问题；数据对象存储通过分布式文件系统FastDFS进行数据存储；数据库通过持久化数据库MySQL与缓存数据库Redis的协调工作进行数据信息管理；服务端语言采用以C++语言为主的CGI程序完成服务端逻辑。</p><p>基于云存储的图像管理平台，最终为用户提供高效且安全的图像云存储与管理服务，包括用户的登录与注册、数据上传、数据下载、文件列表浏览、共享文件浏览、下载榜浏览、数据传输情况浏览、文件的共享与转存、数据删除、图像预览等功能，可作为图床进行图像存储，也可作为云盘进行对象存储，方便用户对图像数据进行数字化管理。</p><p>关键词：云存储，分布式文件系统，Nginx，MySQL，C++，Qt</p><p><strong>Design and</strong> <strong>I**</strong>mplementation of<strong> </strong>I<strong>**mage</strong> <strong>M**</strong>anagement<strong> </strong>P<strong>**latform based on</strong> <strong>C**</strong>loud<strong> </strong>S<strong>**torage</strong></p><h1 id="ABSTRACT"><a href="#ABSTRACT" class="headerlink" title="ABSTRACT"></a><strong>ABSTRACT</strong></h1><p>With the development of computer and network, image storage at home and abroad has gradually realized the transformation from traditional image to digital image. This means that the image is more and more stored in the computer with binary information, which not only can be saved for a long time, but also has the advantages of convenient replication, arbitrary modification, easy transmission and so on. With the development of big data and cloud computing, the storage of images is also gradually developing towards distributed storage. The design of distributed file system is based on C / S mode. Moreover, the distributed file system can easily solve the problem of massive image processing.</p><p>By using the advantages of big data and cloud computing, digital image storage management in the way of cloud storage can solve the common problems of mass image storage, such as low efficiency and insecurity, the server can not carry multi-user concurrent access and so on. Therefore, a set of cloud storage image management platform based on the distributed file system is designed to provide users with efficient and safe image upload, download, share, preview and other object storage and management services, to solve the problems brought by the conventional physical storage, such as easy loss and hard recovery of data, inconvenient Download and storage, limited storage space, need to carry around, and to solve the common storage network disk There are many problems such as low concurrent users and poor data sharing.</p><p>The platform adopts C / S model, namely client / server mode. The client uses QT visual design tool to design user interface and file management interface, and the client language uses QT class library to complete the client logic. The server framework first uses nginx server as the reverse proxy to solve the problem of load balance and high concurrency; the data object storage uses fastdfs as the distributed file system for data storage; the database uses MySQL as the persistent database to coordinate with redis as the cache database for data information management; the server language uses CGI program based on C + + to complete the server logic.</p><p>The image management platform based on cloud storage provides users with efficient and safe image cloud storage and management services, including user login and registration, data upload, data download, file list browsing, shared file browsing, download list browsing, data transmission browsing, file sharing and transfer, data deletion, image preview and other functions, which can be used as a drawing bed Image storage can also be used as cloud disk for object storage, which is convenient for users to digitize image data management.</p><p><strong>Key</strong> <strong>words:</strong> Cloud Storage, Distributed File System, Nginx, MySQL, C + +, QT</p><p>目 录</p><p><a href="#_Toc2488">摘 要    I</a></p><p><a href="#_Toc13379">ABSTRACT    II</a></p><p><a href="#_Toc24459">1 绪论    1</a></p><p><a href="#_Toc16618">1.1 课题背景    1</a></p><p><a href="#_Toc1878">1.2 发展趋势    1</a></p><p><a href="#_Toc30693">1.3 项目意义    2</a></p><p><a href="#_Toc4211">2 需求分析    4</a></p><p><a href="#_Toc9992">2.1 功能需求分析    4</a></p><p><a href="#_Toc9660">2.1.1 服务端功能需求分析    4</a></p><p><a href="#_Toc30903">2.1.2 客户端功能需求分析    4</a></p><p><a href="#_Toc3888">2.2 可行性分析    5</a></p><p><a href="#_Toc26488">2.2.1 经济可行性分析    5</a></p><p><a href="#_Toc28087">2.2.2 技术可行性分析    5</a></p><p><a href="#_Toc18212">2.2.3 运行可行性分析    5</a></p><p><a href="#_Toc27154">2.2.4 操作可行性分析    6</a></p><p><a href="#_Toc22683">3 技术支持    7</a></p><p><a href="#_Toc6199">3.1 FastDFS分布式文件系统    7</a></p><p><a href="#_Toc17449">3.2 Nginx服务器反向代理与负载均衡    8</a></p><p><a href="#_Toc6830">3.3 Qt客户端GUI界面设计    10</a></p><p><a href="#_Toc30717">4 设计方案    12</a></p><p><a href="#_Toc11686">4.1 设计原理    12</a></p><p><a href="#_Toc4956">4.2 总体设计方案    12</a></p><p><a href="#_Toc16343">4.2.1 客户端设计方案    13</a></p><p><a href="#_Toc3197">4.2.2 服务端设计方案    14</a></p><p><a href="#_Toc12152">4.3 功能模块方案    14</a></p><p><a href="#_Toc28206">4.3.1 用户注册与登录    14</a></p><p><a href="#_Toc13258">4.3.2 文件列表查询    16</a></p><p><a href="#_Toc13231">4.3.3 数据上传与秒传    16</a></p><p><a href="#_Toc4">4.3.4 文件删除    18</a></p><p><a href="#_Toc15469">4.3.5 文件共享与共享列表查询    19</a></p><p><a href="#_Toc21161">4.3.6 数据下载    20</a></p><p><a href="#_Toc24190">4.3.7 图像预览    21</a></p><p><a href="#_Toc31890">4.4 流程关系    22</a></p><p><a href="#_Toc5645">4.4.1 客户端流程    22</a></p><p><a href="#_Toc1323">4.4.2 服务端流程    23</a></p><p><a href="#_Toc278">5 具体实现    25</a></p><p><a href="#_Toc32181">5.1 服务端架构实现    25</a></p><p><a href="#_Toc4647">5.1.1 负载均衡    25</a></p><p><a href="#_Toc25489">5.1.2 数据库设计    25</a></p><p><a href="#_Toc1570">5.1.3 文件对象存储    28</a></p><p><a href="#_Toc8402">5.2 客户端架构实现    29</a></p><p><a href="#_Toc20029">5.2.1 用户界面设计    29</a></p><p><a href="#_Toc19068">5.2.2 文件界面设计    31</a></p><p><a href="#_Toc4461">5.2.3 基础功能模块    35</a></p><p><a href="#_Toc28158">5.3 功能模块实现    38</a></p><p><a href="#_Toc22221">5.3.1 数据封装与提取    38</a></p><p><a href="#_Toc10445">5.3.2 用户登录与注册    39</a></p><p><a href="#_Toc13752">5.3.3 数据上传模块（上传、秒传）    40</a></p><p><a href="#_Toc19878">5.3.4 文件查询模块（文件列表、共享列表、下载榜）    41</a></p><p><a href="#_Toc13182">5.3.5 文件处理模块（删除、共享、转存）    42</a></p><p><a href="#_Toc31739">5.3.6 数据下载模块    43</a></p><p><a href="#_Toc27560">5.3.7 图像预览模块    43</a></p><p><a href="#_Toc23461">6 测试    46</a></p><p><a href="#_Toc16209">6.1 程序调试    46</a></p><p><a href="#_Toc26451">6.2 工具测试    46</a></p><p><a href="#_Toc27750">6.2.1 测试的目的和意义    46</a></p><p><a href="#_Toc17235">6.2.2 测试框架    46</a></p><p><a href="#_Toc19357">6.2.3 测试步骤    46</a></p><p><a href="#_Toc11694">6.3 测试用例设计    47</a></p><p><a href="#_Toc6990">6.4 测试数据及结果    48</a></p><p><a href="#_Toc9634">6.4.1 功能测试数据及结果    48</a></p><p><a href="#_Toc25635">6.4.2 性能测试结果    52</a></p><p><a href="#_Toc11899">7 总结    53</a></p><p><a href="#_Toc14779">致 谢    54</a></p><p><a href="#_Toc10261">参 考 文 献    55</a></p><p><a href="#_Toc32742">附 录    57</a></p><h1 id="1-绪论"><a href="#1-绪论" class="headerlink" title="1 绪论"></a>1 绪论</h1><h2 id="1-1-课题背景"><a href="#1-1-课题背景" class="headerlink" title="1.1 课题背景"></a>1.1 课题背景</h2><p>由于大数据与云计算技术的普及，互联网已经与人们的生活越来越密切，人们无时无刻不产生着各种数据。同时伴随着直播、短视频、电子相册、数字影院等流媒体的发展，图像数据处理需求正急速增长，传统的物理存储由于共享性差、数据处理缓慢、不易于迁移与恢复等缺点，已渐渐不适用于业务发展需求。而随着云计算的发展，分布式存储的大容量存储、方便移植、快速存储、快速共享、快速备份等各种优点逐渐显现出来，图像存储已渐渐从传统的物理存储方式转变为云存储方式。</p><p>基于云存储的图像管理方式是大数据时代数据对象存储的重要方式之一，这种对象存储方式不仅应用于图像管理，更应用于大数据时代影视、文件、用户信息等各种数据存储之上。通过云存储的方式，可对数据随时上传下载，随时分享备份，使数据对象的管理更加方便方便，更加安全。项目尝试采用分布式文件系统对数据对象进行存储，同时采用Nginx服务器实现高并发与负载均衡，对海量用户的请求进行响应，为用户提供可靠、方便的图像管理平台。</p><h2 id="1-2-发展趋势"><a href="#1-2-发展趋势" class="headerlink" title="1.2 发展趋势"></a>1.2 发展趋势</h2><p>随着计算机与网络的发展，国内外的图像存储已逐渐实现由传统图像向数字化图像转型。这意味着图像越来越多地以二进制信息保存在计算机中，这样不仅可以长期保存，而且还有方便复制、随意修改、便于传输等优点。而随着大数据与云计算的发展，图像的存储方式逐渐向分布式存储方向发展，使得图像管理的物理存储资源不一定直接连接在本地服务器结点上，而是通过网络与存储结点连接[1]，因此衍生出了分布式文件系统。分布式文件系统即集群文件系统，是指物理存储资源通过网络与结点相连，支持大数量的节点以及PB级的数量存储[2]。因此，分布式文件系统解决了海量图像处理相关的难题。</p><p>国内自从2008到2009年间，以华为为代表的一些国内互联网企业开始踏足个人云存储业务，开发出国内第一批网盘产品。2010年以后，出于占领大数据时代入口的目的，国内互联网巨头也纷纷布局云存储业务，腾讯、百度、360、金山、华为等互联网企业也陆续推出了自己的云盘，并开始跑马圈地[3]。这意味着大数据不仅为国内开拓了广阔的市场，也使得国内已逐渐由传统存储向云存储转型[4]。而自从阿里云、腾讯云纷纷崛起，不仅推动了云计算在国内的发展，也在客观上对国内的市场进行了开拓，对云服务提供商们形成了刺激作用。2018年我国数字经济规模达到31.3万亿元，占当年GDP比重达34.8%[5]。</p><p>进入5G时代，5G将与AI智能、IoT物联网、Cloud云、Big Data大数据、Edge Cloud边缘云等技术交叉发展，共同构建智能化的基础设施。云已成为新型信息基础设施的重要组成部分，也是面向政企提供数字化服务的主入口，各行各业的数字化发展已经离不开云计算的支撑。中国云市场IaaS、PaaS、SaaS服务模式继续协同发展，市场规模随客户需求的变化而调整[6]。</p><p>国外云存储市场2017年为307亿美元，预计到2022年889.1亿美元，CAGR为23.7%[7]。中国云存储市场2017年规模为88.68亿人民币，同比增长71.8%，2018年同比增长率将上升至72.8%[8]，市场规模为158.5亿元人民币。Gartner在2019年的报告中显示：到2024年，40%的企业将实施至少一种混合云存储方式，高于2019年的10%[9]。存储如何更好的服务私有云，成为企业级存储的一个重要课题。除了存储自身的池化、自动化之外，向上提供API，方便私有云管理平台按需驱动存储资源的创建、调整、优化甚至回收，将逐渐成为必备配置。云化对接包含两大块，一是对接开源的云管理平台；二是对接商业的云管理平台，首当其冲的是能够被主流Hypervisor识别，如VMware ESXi、Microsoft Hyper-V[10]。</p><h2 id="1-3-项目意义"><a href="#1-3-项目意义" class="headerlink" title="1.3 项目意义"></a>1.3 项目意义</h2><p>如今数据处理需求飞速增长，稍不留神便会跟不上时代发展的步伐。传统的数据管理技术已逐渐不能满足互联网应用所提出的对大数据管理的要求。如何高效地存储和管理海量图像数据，已然成为当今时代的热门探讨话题。</p><p>而云存储、云服务、虚拟化等IT热词的不断盛行，已标志着云计算正引领着时代发展的趋势。相较于传统的物理存储，基于云存储的图像管理方式不仅解决了物理硬件易损坏、数据易丢失的问题，而且存储容量可弹性扩展，这意味着基于云存储的图像管理方式不仅扩容方便，而且在存储更新或者服务升级的过程中并不会引起服务中断，造成不必要的损失。</p><p>本着开源精神，借鉴传统数据存储与管理的方式，针对大数据与云计算的特点，设计了一套基于云存储的图像管理平台，方便管理图像数据。该平台采用分布式文件系统、缓存数据库、负载均衡等技术，具备弹性伸缩、弹性扩容、高并发等特点，支持海量图像数据的存储与管理。实践证明，该平台具备可行性，可满足空间信息服务的多种需求。</p><p>平台设计使用的服务器是基于FastDFS分布式文件系统以及Nginx服务器作为反向代理的Linux服务器，编程语言使用C++语言，图像存储于FastDFS中，数据信息存储于持久性数据库MySQL，Redis作为辅助提高访问效率。客户端使用Qt作为开发工具设计该平台。该平台客户端界面美观方便，功能齐全。数据采用Md5加密算法与Base64数据处理技术，保证数据传输的安全性[11]。该平台是一个简单实用的图像管理平台，具有以下功能：</p><p>用户注册与登录，文件的上传与下载，查询与删除，共享与转存。同时针对图像文件具备预览功能。</p><p>该平台重在为用户提供一套完整的图像管理与存储服务，解决常规物理存储所带来的数据易丢失难恢复、下载存储不方便、存储空间有限、需随身携带等问题，同时解决普通存储网盘用户并发量低下、数据共享性差等问题。</p><h1 id="2-需求分析"><a href="#2-需求分析" class="headerlink" title="2  需求分析"></a>2  需求分析</h1><h2 id="2-1-功能需求分析"><a href="#2-1-功能需求分析" class="headerlink" title="2.1 功能需求分析"></a>2.1 功能需求分析</h2><h3 id="2-1-1-服务端功能需求分析"><a href="#2-1-1-服务端功能需求分析" class="headerlink" title="2.1.1 服务端功能需求分析"></a>2.1.1 服务端功能需求分析</h3><p>传统的云存储方式将数据直接集中存储于某一台或多台服务器或者硬盘上，这样虽然方便服务端的查询，但是一旦服务器或硬盘损坏，便会造成数据丢失且无法恢复。而且由于数据无法直接共享，导致资源的浪费。如今随着时代的发展，无论软件还是硬件的更新速度越来越快，传统的存储方式由于更新麻烦，数据迁移或备份困难，因此已渐渐被分布式存储所替代。因此，对于服务端，应该满足以下需求：</p><p>(1) 功能需求</p><p>(a) 为用户提供云存储服务。</p><p>(b) 满足用户完备的图像管理功能需求。</p><p>(c) 对于用户的数据管理应具备快速响应。</p><p>(d) 针对多人访问服务器的情况应具备负载均衡的能力。</p><p>(e) 数据应具备快速备份与易迁移的特性，保证用户数据不会因服务器问题而丢失。</p><p>(2) 性能需求</p><p>(a) 多人同时访问服务器应具备高并发性。</p><p>(b) 并发不会带来内存泄露等安全问题。</p><p>(c) 对于高频数据访问应快速响应，而低频数据应不过多占用内存资源。</p><p>(d) 对于用户的信息例如密码等敏感信息应保证安全性。</p><p>(e) 程序执行流程合理，代码思路清晰，不会造成逻辑上的问题。</p><p>(3) 可靠、可用性需求</p><p>(a) 针对各类错误应有相应的提示或解决方案。</p><p>(b) 对于失败操作需要有一套完整的错误码进行失败原因提示与排查。</p><h3 id="2-1-2-客户端功能需求分析"><a href="#2-1-2-客户端功能需求分析" class="headerlink" title="2.1.2 客户端功能需求分析"></a>2.1.2 客户端功能需求分析</h3><p>客户端作为用户一系列操作的载体，对用户的使用体验起着最直接的决定作用。因此，客户端不仅需要具备齐全的功能服务，还需具备美观、操作简单、处理流畅等特性，这样才能避免用户的流失。因此，将客户端独立出来进行需求分析。以下从业务需求与性能需求两部分进行分析：</p><p>(1) 业务需求</p><p>(a) 为用户提供用户身份的载体，因此需包含用户登录与注册界面。</p><p>(b) 作为平台的核心，需具备上传图像与下载图像的功能按钮。</p><p>(c) 方便数据的交互，因此需具备共享文件的浏览界面。</p><p>(d) 提高用户数据获取的速度，为用户提供数据下载量的界面。</p><p>(e) 为节约用户空间，需为用户提供图像预览的功能。</p><p>(f) 为节约加载速度，可增加缓存机制。</p><p>(2) 性能需求</p><p>(a) 界面简约又不失美观。</p><p>(b) 任何操作不造成客户端界面交互无响应。</p><p>(c) 在数据交互的过程中需保证数据的安全性。</p><p>(d) 及时对服务端响应异常的情况进行处理。</p><h2 id="2-2-可行性分析"><a href="#2-2-可行性分析" class="headerlink" title="2.2 可行性分析"></a>2.2 可行性分析</h2><h3 id="2-2-1-经济可行性分析"><a href="#2-2-1-经济可行性分析" class="headerlink" title="2.2.1 经济可行性分析"></a>2.2.1 经济可行性分析</h3><p>对于该平台软件所需要的一系列相关资料均可以通过互联网和文献材料进行获取采集，由于开源软件的盛行，对于软件所依赖的各种库均可从GitHub网站获取。而国内云计算的发展，无论操作系统还是硬件设备均可从国内云计算公司获取，无需特殊的工具，且开发成本较低，软件程序简单易实现，从经济的角度来看，对于该平台软件的开发经济方面可行。</p><h3 id="2-2-2-技术可行性分析"><a href="#2-2-2-技术可行性分析" class="headerlink" title="2.2.2 技术可行性分析"></a>2.2.2 技术可行性分析</h3><p>由于开源软件的盛行，目前主流的分布式文件系统均具备备份与数据迁移功能，同时也能保证数据的安全性。而针对高并发问题，目前Nginx服务器可通过反向代理实现负载均衡，解决了高并发的问题[12]。而随着非关系型数据库的发展，针对高频访问的数据可直接存入非关系型数据库中，这样便显著提高了访问效率。对于客户端与服务端数据如何进行交互，这已经在互联网正式普及之时便已解决，而作为主流可靠的传输方式，HTTP协议已经成为TCP传输的典范。因此，从技术角度来看，通过HTTP协议将客户端数据传输服务端，服务端通过Nginx服务器进行反向代理，监听网络，通过CGI程序将接收到的数据加以处理，数据存储于FastDFS中，信息存储于MySQL，同时Redis加以辅助[13]，这种设计方式是可行的。</p><h3 id="2-2-3-运行可行性分析"><a href="#2-2-3-运行可行性分析" class="headerlink" title="2.2.3 运行可行性分析"></a>2.2.3 运行可行性分析</h3><p>运行性是对组织结构最直观的影响，它决定着用户的体验感。主要体现在客户端美观与流畅上。而该平台的设计界面通过Qt设计，简约而不失美观，操作十分简单，功能齐全，由于Qt各种动态库获取方便，因此只需要有相应的动态库文件，在Windows操作系统上安装便可运行。</p><h3 id="2-2-4-操作可行性分析"><a href="#2-2-4-操作可行性分析" class="headerlink" title="2.2.4 操作可行性分析"></a>2.2.4 操作可行性分析</h3><p>软件的设计开发分为客户端与服务端两部分，客户端主要所采用的工具是Qt 5.4.1，开发出的应用程序客户端在Windows操作系统的计算机上运行，分为用户界面与文件界面两部分，以UI界面窗口的方式呈现给用户，接收鼠标和键盘的输入，以显示器作为载体输出，符合新时代计算机操作系统用户的使用习惯，方便用户对图像数据进行存储和管理，包括用户的登录、注册以及图像的上传、下载、共享、预览、转存、秒传、删除等一系列操作，简单而且容易上手。而服务端作为用户数据的载体，必须保证数据的安全性与可靠性，因此服务端的操作均由服务端代码进行处理，不直接授予用户权限。所以此软件在操作上是可行的。</p><p>综上所述，该平台软件的开发与设计从经济、技术、运行、操作等各个方面完全可行。</p><h1 id="3-技术支持"><a href="#3-技术支持" class="headerlink" title="3  技术支持"></a>3  技术支持</h1><h2 id="3-1-FastDFS分布式文件系统"><a href="#3-1-FastDFS分布式文件系统" class="headerlink" title="3.1 FastDFS分布式文件系统"></a>3.1 FastDFS分布式文件系统</h2><p>传统的网络存储系统通过集中的存储方式将全部数据存放到服务器上[14]，因此服务器的性能成为数据安全性与可靠性的关键。而针对以数据为根本的大数据时代，显然传统的网络存储方式已不能满足时代的要求。因此，衍生出了分布式文件系统。</p><p>分布式文件系统可以简单理解为将对象数据离散地分布存储到许多台独立的存储设备上。分布式文件系统存储方式采用弹性扩展的结构，通过多态弹性服务器来分担数据存储的负荷，通过追踪器服务器来定位存储的结点，这种方式不仅提高了系统的执行效率，而且由于其本身易于扩展的特性，显著提高了系统的实用性与可靠性。</p><p>FastDFS分布式文件系统是一款轻量级开源项目，由C语言实现，支持Uinx、Linux等操作系统，为互联网应用开发定制。可用于管理不局限于图像的各种数据，包括对象存储、数据同步、上传、下载、删除等一系列操作[15]，解决了大空间存储和负载均衡等问题，追求高性能和弹性扩展。</p><p>FastDFS分布式文件系统分为三部分：追踪器Tracker，存储结点Storage，客户端Client。客户端Client和存储结点Storage请求连接追踪器Tracker，Storage主动向Tracker报告空闲存储空间、数据同步状况、上传下载次数等信息。每次启动时存储结点会启动单线程实现对追踪器的连接与汇报信息。FastDFS可划分多个组，每组所包含的存储结点由追踪器获取。整体架构如下图：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps4.png" alt="img"></p><p>图3-1 FastDFS分布式文件系统结构</p><p>FastDFS集群可分为追踪器集群与存储结点集群，追踪器集群之间是平等的关系，不存在单点故障的情况，Client访问追踪器通过轮回的方式请求。存储结点集群通过分组的方式集群，存储容量为每个存储结点容量之和[16]。</p><p>FastDFS集群的扩容分为横向扩容与纵向扩容，横向扩容可通过添加组的方式进行空间扩充，而纵向扩容用来实现备份，一组内的最大容量为当前组内存储结点中空间最小的服务器容量。集群整体结构如下：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps5.png" alt="img"></p><p>图3-2 FastDFS分布式文件系统集群</p><h2 id="3-2-Nginx服务器反向代理与负载均衡"><a href="#3-2-Nginx服务器反向代理与负载均衡" class="headerlink" title="3.2 Nginx服务器反向代理与负载均衡"></a>3.2 Nginx服务器反向代理与负载均衡</h2><p>Nginx是一款轻量级的Web 服务器/反向代理服务器及电子邮件代理服务器，采用C进行编写。不仅可以作为HTTP服务器相应Web请求，同时还可以作为反向代理服务器。其特点是占有内存少，并发能力强。Nginx 既可以直接支持Rails和PHP程序，也可以支持作为HTTP代理服务对外服务[17]。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps6.png" alt="img"></p><p>图3-3 反向代理服务器原理</p><p>Nginx三个核心功能是静态服务器、反向代理和负载均衡[18]。这三个功能通过配置文件来实现，所有配置选项代码大致分为以下几部分：</p><p>main                                # 全局配置</p><p>events {                            # Nginx工作模式配置</p><p>}</p><p>HTTP {                                # HTTP设置</p><p>​    ….</p><p>​    server {                        # 服务器主机配置</p><p>​        ….</p><p>​        location {                    # 路由配置</p><p>​            ….</p><p>​        }</p><p>​        location path {</p><p>​            ….</p><p>​        }</p><p>​        location otherpath {</p><p>​            ….</p><p>​        }</p><p>​    }</p><p>​    server {</p><p>​        ….</p><p>​        location {</p><p>​            ….</p><p>​        }</p><p>​    }</p><p>​    upstream name {                    # 负载均衡配置</p><p>​        ….</p><p>​    }</p><p>}</p><p>如上述配置文件所示，主要由6个部分组成：</p><p>(a) main：用于全局信息的配置。</p><p>(b) events：用于Nginx工作模式的配置。</p><p>(c) HTTP：用于进行HTTP协议信息的一些配置。</p><p>(d) server：用于进行服务器访问信息的配置。</p><p>(e) location：用于进行访问路由的配置。</p><p>(f) upstream：用于进行负载均衡的配置。</p><p>upstream模块主要负责负载均衡的配置[19]。简单的配置方式如下：</p><p>upstream name {</p><p>​    ip_hash;</p><p>​    server 192.168.1.100:8000;</p><p>​    server 192.168.1.100:8001 down;</p><p>​    server 192.168.1.100:8002 max_fails=3;</p><p>​    server 192.168.1.100:8003 fail_timeout=20s;</p><p>​    server 192.168.1.100:8004 max_fails=3 fail_timeout=20s;</p><p>}</p><p>核心配置信息如下：</p><p>(a) ip_hash：指定请求调度算法。</p><p>(b) server host:port：分发服务器的列表配置。</p><p>(c) down：表示该主机暂停服务。</p><p>(d) max_fails：表示失败最大次数，超过失败最大次数暂停服务。</p><p>(e) fail_timeout：表示请求失败，指定的时间后重新请求。</p><h2 id="3-3-Qt客户端GUI界面设计"><a href="#3-3-Qt客户端GUI界面设计" class="headerlink" title="3.3 Qt客户端GUI界面设计"></a>3.3 Qt客户端GUI界面设计</h2><p>Qt作为一款开源的跨平台图形界面开发框架，既可以对GUI进行设计，同时由于其是基于C++的面向对象的框架，因此同样可以作为C++编译软件编写程序。Qt类库中的类大致分为两种类型：一种是独立的不从任何类集成的类；另一种直接继承自Qt类。</p><p>独立的类通常在Qt类库中用来实现独立的功能。继承自Qt的类主要分为QEvent类和QObject类。QEvent类是所有QT事件响应类的基类，QObject类是所有应用组件的基类[20]。</p><p>QWidget类是组件容器，所有能结合在一起的组件均继承自从该类。而QWidget类则继承自QObject基类[21]。</p><p>信号和槽是Qt引进的一种处理机制，信号可以被理解为一个对象发出的事件请求，槽是处理信号的函数。</p><p>信号和槽能完成回调函数的所有功能，并且信号和槽机制是类型安全的，而且还能完成其他许多复杂的功能。</p><p>信号和槽可以是单一或者多对多的关系。一个信号可以被连接到多个槽，一个槽也可以响应多个信号，此外，信号之间也可以被连接[22]。</p><h1 id="4-设计方案"><a href="#4-设计方案" class="headerlink" title="4  设计方案"></a>4  设计方案</h1><h2 id="4-1-设计原理"><a href="#4-1-设计原理" class="headerlink" title="4.1 设计原理"></a>4.1 设计原理</h2><p>该项目的设计采用C/S结构，即客户端/服务端模式。首先，客户端响应用户的请求，将用户的请求封装成Json格式，然后通过HTTP协议发送给服务端。对于密码等敏感信息可通过Md5加密后封装成Json格式发送[23]。在整个数据交互的过程中，客户端始终保证用户操作的合理性。</p><p>服务端通过指定端口接收到数据后，首先由Nginx服务器进行反向代理，将数据转发给Nginx配置文件中记录的Web服务器IP。Web服务器接收到数据后根据当前数据HTTP请求头的类型将不同类型数据，通过配置文件中对应的端口转发给服务器相应的CGI程序进行处理，端口对应的CGI程序首先对数据进行拆解，获取数据具体的请求，然后进行处理，并将处理结果转发给客户端。</p><p>对于数据对象本身，CGI程序通过分布式文件系统追踪器对存储结点的数据进行操作，对于信息类数据，CGI程序则将对持久性数据库MySQL进行一系列操作，同时缓存数据库Redis加以辅助提高效率。</p><p>整体结构如下：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps7.png" alt="img"></p><p>图4-1 总体设计框架</p><h2 id="4-2-总体设计方案"><a href="#4-2-总体设计方案" class="headerlink" title="4.2 总体设计方案"></a>4.2 总体设计方案</h2><p>该平台总体包括客户端与服务端两部分。二者之间数据以Json格式通过HTTP协议进行交互。同时对于特殊数据例如密码需进行Md5加密，然后封装Json格式传输。</p><p>客户端主要分为界面设计与功能模块两部分。界面设计分为用户界面和文件界面，其中用户界面包括登录界面、注册界面、设置界面；文件界面包括我的文件、共享文件、下载榜、传输列表。功能模块包括基础功能模块与特殊功能模块，其中基础功能统一封装在一个基础功能类中，用于实现包括数据封装与解析、HTTP传输、读取配置文件、加密等功能；特殊功能模块作为工具类，包括实现上传下载任务与进度、图像预览等功能。</p><p>服务端主要包括服务端框架搭建与功能模块两部分。服务端框架包括Nginx与负载均衡、MySQL数据库与Redis缓存数据库、分布式文件系统的搭建。功能模块用于实现包括用户注册与登录、文件上传与秒传、文件列表查询、文件共享与转存、文件删除、文件下载等功能[24]。</p><p>具体整体设计方案如下图：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps8.png" alt="img"></p><p>图4-2 总体方案结构</p><h3 id="4-2-1-客户端设计方案"><a href="#4-2-1-客户端设计方案" class="headerlink" title="4.2.1 客户端设计方案"></a>4.2.1 客户端设计方案</h3><p>由于客户端是用户直接进行数据交互的载体，因此客户端在达到美观简洁的同时需要有平台完整的功能。根据平台的需求，客户端采用Qt编译器进行客户端代码的编写与界面的设计。作为图像文件管理平台，需要为用户提供文件界面供用户进行管理操作；同时为方便用户信息的验证，客户端还需用户界面获取用户的信息。因此客户端包括用户界面与文件界面。</p><p>用户界面通过一个主QWidget，包含三个子QWidget，分别作为登录、注册、设置三个子界面，通过不同的按钮切换不同的子界面。登录注册用于用户的身份校验，设置用于设置代理服务器服务器的端口号和IP用于数据交互。</p><p>通过登录界面信息校验成功后会关闭用户界面，同时打开文件界面。文件界面包括头部和信息部两部分组成，头部包含多个文件功能切换按钮，信息部界面主要用于对文件信息的展示，因此在设计上，头部作为公共部分只需一个QWidget派生类，而信息部分展示界面通过不同的QWidget派生类与头部拼接成不同的文件界面。</p><h3 id="4-2-2-服务端设计方案"><a href="#4-2-2-服务端设计方案" class="headerlink" title="4.2.2 服务端设计方案"></a>4.2.2 服务端设计方案</h3><p>对于服务端，需要保障数据的高并发与流畅性，因此通过一个Nginx服务器配置使得客户端直接连接的服务器具备反向代理与负载均衡的功能。由于Nginx服务器不能直接处理动态数据，因此Web服务器需要借助CGI程序来处理动态响应。处理不同事件的CGI程序绑定Web服务器不同的端口，通过HTTP协议请求头来确定对应端口，供CGI程序处理。对于数据本身，CGI程序通过分布式文件系统提供的API对分布式文件系统进行操作。同时对于信息类数据存于MySQL，将访问量大的数据插入非关系型数据库，以便下次查找直接从非关系型数据库中提取数据。</p><p>对于分布式文件系统采用FastDFS，需要配置追踪器与存储节点，使得服务器构建成一个集群。同时对于每一台存储节点服务器，通过Storage与Nginx绑定，使得存储于存储节点服务器的数据可通过Url的方式直接访问，而不需重新下载。这样只需将文件对应的Url存储于数据库中，下载或者访问时直接通过访问数据库中的Url即可，不需再从存储节点中下载后发送给客户端，显著地提高了下载与访问效率。</p><p>对于数据库采用MySQL进行数据库设计以及增删改查，根据需求需建五张表，用户表用于用户登录的确认，文件表作为文件信息的保存，共享文件表用于共享文件信息的获取，用户文件表用于用户文件信息的获取，用户文件数量表用于辅助用户访问文件界面时文件的展示，同时为扩展功能提供预留空位。</p><p>缓存数据库通过Redis对访问频繁的数据进行存储。每次获取信息先查询Redis，如果没有需要的信息则访问MySQL，同时将查询数据存入Redis，提高数据获取效率。</p><h2 id="4-3-功能模块方案"><a href="#4-3-功能模块方案" class="headerlink" title="4.3 功能模块方案"></a>4.3 功能模块方案</h2><h3 id="4-3-1-用户注册与登录"><a href="#4-3-1-用户注册与登录" class="headerlink" title="4.3.1 用户注册与登录"></a>4.3.1 用户注册与登录</h3><p>对于用户模块可按功能具体划分为注册模块与登录模块。二者客户端为通过继承用户界面而派生的两个子界面。服务端主要对数据库进行操作。</p><p>注册的客户端逻辑为：用户通过进入注册界面的填写注册信息，客户端代码获取数据后进行逻辑判断，如果用户名或昵称不符合格式要求，则向客户端反馈用户名或昵称格式不符合要求的消息；如果密码不符合格式要求或两次输入密码不一致，则向客户端反馈密码相关操作失败的消息；如果电话或者邮箱不符合规范，则向客户端反馈电话或者邮箱格式不规范的消息。如果用户填写的注册信息均通过客户端校验格式的代码验证，则首先用Md5对密码加密，然后封装成Json格式以HTTP协议发送给服务端。如果服务端长时间未响应则反馈注册失败信息。Web服务端通过请求头为reg交给相应端口的CGI程序。服务端CGI程序的逻辑为：首先将Json数据提取出来，然后查询数据库用户表与通过Json解析的用户名进行比对，如果用户表存在该用户名，则反馈用户名重复的状态码，否则将该注册用户信息插入用户表中，反馈注册成功的状态码。客户端接收到状态码后，通过比对，如果不为成功状态码则根据状态码类型向用户反馈注册失败的原因，并提示用户重新注册；否则客户端会提示用户注册成功，同时会跳转至用户登录的界面，待用户进行登录操作。</p><p>注册流程如下：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps9.png" alt="img"></p><p>图4-3 用户注册流程图</p><p>登录的客户端逻辑为用户通过登录界面填写用户名与密码，如果选择记住密码则登录成功后会把用户以及用户密码的Md5值保存到缓存配置文件中[25]。用户通过登录界面填写登录信息，点击登录按钮，客户端会通过信号槽将登录信息向服务端发送，Web服务端根据请求头为login交给相应端口的CGI程序。服务端CGI程序的逻辑为首先将Json数据提取出来，然后查询数据库用户表与解析后的用户名与密码进行比对，如果存在该用户名，并且密码Md5值跟数据库中密码存储信息一致则反馈注册成功状态码，否则反馈根据情况反馈登录失败状态码。客户端接收到状态码后，如果不为登录成功状态码则提示用户登录失败，否则客户端跳转至我的文件界面。</p><p>登录流程如下：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps10.png" alt="img"></p><p>图4-4 用户登录流程图</p><h3 id="4-3-2-文件列表查询"><a href="#4-3-2-文件列表查询" class="headerlink" title="4.3.2 文件列表查询"></a>4.3.2 文件列表查询</h3><p>当用户进入文件界面后，客户端需要保存当前用户的所有文件信息，因此会向服务端发起当前用户的文件查询请求。当服务端通过请求头myfile将用户信息交给相应端口的CGI程序。CGI程序逻辑为通过以用户名查询数据库user_file_list表将所有文件信息传给客户端，客户端获取到所有信息后，通过QWigitList将文件信息按图标的形式排列到界面，同时在排列过程中对于文件为图像类型的文件进行判断，如果该图像文件在缓存中有缩略图，则显示缩略图，否则显示默认图片。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps11.png" alt="img"></p><p>图4-5 文件列表查询流程图</p><h3 id="4-3-3-数据上传与秒传"><a href="#4-3-3-数据上传与秒传" class="headerlink" title="4.3.3 数据上传与秒传"></a>4.3.3 数据上传与秒传</h3><p>当用户进行上传操作时，首先是采取秒传的方式，将待上传文件的信息通过Md5加密，然后封装好数据后通过HTTP传输，服务端通过Md5请求头交给负责秒传的CGI程序。CGI程序通过文件信息表中Md5值的比较，判断当前文件信息是否存在于数据库中，如果存在则将该文件信息与该用户通过user_file_list表进行关联，否则返回数据库无该文件信息的状态码。客户端接受到状态码后进行判断，成功则不需再进行上传操作，即实现了秒传，否则需要进一步进行上传操作。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps12.png" alt="img"></p><p>图4-6 数据秒传流程图</p><p>上传过程需要客户端维护一个上传队列。客户端选择文件路径后，每次对于确定无法秒传需要上传的文件信息假如到上传队列中。上传时每次从队列中提取队首元素进行请求，上传完成时将该任务从队列中移除。该过程客户端会时时跟进上传进度，并且将进度按进度条的形式更新在数据传输列表界面。</p><p>开始上传时，客户端获取到该文件后将文件以二进制流的形式进行HTTP传输。服务端通过请求头upload将用户信息与数据交给相应端口的CGI程序。CGI程序逻辑为首先通过数据库file_info表判断该文件是否存在，若存在则判断该用户是否拥有，是则反馈已拥有状态码，负责对user_file_list与user_file_count表进行修改操作。否则会通过fork创建子进程，子进程将数据上传到分布式文件系统，通过fdfs_upload_file的API将提取出的二进制流文件上传到分布式文件系统，同时获取到分布式文件系统反馈的文件id，让id传给父进程。父进程用于处理数据信息，将文件生成后的信息插入到file_info表中，同时将用户与文件但关联信息插入到user_file_list中，同时对user_file_count表进行更新。文件信息处理好后，给用户反馈成功状态码。在父子进程的过程中任意一步出现问题均反馈失败状态码。客户端接收到状态码后，通过状态码比对，如果是成功状态码则向用户反馈上传成功的信息，否则给用户反馈上传失败的信息。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps13.png" alt="img"></p><p>图4-7 数据上传流程图</p><h3 id="4-3-4-文件删除"><a href="#4-3-4-文件删除" class="headerlink" title="4.3.4 文件删除"></a>4.3.4 文件删除</h3><p>当用户请求删除操作时，客户端首先需要进行判断用户请求的文件拥有者是否为该用户，如果不是则提示文件不属于该用户的错误信息；否则向服务端发起请求。服务端接收到请求后，通过请求头dealfile或者dealsharefile将用户信息与数据交给相应端口用于文件操作的CGI程序，CGI程序进行处理。CGI程序的逻辑为首先进行数据库查询，首先对user_file_count表进行减一操作，对user_file_list中该用户与该文件的关联进行删除。最后需要通过file_info表的数量属性进行判断，如果大于1，则将该属性减1，否则将该信息从数据库file_info表中删除。同时子进程需通过分布式文件系统提供的fdfs_delete_file相关API对通过该文件Id删除分布式文件系统中该文件的数据。一切成功后向客户端反馈状态码。客户端收到反馈后刷新界面。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps14.png" alt="img"></p><p>图4-8 文件删除流程图</p><h3 id="4-3-5-文件共享与共享列表查询"><a href="#4-3-5-文件共享与共享列表查询" class="headerlink" title="4.3.5 文件共享与共享列表查询"></a>4.3.5 文件共享与共享列表查询</h3><p>当用户切换到共享文件界面时，会向服务端发起共享文件列表获取的请求，通过share_file_list表进行共享文件信息的查询，然后将查询到的列表信息发送给客户端。客户端接收到数据后对界面按照图标显示的方式进行刷新。对下载榜界面，服务端会将文件按下载量进行排序，然后发给客户端，客户端通过信息列表的形式进行显示。</p><p>当用户发起共享或者取消共享操作后，客户端逻辑首先进行判断用户发起的请求文件是否属于该用户，不是的话反馈错误信息；是的话需要根据该文件信息判断该文件分享状态，如果已是该状态则不需操作，否则会向服务端发起请求。当服务端接收到请求后，通过请求头dealfile或者dealsharefile将用户信息与数据交给相应端口用于文件操作的CGI程序，CGI程序的逻辑为首先提取数据，对数据库share_file_list表进行插入，然后对file_info表等文件相关的表进行更新。最后反馈状态码。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps15.png" alt="img"></p><p>图4-9 文件共享流程图</p><h3 id="4-3-6-数据下载"><a href="#4-3-6-数据下载" class="headerlink" title="4.3.6 数据下载"></a>4.3.6 数据下载</h3><p>下载模块首先需保证服务端存储结点Storage与Web处理服务器Nginx相关联，关联后对于存储结点上的数据可直接通过Url进行下载。客户端维护一个下载队列。而下载的流程主要是用户发起下载请求后，客户端会向服务器请求该文件Url信息，收到文件Url后，客户端将下载信息插入下载队列。客户端每次执行队首任务，根据下载信息向相应Url进行Get请求，请求成功后便开始数据下载，同时对于下载进度通过进度条时时更新在数据传输列表界面上。当下载完成时，将该任务从下载队列中移除，然后进行下一个文件下载。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps16.png" alt="img"></p><p>图4-10 文件下载流程图</p><h3 id="4-3-7-图像预览"><a href="#4-3-7-图像预览" class="headerlink" title="4.3.7 图像预览"></a>4.3.7 图像预览</h3><p>由于用户进入文件界面后，客户端代码会将当前缓存中的文件数据保存起来，因此当用户点击预览按钮时，首先客户端会判断该文件信息的类型，如果为图像文件方可进行预览操作，否则反馈失败信息。客户端根据当前保存的文件信息进行Url获取，同时通过HTTP协议对该Url进行请求，获取到响应后客户端会通过QLable进行图像的绘制，为用户呈现该图像的完整状态。同时客户端会将该图像文件缓存起来，以便下次再次访问该图像文件时直接对缓存中的数据进行绘制，而不需在向服务器进行请求。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps17.png" alt="img"></p><p>图4-11 图像预览流程图</p><h2 id="4-4-流程关系"><a href="#4-4-流程关系" class="headerlink" title="4.4 流程关系"></a>4.4 流程关系</h2><p>本项目的流程并不是很复杂，但是由于涉及到的东西较多，因此整个项目流程的清晰度决定了项目实现的难易。</p><h3 id="4-4-1-客户端流程"><a href="#4-4-1-客户端流程" class="headerlink" title="4.4.1 客户端流程"></a>4.4.1 客户端流程</h3><p>客户端流程分为用户界面流程与文件界面流程两部分。用户通过可执行文件首先加载的是用户界面，通过用户界面的设置栏设置反向代理服务器的IP与端口号，客户端程序保存IP与端口号，之后将所有相关数据发送对于发现代理服务器IP。设置完成后，用户可选择性通过注册栏发送注册信息给服务端，收到服务端注册成功的反馈后跳转至登录界面。用户通过登录界面填写用户名及密码，点击登录后，获取服务端的反馈信息，校验成功则跳转文件界面，否则提示登录失败。</p><p>进入文件界面后，默认在我的文件界面，客户端会向服务端发送当前用户信息以及获取当前用户拥有文件信息，得到服务端反馈的信息后，客户端代码将其文件信息绘制到UI界面上，同时如果本地缓存中有相应文件的缓存缩略图，则将默认显示图像替换为缩略图图像，实现预览效果。</p><p>文件界面默认主界面有上传按钮，点击后可选择指定文件夹下的一个或多个图像文件进行上传操作，然后会切换到文件界面的传输列表界面。文件主界面空白域右键点击事件包括文件重新排序与上传等操作，其中上传操作与点击上传按钮事件一样。文件默认展示文件类型图像，如果该文件为图像文件且缓存中有该文件的缩略图，则以缩略图的方式显示。文件右键点击事件包括下载、共享、预览、删除、属性等点击事件，对应下载、共享、预览、删除、属性操作。</p><p>文件界面包含主界面、共享文件界面、下载榜界面、传输列表界面四部分，在UI头部有相应切换事件响应的按钮。</p><p>共享文件界面与下载榜界面的流程与主界面的流程相似，唯一不同的是向服务端请求的是共享文件信息而不是用户文件信息。共享文件界面与下载榜界面的不同在于排列方式不同以及文件信息显示方式不同，共享文件界面的排列方式为按共享时间顺序排列，同时以图标的形势显示文件；而下载榜是以文件下载量的方式进行排序，以详细信息的方式进行显示。</p><p>传输列表包含上传列表、下载列表、传输记录三部分，对应上传进度、下载进度、上传下载记录三部分的展示。</p><p>主界面同时包含切换用户按钮，点击后跳转登录界面。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps18.png" alt="img"></p><p>图4-12 客户端总体流程图</p><h3 id="4-4-2-服务端流程"><a href="#4-4-2-服务端流程" class="headerlink" title="4.4.2 服务端流程"></a>4.4.2 服务端流程</h3><p>服务端整体的流程包括数据转发、数据提取、分布式文件系统操作、数据库操作四部分。</p><p>首先数据转发部分主要流程是反向代理服务器接收到数据后根据并发权重将数据转发给Web服务器，Web服务器通过配置文件与HTTP请求头信息进行类型解析，根据不同的类型将数据发送给不同的端口所绑定的CGI程序。</p><p>数据提取主要为服务端公共代码的任务，将Json数据中的信息提取出来，然后供CGI程序进行响应一系列执行操作。</p><p>分布式文件系统通过FastDFS提供的API对数据对象进行上传、下载、删除操作。在此之前需要服务器先搭建好分布式文件系统的集群。由于FastDFS为C语言所写，因此安装后的API直接可以用到服务端C++程序中。</p><p>数据库操作主要分为两部分，一部分是通过MySQL进行数据的增删改查，另一部分是对访问量较多的数据储存于Redis[26]。所有程序在对数据库进行操作时，首先会从缓存数据库Redis中查询，如果缓存数据库中已有该数据，则直接获取，否则会从MySQL中进行查询，然后在处理数据的过程中将数据同时插入缓存数据库中。</p><p>服务端从功能部分大致分为用户登录与注册、文件上传或删除、文件共享与转存、文件下载与预览几部分。这些功能模块均首先通过数据转发后进行数据提取，然后进行各类型的一系列操作。</p><p>用户登录与注册部分主要为数据库操作；文件上传或删除包括分布式文件系统操作与数据库操作两部分；文件的共享与转存操作并未涉及到分布式文件系统操作，主要为数据库操作。</p><p>文件下载与预览部分有两种实现方式，第一种也是常规的方式包括分布式文件操作与数据库操作，但这样每次会造成效率的低下，因此通过第三方软件将存储结点Storage与Nginx连接，使得存储结点的数据可直接以Url的方式进行获取，这样只需要进行数据库操作即可，即将Url保存至数据库中，而数据的获取直接通过Url便可下载，而不需经过分布式文件系统追踪器等一系列过程。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps19.png" alt="img"></p><p>图4-13 服务端总体流程图</p><h1 id="5-具体实现"><a href="#5-具体实现" class="headerlink" title="5  具体实现"></a>5  具体实现</h1><h2 id="5-1-服务端架构实现"><a href="#5-1-服务端架构实现" class="headerlink" title="5.1 服务端架构实现"></a>5.1 服务端架构实现</h2><h3 id="5-1-1-负载均衡"><a href="#5-1-1-负载均衡" class="headerlink" title="5.1.1 负载均衡"></a>5.1.1 负载均衡</h3><p>Nginx负载均衡是在反向代理的基础上完成的，首先用户通过浏览器或者客户端连接到Nginx反向代理服务器，Nginx通过配置文件中的server模块找到server_name映射的域名，通过proxy_pass+Url找到upstream模块，然后访问server相应的地址。upstream模块中可设置多个IP，同时赋予权重，每次用户访问服务器时，Nginx都会按权重将用户请求分配到upstream模块中对应的IP，这样便实现了负载均衡。</p><p>负载均衡通过配置Nginx.conf实现[27]。具体负载均衡部分配置样例如下：</p><p>upstream test.com{</p><p>server 39.96.209.253:80; #服务器1</p><p>server 172.17.49.222:80; #服务器2</p><p>}</p><p>server{</p><p>listen 80;</p><p>server_name localhost;</p><p>Location /{</p><p>proxy_pass HTTP://test.com;</p><p>}</p><p>}</p><h3 id="5-1-2-数据库设计"><a href="#5-1-2-数据库设计" class="headerlink" title="5.1.2 数据库设计"></a>5.1.2 数据库设计</h3><p>数据库主要用于存储用户与文件的信息，数据信息存于MySQL中。数据库表主要分为五张表，具体表结构如下图所示：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps20.jpg" alt="img"> </p><p>图5-1 数据库表结构</p><p>user表用于储存用户相关信息。当用户注册时将信息插入该表中；当用户登录时通过查询该表进行用户身份校验，校验成功方能进入文件界面对图像进行管理。user表中包含name、nickname、password、phone、createtime、email六个栏位，其中name作为用户名，password作为密码，用于登录时校验，其余作为用户信息储存栏位。</p><p>表5-1 user表</p><table><thead><tr><th>序号</th><th>列名</th><th>数据类型</th><th>长度</th><th>主键</th><th>允许空</th><th>备注</th></tr></thead><tbody><tr><td>1</td><td>name</td><td>varchar</td><td>20</td><td>是</td><td>否</td><td>用户id</td></tr><tr><td>2</td><td>nickname</td><td>varchar</td><td>20</td><td></td><td>是</td><td>用户昵称</td></tr><tr><td>3</td><td>password</td><td>varchar</td><td>65</td><td></td><td>是</td><td>用户密码</td></tr><tr><td>4</td><td>phone</td><td>varchar</td><td>12</td><td></td><td>是</td><td>电话</td></tr><tr><td>5</td><td>createtime</td><td>datetime</td><td>0</td><td></td><td>是</td><td>注册时间</td></tr><tr><td>6</td><td>email</td><td>varchar</td><td>30</td><td></td><td>是</td><td>邮箱</td></tr></tbody></table><p>file_info表用于储存文件信息。该表包括md5、file_id、url、size、type、count六个栏位。md5作为文件的唯一标识，也可认为是文件的唯一id标识；file_id用于储存文件在分布式文件系统中对应的id即文件名，可通过该id从分布式文件系统中下载文件；url用于储存该文件的获取网址；size用于记录文件的大小；type代表该文件类型；count用于统计有多少用户拥有该文件，主要用于文件删除。</p><p>表5-2 file_info表</p><table><thead><tr><th>序号</th><th>列名</th><th>数据类型</th><th>长度</th><th>主键</th><th>允许空</th><th>备注</th></tr></thead><tbody><tr><td>1</td><td>md5</td><td>varchar</td><td>65</td><td>是</td><td>否</td><td>文件id</td></tr><tr><td>2</td><td>file_id</td><td>varchar</td><td>100</td><td></td><td>是</td><td>对象存储id</td></tr><tr><td>3</td><td>url</td><td>varchar</td><td>100</td><td></td><td>是</td><td>文件url</td></tr><tr><td>4</td><td>size</td><td>bigint</td><td>20</td><td></td><td>是</td><td>文件大小</td></tr><tr><td>5</td><td>type</td><td>varchar</td><td>10</td><td></td><td>是</td><td>文件类型</td></tr><tr><td>6</td><td>count</td><td>int</td><td>11</td><td></td><td>是</td><td>拥有者数量</td></tr></tbody></table><p>user_file_list作为用户与文件的关系桥梁而存在。表共包含user、md5、createtime、filename、shared_status、pv六栏。user代表用户id；md5代表文件id；createtime代表用户拥有该文件的时间；filename代表用户拥有该文件时的文件名；share_status用于表示该文件的分享状态；pv表示该用户对该文件的下载次数。</p><p>表5-3 user_file_list表</p><table><thead><tr><th>序号</th><th>列名</th><th>数据类型</th><th>长度</th><th>主键</th><th>允许空</th><th>备注</th></tr></thead><tbody><tr><td>1</td><td>user</td><td>varchar</td><td>20</td><td></td><td>否</td><td>用户id</td></tr><tr><td>2</td><td>md5</td><td>varchar</td><td>65</td><td></td><td>否</td><td>文件id</td></tr><tr><td>3</td><td>createtime</td><td>datetime</td><td>0</td><td></td><td>是</td><td>关联时间</td></tr><tr><td>4</td><td>filename</td><td>varchar</td><td>100</td><td></td><td>是</td><td>文件名称</td></tr><tr><td>5</td><td>shared_status</td><td>int</td><td>11</td><td></td><td>是</td><td>分享状态</td></tr><tr><td>6</td><td>pv</td><td>int</td><td>11</td><td></td><td>是</td><td>下载量</td></tr></tbody></table><p>share_file_list表记录共享文件的信息。包括user、md5、createtime、filename、pv五个栏位。user代表该文件的分享者；md5代表该文件id；createtime代表分享时间；filename代表该文件被分享时的文件名；pv代表该文件全部的下载次数。</p><p>表5-4 share_file_list表</p><table><thead><tr><th>序号</th><th>列名</th><th>数据类型</th><th>长度</th><th>主键</th><th>允许空</th><th>备注</th></tr></thead><tbody><tr><td>1</td><td>user</td><td>varchar</td><td>65</td><td></td><td>否</td><td>分享用户id</td></tr><tr><td>2</td><td>md5</td><td>varchar</td><td>65</td><td></td><td>否</td><td>分享文件id</td></tr><tr><td>3</td><td>createtime</td><td>datetime</td><td>0</td><td></td><td>是</td><td>分享时间</td></tr><tr><td>4</td><td>filename</td><td>varchar</td><td>100</td><td></td><td>是</td><td>文件名称</td></tr><tr><td>5</td><td>pv</td><td>int</td><td>11</td><td></td><td>是</td><td>下载量</td></tr></tbody></table><p>user_file_count表主要记录用户当前拥有多少个文件。其主要用于文件列表获取前访问，如果文件列表数量庞大，需先访问用户文件数目，再分批访问。该表共user、count两个栏位。user代表用户id；count代表该用户拥有文件数量。</p><p>表5-5 user_file_count表</p><table><thead><tr><th>序号</th><th>列名</th><th>数据类型</th><th>长度</th><th>主键</th><th>允许空</th><th>备注</th></tr></thead><tbody><tr><td>1</td><td>user</td><td>varchar</td><td>20</td><td>是</td><td>否</td><td>用户id</td></tr><tr><td>2</td><td>count</td><td>int</td><td>11</td><td></td><td>是</td><td>用户文件数</td></tr></tbody></table><h3 id="5-1-3-文件对象存储"><a href="#5-1-3-文件对象存储" class="headerlink" title="5.1.3 文件对象存储"></a>5.1.3 文件对象存储</h3><p>数据对象本身存储与分布式文件系统中。在服务器上安装好FastDFS分布式文件系统后，需要修改配置文件。由于FastDFS分布式文件系统包括追踪器、存储节点、客户端三部分，因此需要修改tracker.conf、storage.conf、client.conf三个配置文件。</p><p>先配置Tracker，再添加一个Storage，每添加添加一个Storage，实际上是Storage连接Tracker，Tracker必须存在，否则Storage无法加进来，Client主要用于测试上传、下载文件。</p><p>假如有3台以上的服务器或者虚拟机，一台用来作为Tracker、一台用来作为Client、其他多台用来作为Storage，不过前提需要保证这些服务器之间的网络均可以互相PING通。如果并没有足够多的设备，一台服务器可以同时作为Tracker、Storage、Client使用。</p><p>首先是tracker.conf的配置，追踪器服务器需要修改，其他服务器可以不用配置。bind_addr需要修改为追踪器服务器所在的IP，port修改为绑定的端口， base_path为日志目录，配置样例如下：</p><p>bind_addr=39.96.209.253</p><p>port=22122</p><p>base_path=/home/fastdfs/tracker</p><p>作为存储节点的服务器需要修改storage.conf，主要修改以下部分。group_name表示存储节点所属的组；bind_addr表示存储节点绑定的IP；port为存储节点绑定的端口；base_path表示存储日志目录；store_path_count配置存储目录的个数；store_path0配置具体的存储目录；tracker_server用于配置连接Tracker的时候使用的IP和端口；配置样例如下：</p><p>group_name=group1 </p><p>bind_addr=39.96.209.253</p><p>port=23000 </p><p>base_path=/home/fastdfs/storage  </p><p>store_path_count=1 </p><p>store_path0=/home/fastdfs/storage</p><p>tracker_server=39.96.209.253:22122</p><p>客户端服务器主要通过API请求上传、下载等操作。因此所有用于响应用户请求的HTTP服务器均需对文件client.conf进行配置。主要需要修改两部分：base_path配置日志目录；tracker_server配置连接Tracker服务器时使用的IP和端口。Client配置样例如下：</p><p>base_path=/home/fastdfs/client </p><p>tracker_server=39.96.209.253:22122</p><p>配置文件配置完成后，所有响应请求的HTTP服务器通过Client调用API向Tracker请求上传、下载等操作[28]。对于常用的API，可通过源码的方式获取。文件上传调用fdfs_upload_file，下载调用fdfs_download_file，删除调用fdfs_delete_file[29]。因此对于数据上传、下载或删除请求，我们可以通过加载fdfs_upload_file.c，fdfs_download_file.c，fdfs_delete_file.c获取对应操作的API。</p><h2 id="5-2-客户端架构实现"><a href="#5-2-客户端架构实现" class="headerlink" title="5.2 客户端架构实现"></a>5.2 客户端架构实现</h2><h3 id="5-2-1-用户界面设计"><a href="#5-2-1-用户界面设计" class="headerlink" title="5.2.1 用户界面设计"></a>5.2.1 用户界面设计</h3><p>客户端界面分为两部分，用户界面与文件界面。其中用户界面为一个主界面包含注册、登录、设置三个子界面。而文件界面由按钮栏和文件列表栏两部分拼凑而成，文件列表栏作为父类有我的文件界面、共享列表界面、下载榜列表界面和传输列表界面四个派生类，通过按钮栏的点击事件通过信号槽触发回调函数，创建不同的文件列表栏派生类。</p><p>用户界面由一个主界面Login类构成，该类由信息栏title_widget与表单栏stackedWidget两部分组成。信息栏主要用于图标、标题等固定信息的展示；表单栏包含三个QWidget子界面login_page、register_page与set_page，分别用于登录、注册与设置。具体结构如下图：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps21.png" alt="img"></p><p>图 5-2 用户界面结构</p><p>当触发切换界面按钮事件时，通过信号槽触发回调函数，通过回调函数调用setCurrentWidget(…)方法根据传参子界面参数进行不同界面的切换。用户界面类的声明如下：</p><p>class Login : public QDialog{</p><p>​    Q_OBJECT</p><p>public:</p><p>​    explicit Login(QWidget *parent = 0);</p><p>​    ~Login();</p><p>​    // 设置登陆用户信息的Json包</p><p>​    QByteArray setLoginJson(QString user, QString pwd);</p><p>​    // 设置注册用户信息的Json包</p><p>​    QByteArray setRegisterJson(QString userName, QString nickName, QString firstPwd, QString phone, QString email);</p><p>​    // 得到服务器回复的登陆状态， 状态码返回值为 “000”, 或 “001”，还有登陆section</p><p>​    QStringList getLoginStatus(QByteArray json);</p><p>protected:</p><p>​    void paintEvent(QPaintEvent *);</p><p>private slots:</p><p>​    void on_register_btn_clicked();</p><p>​    void on_login_btn_clicked();</p><p>​    void on_set_ok_btn_clicked();</p><p>private:</p><p>​    // 读取配置信息，设置默认登录状态，默认设置信息</p><p>​    void readCfg();</p><p>private:</p><p>​    Ui::Login *ui;</p><p>​    // 处理网络请求类对象</p><p>​    QNetworkAccessManager* m_manager;</p><p>​    // 主窗口指针</p><p>​    MainWindow* m_mainWin;</p><p>​    Common m_cm;</p><p>};</p><p>其登录主界面效果展示如下：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps22.jpg" alt="img"> </p><p>图5-3 登录界面效果图</p><p>用户进入登录界面后，通过点击注册，进入注册界面，点击关闭会返回登录界面。其注册界面效果展示如下：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps23.jpg" alt="img"> </p><p>图5-4 注册界面效果图</p><h3 id="5-2-2-文件界面设计"><a href="#5-2-2-文件界面设计" class="headerlink" title="5.2.2 文件界面设计"></a>5.2.2 文件界面设计</h3><p>文件界面作为文件基础界面，在用户点击登录按钮后启动。文件界面分为导航栏ButtonGroup类与文件列表界面MainWindow类两部分组成。结构如下：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps24.png" alt="img"></p><p>图5-5 文件界面结构</p><p>文件列表界面MainWindow中包含ButtonGroup指针，在启动界面时会通过指针先加载导航栏ButtonGroup类。导航栏由我的文件、共享列表、下载榜、传输列表、切换用户5个界面切换按钮以及关闭之类的基础按钮组成，通过信号槽分别对应不同回调函数。其回调函数声明在signals中。ButtonGroup类声明代码声明如下：</p><p>class ButtonGroup : public QWidget{</p><p>​    Q_OBJECT</p><p>public:</p><p>​    explicit ButtonGroup(QWidget *parent = 0);</p><p>​    ~ButtonGroup();</p><p>public slots:</p><p>​    // 按钮处理函数</p><p>​    void slotButtonClick(Page cur);</p><p>​    void slotButtonClick(QString text);</p><p>​    void setParent(QWidget *parent);</p><p>….</p><p>signals:</p><p>​    void sigMyFile();        //我的文件信号</p><p>​    void sigShareList();        //共享文件信号</p><p>​    void sigDownload();    //下载榜信号</p><p>​    void sigTransform();    //传输列表信号</p><p>​    void sigSwitchUser();    //切换用户信号</p><p>​    void closeWindow();    //关闭信号</p><p>​    void minWindow();        //最小化信号</p><p>​    void maxWindow();        //最大化信号</p><p>private:</p><p>​    Ui::ButtonGroup *ui;</p><p>​    QPoint m_pos;</p><p>​    QWidget* m_parent;</p><p>​    QSignalMapper* m_mapper;</p><p>​    QToolButton* m_curBtn;</p><p>​    QMap&lt;QString, QToolButton*&gt; m_btns;</p><p>​    QMap&lt;Page, QString&gt; m_pages;        //文件列表界面及名称</p><p>};</p><p>导航栏ButtonGroup 效果界面展示图如下：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps25.jpg" alt="img"> </p><p>图5-6 文件界面导航栏</p><p>文件列表MainWindow作为父类共包含我的文件界面MyFileWg类、共享列表界面ShareList类、下载榜界面RankingList类和传输列表界面Transfer类四个派生类，这四个界面均继承自MainWindow类。通过不同的按钮触发信号槽对应的回调函数绘制不同的子界面。</p><p>文件列表界面父类MainWindow具体声明代码如下：</p><p>class MainWindow : public QMainWindow{</p><p>​    Q_OBJECT</p><p>public:</p><p>​    explicit MainWindow(QWidget *parent = 0);</p><p>​    void showMainWindow();    // 显示主窗口</p><p>​    void managerSignals();        // 处理信号</p><p>​    void loginAgain();            // 重新登陆</p><p>signals:</p><p>​    void changeUser();            // 切换用户按钮信号</p><p>protected:</p><p>​    void paintEvent(QPaintEvent *event);</p><p>private:</p><p>​    Ui::MainWindow *ui;        //文件界面指针</p><p>​    Common m_common;        //工具类</p><p>};</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps26.jpg" alt="img"> </p><p>图5-7 我的文件效果图</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps27.jpg" alt="img"> </p><p>图5-8 共享列表效果图</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps28.jpg" alt="img"> </p><p>图5-9 下载榜效果图</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps29.jpg" alt="img"> </p><p>图5-10 传输列表效果图</p><h3 id="5-2-3-基础功能模块"><a href="#5-2-3-基础功能模块" class="headerlink" title="5.2.3 基础功能模块"></a>5.2.3 基础功能模块</h3><p>客户端在进行界面设计的同时为了避免代码冗余，需要对一些比较常用的方法进行抽离，实现高内聚低耦合。因此将这些常用的方法封装成工具类，放在Common文件夹里。该文件夹包含基础类文件和工具类文件。基础类汇集在common.cpp，工具类包括Md5加密算法des.c、用户信息保存logininfoinstance.cpp、下载任务列表downloadtask.cpp、下载进度界面downloadlayout.cpp、上传任务列表uploadtask.cpp、上传进度界面uploadlayout.cpp。</p><p>基础类头文件common.h包含宏定义配置，包括配置文件的宏定义与正则表达式的宏定义，同时包括文件类的属性声明。基础类Common包括读写配置文件、读写日志、文件类型判断、Md5加密、HTTP通信、获取状态码等方法的实现。具体声明如下：</p><p>class Common : public QObject{</p><p>​    Q_OBJECT</p><p>public:</p><p>​    Common(QObject* parent = 0);</p><p>​    ~Common();</p><p>​    // 窗口在屏幕中央显示</p><p>​    void moveToCenter(QWidget *tmp);</p><p>​    // 从配置文件中得到相对应的参数</p><p>​    QString getCfgValue(QString title, QString key, QString path = CONFFILE);</p><p>​    // 通过读取文件, 得到文件类型, 存放在typeList</p><p>​    void getFileTypeList();</p><p>​    // 得到文件后缀，参数为文件类型，函数内部判断是否有此类型，如果有，使用此类型，没有，使用other.png</p><p>​    QString getFileType(QString type);</p><p>​    // 登录信息，写入配置文件</p><p>​    void writeLoginInfo(QString user, QString pwd, bool isRemeber, QString path = CONFFILE);</p><p>​    // 服务器信息，写入配置文件</p><p>​    void writeWebInfo(QString ip, QString port, QString path=CONFFILE);</p><p>​    // 获取某个文件的Md5码</p><p>​    QString getFileMd5(QString filePath);</p><p>​    // 将某个字符串加密成Md5码</p><p>​    QString getStrMd5(QString str = “”);</p><p>​    // 产生分隔线</p><p>​    QString getBoundary();</p><p>​    // 得到服务器回复的状态码， 返回值为 “000”, 或 “001”</p><p>​    QString getCode(QByteArray json);</p><p>​    // 传输数据记录到本地文件，user：操作用户，name：操作的文件, code: 操作码， path: 文件保存的路径</p><p>​    void writeRecord(QString user, QString name, QString code, QString path = RECORDDIR);</p><p>​    // 得到HTTP通信类对象</p><p>​    static QNetworkAccessManager* getNetManager();</p><p>public:</p><p>​    static QStringList  m_typeList;</p><p>private:</p><p>​    // 文件类型路径</p><p>​    static QString      m_typePath;</p><p>​    static QNetworkAccessManager *m_netManager;</p><p>};</p><p>其配置反向代理服务器IP与端口的设置界面如下：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps30.jpg" alt="img"> </p><p>图5-11 配置设置效果图</p><p>工具类LoginInfoInstance为单例模式，当用户信息确认后会将当前用户信息与服务器信息保存到堆中，每次当需要获取用户信息或服务器信息时直接从堆中获取。</p><p>工具类中下载任务列表DownloadTask、下载进度界面DownloadLayout、上传任务列表UploadTask、上传进度界面UploadLayout均采用单例设计模式。</p><p>Layout作为客户端界面，当客户端访问数据传输列表界面时会加载该单例模式界面。其界面如下：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps31.jpg" alt="img"> </p><p>图5-12 任务进度图</p><p>Task作为任务，维护一个队列，当有任务时会将任务插入队列中，每次提取队首任务进行上传、下载操作。当任务完成时从队列中删除该任务。以上传任务为例，其界面效果图如下：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps32.jpg" alt="img"> </p><p>图5-13上传任务界面效果图</p><h2 id="5-3-功能模块实现"><a href="#5-3-功能模块实现" class="headerlink" title="5.3 功能模块实现"></a>5.3 功能模块实现</h2><h3 id="5-3-1-数据封装与提取"><a href="#5-3-1-数据封装与提取" class="headerlink" title="5.3.1 数据封装与提取"></a>5.3.1 数据封装与提取</h3><p>由于客户端跟服务端数据之间需要不断交互，但客户端和服务端无论在操作系统还是开发工具上都截然不同，因此数据需要采用统一的格式去存储。而Json作为跨平台的数据交互方式，因此可以将数据封装成Json格式，进行交互。</p><p>封装与提取的过程由于客户端与服务端的开发工具不同因此实现方式也不同。首先对于服务端，cJSON是由纯C实现的，跨平台性较好。cJSON是采用链表存储的。</p><p>cJSON库在使用时只需两步：将cJSON.c和cJSON.h添加到项目即可；如果在命令行进行链接还需加上-lm表示链接math库[30]。</p><p>对于客户端，由于Qt将C++封装成了一套专属于Qt的语言，同时有一套自己的框架，因此对于Json的处理Qt有操作Json数据的中心类QJsonDocument。因此对于解析Json数据只需调用API即可，而对于封装Json数据的方法代码如下：</p><p>void Common::writeWebInfo(QString ip, QString port, QString path){</p><p>​    // Web_server信息</p><p>​    QMap&lt;QString, QVariant&gt; web_server;</p><p>​    web_server.insert(“ip”, ip);</p><p>​    web_server.insert(“port”, port);</p><p>​    // type_path信息</p><p>​    QMap&lt;QString, QVariant&gt; type_path;</p><p>​    type_path.insert(“path”, m_typePath);</p><p>​    // login信息</p><p>​    QString user = getCfgValue(“login”, “user”);</p><p>​    QString pwd = getCfgValue(“login”, “pwd”);</p><p>​    QString remember = getCfgValue(“login”, “remember”);</p><p>​    QMap&lt;QString, QVariant&gt; login;</p><p>​    login.insert(“user”, user);</p><p>​    login.insert(“pwd”, pwd);</p><p>​    login.insert(“remember”, remember);</p><p>​    QMap&lt;QString, QVariant&gt; json;</p><p>​    json.insert(“web_server”, web_server);</p><p>​    json.insert(“type_path”, type_path);</p><p>​    json.insert(“login”, login);</p><p>​    QJsonDocument jsonDocument = QJsonDocument::fromVariant(json);</p><p>​    file.write(jsonDocument.toJson());</p><p>​    file.close();</p><p>}</p><h3 id="5-3-2-用户登录与注册"><a href="#5-3-2-用户登录与注册" class="headerlink" title="5.3.2 用户登录与注册"></a>5.3.2 用户登录与注册</h3><p>对于用户部分，除了客户端界面以外，服务端的实现主要是对于数据库的操作，首先Web服务器Nginx将登录请求交由10000端口CGI程序进行处理，将注册请求交由10001端口CGI程序进行处理，需要配置如下：</p><p>location /login{</p><p>fastcgi_pass 127.0.0.1:10000;</p><p>include fastcgi.conf;</p><p>}</p><p>location /reg{</p><p>fastcgi_pass 127.0.0.1:10001;</p><p>include fastcgi.conf;</p><p>}</p><p>Shell命令需要将端口与CGI程序绑定，脚本如下：</p><p>spawn-fcgi -a 127.0.0.1 -p 10000 -f ./bin_cgi/login</p><p>spawn-fcgi -a 127.0.0.1 -p 10001 -f ./bin_cgi/register</p><p>通过配置文件将数据传递给对应端口的CGI程序，登录模块的核心部分是数据库信息的比对与结果的封装，数据封装通过数据处理模块完成，而核心的SQL操作语句如下：</p><p>sprintf(sql_cmd, “select password from user where name=\”%s\””, user);</p><p>注册部分对于数据库操作的核心代码如下：</p><p>sprintf(sql_cmd, “insert into user (name, nickname, password, phone, createtime, email) values (‘%s’, ‘%s’, ‘%s’, ‘%s’, ‘%s’, ‘%s’)”, user, nick_name, pwd, tel, time_str ,email);</p><h3 id="5-3-3-数据上传模块（上传、秒传）"><a href="#5-3-3-数据上传模块（上传、秒传）" class="headerlink" title="5.3.3 数据上传模块（上传、秒传）"></a>5.3.3 数据上传模块（上传、秒传）</h3><p>文件上传分为秒传与上传，秒传是对于服务端已有该文件的情况下无需再对文件进行分布式文件系统存储，而直接更改数据库，上传则需要将文件上传到分布式文件系统，</p><p>对于客户端的上传请求，首先客户端将上传请求插入到上传队列里，对于完成的请求从队列中删除。</p><p>当第0号任务开始进行上传工作时，客户端将文件信息封装后向服务器发起秒传请求，服务端接收到请求后对请求头进行判断，如果是Md5，则将数据信息传给10003端口绑定的CGI程序。CGI程序对数据库进行查询，如果有该文件信息，则直接更改数据库，通过file_info表将文件信息和该用户信息相关联，然后反馈成功状态码。否则反馈失败状态码。Web服务器Nginx需要配置如下：</p><p>location /Md5{</p><p>​    fastcgi_pass 127.0.0.1:10003;</p><p>​    include fastcgi.conf;</p><p>}</p><p>Shell命令需要将端口与CGI程序绑定，脚本如下：</p><p>spawn-fcgi -a 127.0.0.1 -p 10003 -f ./bin_cgi/Md5</p><p>客户端接收到服务端的反馈信息后，如果状态码提示服务器没有该文件，则意味着无法秒传，需继续进行数据上传操作。客户端向服务端发送请求：</p><p>QNetworkReply * reply = m_manager-&gt;post( request, data );</p><p>if(reply == NULL){</p><p>​    cout &lt;&lt; “reply == NULL”;</p><p>​    return;</p><p>}</p><p>服务端接收到Post请求后对请求头进行判断是否为upload，将数据信息传给10002端口绑定的CGI程序。CGI程序对数据库进行添加文件信息操作，同时通过fdfs_upload_file提供的API将数据信息上传到服务器分布式文件系统中。Web服务器Nginx需要配置如下：</p><p>location /upload{</p><p>fastcgi_pass 127.0.0.1:10002;</p><p>include fastcgi.conf;</p><p>}</p><p>Shell命令需要将端口与CGI程序绑定，脚本如下：</p><p>spawn-fcgi -a 127.0.0.1 -p 10002 -f ./bin_cgi/upload</p><p>客户端的数据传输列表界面时时跟进当前的上传进度，当有可用数据更新时，会刷新界面。跟进的信号槽代码如下：</p><p>connect(reply, &amp;QNetworkReply::uploadProgress, <a href="qint64 bytesRead, qint64 totalBytes">=</a>{</p><p>​    if(totalBytes != 0) {</p><p>​        dp-&gt;setProgress(bytesRead/1024, totalBytes/1024); //设置进度条</p><p>​    }</p><p>});</p><h3 id="5-3-4-文件查询模块（文件列表、共享列表、下载榜）"><a href="#5-3-4-文件查询模块（文件列表、共享列表、下载榜）" class="headerlink" title="5.3.4 文件查询模块（文件列表、共享列表、下载榜）"></a>5.3.4 文件查询模块（文件列表、共享列表、下载榜）</h3><p>对于客户端的请求，首先Web服务器Nginx将文件信息请求交由10004端口CGI程序进行处理，将共享列表请求交由10006端口CGI程序进行处理，需要配置如下：</p><p>location /myfiles{</p><p>fastcgi_pass 127.0.0.1:10004;</p><p>include fastcgi.conf;</p><p>}</p><p>location /sharefiles{</p><p>fastcgi_pass 127.0.0.1:10006;</p><p>include fastcgi.conf;</p><p>}</p><p>Shell命令需要将端口与CGI程序绑定，脚本如下：</p><p>spawn-fcgi -a 127.0.0.1 -p 10004 -f ./bin_cgi/myfiles</p><p>spawn-fcgi -a 127.0.0.1 -p 10006 -f ./bin_cgi/sharefiles</p><p>对于CGI程序，文件信息与共享文件分别交给myfiles.c与sharefiles.c处理。以myfiles.c为例，首先会对数据提取的信息状态进行比对，判断具体请求，比如下载榜需将请求数据排序。对于文件信息列表请求的数据库核心代码如下：</p><p>sprintf(sql_cmd, “select user_file_list.*, file_info.Url, file_info.size, file_info.type from file_info, user_file_list where user = ‘%s’ and file_info.Md5 = user_file_list.Md5 limit %d, %d”, user, start, count);</p><h3 id="5-3-5-文件处理模块（删除、共享、转存）"><a href="#5-3-5-文件处理模块（删除、共享、转存）" class="headerlink" title="5.3.5 文件处理模块（删除、共享、转存）"></a>5.3.5 文件处理模块（删除、共享、转存）</h3><p>对于客户端的删除、共享、取消共享、转存等请求，首先Web服务器Nginx将文件信息请求交由10004端口CGI程序进行处理，将共享列表请求交由10006端口CGI程序进行处理，需要配置如下：</p><p>location //dealfile{</p><p>fastcgi_pass 127.0.0.1:10005;</p><p>include fastcgi.conf;</p><p>}</p><p>location //dealsharefile{</p><p>fastcgi_pass 127.0.0.1:10007;</p><p>include fastcgi.conf;</p><p>}</p><p>Shell命令需要将端口与CGI程序绑定，脚本如下：</p><p>spawn-fcgi -a 127.0.0.1 -p 10005 -f ./bin_cgi/dealfile</p><p>spawn-fcgi -a 127.0.0.1 -p 10007 -f ./bin_cgi/sharefiles</p><p>对于CGI程序，需要将文件划分为普通文件与共享文件，普通文件可直接操作，而共享文件需要进行判断共享文件拥有者。普通文件与共享文件的处理分别交给dealfile.c与sharefiles.c处理。以dealfile.c为例，首先会对数据请求类型进行判断，请求类型具体分为删除、分享、取消分享、转存等类型，四者均对数据库进行增删改查操作，只有删除操作在确认该文件拥有者为0时会对分布式文件系统中的文件进行删除，具体删除FastDFS中文件的核心代码如下：</p><p>int remove_file_from_storage(char *fileid){</p><p>​    int ret = 0;</p><p>​    //读取fdfs client 配置文件的路径</p><p>​    char fdfs_cli_conf_path[256] = {0};</p><p>​    get_cfg_value(CFG_PATH, “dfs_path”, “client”, fdfs_cli_conf_path);</p><p>​    char cmd[1024*2] = {0};</p><p>​    sprintf(cmd, “fdfs_delete_file %s %s”, fdfs_cli_conf_path, fileid);</p><p>​    ret = system(cmd);</p><p>​    return ret;</p><p>}</p><h3 id="5-3-6-数据下载模块"><a href="#5-3-6-数据下载模块" class="headerlink" title="5.3.6 数据下载模块"></a>5.3.6 数据下载模块</h3><p>由于服务器端存储结点Storage与Nginx关联，因此存储在存储结点的数据可直接通过Url的方式进行获取，提高了服务端下载的效率。对于客户端，维护一个静态队列，队列中存储需要下载的任务信息。每次移除已经下载完成的任务，将最新下载请求进行数据封装后插入下载队列。当队列第0个任务元素需要下载时，首先通过该文件Url发起HTTP请求，具体Get请求代码如下：</p><p>QNetworkReply * reply = m_manager-&gt;get( QNetworkRequest(Url) );</p><p>if(reply == NULL){</p><p>​    p-&gt;dealDownloadTask(); //删除任务</p><p>​    cout &lt;&lt; “get err”;</p><p>​    return;</p><p>}</p><p>获取请求的数据完成时，就会发送信号SIGNAL(finished())，代码如下：</p><p>connect(reply, &amp;QNetworkReply::finished, <a href>=</a>{</p><p>​    cout &lt;&lt; “下载完成”;</p><p>​    reply-&gt;deleteLater();</p><p>p-&gt;dealDownloadTask();//删除下载任务</p><p>m_cm.writeRecord(user, filename, “010”); //下载文件成功，记录</p><p>dealFilePv(Md5, filename); //下载文件pv字段处理</p><p>});</p><p>reply在有数据时发出readyRead信号，我们便可保存数据。具体代码如下：</p><p>connect(reply, &amp;QNetworkReply::readyRead, <a href>=</a>{</p><p>​    if (file != NULL){</p><p>​        file-&gt;write(reply-&gt;readAll());</p><p>​    }</p><p>});</p><p>有可用数据更新时，会通过信号槽刷新进度界面，代码如下：</p><p>connect(reply, &amp;QNetworkReply::downloadProgress, <a href="qint64 bytesRead, qint64 totalBytes">=</a>{</p><p>​    dp-&gt;setProgress(bytesRead, totalBytes);//设置进度</p><p>});</p><h3 id="5-3-7-图像预览模块"><a href="#5-3-7-图像预览模块" class="headerlink" title="5.3.7 图像预览模块"></a>5.3.7 图像预览模块</h3><p>由于图像Url信息保存在数据库中，而在文件列表请求的过程中会默认将Url保存到文件信息中，因此对于图像预览，需要根据传进来不同的Url参数进行请求。首先创建QNetworkAccessManager进行HTTP通信，然后建立信号连接槽，通过Get的方式向Url发起请求。流程如下：</p><p>void PreviewImg::load_network_img(QString Url){</p><p>​    currentPicture = new QPixmap;</p><p>​    //获取网络图片</p><p>​    QNetworkAccessManager *manager;</p><p>​    manager = new QNetworkAccessManager(this);</p><p>​    connect(manager, SIGNAL(finished(QNetworkReply*)),</p><p>​        this, SLOT(replyFinished(QNetworkReply*)));</p><p>​    manager-&gt;get(QNetworkRequest(QUrl( Url )));</p><p>}</p><p>当请求完成时会调用完成回调函数，绘制预览图像界面，同时如果用户选择缓存图片，则会对缩略图及缓存图片进行本地缓存，之后访问直接先通过缓存加载图像，加快下一次访问时的效率。回调函数如下：</p><p>void PreviewImg::replyFinished(QNetworkReply *reply){</p><p>​    if (reply-&gt;error() == QNetworkReply::NoError){</p><p>​        currentPicture-&gt;loadFromData(reply-&gt;readAll());//获取字节流QPixmap对象</p><p>​        QString filename = cachePathFile;</p><p>​        currentFileName = filename;</p><p>​        if(flag){//true预览图片，false加载缩略图</p><p>​            showImgFile(currentPicture);//加载预览界面</p><p>​        }else{</p><p>​            PreviewImg::isTask = false;//缩略图请求任务结束</p><p>​        }</p><p>​        if(isCache){    //是否缓存图片</p><p>​            currentPicture-&gt;save(cachePathFile);//保存图片</p><p>​            saveIcoFile(currentPicture);//保存缩略图</p><p>​        }</p><p>​    }</p><p>}</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps33.jpg" alt="img"> </p><p>图5-14 图像预览列表图</p><h1 id="6-测试"><a href="#6-测试" class="headerlink" title="6  测试"></a>6  测试</h1><h2 id="6-1-程序调试"><a href="#6-1-程序调试" class="headerlink" title="6.1 程序调试"></a>6.1 程序调试</h2><p>任何项目在开发过程中均或多或少会遇到各种各样的错误，除了比较基础的配置环境问题或语法错误以外，还有很多问题是在程序运行的过程中才能发现的。因此在程序设计的同时，尽量使每个模块独立，减少文件之间因耦合度过高而出现错误的几率，达到高内聚低耦合的效果，这样在每个模块设计完成的同时可以独立测试，方便排查错误，提高修复错误的效率。</p><p>在程序调试的程序的过程中，服务端主要通过Linux自带的GDB工具进行断点调试，排查错误语法；客户端主要通过Qt Creator语法错误提示和Debug断点单步调试，迅速定位错误代码并显示错误信息。</p><h2 id="6-2-工具测试"><a href="#6-2-工具测试" class="headerlink" title="6.2 工具测试"></a>6.2 工具测试</h2><h3 id="6-2-1-测试的目的和意义"><a href="#6-2-1-测试的目的和意义" class="headerlink" title="6.2.1 测试的目的和意义"></a>6.2.1 测试的目的和意义</h3><p>软件测试重点在于在真实的软件运行环境下通过与软件需求进行比较，发现软件与需求有所偏差的地方。</p><p>此次软件测试的目的在于检查基于云存储的图像管理平台已完成的功能，发现软件在运行过程中出现的错误并及时解决，使软件能正常运行，确保每个功能可以正常使用，同时尽量保证软件的功能基本符合软件需求。</p><h3 id="6-2-2-测试框架"><a href="#6-2-2-测试框架" class="headerlink" title="6.2.2 测试框架"></a>6.2.2 测试框架</h3><p>QTestLib为用户提供了一个操作简便的单元测试框架，因此本次测试使用Qt Creator 自带的单元测试框架QTestlib进行测试。</p><h3 id="6-2-3-测试步骤"><a href="#6-2-3-测试步骤" class="headerlink" title="6.2.3 测试步骤"></a>6.2.3 测试步骤</h3><p>本平台的设计步骤通过断点调试、单元测试、集成测试、系统测试四部分对系统的功能和性能进行检查和完善[31]。</p><p>首先是单元测试，单元测试以功能模块或函数作为对象，通常采用白盒测试技术，辅以黑盒技术，集中地对程序所实现的每个功能模块进行测试，竭力覆盖每个函数，检验各个程序模块是否存在问题，与所描述的功能是否相符合。</p><p>其次是集成测试，把已通过单元测试完成的模块进行组合，最终组成所预期的平台系统。其作用主要是检验软件体系的结构是否合理，检查接口之间的问题。</p><p>最后是系统测试，把已经集成测试的软件纳入实际运行环境中，与硬件、外设等支持软件运行的系统因素组合，进行环境相关的测试。</p><h2 id="6-3-测试用例设计"><a href="#6-3-测试用例设计" class="headerlink" title="6.3 测试用例设计"></a>6.3 测试用例设计</h2><p>QTestLib为用户提供了一个操作简便的单元测试框架，使用时可以通过在新建项目栏点击其他项目-Qt单元测试，也可以直接在工程文件里加入语句Qt+=testlib。其基本操作代码如下：</p><p>class Untitled2Test : public QObject {</p><p>Q_OBJECT</p><p>public:</p><p>Untitled2Test();</p><p>private Q_SLOTS:</p><p>void initTestCase();</p><p>void cleanupTestCase();</p><p>void testCase1();</p><p>};</p><p>Untitled2Test::Untitled2Test() {</p><p>…</p><p>}</p><p>void Untitled2Test::initTestCase() {</p><p>…</p><p>}</p><p>void Untitled2Test::cleanupTestCase() {</p><p>…</p><p>}</p><p>void Untitled2Test::testCase1() {</p><p>QVERIFY2(true, “Failure”);</p><p>}</p><p>QTEST_APPLESS_MAIN(Untitled2Test)</p><p>#include “tst_untitled2test.moc”</p><p>其中，首个测试函数执行前调用initTestCase()；最后一个测试函数执行后调用cleanupTestCase()；每个测试函数执行前调用init()；每个测试函数执行后调用cleanup()[32]。</p><p>对于GUI相关的操作，Qtestlib同样提供了接口。通过对控件传递信息来检查结果。常用的操作函数例如鼠标的点击事件QTest::mouseClick()，以及键盘的点击事件QTest::keyClick()[33]。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps34.jpg" alt="img"> </p><p>图6-1 GUI单元测试部分结果</p><h2 id="6-4-测试数据及结果"><a href="#6-4-测试数据及结果" class="headerlink" title="6.4 测试数据及结果"></a>6.4 测试数据及结果</h2><h3 id="6-4-1-功能测试数据及结果"><a href="#6-4-1-功能测试数据及结果" class="headerlink" title="6.4.1 功能测试数据及结果"></a>6.4.1 功能测试数据及结果</h3><p>功能测试通过对平台已实现的功能进行单元测试与集成测试，查看功能在运行状况下是否与预期的功能效果相符，同时查找在单步调试中未发现而在程序运行中会出现的潜在错误。以下是功能测试数据及结果。</p><p>表6-1 功能测试结果</p><table><thead><tr><th>功能模块</th><th>前置条件</th><th>测试步骤</th><th>预期结果</th><th>实测结果</th></tr></thead><tbody><tr><td>设置测试-IP</td><td>进入设置界面</td><td>IP输入不规范</td><td>提示IP不正确</td><td>提示IP不正确</td></tr><tr><td>设置测试-端口</td><td>进入设置界面</td><td>端口输入不规范</td><td>提示端口不正确</td><td>提示端口不正确</td></tr><tr><td>设置测试-集成测试</td><td>进入设置界面</td><td>IP与端口输入均符合规范</td><td>自动跳转至登录界面</td><td>自动跳转至登录界面</td></tr><tr><td>设置测试-集成测试</td><td>进入注册界面，信息输入正确</td><td>未设置端口和IP</td><td>提示注册连接失败</td><td>提示注册连接失败</td></tr><tr><td>设置测试-集成测试</td><td>进入登录界面，信息输入正确</td><td>未设置端口和IP</td><td>提示登录连接失败</td><td>提示登录连接失败</td></tr><tr><td>用户注册测试-必填项</td><td>进入用户注册页面</td><td>信息栏为空，点击注册</td><td>提示用户注册信息为空</td><td>提示用户注册信息为空</td></tr><tr><td>用户注册测试-边界值</td><td>进入用户注册页面</td><td>输入用户名不规范，其他信息规范</td><td>提示注册失败</td><td>提示用户名不正确</td></tr><tr><td>用户注册测试-边界值</td><td>进入用户注册页面</td><td>输入昵称不规范，其他信息规范</td><td>提示注册失败</td><td>提示昵称不正确</td></tr><tr><td>用户注册测试-边界值</td><td>进入用户注册页面</td><td>输入密码不规范，其他信息规范</td><td>提示注册失败</td><td>提示密码不正确</td></tr><tr><td>用户注册测试-边界值</td><td>进入用户注册页面</td><td>输入两次密码不同，其他信息规范</td><td>提示注册失败</td><td>提示两次密码不同</td></tr></tbody></table><p>续表 6-1</p><table><thead><tr><th>功能模块</th><th>前置条件</th><th>测试步骤</th><th>预期结果</th><th>实测结果</th></tr></thead><tbody><tr><td>用户注册测试-边界值</td><td>进入用户注册页面</td><td>输入电话不规范，其他信息规范</td><td>提示注册失败</td><td>提示电话不正确</td></tr><tr><td>用户注册测试-边界值</td><td>进入用户注册页面</td><td>输入邮箱不规范，其他信息规范</td><td>提示注册失败</td><td>提示邮箱格式不正确</td></tr><tr><td>用户注册测试-集成测试</td><td>进入用户注册页面，IP与端口可用</td><td>填写用户名存在，其他信息填写正确</td><td>提示注册失败</td><td>提示用户已存在</td></tr><tr><td>用户注册测试-集成测试</td><td>进入用户注册页面，IP与端口可用</td><td>填写注册均信息规范且用户名不存在</td><td>提示注册成功，跳转登录界面</td><td>提示注册成功，跳转登录界面</td></tr><tr><td>用户登录测试-必填项</td><td>用户已经注册并激活账户</td><td>用户名为空，密码规范，点击登录</td><td>提示用户名为空</td><td>提示用户名为空</td></tr><tr><td>用户登录测试-必填项</td><td>用户已经注册并激活账户</td><td>密码为空，用户名规范，点击登录</td><td>提示密码为空</td><td>提示密码为空</td></tr><tr><td>用户登录测试-边界值</td><td>用户已经注册并激活账户</td><td>用户名规范，密码不规范，点击登录</td><td>登陆失败</td><td>登陆失败</td></tr><tr><td>用户登录测试-边界值</td><td>用户已经注册并激活账户</td><td>密码规范，用户名不规范，点击登录</td><td>登陆失败</td><td>登陆失败</td></tr><tr><td>用户登录测试-边界值</td><td>用户已经注册并激活账户</td><td>密码与用户名均不规范，点击登录</td><td>登陆失败</td><td>登陆失败</td></tr><tr><td>用户登录测试-集成测试</td><td>用户已经注册账户</td><td>用户名和密码输入正确，点击登录</td><td>登录成功，跳转至我的文件界面</td><td>登录成功，跳转至我的文件界面</td></tr><tr><td>用户登录测试-缓存测试</td><td>用户已经注册账户</td><td>选择记住密码登录，再进登录界面</td><td>登录栏有上次用户输入的信息</td><td>登录栏有上次用户输入的信息</td></tr><tr><td>文件上传测试-文件类型</td><td>1.用户已登录，并进入文件页面；2.准备1个非图像文件</td><td>1.选择非图像文件文件；2.确认上传</td><td>提示上传成功，文件信息保存至数据库中</td><td>提示上传成功，文件信息保存至数据库中</td></tr><tr><td>文件上传测试-文件类型</td><td>1.用户已登录，并进入文件页面；2.准备1个图像文件</td><td>1.选择图像文件；2.确认上传</td><td>提示上传成功，文件信息保存至数据库中</td><td>提示上传成功，文件信息保存至数据库中</td></tr><tr><td>文件上传测试-性能测试</td><td>1.用户已登录，并进入文件页面；2.准备10个文件</td><td>1.选择准备好的文件；2.确认上传</td><td>10个文件加入到上传队列</td><td>10个文件加入到上传队列</td></tr></tbody></table><p>续表 6-1</p><table><thead><tr><th>功能模块</th><th>前置条件</th><th>测试步骤</th><th>预期结果</th><th>实测结果</th></tr></thead><tbody><tr><td>文件上传测试-性能测试</td><td>用户已登录，并进入文件页面</td><td>1.选择1KB文件；2.确认上传</td><td>成功上传</td><td>成功上传</td></tr><tr><td>文件上传测试-性能测试</td><td>用户已登录，并进入文件页面</td><td>选择准备的100MB文件；确认上传</td><td>成功上传</td><td>成功上传</td></tr><tr><td>文件秒传测试-性能测试</td><td>1.用户已登录，并进入文件页面；2.准备已上传过的文件</td><td>1.选择准备好的文件；2.确认上传</td><td>直接提示上传成功，文件信息保存至数据库中</td><td>直接提示上传成功，文件信息保存至数据库中</td></tr><tr><td>文件下载测试</td><td>1.用户已经登陆；2.已经有上传好的文件</td><td>1.选择一个自己文件点击下载；2.在本地打开文件</td><td>文件成功打开，且格式正确</td><td>文件成功打开，且格式正确</td></tr><tr><td>文件下载测试-共享文件</td><td>1.用户已经登陆；2.系统中有共享文件存在</td><td>在共享文件界面点击一个文件下载，然后打开下载文件</td><td>文件成功打开，且格式正确</td><td>文件成功打开，且格式正确</td></tr><tr><td>文件下载测试-共享文件</td><td>1.用户已经登陆；3.系统中有共享文件存在</td><td>在共享文件界面点击一个文件下载，然后再上传该文件</td><td>文件采用秒传方式上传成功</td><td>文件采用秒传方式上传成功</td></tr><tr><td>文件共享测试</td><td>1.用户已经登陆；2.文件列表存在文件</td><td>用户选择文件设为共享并进共享页面</td><td>用户1可以查找到该文件</td><td>用户1可以查找到该文件</td></tr><tr><td>文件共享测试</td><td>1.准备两个用户，且已经登陆；2.文件列表存在文件</td><td>1.用户1选择一个文件共享；2.用户2转存该文件</td><td>用户2可以在共享界面转存该文件</td><td>用户2可以在共享界面转存该文件</td></tr><tr><td>文件共享测试</td><td>1.准备两个用户，且已经登陆；2.文件列表存在文件</td><td>1.用户1选择一个文件共享；2.用户2取消共享该文件</td><td>用户2不可以在共享界面取消共享该文件</td><td>用户2不可以在共享界面取消共享该文件</td></tr><tr><td>文件共享测试</td><td>1.准备两个用户，且已经登陆；2.文件列表存在文件</td><td>1.用户1选择文件取消共享；2.用户2前往共享页面</td><td>用户2不可以找到该文件</td><td>用户2不可以找到该文件</td></tr><tr><td>文件共享测试</td><td>1.用户已经登陆；2.文件列表存在文件</td><td>用户将转存文件共享</td><td>用户不可以共享该文件</td><td>用户不可以共享该文件</td></tr><tr><td>文件列表测试-我的文件</td><td>1.用户已经登录；2.该存在文件</td><td>进入我的文件</td><td>图标形式显示用户所有文件</td><td>图标形式显示用户所有文件</td></tr></tbody></table><p>续表 6-1</p><table><thead><tr><th>功能模块</th><th>前置条件</th><th>测试步骤</th><th>预期结果</th><th>实测结果</th></tr></thead><tbody><tr><td>文件列表测试-共享文件</td><td>1.用户已经登录；2.存在共享文件</td><td>进入共享文件</td><td>图标形式显示所有共享文件</td><td>图标形式显示所有共享文件</td></tr><tr><td>文件列表测试-下载榜</td><td>1.用户已经登录；2.存在共享文件</td><td>进入下载榜</td><td>以下载量排序共享文件信息</td><td>以下载量排序共享文件信息</td></tr><tr><td>文件删除测试-删除普通文件</td><td>1.用户已经登录；2.系统中存在文件</td><td>1.用户选择一个文件删除</td><td>用户文件列表中没有该文件</td><td>用户文件列表中没有该文件</td></tr><tr><td>文件删除测试-删除共享文件</td><td>1.准备两个用户，且已经登录；2.系统中存在文件</td><td>1.用户1删除自己的共享文件；2.用户2进入共享页面</td><td>用户2不可以找到该文件</td><td>用户2不可以找到该文件</td></tr><tr><td>文件删除测试-删除共享文件</td><td>1.用户已经登录；2.系统中存在文件</td><td>用户选择非自己的共享文件点击删除</td><td>删除失败</td><td>删除失败</td></tr><tr><td>文件删除测试-删除共享文件</td><td>用户1用户2均拥有该共享文件，且用户1为共享者</td><td>1.用户1删除该文件2.用户2进入共享文件界面查找</td><td>用户2不可以查找到该文件</td><td>用户2不可以查找到该文件</td></tr><tr><td>文件删除测试-删除共享文件</td><td>用户1用户2均拥有该共享文件，且用户2为共享者</td><td>1.用户1删除该文件2.用户2进入共享文件界面查找</td><td>用户2可以查找到该文件</td><td>用户2可以查找到该文件</td></tr><tr><td>图像预览测试</td><td>用户拥有已上传非图像文件</td><td>选中非图像文件右键点击预览</td><td>提示该文件非图像，无法预览</td><td>提示该文件非图像，无法预览</td></tr><tr><td>图像预览测试</td><td>用户拥有已上传图像文件并点击预览</td><td>选中图像文件右键点击预览</td><td>显示预览效果</td><td>显示预览效果</td></tr><tr><td>图像预览测试-缩略图</td><td>进入文件列表界面，缓存没有预览图</td><td>无</td><td>先显示默认图像，一段时间后部分图像逐渐显现缩略图</td><td>先显示默认图像，一段时间后部分图像逐渐显现缩略图</td></tr><tr><td>图像预览测试-缩略图</td><td>进入文件列表界面，缓存有预览图</td><td>无</td><td>显示图像缩略图</td><td>显示图像缩略图</td></tr><tr><td>图像预览测试-缩略图</td><td>进入文件列表界面</td><td>1.预览图像文件2.刷新文件列表</td><td>预览过的图像文件显示图像缩略图</td><td>预览过的图像文件显示图像缩略图</td></tr><tr><td>图像预览测试-缓存</td><td>进入文件列表界面</td><td>右键取消缓存，刷新界面</td><td>未在缓存中的缩略图不会自动加载</td><td>未在缓存中的缩略图不会自动加载</td></tr><tr><td>图像预览测试-缓存</td><td>进入文件列表界面</td><td>右键点击清理缓存</td><td>缓存文件清空</td><td>缓存文件清空</td></tr><tr><td>用户切换测试</td><td>进入文件界面</td><td>点击切换用户</td><td>切换到登录界面</td><td>切换到登录界面</td></tr></tbody></table><h3 id="6-4-2-性能测试结果"><a href="#6-4-2-性能测试结果" class="headerlink" title="6.4.2 性能测试结果"></a>6.4.2 性能测试结果</h3><p>在性能测试中主要通过SpeedTest性能测试工具监控指定进程，通过上传或下载指定大小的数据来测试上传与下载过程中数据接收的速度。在文件上传或下载的速度测试过程中以采样时间段速度的形式进行平均速度的计算。以下是采样测试结果。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps35.jpg" alt="img"> </p><p>图6-2 虚拟机服务端环境性能测试</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml11024\wps36.jpg" alt="img"> </p><p>图6-3 阿里云服务端环境性能测试</p><h1 id="7-总结"><a href="#7-总结" class="headerlink" title="7  总结"></a>7  总结</h1><p>作为大学四年知识汇聚的结晶，基于云存储的图像管理平台的设计与实现最终顺利完成。该平台尽管采用C++设计，但所包含的技术点却很多。</p><p>首先服务端的架构就包含分布式文件系统、持久化数据库、非关系型数据库、负载均衡等比较新但应用很广的技术，这些技术原本只能通过书籍或课堂接触，而通过本平台的设计均得到了实践，因此对今后应用的开发有着启迪性的作用；同时，对于目前服务端主流的分布式文件系统、Redis、MySQL、Nginx等应用较广的技术的使用越来越熟练。由于服务端部署在Linux操作系统上，同时用到很多云计算相关技术，为之后无论是应用开发还是大数据开发均提供了宝贵的经验。</p><p>客户端通过Qt设计，而Qt作为C++跨平台界面开发的工具，里面支持包括Lambda表达式等一系列C++11特性，同时包含很多通过C++实现的比较新的技术。在设计客户端的同时，不仅巩固了C++基础，同时也为客户端相关的开发积累了丰富的经验。</p><p>刚开始设计该平台时，我还没有多少项目开发经验，但由于该应用的功能正好用处很广，不仅可以用来作为文件存储的云盘，同时还可以作为图床供博客使用，因此满怀兴趣的我开始查阅云存储相关的资料。在学习的过程中，不仅掌握了目前时代较前沿的技术，同时也拓展了视野，认识到纸上得来终觉浅，作为开发者不仅需要不断学习，更重要的是进行实践，有了足够的设计经验，对于新的技术学起来会非常快，这样才能跟随时代发展而不被时代所甩掉。</p><p>该平台作为较完整的项目，我将会通过GitHub将该平台开源化，供其他开发者使用的同时进行学习与交流，为开源软件贡献一份尽管微不足道但充满诚意的力量。</p><h1 id="致-谢"><a href="#致-谢" class="headerlink" title="致 谢"></a>致 谢</h1><p>首先，我要感谢我的指导老师——齐勇老师。此次基于云存储的图像管理平台设计与实现以及毕业论文的撰写与完善均是在齐勇老师的耐心辅导下完成的，从毕业设计开题到毕业论文的完善，齐老师都定期查看，悉心辅导，同时推荐了许多有用的材料，给予我很多有价值的建议。尽管由于一系列不可控因素的存在，导致此次毕业设计齐老师只能通过线上的方式指导，但齐老师那对于学术的严谨态度、对于项目的精益求精品质都使我受益匪浅。正因为齐老师这种认真负责的责任感以及对学生细致入微的关爱，让我一次次在面对压力与困难时从未妥协，也正因为有齐老师的指导我才可以顺顺利利地完成这次毕业设计。</p><p>其次，我还要感谢和同一毕业小组的同学们，在完成毕业设计的时光里我们互相勉励，一起解决了毕业设计中的一个个问题，一起进步与成长。纵使日后各奔东西，曾经的这份共情仍在。</p><p>在我们即将踏出校门步入社会之际，我的思绪万千，曾几何时懵懵懂懂地踏入大学校门，连最基本的编程都还没学，而现在已经能够独立自主设计一个完整的项目，这背后不仅包含自身的努力与付出，更映射着学校的栽培、老师的关爱、辅导员的呵护以及同学们的互助。因此我向你们致以我最真挚的感激，感谢一路有你们伴我度过这段有欢笑、有快乐、有付出、有收获的大学时光。</p><h1 id="参-考-文-献"><a href="#参-考-文-献" class="headerlink" title="参 考 文 献"></a>参 考 文 献</h1><p>[1]  张雨, 蔡鑫, 李爱民, 等. 分布式文件系统与 MPP 数据库的混搭架构在电信大数据平台中的应用[J]. 电信科学, 2013, 29(11): 12-16.</p><p>[2]  王波. 基于FastDFS的轻量级分布式文件系统的设计与实现[D]. 东北大学,2013.</p><p>[3]  巨头的云计算,谁将是下一个霸主?[J]. 软件, 2018, 39(06): 224-227.</p><p>[4]  杨正洪. 智慧城市: 大数据, 物联网和云计算之应用[M]. 清华大学出版社, 2017.</p><p>[5]  陈肇雄. 推进工业和信息化高质量发展[J]. 网信军民融合,2019(07):5-7.</p><p>[6]  徐为成. 5G时代 云计算发展的五大新趋势[J]. 通信世界,2019(20):46.</p><p>[7]  Li S, Da Xu L, Zhao S. 5G Internet of Things: A survey[J]. Journal of Industrial Information Integration, 2018, 10: 1-9.</p><p>[8]  本刊讯. 工信部印发《云计算发展三年行动计划(2017-2019年)》[J]. 中国公共安全, 2017(05): 20.</p><p>[9]  Singh J. Study on challenges, opportunities and predictions in cloud computing[J]. International Journal of Modern Education and Computer Science, 2017, 9(3): 17.</p><p>[10]  Jiang C, Wang Y, Ou D, et al. Energy efficiency comparison of hypervisors[J]. Sustainable Computing: Informatics and Systems, 2019, 22: 311-321.</p><p>[11]  Mesran M, Abdullah D, Hartama D, et al. Combination Base64 and Hashing Variable Length for Securing Data[C]//Journal of Physics: Conference Series. 2018, 1028: 012056.</p><p>[12]  刘佳祎,崔建明,智春. 基于Nginx服务器的动态负载均衡策略研究[J/OL]. 桂林理工大学学报:1-11[2020-06-22].</p><p>[13]  Hallberg J. Memcached och Redis cachning på lokalt system i en dator[J]. 2019.</p><p>[14]  张兰. 基于云计算的电子商务数据缓存处理的研究[J]. 电脑知识与技术,2016,12(23):249-250.</p><p>[15]  余庆. 分布式文件系统 FastDFS 架构剖析[J]. 程序员, 2010 (11): 63-65.</p><p>[16]  阮光耀. 基于负载均衡的FastDFS新存储节点的同步任务分配策略研究[D]. 武汉纺织大学,2019.</p><p>[17]  赵晔. 基于Nginx的Web后端服务器集群负载均衡技术的研究与改进[D]. 昆明理工大学,2017.</p><p>[18]  Chen X, Song Y, Ye H, et al. Research and Implementation of Digital Ancient Book Library Based on Solr/Lucene[J]. 2018.</p><p>[19]  许红军. 灵活配置,强化Nginx安全管理[J]. 网络安全和信息化,2018(06):132-135.</p><p>[20]  Eng L Z. Qt5 C++ GUI programming cookbook[M]. Packt Publishing Ltd, 2016.</p><p>[21]  Pospelov G. Developing BornAgain graphical user interface: lessons learned[C]//Workshop on Neutron Scattering Data Analysis Software. 2018, 6: 8.</p><p>[22]  陶文玲,侯冬青. PyQt5与Qt设计师在GUI开发中的应用[J]. 湖南邮电职业技术学院学报,2020,19(01):19-21.</p><p>[23]  李飞. 基于C/S模式的图件管理系统的构建[J]. 科技视界,2019(27):39-41.</p><p>[24]  石珊. 云平台下基于FastDFS的文件管理系统的研究与实现[D]. 电子科技大学,2019.</p><p>[25]  Bhandari A, Bhuiyan M, Prasad P W C. Enhancement of MD5 Algorithm for Secured Web Development[J]. JSW, 2017, 12(4): 240-252.</p><p>[26]  Carlson J L. Redis in action[M]. Manning Publications Co., 2013.</p><p>[27]  张云, 许江淳, 李玉惠, 等. 基于 Nginx 服务器负载均衡技术的研究与改进[J]. 软件, 2017, 38(8): 6-12.</p><p>[28]  王宁. 基于分布式云平台视频存储及管理[D]. 中国石油大学(华东),2016.</p><p>[29]  孔德云. 基于FastDFS的大并发问题的研究与应用[D]. 中北大学,2017.</p><p>[30]  Bourhis P, Reutter J L, Suárez F, et al. JSON: data model, query languages and schema specification[C]//Proceedings of the 36th ACM SIGMOD-SIGACT-SIGAI symposium on principles of database systems. 2017: 123-135.</p><p>[31]  杨丽波. 浅析集成测试和系统测试的关系[J]. 电子测试,2017(20):109-110.</p><p>[32]  范方政. 软件测试技术与缺陷跟踪管理的应用研究[D]. 吉林大学,2014.</p><p>[33]  朱健. 基于Qt Test的自动化单元测试[J]. 价值工程,2017,36(14):216-219.</p><h1 id="附-录"><a href="#附-录" class="headerlink" title="附 录"></a>附 录</h1><p><a href="#_Toc30457">图3-1  FastDFS分布式文件系统结构    7</a></p><p><a href="#_Toc2862">图3-2  FastDFS分布式文件系统集群    8</a></p><p><a href="#_Toc4893">图3-3  反向代理服务器原理    9</a></p><p><a href="#_Toc32637">图4-1  总体设计框架    12</a></p><p><a href="#_Toc29224">图4-2  总体方案结构    13</a></p><p><a href="#_Toc16969">图4-3  用户注册流程图    15</a></p><p><a href="#_Toc31498">图4-4  用户登录流程图    16</a></p><p><a href="#_Toc28835">图4-5  文件列表查询流程图    16</a></p><p><a href="#_Toc9982">图4-6  数据秒传流程图    17</a></p><p><a href="#_Toc24130">图4-7  数据上传流程图    18</a></p><p><a href="#_Toc32014">图4-8  文件删除流程图    19</a></p><p><a href="#_Toc3366">图4-9  文件共享流程图    20</a></p><p><a href="#_Toc26329">图4-10  文件下载流程图    21</a></p><p><a href="#_Toc18554">图4-11  图像预览流程图    21</a></p><p><a href="#_Toc17044">图4-12  客户端总体流程图    23</a></p><p><a href="#_Toc26303">图4-13  服务端总体流程图    24</a></p><p><a href="#_Toc22095">图5-1  数据库表结构    26</a></p><p><a href="#_Toc30503">图 5-2  用户界面结构    29</a></p><p><a href="#_Toc2169">图5-3  登录界面效果图    31</a></p><p><a href="#_Toc24127">图5-4  注册界面效果图    31</a></p><p><a href="#_Toc423">图5-5  文件界面结构    32</a></p><p><a href="#_Toc9681">图5-6  文件界面导航栏    33</a></p><p><a href="#_Toc7057">图5-7  我的文件效果图    34</a></p><p><a href="#_Toc1033">图5-8  共享列表效果图    34</a></p><p><a href="#_Toc16733">图5-9  下载榜效果图    35</a></p><p><a href="#_Toc24022">图5-10  传输列表效果图    35</a></p><p><a href="#_Toc9505">图5-11  配置设置效果图    37</a></p><p><a href="#_Toc18579">图5-12  任务进度图    38</a></p><p><a href="#_Toc28323">图5-13 上传任务界面效果图    38</a></p><p><a href="#_Toc20199">图5-14  图像预览列表图    45</a></p><p><a href="#_Toc18275">图6-1  GUI单元测试部分结果    48</a></p><p><a href="#_Toc31978">图6-2  虚拟机服务端环境性能测试    52</a></p><p><a href="#_Toc26587">图6-3  阿里云服务端环境性能测试    52</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;file:///C:&#92;Users&#92;DELL&#92;AppData&#92;Local&#92;Temp&#92;ksohtml11024&#92;wps1.jpg&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;p&gt;毕 业 设 计&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;file:///C:&#92;Users&#92;DEL
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>请逗留一刻吧，是那样美丽</title>
    <link href="http://qianyouyou.cn/2020/05/14/2020-05-14/"/>
    <id>http://qianyouyou.cn/2020/05/14/2020-05-14/</id>
    <published>2020-05-14T11:22:06.000Z</published>
    <updated>2020-07-26T16:03:10.213Z</updated>
    
    <content type="html"><![CDATA[<p>你只管努力，一切交给天意。很久前便听过这句话，听起来挺励志的，就像我的大四。然而随着涉世越来越深，我却渐渐明白，很多事情其实不是我们能决定的，哪怕独自再怎么努力。曾经年少轻狂，某人给我贴上了“自以为是”的标签而离开。四年时间，我逐渐磨灭了的脾气，收敛了的锋芒，处处考虑别人感受，向着某人所期待的模样改变，结果最后还是换来某人一句“自以为是”而结束。我不断为维持我们的联系而努力，尽管她从来不曾考虑过我们的感情如何经营。所以当再次约她时，最终仍然换得一句“你太自以为是了”而结束，这一次我反而释怀了，因为我明白了，自以为是的不是我。我终于明白，在感情的世界里，一个人的努力是不够的，感情是需要两个人共同经营的。而且感情的世界最主要的是平等，一旦一方失去平衡，感情很难维护。试想一下，假如对方享受惯了被追的感觉，对你爱理不理，你再怎么努力都是白费，因为你再怎么努力也唤不醒一个装睡的人。感情如此，人生亦如此。就像我努力求职，最终成功签约心仪的公司，然而却因学校方面的一个简简单单的手续卡了我三个月。我终于明白，有时候，即使你努力，也白费，你的命运常常需要交到其他人手上，所以，人脉很重要。</p><p>曾经我也想过一了百了。</p><p>在疫情爆发的那段岁月里，每一天都是浑浑噩噩，一方面因为久久得不到学校方面的任何消息，使得我的精神饱受折磨；另一方面由于长期受到鼻炎的困扰，导致每天从睁开眼开始便是噩梦。就这样，一天天消磨着时间，每天都想做出改变，但每天都重复着昨天的过程。我常常在想，为什么上帝总是选择我，明明我只想安安稳稳，却总是被命运推着起起伏伏；明明想从今天起做出改变，但依旧重复着单调的生活。</p><p>那段时间，我总是把自己封闭起来，把所有情绪包裹在肚子里，不像任何人诉说心里的苦，即使对家人也不例外，因此家里人并不太清楚具体发生的事情。因此某天因为没有获得返校的资格而心中一肚子委屈，终于在吃饭时全部宣泄到了家人的身上。小时候每次发火，母亲总是忍耐我，而其他人骂我；但随着我的成长，懂得东西越来越多，家里人都知道说不过我，所以每次在我发火时，其他人反而总是忍耐我，只有母亲开始反驳我。我知道，母亲是怕我误入歧途，随着我的经历越来越多，没人再能管我，所以每次当我做错事或者宣泄情绪时，只有母亲站了出来。这一次所有人都开始劝我母亲不要再说下去，而我母亲却一直在指我错误的地方。终于当我母亲说理解我最近的心情，我说“你理解个屁”时，我母亲又一次哭了，或许是因为激动，或许是因为听到我受到委屈。那天，我上楼后，长期以来积在心里的委屈，终于以眼泪的形式散落出来。我躲在房间里哭的歇斯底里，或许因为委屈，或许因为母亲。</p><p>很长时间我常常想着如何没有痛苦地一了百了，但每当想起之后家人的眼泪，就打消了这个念头。有时候甚至抱怨，明明疫情把我的精神璀璨的支离破碎，为什么不让我患上肺炎，这样至少我便有了死去的理由，不用担心受到别人的谴责，或许这只是我想逃避一切的借口吧。</p><p>自疫情以来，我越来越喜欢睡觉，也越来越容易做梦。因为我发现当心情不好时，睡一觉什么都过去了，心情也好了，同时梦里的世界总是那么美好。某一天梦里，因为衣服脏了，我开始抱怨，结果母亲骂了我，随后因为意外我真的死去了。然后我以上帝视角看着一切，在我死后，我获得了想要的一切，我获得了所有的闪卡（可能和我玩的游戏有关），美国总统宣布我生前对世界的贡献（可能与每天的新闻报道有关），街头小巷也放映着我喜欢但不被大众接受的音乐（可能因为华晨宇得歌王后被大众黑），尽管我得到了一切，但是我已经死了，那一刻，我在呐喊，多希望上帝赋予我生命，哪怕一切化为乌有。我终于明白，当我死后我是多么希望我活下去。有时候不得不承认，梦虽然荒诞，像《爱丽丝梦游仙境》或者《红辣椒》一样，但却是我们潜意识真实的感受，像《夏洛特烦恼》，鼓舞我们继续向前，或许这一切都是上帝的指示，就像但丁的《神曲》。于是，我醒了，带着生的希望。</p><p>用漫不经心的态度，过随遇而安的生活。</p><p>虽然打消了死亡的念头，但生活中的无奈并未消退。曾经天天蹲教育厅，终于教育厅宣布可以开学了，于是蹲学校。然而当知道自己没办法去学校，而自己可能因为意外而面临失业时，犹如晴空霹雳，渐渐地，我不再去关注任何开学的消息，对生活也渐渐失去希望。某天夜里，我睁开了眼，却无法动，眼前一副鬼脸，一根棒子压着我，就像雷神的锤子落在洛基身上，施了魔法一样，明明意识想控制身体，但就是无法动。我清楚，这是魔鬼的考验，于是用尽全身的力气动了动手指，最终拜托了魔鬼的困扰。尽管这次成功了，但生活的烦恼越来越多。</p><p>后来发现了《与神对话》这部作品，于是一段时间生活又充满了阳光，开始了等待。然而迟迟等不到开学的消息，反而等来越来越多不好的消息。我开始埋怨，明明一个章的事情，结果拖了我三个月没有消息，眼前政府贪污，但至少有钱可以办事，现在政府领导们不接受贿赂，但也不愿承担风险，有钱也没办法。看着自己可能面临失业，我开始抱怨制度，甚至渐渐开始质疑上帝。某天梦里，我躺在床上，魔鬼抱起了我，而我却欣然接受了。然后我便醒了，我知道，这一刻，我已离上帝越来越远，渐渐变成了魔鬼。</p><p>然而事情总有解决的途径，上帝通过考验使人成长，但所有的苦难都是人们所能承受的。当困扰我三个月的问题有了解决途径时，我终于明白，其实之所以被困扰，完全是我自己困扰着我自己。每个人都只能通过自己的方式来认识世界，我们没办法感受别人的心情。也许在你看来很复杂的事情其实并没有那么复杂，在你看来很重要的事情别人可能并不了解情况，所有的困扰都是我们自己给自己带来的。当我们抱怨自己的命运在别人的一念之间，自己所有的努力都没有任何作用时，不妨多从别人的角度看待问题，多沟通，一切并不难解决。</p><p>在心门终于打开那一刻，我来到了天台，夕阳照在身上，群鸟飞翔，一切充满了生机。我知道，上帝不会放弃每一个人。</p><p>请逗留一刻吧，是那样美丽。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;你只管努力，一切交给天意。很久前便听过这句话，听起来挺励志的，就像我的大四。然而随着涉世越来越深，我却渐渐明白，很多事情其实不是我们能决定的，哪怕独自再怎么努力。曾经年少轻狂，某人给我贴上了“自以为是”的标签而离开。四年时间，我逐渐磨灭了的脾气，收敛了的锋芒，处处考虑别人感
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>分布式云盘部署服务端的漫漫bug路</title>
    <link href="http://qianyouyou.cn/2020/03/13/2020-03-13/"/>
    <id>http://qianyouyou.cn/2020/03/13/2020-03-13/</id>
    <published>2020-03-13T12:04:27.000Z</published>
    <updated>2020-03-13T14:05:28.443Z</updated>
    
    <content type="html"><![CDATA[<p>云盘服务端代码经历两天bug之后终于部署到了自己的服务器上。因此总结一下这两天所出现的所有问题，日后再出现同样的问题便可解决。</p><h1 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h1><ol><li><p>服务端代码部署到虚拟机并启动</p></li><li><p>发现问题，Qt客户端注册与登录无响应</p></li><li><p>检查客户端登录注册代码，发现没有问题</p></li><li><p>检查客户端收到的错误码，发现客户端并未收到服务端反馈的错误码</p></li><li><p>查询服务端Nginx服务器log日志，发现80端口请求注册登录端口未成功</p></li><li><p>检查登录注册端口，发现未启动端口，排除客户端的问题</p></li><li><p>关闭防火墙，仍无法启动端口</p></li><li><p>重新启动服务端代码，查看服务端cgi程序的log日志，发现并没有log日志</p></li><li><p>spawn-fcgi启动报错提示spawn-fcgi: child exited with: 127</p></li><li><p>尝试执行 <code>spawn-fcgi</code> 命令 ，发现没有问题</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">qianyouyou:~ $ spawn-fcgi</span><br><span class="line">Usage: spawn-fcgi [options] [-- &lt;fcgiapp&gt; [fcgi app arguments]]</span><br><span class="line">spawn-fcgi v1.6.5 - spawns FastCGI processes</span><br><span class="line">Options:</span><br><span class="line">省略一万字</span><br></pre></td></tr></table></figure></li><li><p>执行cgi程序，发现问题<code>No such file or directory</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 找一下 libfcgi.so 位置在哪里。</span><br><span class="line">qianyouyou:~ $ whereis libfcgi.so</span><br><span class="line">libfcgi: /usr/local/lib/libfcgi.so /usr/local/lib/libfcgi.a /usr/local/lib/libfcgi.la</span><br><span class="line"></span><br><span class="line"># 然后查看一下 /usr/local/lib/ 下面有什么。</span><br><span class="line">qianyouyou:~ $ ll /usr/local/lib/libfcgi.so*</span><br><span class="line">lrwxrwxrwx 1 root root   16 Jan  8 16:07 /usr/local/lib/libfcgi.so -&gt; libfcgi.so.0.0.0*</span><br><span class="line">-rwxr-xr-x 1 root root 124K Jan  8 16:07 /usr/local/lib/libfcgi.so.0.0.0*</span><br><span class="line"></span><br><span class="line"># 原来没有 libfcgi.so.0 这个文件， 那我们就创造一个吧。</span><br><span class="line">qianyouyou:~ $ sudo ln -s /usr/local/lib/libfcgi.so.0.0.0 /usr/local/lib/libfcgi.so.0</span><br><span class="line"></span><br><span class="line"># 执行cgi还是不行，于是我把 libfcgi.so.0 在 /usr/lib64/ 和 /usr/lib/ 里都链接了一份。</span><br><span class="line">qianyouyou:~ $ sudo ln -s /usr/local/lib/libfcgi.so.0.0.0 /usr/lib/libfcgi.so.0</span><br><span class="line">qianyouyou:~ $ sudo ln -s /usr/local/lib/libfcgi.so.0.0.0 /usr/lib64/libfcgi.so.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//fcgi和glog都需要建立软连接, 正常情况下只要在/usr/lib目录下建立链接就可以了，如果不行的话在/usr/lib64目录下也建立链接</span><br><span class="line"># ln -s /usr/local/lib/libfcgi.so.0  /usr/lib/libfcgi.so.0</span><br><span class="line"># ln -s /usr/local/lib/libfcgi.so.0  /usr/lib64/libfcgi.so.0</span><br><span class="line"># ln -s /usr/local/lib/libglog.so.0  /usr/lib/libglog.so.0</span><br><span class="line"># ln -s /usr/local/lib/libglog.so.0  /usr/lib64/libglog.so.0</span><br></pre></td></tr></table></figure></li><li><p>依然提示<code>No such file or directory</code>，重新make编译代码，提示找不到<code>mysql/mysql.h</code></p></li><li><p>发现问题，虚拟机装了mysql-server，没有装mysql-devel，安装mysql-devel</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Ununtu安装</span><br><span class="line">sudo apt-get install libmysql++-dev</span><br><span class="line"># CentOS安装</span><br><span class="line">sudo yum install -y mysql-devel</span><br></pre></td></tr></table></figure></li><li><p>make成功，重新启动成功，查看相应端口已启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ant | grep 10000</span><br></pre></td></tr></table></figure></li><li><p>客户端登录注册失败，返回错误码，查询服务端log日志，发现没有相应数据库表</p></li><li><p>远程链接数据库，创建相应数据表</p></li><li><p>虚拟机服务端部署成功</p></li><li><p>代码部署到服务器，make同样提示没有<code>mysql/mysql.h</code></p></li><li><p>安装mysql-devel未成功，提示冲突</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Transaction check error: file /usr/include/mysql/client_plugin.h from install of mariadb-1:5.5.41-2.el7_0.x86_64 conflicts with file from package MySQL-client-5.0.96-1.glibc23.x86_64</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>查阅yum安装如何避免冲突，删掉冲突文件，均没有用(后发现由于文件夹为软连接)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># yum查看依赖库</span><br><span class="line">yum search mysql</span><br><span class="line"></span><br><span class="line">yum install mysql-devel --exclude a    #a为冲突包名</span><br></pre></td></tr></table></figure></li><li><p>由于已安装mysql为自定义文件夹，因此锁定问题为找不到自定义文件夹库</p></li><li><p>创建预编译链接，创建静态库动态库链接。<a href="https://blog.csdn.net/qq_22203741/article/details/77742800" target="_blank" rel="noopener">查阅</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 一次性命令</span><br><span class="line">export C_INCLUDE_PATH=/www/server/mysql/include:$C_INCLUDE_PATH</span><br><span class="line">export CPLUS_INCLUDE_PATH=/www/server/mysql/include:$CPLUS_INCLUDE_PATH</span><br><span class="line">export LD_LIBRARY_PATH=/www/server/mysql/lib:$LD_LIBRARY_PATH</span><br><span class="line">export LIBRARY_PATH=/www/server/mysql/lib:$LIBRARY_PATH</span><br><span class="line"></span><br><span class="line"># 所有用户都执行需将以上命令添加至/etc/profile</span><br><span class="line"></span><br><span class="line"># 动态库路径可添加至/etc/ld.so.conf</span><br></pre></td></tr></table></figure></li><li><p>make成功，但除了login与upload外其余端口均为启动</p></li><li><p>执行login可执行文件，提示没有<code>libmysqlcient.so.20</code></p></li><li><p>下载libmysqlclient.so.20，执行可执行文件，仍然报错</p></li><li><p>更换mysql版本为5.7</p></li><li><p>原本部署的博客无法访问。重新配置博客，博客访问成功。<a href="http://jpress.io/article/category/install" target="_blank" rel="noopener">网站1</a><a href="https://blog.shiyunhong.com/3025.html" target="_blank" rel="noopener">网站2</a></p></li><li><p>服务端重新启动，云盘服务端启动成功</p></li><li><p>客户端启动，可注册，不可登录</p></li><li><p>检查服务端代码，发现代码没问题</p></li><li><p>重新编译，提示没有任何文件改动，删除cgi所有.o文件，重新编译成功。</p></li><li><p>服务器云盘部署成功。</p></li></ol><h1 id="防火墙相关"><a href="#防火墙相关" class="headerlink" title="防火墙相关"></a>防火墙相关</h1><p>一、CentOS 7快速开放端口：</p><p>CentOS升级到7之后，发现无法使用iptables控制Linuxs的端口，baidu之后发现Centos 7使用firewalld代替了原来的iptables。下面记录如何使用firewalld开放Linux端口：</p><p>开启端口</p><p>[root@centos7 ~]# firewall-cmd –zone=public –add-port=80/tcp –permanent</p><p>查询端口号80 是否开启：</p><p>[root@centos7 ~]# firewall-cmd –query-port=80/tcp</p><p>重启防火墙：</p><p>[root@centos7 ~]# firewall-cmd –reload</p><p>查询有哪些端口是开启的:</p><p>[root@centos7 ~]# firewall-cmd –list-port</p><p>命令含义：</p><p>–zone #作用域<br>–add-port=80/tcp #添加端口，格式为：端口/通讯协议<br>–permanent #永久生效，没有此参数重启后失效</p><p>关闭firewall：</p><p>systemctl stop firewalld.service #停止firewall</p><p>systemctl disable firewalld.service #禁止firewall开机启动</p><p>二、CentOS6防火墙开放端口：</p><p>在我们使用CentOS系统的时候，CentOS防火墙有时是需要改变设置的。CentOS防火墙默认是打开的，设置CentOS防火墙开放端口方法如下：</p><p>打开iptables的配置文件：vi /etc/sysconfig/iptables</p><p>修改CentOS防火墙时注意：一定要给自己留好后路,留VNC一个管理端口和SSh的管理端口</p><p>下面是一个iptables的示例：</p><p># Firewall configuration written by system-config-securitylevel<br># Manual customization of this file is not recommended.<br>*filter<br>:INPUT ACCEPT [0:0]<br>:FORWARD ACCEPT [0:0]<br>:OUTPUT ACCEPT [0:0]<br>:RH-Firewall-1-INPUT - [0:0]<br>-A INPUT -j RH-Firewall-1-INPUT<br>-A FORWARD -j RH-Firewall-1-INPUT<br>-A RH-Firewall-1-INPUT -i lo -j ACCEPT<br>-A RH-Firewall-1-INPUT -p icmp –icmp-type any -j ACCEPT<br>-A RH-Firewall-1-INPUT -p 50 -j ACCEPT<br>-A RH-Firewall-1-INPUT -p 51 -j ACCEPT<br>-A RH-Firewall-1-INPUT -m state –state ESTABLISHED,RELATED -j ACCEPT<br>-A RH-Firewall-1-INPUT -m state –state NEW -m tcp -p tcp –dport 53 -j ACCEPT<br>-A RH-Firewall-1-INPUT -m state –state NEW -m udp -p udp –dport 53 -j ACCEPT<br>-A RH-Firewall-1-INPUT -m state –state NEW -m tcp -p tcp –dport 22 -j ACCEPT<br>-A RH-Firewall-1-INPUT -m state –state NEW -m tcp -p tcp –dport 25 -j ACCEPT<br>-A RH-Firewall-1-INPUT -m state –state NEW -m tcp -p tcp –dport 80 -j ACCEPT<br>-A RH-Firewall-1-INPUT -m state –state NEW -m tcp -p tcp –dport 443 -j ACCEPT<br>-A RH-Firewall-1-INPUT -j REJECT –reject-with icmp-host-prohibited<br>COMMIT</p><p>修改CentOS防火墙需要注意的是，你必须根据自己服务器的情况来修改这个文件。</p><p>举例来说，如果你不希望开放80端口提供web服务，那么应该相应的删除这一行：<br>-A RH-Firewall-1-INPUT -m state –state NEW -m tcp -p tcp –dport 80 -j ACCEPT</p><p>全部修改完之后重启iptables:service iptables restart</p><p>你可以验证一下是否规则都已经生效：iptables -L</p><p>这样，我们就完成了CentOS防火墙的设置修改。</p><h1 id="库相关"><a href="#库相关" class="headerlink" title="库相关"></a>库相关</h1><p><strong>方法一：在编译自己的项目时添加-L和-I编译选项</strong></p><p> 1）添加头文件路径： -I     #指明头文件的路径  </p><p>2）添加库文件路径： -L    #指定目录。link的时候，去找的目录。gcc会先从-L指定的目录去找，然后才查找默认路径。（告诉gcc,-l库名最可能在这个目录下）。 -l     #指定文件（库名），linking options  </p><p>注：-l紧接着就是库名，这里的库名不是真正的库文件名。比如说数学库，它的库名是m，他的库文件名是libm.so。再比如说matlab eigen库，它的库名是eng，它的库文件名是libeng.so。很容易总结得：把库文件名的头lib和尾.so去掉就是库名了。在使用时，“-leng”就告诉gcc在链接阶段引用共享函数库libeng.so。</p><p><strong>方法二：将库路径添加到环境变量</strong></p><p>1）添加头文件路径：  在/etc/profile中添加（根据语言不同，任选其一）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export C_INCLUDE_PATH=C_INCLUDE_PATH:头文件路径            #c </span><br><span class="line"></span><br><span class="line">export CPLUS_INCLUDE_PATH=CPLUS_INCLUDE_PATH:头文件路径    #c++ </span><br><span class="line"></span><br><span class="line">export OBJC_INCLUDE_PATH=OBJC_INCLUDE_PATH:头文件路径      #java</span><br></pre></td></tr></table></figure><p>终端重启后需执行一次source。 </p><p>另有一种方法：在/etc/ld.so.conf文件中加入自定义的lib库的路径，然后执行<code>sudo /sbin/ldconfig</code>，这个方法对所有终端有效。  </p><p>2）添加库文件路径：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LIBRARY_PATH    #used by gcc before compilation to search for directories containing libraries that need to be linked to your program.</span><br><span class="line">LD_LIBRARY_PATH    #used by your program to search for directories containing the libraries after it has been successfully compiled and linked.</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MATLAB=/opt/MATLAB/R2012a</span><br><span class="line">export LIBRARY_PATH=$LIBRARY_PATH:$MATLAB/bin/glnxa64</span><br><span class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$MATLAB/bin/glnxa64</span><br></pre></td></tr></table></figure><p>题外话，顺便提一下LIBRARY_PATH和LD_LIBRARY_PATH的区别： </p><p>我们知道Linux下有2种库：static libraries和shared libraries。如（这里）阐述的，静态库是在编译期间会被链接并拷贝到你的程序中，因此运行时不再需要该静态库。动态库在编译时并不会被拷贝到你的程序中，而是在程序运行时才被载入，因此在程序运行时还需要动态库存在，这时就会用到LD_LIBRARY_PATH指定的路径去查找这个动态库。The libraries can be static or shared. If it is static then the code is copied over into your program and you don’t need to search for the library after your program is compiled and linked. If your library is shared then it needs to be dynamically linked to your program and that’s when LD_LIBRARY_PATH comes into play.</p><h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><p>库文件在连接（静态库和共享 库）和运行（仅限共享库的程序，静态库会和可执行编译到一起）时被使用，其搜索路径是在系统中进行设置的。一般 Linux 系统把 /lib 和 /usr/lib 两个目录作为默认的库搜索路径，所以使用这两个目录中的库时不需要进行设置搜索路径即可直接使用。对于处于默认库搜索路径之外的库，需要将库的位置添加到 库的搜索路径之中。</p><p>设置库文件的搜索路径总的来说有以下几种：</p><ul><li>LIBRARY_PATH、LD_LIBRARY_PATH等 环境变量：指定连接、运行时库文件路径；</li><li>/etc/ld.so.conf 文件：添加链接时库文件的搜索路径，运行时还需要使用ldconfig命令将路径刷新到ld.so.cache中；</li><li>g++/gcc参数-L、-l、-I：指定链接时库文件的路径、名字和头文件，运行时还需要使用环境变量或者在文件/etc/ld.so.conf中指定（或者放到默认/lib路径），然后ldconfig；</li></ul><p>在/etc/profile中添加如下环境变量。</p><p> 编译时用到的环境变量： </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#gcc找到头文件的路径</span><br><span class="line">C_INCLUDE_PATH=/usr/include/libxml2:/MyLib</span><br><span class="line">export C_INCLUDE_PATH</span><br><span class="line"> </span><br><span class="line">#g++找到头文件的路径</span><br><span class="line">CPLUS_INCLUDE_PATH=$CPLUS_INCLUDE_PATH:/usr/include/libxml2:/MyLib</span><br><span class="line">export CPLUS_INCLUDE_PATH</span><br><span class="line"> </span><br><span class="line">#gcc和g++在编译的链接(link)阶段查找库文件的目录列表</span><br><span class="line">LIBRARY_PATH=$LIBRARY_PATH:/MyLib</span><br><span class="line">export LIBRARY_PATH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">对于头文件的搜索路径:export  C_INCLUDE_PATH=&lt;your include path&gt;;</span><br><span class="line">对于库文件的搜索路径:export  LIBRARY_PATH=&lt;your lib path&gt;;</span><br></pre></td></tr></table></figure><p>运行时环境变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#程序运行时查找ku文件的路径</span><br><span class="line">LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/MyLib</span><br><span class="line">export LD_LIBRARY_PATH</span><br></pre></td></tr></table></figure><h1 id="mysql相关"><a href="#mysql相关" class="headerlink" title="mysql相关"></a>mysql相关</h1><h2 id="设置远程连接"><a href="#设置远程连接" class="headerlink" title="设置远程连接"></a>设置远程连接</h2><h3 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h3><ol><li><p>编辑mysql配置文件，把其中<code>bind-address = 127.0.0.1</code>注释了。<code>vi /etc/mysql/mysql.conf.d/mysqld.cnf</code> </p></li><li><p>使用root进入mysql命令行，执行如下2个命令，示例中mysql的root账号和密码：root</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line">grant all privileges on 库名.表名 to &apos;用户名&apos;@&apos;IP地址&apos;</span><br><span class="line">identified by &apos;密码&apos; with grant option;</span><br><span class="line"></span><br><span class="line">#例：</span><br><span class="line">mysql&gt; grant all on . to root@&apos;%&apos; identified by &apos;root&apos; with grant option;</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure><ol start="3"><li>重启mysql<code>/etc/init.d/mysql restart</code></li></ol><h3 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h3><ol><li>编辑mysql配置文件，把其中bind-address = 127.0.0.1注释了。<code>vi /etc/mysql/mysql.conf.d/mysqld.cnf</code> </li><li>使用root进入mysql命令行，执行如下2个命令，示例中mysql的root账号密码：root</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   mysql –u root -p        </span><br><span class="line"></span><br><span class="line">   mysql&gt; use mysql; </span><br><span class="line"></span><br><span class="line">   mysql&gt; update user set host = &apos;%&apos; where user = &apos;root&apos;;</span><br><span class="line"></span><br><span class="line">   mysql&gt; flush privileges;</span><br><span class="line">   </span><br><span class="line">#第一句是以权限用户root登录</span><br><span class="line">#第二句：选择mysql库</span><br><span class="line">#第三句：修改host值（以通配符%的内容增加主机/IP地址），当然也可以直接增加IP地址</span><br><span class="line">#第四句：刷新MySQL的系统权限相关表</span><br></pre></td></tr></table></figure><ol start="3"><li>重启mysql<code>/etc/init.d/mysql restart</code></li></ol><h2 id="修改MySQL默认编码"><a href="#修改MySQL默认编码" class="headerlink" title="修改MySQL默认编码"></a>修改MySQL默认编码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">......  </span><br><span class="line">[mysqld]  </span><br><span class="line">......   </span><br><span class="line">character-set-server=utf8  </span><br><span class="line">......</span><br></pre></td></tr></table></figure><h2 id="设置表名不区分大小写"><a href="#设置表名不区分大小写" class="headerlink" title="设置表名不区分大小写"></a>设置表名不区分大小写</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">......  </span><br><span class="line">[mysqld]  </span><br><span class="line">......   </span><br><span class="line">character-set-server=utf8</span><br><span class="line">lower_case_table_names=1</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h1 id="Jpress相关"><a href="#Jpress相关" class="headerlink" title="Jpress相关"></a>Jpress相关</h1><h2 id="通过宝塔进行安装"><a href="#通过宝塔进行安装" class="headerlink" title="通过宝塔进行安装"></a>通过宝塔进行安装</h2><p>宝塔是一个优秀的可视化服务器管理工具，提供了web操作面板，方便我们通过宝塔的web面板对服务器进行管理，例如</p><p>1、数据库安装、账号密码管理和数据管理 2、FTP账号的管理 3、各种服务器软件的安装，php、tomcat、nginx等 4、文件管理</p><p>宝塔的官网网站： <a href="http://www.bt.cn/" target="_blank" rel="noopener">http://www.bt.cn</a></p><p>通过宝塔进行安装 JPress，大概分为以下几个步骤：</p><p>1、购买服务器并安装宝塔 2、通过宝塔的后台面板安装nginx、Mysql和tomcat。 3、创建网站，并启用tomcat功能 4、上传JPress的war包，并解压缩 5、访问网站，走jpress自动安装过程</p><h3 id="1、购买服务器并安装宝塔"><a href="#1、购买服务器并安装宝塔" class="headerlink" title="1、购买服务器并安装宝塔"></a>1、购买服务器并安装宝塔</h3><p>购买服务器建议购买阿里云的 centos 7.4 以上 ，里面不要安装其他任何功能（笔者在centos 7.2 下安装宝塔，nginx是无法使用的，centos 7.4 没问题）</p><p>安装宝塔非常简单，用 root 账号进入Linux服务，然后执行如下命令即可自动安装宝塔：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y wget &amp;&amp; wget -O install.sh http://</span><br><span class="line">download.bt.cn/install/install_6.0.sh &amp;&amp; bash install.sh</span><br></pre></td></tr></table></figure><p>需要注意的是：安装的过程中控制台会打印安装的过程，在安装完成后，控制台会输出宝塔的登陆地址、账号和密码。</p><p>重要事情说三遍：</p><blockquote><p>登陆地址、账号和密码，这部分务必要记住。 登陆地址、账号和密码，这部分务必要记住。 登陆地址、账号和密码，这部分务必要记住。</p></blockquote><h3 id="2、通过宝塔的后台，安装nginx、mysql和tomcat"><a href="#2、通过宝塔的后台，安装nginx、mysql和tomcat" class="headerlink" title="2、通过宝塔的后台，安装nginx、mysql和tomcat"></a>2、通过宝塔的后台，安装nginx、mysql和tomcat</h3><p>可以在宝塔的后台，通过 <code>软件管理 &gt; 运行环境</code> 可以找到 nginx、mysql 和 tomcat。</p><p>点击安装即可。</p><p>需要注意的是各个软件的版本号：</p><ul><li>nginx ： 1.14</li><li>tomcat ： 8.5</li><li>mysql ： 5.6</li></ul><h3 id="3、创建网站"><a href="#3、创建网站" class="headerlink" title="3、创建网站"></a>3、创建网站</h3><p>在宝塔后台，通 <code>网站 &gt; 添加网站</code> 创建一个新的网站。</p><p>创建网站的时候需要注意的是，创建mysql数据库的时候，版本要选择 <code>utf8mb4</code> 编码。</p><p>在宝塔后台的 <code>网站</code> 里，点击网站域名，在 <code>tomcat</code> 菜单里，启用 tomcat 功能。 <img src="https://gitee.com/fuhai/jpress/raw/master/doc/images/install_02.jpg" alt="img"></p><h3 id="4、上传war，并解压缩"><a href="#4、上传war，并解压缩" class="headerlink" title="4、上传war，并解压缩"></a>4、上传war，并解压缩</h3><p>在宝塔后台的 <code>网站</code> 里，点击根目录对应的目录链接，然后上传 jpress.war 到此目录。</p><p>因为宝塔无法对 .war 这种文件格式解压缩，所以需要重命名为 jpress.zip ，当然也可以在本地先把 jpress.war 先重命名为 jpress.zip 然后再上传也可以。</p><p>操作完成后，点击 jpress.zip 的解压缩即可。</p><h3 id="5、访问网站走jpress自动安装过程"><a href="#5、访问网站走jpress自动安装过程" class="headerlink" title="5、访问网站走jpress自动安装过程"></a>5、访问网站走jpress自动安装过程</h3><p>访问你的域名，JPress自动引导进行安装，在JPress安装向导的过程中，只需要填写宝塔创建完毕的数据库账号和密码即可。</p><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><blockquote><p>问题：宝塔安装初次安装JPress无法正常启动？</p><p>答：</p><p>1、请查看下 /WEB-INF/classes 目录下是否有 <code>jboot.porperties</code> 和 <code>install.lock</code> 这两个文件，如果有的话请删除。</p><p>2、尝试重启 nginx 和 tomcat。</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;云盘服务端代码经历两天bug之后终于部署到了自己的服务器上。因此总结一下这两天所出现的所有问题，日后再出现同样的问题便可解决。&lt;/p&gt;
&lt;h1 id=&quot;过程&quot;&gt;&lt;a href=&quot;#过程&quot; class=&quot;headerlink&quot; title=&quot;过程&quot;&gt;&lt;/a&gt;过程&lt;/h1&gt;&lt;o
      
    
    </summary>
    
      <category term="程序人生" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
      <category term="Linux" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/Linux/"/>
    
    
      <category term="Linux" scheme="http://qianyouyou.cn/tags/Linux/"/>
    
      <category term="大数据" scheme="http://qianyouyou.cn/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="分布式" scheme="http://qianyouyou.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Qt5中QObject::connect()传参为lambda注意问题</title>
    <link href="http://qianyouyou.cn/2020/03/11/2020-03-11/"/>
    <id>http://qianyouyou.cn/2020/03/11/2020-03-11/</id>
    <published>2020-03-11T13:25:42.000Z</published>
    <updated>2020-03-11T13:44:56.169Z</updated>
    
    <content type="html"><![CDATA[<p> 在 Qt 5 中，<code>QObject::connect()</code>有五个重载： </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">QMetaObject::Connection connect(const QObject *, const char *,</span><br><span class="line">                                const QObject *, const char *,</span><br><span class="line">                                Qt::ConnectionType);</span><br><span class="line"> </span><br><span class="line">QMetaObject::Connection connect(const QObject *, const QMetaMethod &amp;,</span><br><span class="line">                                const QObject *, const QMetaMethod &amp;,</span><br><span class="line">                                Qt::ConnectionType);</span><br><span class="line"> </span><br><span class="line">QMetaObject::Connection connect(const QObject *, const char *,</span><br><span class="line">                                const char *,</span><br><span class="line">                                Qt::ConnectionType) const;</span><br><span class="line"> </span><br><span class="line">QMetaObject::Connection connect(const QObject *, PointerToMemberFunction,</span><br><span class="line">                                const QObject *, PointerToMemberFunction,</span><br><span class="line">                                Qt::ConnectionType)</span><br><span class="line"> </span><br><span class="line">QMetaObject::Connection connect(const QObject *, PointerToMemberFunction,</span><br><span class="line">                                Functor);</span><br></pre></td></tr></table></figure><p>由于做界面窗口最大化按钮时，第一次点击最大化窗口，第二次还原为原大小窗口，因此需要自己写一个函数。而为了避免代码冗余，于是在connect传参时使用了lambda表达式，代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">connect(ui-&gt;btn_group, &amp;ButtonGroup::maxWindow, [=]()</span><br><span class="line">&#123;</span><br><span class="line">    static bool flag = false;</span><br><span class="line">    if(!flag)</span><br><span class="line">    &#123;</span><br><span class="line">        this-&gt;showMaximized();</span><br><span class="line">        flag = true;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        this-&gt;showNormal();</span><br><span class="line">        flag = false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>于是编译错误，提示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no matching function for call to (类名):：connect()……</span><br></pre></td></tr></table></figure><p>看到这个错误，首先想到的是参数问题，由于connect()参数为四个，虽然lambda表达式默认可以省略this参数，但还是添加上试试</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connect(ui-&gt;btn_group, &amp;ButtonGroup::maxWindow, this, [=]()&#123;&#125;);</span><br></pre></td></tr></table></figure><p>结果还是编译错误。后来上网查阅相关错误，结果大多数人的错误基本都是传参问题，但基本没有用lambda表达式的。于是删掉lambda表达式改用函数调用，结果编译通过。因此错误锁定在lambda表达式上。</p><p>后来发现，lambda表达式是C++11范畴，于是在pro文件当中添加以下代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG += c++11</span><br></pre></td></tr></table></figure><p>编译通过。</p><p>因此Qt使用lambda表达式时，首先使用的编译器要支持要用的C++11 特性，其次，在.pro中加上 <code>CONFIG += c++11</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt; 在 Qt 5 中，&lt;code&gt;QObject::connect()&lt;/code&gt;有五个重载： &lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line
      
    
    </summary>
    
      <category term="程序人生" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
      <category term="C/C++" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/C-C/"/>
    
    
      <category term="C/C++" scheme="http://qianyouyou.cn/tags/C-C/"/>
    
      <category term="Qt" scheme="http://qianyouyou.cn/tags/Qt/"/>
    
      <category term="UI" scheme="http://qianyouyou.cn/tags/UI/"/>
    
      <category term="lambda表达式" scheme="http://qianyouyou.cn/tags/lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Nginx+fastDFS搭建图床服务端</title>
    <link href="http://qianyouyou.cn/2020/03/09/2020-03-09/"/>
    <id>http://qianyouyou.cn/2020/03/09/2020-03-09/</id>
    <published>2020-03-09T03:56:46.000Z</published>
    <updated>2020-03-10T05:14:03.641Z</updated>
    
    <content type="html"><![CDATA[<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><p>服务器：Linux（CentOS 7.x，Ubuntu）</p><h2 id="Nginx安装"><a href="#Nginx安装" class="headerlink" title="Nginx安装"></a>Nginx安装</h2><h3 id="宝塔安装"><a href="#宝塔安装" class="headerlink" title="宝塔安装"></a>宝塔安装</h3><p>通过宝塔面板编译安装 Nginx 1.15</p><h3 id="Ubuntu源码安装"><a href="#Ubuntu源码安装" class="headerlink" title="Ubuntu源码安装"></a>Ubuntu源码安装</h3><h4 id="APT安装"><a href="#APT安装" class="headerlink" title="APT安装"></a>APT安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nginx</span><br></pre></td></tr></table></figure><h4 id="源码安装"><a href="#源码安装" class="headerlink" title="源码安装"></a>源码安装</h4><p>安装包：nginx-1.10.1.tar.gz</p><h5 id="安装相关软件"><a href="#安装相关软件" class="headerlink" title="安装相关软件"></a>安装相关软件</h5><p>安装gcc g++的依赖库（如果没有gcc）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install build-essential</span><br><span class="line">sudo apt-get install libtool</span><br><span class="line">centos的话：yum install gcc-c++</span><br></pre></td></tr></table></figure><p>安装pcre依赖库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install libpcre3 libpcre3-dev</span><br><span class="line">centos的话：yum install -y pcre pcre-devel</span><br></pre></td></tr></table></figure><p>安装zlib依赖库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install zlib1g-dev</span><br><span class="line">centos的话：yum install -y zlib zlib-devel</span><br></pre></td></tr></table></figure><p>安装SSL依赖库（16.04默认已经安装了）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssl</span><br><span class="line">centos的话：yum install -y openssl openssl-devel</span><br></pre></td></tr></table></figure><h5 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h5><p>关于configure、make、make install</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">源码的安装一般由有这三个步骤：配置(configure)、编译(make)、安装(make install)</span><br><span class="line"></span><br><span class="line">其中–prefix选项就是配置安装的路径，如果不配置该选项，安装后可执行文件默认放在/usr /local/bin，库文件默认放在/usr/local/lib，配置文件默认放在/usr/local/etc，其它的资源文件放在/usr /local/share，比较分散。</span><br><span class="line">为了便于集中管理某个软件的各种文件，可以配置–prefix，如：./configure –prefix=/usr/local 。可以把所有资源文件放在/usr/local的路径中，就不会分散了。</span><br><span class="line">使用--prefix选项的另一个好处是方便卸载软件或移植软件；当某个安装的软件不再需要时，只须简单的删除该安装目录，就可以把软件卸载得干干净净；而移植软件只需拷贝整个目录到另外一个机器即可（相同的操作系统下）。</span><br></pre></td></tr></table></figure><p>configure</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">首先检查机器的一些配置和环境，系统的相关依赖。如果缺少相关依赖，脚本会停止执行，软件安装失败</span><br><span class="line">根据之前检查环境和依赖的结果，生产Makefile文件（main job）</span><br></pre></td></tr></table></figure><p>make</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make是Unix系统下的一个包。执行make命令需Makefile文件。make会根据Makefile文件中指令来安装软件</span><br><span class="line">Makefile文件中有许多标签，来表示不同的section。一般的，make会编译源代码并生成可执行文件，其实Makefile主要就是描述文件编译的相互依赖关系</span><br></pre></td></tr></table></figure><p>make install</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当执行make命令不加任何参数，程序就会按照Makefile的指令在相应的section间跳转并且执行相应的命令</span><br><span class="line">加上install参数即执行make install时，程序只会执行install section处的命令。install section的指令会将make阶段生产的可执行文件拷贝到相应的地方，例如/usr/local/bin</span><br><span class="line">make clean 会删除上次make生产的obj文件以及可执行文件</span><br></pre></td></tr></table></figure><p>配置软链接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /usr/local/nginx/sbin/nginx /usr/bin/nginx</span><br></pre></td></tr></table></figure><p>现在就可以不用路径直接输入nginx启动。</p><p>配置开机启动服务</p><p>在/etc/init.d/下创建nginx文件，sudo vim /etc/init.d/nginx，内容如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">### BEGIN INIT INFO</span><br><span class="line"># Provides:      nginx</span><br><span class="line"># Required-Start:    $local_fs $remote_fs $network $syslog $named</span><br><span class="line"># Required-Stop:     $local_fs $remote_fs $network $syslog $named</span><br><span class="line"># Default-Start:     2 3 4 5</span><br><span class="line"># Default-Stop:      0 1 6</span><br><span class="line"># Short-Description: starts the nginx web server</span><br><span class="line"># Description:       starts nginx using start-stop-daemon</span><br><span class="line">### END INIT INFO</span><br><span class="line"></span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">DAEMON=/usr/local/nginx/sbin/nginx</span><br><span class="line">NAME=nginx</span><br><span class="line">DESC=nginx</span><br><span class="line"></span><br><span class="line"># Include nginx defaults if available</span><br><span class="line">if [ -r /etc/default/nginx ]; then</span><br><span class="line">    . /etc/default/nginx</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">STOP_SCHEDULE=&quot;$&#123;STOP_SCHEDULE:-QUIT/5/TERM/5/KILL/5&#125;&quot;</span><br><span class="line"></span><br><span class="line">test -x $DAEMON || exit 0</span><br><span class="line"></span><br><span class="line">. /lib/init/vars.sh</span><br><span class="line">. /lib/lsb/init-functions</span><br><span class="line"></span><br><span class="line"># Try to extract nginx pidfile</span><br><span class="line">PID=$(cat /usr/local/nginx/conf/nginx.conf | grep -Ev &apos;^\s*#&apos; | awk &apos;BEGIN &#123; RS=&quot;[;&#123;&#125;]&quot; &#125; &#123; if ($1 == &quot;pid&quot;) print $2 &#125;&apos; | head -n1)</span><br><span class="line">if [ -z &quot;$PID&quot; ]; then</span><br><span class="line">    PID=/run/nginx.pid</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ -n &quot;$ULIMIT&quot; ]; then</span><br><span class="line">    # Set ulimit if it is set in /etc/default/nginx</span><br><span class="line">    ulimit $ULIMIT</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">start_nginx() &#123;</span><br><span class="line">    # Start the daemon/service</span><br><span class="line">    #</span><br><span class="line">    # Returns:</span><br><span class="line">    #   0 if daemon has been started</span><br><span class="line">    #   1 if daemon was already running</span><br><span class="line">    #   2 if daemon could not be started</span><br><span class="line">    start-stop-daemon --start --quiet --pidfile $PID --exec $DAEMON --test &gt; /dev/null \</span><br><span class="line">        || return 1</span><br><span class="line">    start-stop-daemon --start --quiet --pidfile $PID --exec $DAEMON -- \</span><br><span class="line">        $DAEMON_OPTS 2&gt;/dev/null \</span><br><span class="line">        || return 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test_config() &#123;</span><br><span class="line">    # Test the nginx configuration</span><br><span class="line">    $DAEMON -t $DAEMON_OPTS &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stop_nginx() &#123;</span><br><span class="line">    # Stops the daemon/service</span><br><span class="line">    #</span><br><span class="line">    # Return</span><br><span class="line">    #   0 if daemon has been stopped</span><br><span class="line">    #   1 if daemon was already stopped</span><br><span class="line">    #   2 if daemon could not be stopped</span><br><span class="line">    #   other if a failure occurred</span><br><span class="line">    start-stop-daemon --stop --quiet --retry=$STOP_SCHEDULE --pidfile $PID --name $NAME</span><br><span class="line">    RETVAL=&quot;$?&quot;</span><br><span class="line">    sleep 1</span><br><span class="line">    return &quot;$RETVAL&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reload_nginx() &#123;</span><br><span class="line">    # Function that sends a SIGHUP to the daemon/service</span><br><span class="line">    start-stop-daemon --stop --signal HUP --quiet --pidfile $PID --name $NAME</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rotate_logs() &#123;</span><br><span class="line">    # Rotate log files</span><br><span class="line">    start-stop-daemon --stop --signal USR1 --quiet --pidfile $PID --name $NAME</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upgrade_nginx() &#123;</span><br><span class="line">    # Online upgrade nginx executable</span><br><span class="line">    # http://nginx.org/en/docs/control.html</span><br><span class="line">    #</span><br><span class="line">    # Return</span><br><span class="line">    #   0 if nginx has been successfully upgraded</span><br><span class="line">    #   1 if nginx is not running</span><br><span class="line">    #   2 if the pid files were not created on time</span><br><span class="line">    #   3 if the old master could not be killed</span><br><span class="line">    if start-stop-daemon --stop --signal USR2 --quiet --pidfile $PID --name $NAME; then</span><br><span class="line">        # Wait for both old and new master to write their pid file</span><br><span class="line">        while [ ! -s &quot;$&#123;PID&#125;.oldbin&quot; ] || [ ! -s &quot;$&#123;PID&#125;&quot; ]; do</span><br><span class="line">            cnt=`expr $cnt + 1`</span><br><span class="line">            if [ $cnt -gt 10 ]; then</span><br><span class="line">                return 2</span><br><span class="line">            fi</span><br><span class="line">            sleep 1</span><br><span class="line">        done</span><br><span class="line">        # Everything is ready, gracefully stop the old master</span><br><span class="line">        if start-stop-daemon --stop --signal QUIT --quiet --pidfile &quot;$&#123;PID&#125;.oldbin&quot; --name $NAME; then</span><br><span class="line">            return 0</span><br><span class="line">        else</span><br><span class="line">            return 3</span><br><span class="line">        fi</span><br><span class="line">    else</span><br><span class="line">        return 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start)</span><br><span class="line">        log_daemon_msg &quot;Starting $DESC&quot; &quot;$NAME&quot;</span><br><span class="line">        start_nginx</span><br><span class="line">        case &quot;$?&quot; in</span><br><span class="line">            0|1) log_end_msg 0 ;;</span><br><span class="line">            2)   log_end_msg 1 ;;</span><br><span class="line">        esac</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        log_daemon_msg &quot;Stopping $DESC&quot; &quot;$NAME&quot;</span><br><span class="line">        stop_nginx</span><br><span class="line">        case &quot;$?&quot; in</span><br><span class="line">            0|1) log_end_msg 0 ;;</span><br><span class="line">            2)   log_end_msg 1 ;;</span><br><span class="line">        esac</span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        log_daemon_msg &quot;Restarting $DESC&quot; &quot;$NAME&quot;</span><br><span class="line"></span><br><span class="line">        # Check configuration before stopping nginx</span><br><span class="line">        if ! test_config; then</span><br><span class="line">            log_end_msg 1 # Configuration error</span><br><span class="line">            exit $?</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        stop_nginx</span><br><span class="line">        case &quot;$?&quot; in</span><br><span class="line">            0|1)</span><br><span class="line">                start_nginx</span><br><span class="line">                case &quot;$?&quot; in</span><br><span class="line">                    0) log_end_msg 0 ;;</span><br><span class="line">                    1) log_end_msg 1 ;; # Old process is still running</span><br><span class="line">                    *) log_end_msg 1 ;; # Failed to start</span><br><span class="line">                esac</span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                # Failed to stop</span><br><span class="line">                log_end_msg 1</span><br><span class="line">                ;;</span><br><span class="line">        esac</span><br><span class="line">        ;;</span><br><span class="line">    reload|force-reload)</span><br><span class="line">        log_daemon_msg &quot;Reloading $DESC configuration&quot; &quot;$NAME&quot;</span><br><span class="line"></span><br><span class="line">        # Check configuration before stopping nginx</span><br><span class="line">        #</span><br><span class="line">        # This is not entirely correct since the on-disk nginx binary</span><br><span class="line">        # may differ from the in-memory one, but that&apos;s not common.</span><br><span class="line">        # We prefer to check the configuration and return an error</span><br><span class="line">        # to the administrator.</span><br><span class="line">        if ! test_config; then</span><br><span class="line">            log_end_msg 1 # Configuration error</span><br><span class="line">            exit $?</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        reload_nginx</span><br><span class="line">        log_end_msg $?</span><br><span class="line">        ;;</span><br><span class="line">    configtest|testconfig)</span><br><span class="line">        log_daemon_msg &quot;Testing $DESC configuration&quot;</span><br><span class="line">        test_config</span><br><span class="line">        log_end_msg $?</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        status_of_proc -p $PID &quot;$DAEMON&quot; &quot;$NAME&quot; &amp;&amp; exit 0 || exit $?</span><br><span class="line">        ;;</span><br><span class="line">    upgrade)</span><br><span class="line">        log_daemon_msg &quot;Upgrading binary&quot; &quot;$NAME&quot;</span><br><span class="line">        upgrade_nginx</span><br><span class="line">        log_end_msg $?</span><br><span class="line">        ;;</span><br><span class="line">    rotate)</span><br><span class="line">        log_daemon_msg &quot;Re-opening $DESC log files&quot; &quot;$NAME&quot;</span><br><span class="line">        rotate_logs</span><br><span class="line">        log_end_msg $?</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        echo &quot;Usage: $NAME &#123;start|stop|restart|reload|force-reload|status|configtest|rotate|upgrade&#125;&quot; &gt;&amp;2</span><br><span class="line">        exit 3</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><p>-</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#设置服务脚本有执行权限</span><br><span class="line">sudo chmod +x /etc/init.d/nginx</span><br><span class="line">#注册服务</span><br><span class="line">cd /etc/init.d/</span><br><span class="line">sudo update-rc.d nginx defaults</span><br></pre></td></tr></table></figure><p>现在基本上就可以开机启动了，常用的命令如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx &#123;start|stop|restart|reload|force-reload|status|configtest|rotate|upgrade&#125;</span><br></pre></td></tr></table></figure><h2 id="fastDFS软件准备"><a href="#fastDFS软件准备" class="headerlink" title="fastDFS软件准备"></a>fastDFS软件准备</h2><p>fastdfs-5.10.tar.gz</p><p>libfastcommon-1.36.zip</p><p>fastdfs-nginx-module_v1.16.tar.gz</p><h2 id="阿里云服务器准备"><a href="#阿里云服务器准备" class="headerlink" title="阿里云服务器准备"></a>阿里云服务器准备</h2><p>参考</p><p><a href="https://www.cnblogs.com/guigujun/p/7804670.html" target="_blank" rel="noopener">https://www.cnblogs.com/guigujun/p/7804670.html</a></p><p>本人使用的是阿里云服务器,配置上和上面教程略有不同</p><p>阿里防火墙 开放端口 TCP 22122 23000 等,记得开放要用的端口,否则后面操作失败</p><p>由于有了阿里云防火墙,所以服务器上的防火墙基本都不想开了,因为如果开放一个端口,要改阿里防火墙和服务器防火墙 2个地方,太繁琐了,所以可以使用以下命令禁用服务器自身的防火墙</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#关闭防火墙</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line">#禁止防火墙开机自启</span><br><span class="line">systemctl disable firewalld.service</span><br></pre></td></tr></table></figure><h1 id="fastDFS安装"><a href="#fastDFS安装" class="headerlink" title="fastDFS安装"></a>fastDFS安装</h1><h2 id="安装libfastcommon"><a href="#安装libfastcommon" class="headerlink" title="安装libfastcommon"></a>安装libfastcommon</h2><p>使用软件上传所有FastDFS软件到服务器的 /home/package/fdfs目录上（目录自己建立）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cd /home/package/fdfs</span><br><span class="line"></span><br><span class="line"># 解压所有的压缩包</span><br><span class="line">unzip libfastcommon-1.0.36.zip</span><br><span class="line">tar -zxvf fastdfs-5.10.tar.gz</span><br><span class="line">tar -zxvf fastdfs-nginx-module_v1.16.tar.gz</span><br><span class="line"></span><br><span class="line"># 安装fastdfs的环境</span><br><span class="line">cd libfastcommon-1.0.36</span><br><span class="line">./make.sh</span><br><span class="line">./make.sh install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#建立软链接(可省略)</span><br><span class="line">ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so</span><br><span class="line">ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so</span><br><span class="line">ln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so</span><br><span class="line">ln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so</span><br></pre></td></tr></table></figure><h2 id="安装fastDFS"><a href="#安装fastDFS" class="headerlink" title="安装fastDFS"></a>安装fastDFS</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 安装FastDFS</span><br><span class="line">cd /home/package/fdfs/fastdfs-5.10</span><br><span class="line">./make.sh</span><br><span class="line">./make.sh install</span><br><span class="line"></span><br><span class="line">#从样本中拷贝配置文件</span><br><span class="line">cd /etc/fdfs/</span><br><span class="line">cp client.conf.sample client.conf</span><br><span class="line">cp storage.conf.sample storage.conf</span><br><span class="line">cp tracker.conf.sample tracker.conf</span><br></pre></td></tr></table></figure><h3 id="配置tracker"><a href="#配置tracker" class="headerlink" title="配置tracker"></a>配置tracker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># 一并把后面要的所有目录创建</span><br><span class="line">mkdir /home/fastdfs/tracker</span><br><span class="line">mkdir /home/fastdfs/storage</span><br><span class="line">mkdir /home/fastdfs/client</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">******************************************</span><br><span class="line"># 配置文件 tracker</span><br><span class="line">vim /etc/fdfs/tracker.conf</span><br><span class="line"># 关注以下配置</span><br><span class="line">disabled=false </span><br><span class="line">port=22122 #默认端口号 </span><br><span class="line">base_path=/home/fastdfs/tracker #自己刚创建的目录 </span><br><span class="line">#http.server_port=8080 #默认端口是8080</span><br><span class="line">#bind_addr 留空即可,不写则(外网内网)都可以访问</span><br><span class="line">bind_addr=</span><br><span class="line">#bind_addr=192.168.133.128内网网址</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看支持命令 ,常用的有 start,stop,status</span><br><span class="line">service fdfs_trackerd</span><br><span class="line"># 启动tracker,这里显示ok还不行,还得看下面的监听端口看不看得到</span><br><span class="line">service fdfs_trackerd start</span><br><span class="line">#fdfs_trackerd /etc/fdfs/tracker.conf 同样可以启动</span><br><span class="line"></span><br><span class="line"># 开机自启动</span><br><span class="line">echo &quot;service fdfs_trackerd start&quot; |tee -a /etc/rc.d/rc.local</span><br><span class="line"></span><br><span class="line">#查看tracker监听端口</span><br><span class="line"># 这里必须看到 tracker的监听端口,否则请检查上面的操作</span><br><span class="line">netstat -unltp|grep fdfs</span><br></pre></td></tr></table></figure><h3 id="配置storage"><a href="#配置storage" class="headerlink" title="配置storage"></a>配置storage</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">*****************************</span><br><span class="line"># 配置文件 storage</span><br><span class="line">vim /etc/fdfs/storage.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 注意下列配置</span><br><span class="line">disabled=false </span><br><span class="line">group_name=group1 #组名，根据实际情况修改 </span><br><span class="line">port=23000 #设置storage的端口号，默认是23000，同一个组的storage端口号必须一致 </span><br><span class="line">base_path=/home/fastdfs/storage #设置storage数据文件和日志目录 </span><br><span class="line">store_path_count=1 #存储路径个数，需要和store_path个数匹配 </span><br><span class="line">store_path0=/home/fastdfs/storage_data #实际文件存储路径 </span><br><span class="line">tracker_server=公网IP:22122 #阿里云服务器的公网IP</span><br><span class="line">#bind_addr 留空即可,不写则(外网内网)都可以访问</span><br><span class="line">bind_addr=</span><br><span class="line">#bind_addr=192.168.133.128内网网址</span><br><span class="line">#http.server_port=8888 #设置 http 端口号</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建软引用</span><br><span class="line">ln -s /usr/bin/fdfs_storaged /usr/local/bin</span><br><span class="line"></span><br><span class="line">#启动storage ,这里ok还不行,必须看到storage的监听端口才行</span><br><span class="line">service fdfs_storaged start</span><br><span class="line">#fdfs_storaged /etc/fdfs/storage.conf</span><br><span class="line"></span><br><span class="line">#开机自启动 storage</span><br><span class="line">echo &quot;service fdfs_storaged start&quot; |tee -a /etc/rc.d/rc.local</span><br><span class="line"></span><br><span class="line"># 看一下是否有tracker和storage的2个监听端口,否则请检查上面操作</span><br><span class="line">netstat -unltp | grep fdfs</span><br></pre></td></tr></table></figure><h3 id="配置client"><a href="#配置client" class="headerlink" title="配置client"></a>配置client</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fdfs/client.conf</span><br><span class="line"></span><br><span class="line"># 注意以下配置</span><br><span class="line">base_path=/home/fastdfs/client #tracker服务器文件路径</span><br><span class="line">tracker_server=公网IP:22122 #tracker服务器IP地址和端口号</span><br><span class="line">#http.tracker_server_port=8080 # tracker 服务器的 http端口号，必须和tracker的设置对应起来</span><br></pre></td></tr></table></figure><h3 id="检验"><a href="#检验" class="headerlink" title="检验"></a>检验</h3><h4 id="检验测试"><a href="#检验测试" class="headerlink" title="检验测试"></a>检验测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdfs_moniter /etc/fdfs/client.conf</span><br></pre></td></tr></table></figure><h4 id="检验上传下载"><a href="#检验上传下载" class="headerlink" title="检验上传下载"></a>检验上传下载</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 图片 /home/temp/test.jpg</span><br><span class="line"></span><br><span class="line">#上传图片</span><br><span class="line">fdfs_upload_file  /etc/fdfs/client.conf /home/temp/test.jpg</span><br><span class="line"></span><br><span class="line"># 看到group1/M00/00/00字眼即成功了,这个信息后面有用</span><br><span class="line"># group1/M00/00/00/rBEx3l5k7cmAW6eiAAGyE0VtDsM290.jpg</span><br><span class="line"></span><br><span class="line">#下载图片</span><br><span class="line">fdfs_download_file group1/M00/00/00/rBEx3l5k7cmAW6eiAAGyE0VtDsM290.jpg</span><br><span class="line"></span><br><span class="line">#查看当前路径下有没有图片 rBEx3l5k7cmAW6eiAAGyE0VtDsM290.jpg</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><h1 id="fastdfs-nginx-module安装"><a href="#fastdfs-nginx-module安装" class="headerlink" title="fastdfs-nginx-module安装"></a>fastdfs-nginx-module安装</h1><h2 id="Nginx相关"><a href="#Nginx相关" class="headerlink" title="Nginx相关"></a>Nginx相关</h2><h3 id="nginx安装"><a href="#nginx安装" class="headerlink" title="nginx安装"></a>nginx安装</h3><h4 id="源码安装路径"><a href="#源码安装路径" class="headerlink" title="源码安装路径"></a>源码安装路径</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /home/package/nginx/nginx-1.10.1/</span><br></pre></td></tr></table></figure><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">./configure --add-module=/home/package/fdfs_nginx_module/fastdfs-nginx-module/src</span><br><span class="line"></span><br><span class="line">#跳转objs目录编辑Makefile添加头文件</span><br><span class="line">vim ./objs/Makefile</span><br><span class="line"># 添加以下语句</span><br><span class="line">-I usr/include/fastdfs \</span><br><span class="line">-I usr/include/fastcommon \</span><br><span class="line"></span><br><span class="line">#最后编译安装</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h3 id="宝塔nginx安装"><a href="#宝塔nginx安装" class="headerlink" title="宝塔nginx安装"></a>宝塔nginx安装</h3><h4 id="默认安装脚本路径"><a href="#默认安装脚本路径" class="headerlink" title="默认安装脚本路径"></a>默认安装脚本路径</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/www/server/panel/install/nginx.sh</span><br></pre></td></tr></table></figure><h4 id="nginx源码位置"><a href="#nginx源码位置" class="headerlink" title="nginx源码位置"></a>nginx源码位置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/www/server/nginx/src/</span><br></pre></td></tr></table></figure><h4 id="重新编译宝塔nginx"><a href="#重新编译宝塔nginx" class="headerlink" title="重新编译宝塔nginx"></a>重新编译宝塔nginx</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /www/server/nginx/src/</span><br></pre></td></tr></table></figure><h5 id="查看nginx编译参数"><a href="#查看nginx编译参数" class="headerlink" title="查看nginx编译参数"></a>查看nginx编译参数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -V</span><br></pre></td></tr></table></figure><p>返回结果（我的）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--user=www --group=www --prefix=/www/server/nginx --add-module=/www/server/nginx/src/ngx_devel_kit --add-module=/www/server/nginx/src/lua_nginx_module --add-module=/www/server/nginx/src/ngx_cache_purge --add-module=/www/server/nginx/src/nginx-sticky-module --with-openssl=/www/server/nginx/src/openssl --with-pcre=pcre-8.43 --with-http_v2_module --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-http_stub_status_module --with-http_ssl_module --with-http_image_filter_module --with-http_gzip_static_module --with-http_gunzip_module --with-ipv6 --with-http_sub_module --with-http_flv_module --with-http_addition_module --with-http_realip_module --with-http_mp4_module --with-ld-opt=-Wl,-E --with-cc-opt=-Wno-error --with-ld-opt=-ljemalloc --with-http_dav_module --add-module=/www/server/nginx/src/nginx-dav-ext-module</span><br></pre></td></tr></table></figure><h5 id="添加代码"><a href="#添加代码" class="headerlink" title="添加代码"></a>添加代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--add-module=/home/package/fdfs_nginx_module/fastdfs-nginx-module/src</span><br></pre></td></tr></table></figure><h5 id="添加fastDFS模块（以上两部分整合）"><a href="#添加fastDFS模块（以上两部分整合）" class="headerlink" title="添加fastDFS模块（以上两部分整合）"></a>添加fastDFS模块（以上两部分整合）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--user=www --group=www --prefix=/www/server/nginx --add-module=/www/server/nginx/src/ngx_devel_kit --add-module=/www/server/nginx/src/lua_nginx_module --add-module=/www/server/nginx/src/ngx_cache_purge --add-module=/www/server/nginx/src/nginx-sticky-module --with-openssl=/www/server/nginx/src/openssl --with-pcre=pcre-8.43 --with-http_v2_module --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-http_stub_status_module --with-http_ssl_module --with-http_image_filter_module --with-http_gzip_static_module --with-http_gunzip_module --with-ipv6 --with-http_sub_module --with-http_flv_module --with-http_addition_module --with-http_realip_module --with-http_mp4_module --with-ld-opt=-Wl,-E --with-cc-opt=-Wno-error --with-ld-opt=-ljemalloc --with-http_dav_module --add-module=/www/server/nginx/src/nginx-dav-ext-module --add-module=/home/package/fdfs_nginx_module/fastdfs-nginx-module/src</span><br></pre></td></tr></table></figure><h5 id="nginx重新编译"><a href="#nginx重新编译" class="headerlink" title="nginx重新编译"></a>nginx重新编译</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --user=www --group=www --prefix=/www/server/nginx --add-module=/www/server/nginx/src/ngx_devel_kit --add-module=/www/server/nginx/src/lua_nginx_module --add-module=/www/server/nginx/src/ngx_cache_purge --add-module=/www/server/nginx/src/nginx-sticky-module --with-openssl=/www/server/nginx/src/openssl --with-pcre=pcre-8.43 --with-http_v2_module --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-http_stub_status_module --with-http_ssl_module --with-http_image_filter_module --with-http_gzip_static_module --with-http_gunzip_module --with-ipv6 --with-http_sub_module --with-http_flv_module --with-http_addition_module --with-http_realip_module --with-http_mp4_module --with-ld-opt=-Wl,-E --with-cc-opt=-Wno-error --with-ld-opt=-ljemalloc --with-http_dav_module --add-module=/www/server/nginx/src/nginx-dav-ext-module --add-module=/home/package/fdfs_nginx_module/fastdfs-nginx-module/src</span><br></pre></td></tr></table></figure><h4 id="make"><a href="#make" class="headerlink" title="make"></a>make</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fatal error: fdfs_define.h: No such file or directory </span><br><span class="line">fatal error: common_define.h: No such file or directory</span><br></pre></td></tr></table></figure><p>vim 打开makefile目录下边的 objs/Makefile </p><p>在这个makefile中添加两个头文件 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /www/server/nginx/src/objs/Makefile</span><br><span class="line"></span><br><span class="line"># 添加以下语句</span><br><span class="line">-I usr/include/fastdfs \</span><br><span class="line">-I usr/include/fastcommon \</span><br></pre></td></tr></table></figure><h4 id="make-install"><a href="#make-install" class="headerlink" title="make install"></a>make install</h4><h5 id="未安装nginx"><a href="#未安装nginx" class="headerlink" title="未安装nginx"></a>未安装nginx</h5><p>直接make install</p><h5 id="已安装"><a href="#已安装" class="headerlink" title="已安装"></a>已安装</h5><p>复制编译后产生的nginx文件，替换旧的nginx文件（自己需提前备份）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /www/server/nginx/src/objs/nginx /www/server/nginx/sbin/</span><br></pre></td></tr></table></figure><h3 id="nginx启动"><a href="#nginx启动" class="headerlink" title="nginx启动"></a>nginx启动</h3><p>启动nginx, 只有一个master没有worker</p><p>查看日志文件 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/logs/error.log </span><br><span class="line"></span><br><span class="line">ERROR - file: shared_func.c, line: 968, file  /etc/fdfs/mod_fastdfs.conf not exist </span><br><span class="line">#拷贝fastdfs-nginx-module/src中的mod_fastdfs.conf到/etc/fdfs/中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ERROR - file: ini_file_reader.c, line: 631, include file &quot;http.conf&quot; not exists, line: &quot;#include http.conf&quot;</span><br><span class="line">#从fastDFS的源码安装包中的conf中 将http.conf 拷贝到 /etc/fdfs/</span><br><span class="line">#从nginx的源码安装包中的conf中mime.types拷贝到 /etc/fdfs/</span><br></pre></td></tr></table></figure><h1 id="mod-fastdfs-conf-配置文件"><a href="#mod-fastdfs-conf-配置文件" class="headerlink" title="mod_fastdfs.conf 配置文件"></a>mod_fastdfs.conf 配置文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">base_path=/home/fastDFS/storage #log日志目录</span><br><span class="line">tracker_server=公网:22122 #追踪器的地址</span><br><span class="line">storage_server_port=23000 #当前存储节点的端口</span><br><span class="line">group_name=group1 #当前存储节点所属的组</span><br><span class="line">url_have_group_name = true #浏览器访问的时候, url中是否包含组名</span><br><span class="line">store_path_count=1 #当前存储节点存储路径的个数</span><br><span class="line">store_path1 store_path2 #如果有多个, 需要全部写到配置文件中</span><br><span class="line">store_path0=/home/robin/fastDFS/storage #当前存储节点的存储路径</span><br><span class="line">group_count = 1 #整个的fastDFS文件系统一共有多少个组</span><br><span class="line">[group1] #每个组信息</span><br><span class="line">group_name=group1</span><br><span class="line">storage_server_port=23000</span><br><span class="line">store_path_count=1</span><br><span class="line">store_path0=/home/fastDFS/storage</span><br></pre></td></tr></table></figure><h1 id="nginx配置文件添加location"><a href="#nginx配置文件添加location" class="headerlink" title="nginx配置文件添加location"></a>nginx配置文件添加location</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location /group1/M00&#123;</span><br><span class="line">    root   /home/fastdfs/storage/data;</span><br><span class="line">    ngx_fastdfs_module;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之前上传的图片路径为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group1/M00/00/00/rBEx3l5k7cmAW6eiAAGyE0VtDsM290.jpg</span><br></pre></td></tr></table></figure><p>访问链接</p><p><a href="http://39.96.209.253/group1/M00/00/00/rBEx3l5k7cmAW6eiAAGyE0VtDsM290.jpg" target="_blank" rel="noopener">http://39.96.209.253/group1/M00/00/00/rBEx3l5k7cmAW6eiAAGyE0VtDsM290.jpg</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;准备工作&quot;&gt;&lt;a href=&quot;#准备工作&quot; class=&quot;headerlink&quot; title=&quot;准备工作&quot;&gt;&lt;/a&gt;准备工作&lt;/h1&gt;&lt;p&gt;服务器：Linux（CentOS 7.x，Ubuntu）&lt;/p&gt;
&lt;h2 id=&quot;Nginx安装&quot;&gt;&lt;a href=&quot;#Ng
      
    
    </summary>
    
      <category term="程序人生" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
      <category term="Linux" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/Linux/"/>
    
    
      <category term="Linux" scheme="http://qianyouyou.cn/tags/Linux/"/>
    
      <category term="大数据" scheme="http://qianyouyou.cn/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="分布式" scheme="http://qianyouyou.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
      <category term="FastDFS" scheme="http://qianyouyou.cn/tags/FastDFS/"/>
    
      <category term="Nginx" scheme="http://qianyouyou.cn/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>在山的那边，还是山</title>
    <link href="http://qianyouyou.cn/2020/01/23/2020-01-23/"/>
    <id>http://qianyouyou.cn/2020/01/23/2020-01-23/</id>
    <published>2020-01-23T04:22:37.000Z</published>
    <updated>2020-01-23T05:16:15.391Z</updated>
    
    <content type="html"><![CDATA[<p>人生天地间，忽如远行客。人从诞生起，便是一场走向死亡的旅程。，我们别无选择的被命运推着向前走，不能回头。虽然人生这场旅程中，我们没办法回头，但是上帝赋予了我们每个人选择的权利。尽管每个人会走向同样的终点，但每个人都身处不同的起点，拥有自己道路的选择权，这就注定了每个人在旅程中会遇到不一样的风景。</p><p>有人说，我们降临到世上，要么是疯子，要么是傻子。疯子风雨兼程，义无反顾；傻子知足常乐，安之若素。其实这话说的也不错，就像人生的分岔路口上，都会有崎岖的山路，也会有平稳的坦途。选择山路，比较辛苦，随时都有跌落山谷的危险，但沿途能欣赏广阔的风景；选择坦途，比较轻松，不用思考任何风险，但也失去了广阔的风景。就像每个人都会问自己，是想成为马云，还是想成为佛祖。每个人都会有自己的选择，谁也没有资格评论其他人的选择，唯一能做的，就是不忘初心，坚持自己的选择。</p><p>我时常会问自己，究竟是选择山路，还是选择坦途。很多时候，我都会犹豫不决，一方面是对挫折的恐惧，一方面又不甘于碌碌无为。但这个时候，上帝总会帮我寻找心中所向往的那片风景。秋招时，因为恐惧面试，而草草的签了三方协议。尽管薪资达不到自己的预期，但还是选择了安稳。本以为从此之后便再也没办法回头，但还是遇到了人生的伯乐，经过心理上克服面试的恐惧，最终成功签约自己心仪的公司。</p><p>当我们历经磨难，踏上山巅时，已经欣赏到了更远阔的风景，也收获了沿途克服崎岖的喜悦。但我们的人生没有暂停键，也没有后退键。这时候，我们依旧要向前走，但当我们到达一座山顶时，四周的路只能向下。而山那边，依然是山。我们别无选择继续跨越前方的山。就像我，因为签约了新的公司，必须想办法解约三方协议，而我们作为违约的一方，就必须承担责任，想获得学校一方的同意挺难，因为有很多流程，谁也不想自己太麻烦；以前的公司不会简简单单的帮助我们违约，违约不违约都是要交违约金，而且没违约成功，未来在旧公司里也会备受排挤。而此刻的我，没有回头路，只能继续向前。</p><p>当我们选择山路时，往往也会向往安稳的坦途，但身在山路，稍不留神便会跌落谷底。与其后悔，不妨继续享受这沿途的风景。我们之所以害怕山路，其实是对挫折的恐惧。就像我对与学校和公司违约谈判的恐惧，对这个过程中可能遇到的各种麻烦一样。但是任何没有打倒我们的力量，只能让我们的内心变得更强大。因此，此刻正望着另一座山的我，定要把挫折当做使自己变得强大的力量，战胜恐惧，欣赏风景，坚定向前。就像汪国真《热爱生命》中写的那样：</p><p>我不去想是否能够成功<br>既然选择了远方<br>便只顾风雨兼程</p><p>我不去想能否赢得爱情<br>既然钟情于玫瑰<br>就勇敢地吐露真诚</p><p>我不去想身后会不会袭来寒风冷雨<br>既然目标是地平线<br>留给世界的只能是背影</p><p>我不去想未来是平坦还是泥泞<br>只要热爱生命<br>一切，都在意料之中</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;人生天地间，忽如远行客。人从诞生起，便是一场走向死亡的旅程。，我们别无选择的被命运推着向前走，不能回头。虽然人生这场旅程中，我们没办法回头，但是上帝赋予了我们每个人选择的权利。尽管每个人会走向同样的终点，但每个人都身处不同的起点，拥有自己道路的选择权，这就注定了每个人在旅程
      
    
    </summary>
    
      <category term="心路历程" scheme="http://qianyouyou.cn/categories/%E5%BF%83%E8%B7%AF%E5%8E%86%E7%A8%8B/"/>
    
      <category term="散文" scheme="http://qianyouyou.cn/categories/%E5%BF%83%E8%B7%AF%E5%8E%86%E7%A8%8B/%E6%95%A3%E6%96%87/"/>
    
    
  </entry>
  
  <entry>
    <title>爱你所爱，行你所行，听从你心，无问西东</title>
    <link href="http://qianyouyou.cn/2019/12/17/2019-12-17/"/>
    <id>http://qianyouyou.cn/2019/12/17/2019-12-17/</id>
    <published>2019-12-17T13:34:08.000Z</published>
    <updated>2019-12-17T15:57:46.511Z</updated>
    
    <content type="html"><![CDATA[<p>对于这部电影，早有耳闻，毕竟王菲的《无问西东》与毛不易的《无问》都是我时常聆听的歌。只是不知何时起，被生活中的各种琐事困扰，渐渐地，失去了对美好世界的向往，以及静下心来欣赏好电影的热忱。正在迷茫之际，所幸遇到这部电影以及它所传达的救赎之道，又点亮了我内心所向往的那道光。</p><p>影片分为了四个小故事，背景分别在当代，文革时代，战火时代，以及那个咆哮的时代。通过职场，爱情，家国，自我救赎，四个主题，以救赎为牵引线，化作了一个故事，共同传达了爱与传承的主旨。</p><p>电影首先讲述的是生活在当代尔虞我诈的职场，每天愁眉苦脸的男主张果果，因为上司的设计而背黑锅被迫离职。在新的公司里，因为看到曾经能帮助而未尽力帮助的四胞胎家庭如今生活落魄，决定通过事业帮助这个家庭。在医院看望四胞胎婴儿时，他向婴儿家人承诺会争取四胞胎的手术费。而在对他们提供帮助后，前公司的老总告诉他一些过往的经历劝他小心。他开始怀疑四胞胎的家人从此以后赖上了他。而同时老总给男主提供了一个揭发曾经算计他的上司丑陋罪行的机会。面对心中善恶的审批，男主该如何回应呢。</p><p>第二个故事发生在文革前。黄晓明饰演的陈鹏是一个大学的优等生，章子怡饰演的王敏佳与铁政饰演的李想则是医学院的一个学生，三人从小便是相依相伴的孤儿。陈鹏一直喜欢着王敏佳，原本打算为爱放弃事业时，却看到王敏佳和李想两个人暧昧，选择了离开。王敏佳和李想看到师母殴打恩师，写信为恩师打抱不平，却遭到师母的告状。面对李想的前程，王敏佳选择独自承担，却遭到了各个阶级莫须有的罪名，李想自始至终选择沉默。最终在批判大会上含冤死去。</p><p>第三个故事讲述的是飞行家的故事，王力宏饰演的沈光耀原本是富家子弟，文武兼备，因为一腔热血，报名空军，却遭到家人的反对，最终选择放下功名，安之若素。之后却看着日军狂轰乱炸，在国与家的面前，他该何去何从。</p><p>第四个故事比较简单，由陈楚生饰演的吴岭澜国学与英语成绩优异，然而当时正值实业救国思潮，本是文科好苗子的他选择了理工科，然而却因物理成绩垫底被迫重新作出选择。对于自己所擅长的文科与实用的理科，他该如何选择。</p><p>最终，吴岭澜听了泰戈尔的演讲，明白了那些伟人以及引领时代的人其实不一定都是实业家，他们其实时时刻刻都在对生命的价值进行思索。最终他毅然遵从内心，选择了文科，从此当一名教师，传道受业解惑。</p><p>而正是吴岭澜的几句话，影响了沈光耀，在日军轰炸同胞，战火迷离之际，他选择了当一名飞行员，为保家卫国献上了自己最绚烂的青春。 在他执行飞行任务时，总不忘将食物从空中撒向贫民区。从自己的村子，到飞机途径的各个村子，都有他所传递的那份爱。</p><p>正因为沈光耀的选择，才救助了陈鹏他们所在的村子，造就了陈鹏一村人感恩的心。最终陈鹏为爱返乡，将濒死的王敏佳带回村子，托付给村子救助。因为陈鹏的守护，王敏佳才有了生的希望。</p><p>在陈鹏的感染下，李想最终在大雪纷飞的雪地里将食物留给了素不相识的张果果的父母，最终自己却冻死了。而每年，张果果一家不管多忙碌，总会在清明节那天去为李想扫墓。正是因为这份爱与传递，最终感染了张果果，他最终洗涤了心中世俗化的感染，无偿为四胞胎的父母提供了住所与工作，也主动选择放弃揭发曾经算计自己的上司。</p><p>满怀热忱的我们，无可避免都得经受现实的洗礼。</p><p>还记得王敏佳在批判大会上的那抹笑容。当她环顾四周，心中所盼望的两个男人统统不在，周围全是乌合之众的谩骂，她笑了。正是因为这一抹笑，引来了群众的不满，由谩骂变成了毒打，使王敏佳付出自己的生命。看到这里，我首先想到的是《鬼子来了》中，姜文最后人头落地时的仰天长笑。那三声长笑，看似荒诞，但正是在嘲讽这荒诞的世界，这没有正义，只有灰色的世界。</p><p>在理想与现实的十字路口上，我们该何去何从。</p><p>影片中，张果果和老总形成了鲜明的对比，是理想与现实的对比。老总在抱怨他曾经帮助过的孩子最终却向自己要房子要工作，而张果果听了老总的劝告，经历了思想斗争之后，却选择主动为四胞胎家庭提供住所与工作。看到这里，我想到了《我不是药神》中程勇由最初为了利益卖药到最后以德报怨主动倒贴钱卖药给穷人的转变。这是一种救赎。能力越大，责任就越大。张果果身为广告公司总监，主动选择将爱传递给那些需要帮助的人，这也是一种救赎。但我们也不能全怪老总，毕竟老总曾经也想过帮助别人，只是没有坚持下去，他所得到的是社会的一次鞭挞，从此被世俗同化，做一条狼。在理想与现实的十字路口，多少人因为社会的一次次的鞭挞而选择向现实妥协，将中心转向了自我，而又有几个人会像道成肉身的耶稣那样以德报怨，选择自己被钉上十字架来替世人赎罪呢。</p><p>当我们选择负重前行时，谁来为我们护航呢。</p><p>在王敏佳环顾四周，心中充满期盼，却又孤立无援的时候，我又想到了《闻香识女人》，查理在遭到同学的冷眼旁观与学校的威逼利诱之时，在自己的前途与心中的道义选择之时，遵从内心，坚守正义与准则。但不同于查理，查理在被勒令退学，心中充满迷茫之时，有老中校的保护，而王敏佳此刻却一无所有。这让我不禁感叹，其实我们每个人都曾满怀热忱选择拥抱这世界，但当我们被这灰色社会各种折磨之时，谁来像老中校那样保护我们的坚守呢。最终大部分人都被这社会所同化，变成了自己曾经最讨厌的那种人。影片毕竟不是悲剧，所幸剧情最终安排陈鹏回到了王敏佳身边，守护王敏佳对这世界最后的一丝好感。</p><p>每个人都认为自己是对的，因此我们需要成长。</p><p>沈光耀原本是富家子弟，却选择当一名飞行员保家卫国，同时救济贫民。但刚开始时，他每次都是擅自开飞机为自己学校所在的村子送食物。他的上司罚他，同时也道出了原因，他这样做，看似义举，但每次同样的路线，只会引来敌人的追踪，最终导致村子遭到敌人的狂轰乱炸。看到这里，我不仅揪起了心。我们每个人其实刚开始时都认为自己是对的，就像王敏佳只看到了师母殴打恩师的表象，却忽略了恩师对师母的冷落，因此她将师母抹黑，遭到师母的告发。而同样因为师母的一句话，群众们又谩骂变成毒打，险些让王敏佳丧命。显然，师母当时因为嫉妒与愤怒，导致一个人前程与生命被毁。她其实也是无心之过，也是被这世界摧残的遍体鳞伤，不然也不会在最后在内疚与绝望中选择跳井自杀。有时候，我们自己的一点点微不足道的私欲或自以为是的正义可能会给其他人带来不可弥补的伤害。</p><p>成长中的负重前行，方得始终。</p><p>最终沈光耀的故事算是最完美的结局。他后来不断改变路线，给村子驱赶饥饿的同时保证了村子的安全。同时，将小义变成了大义，所到之处都有他的带来的食物。人们亲切地称他为晃晃叔叔。</p><p>当影片《奇异恩典》想起，我便明白，正值迷茫之际，此电影以救赎之道，为我曾经人生十字路口的选择保驾护航。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;对于这部电影，早有耳闻，毕竟王菲的《无问西东》与毛不易的《无问》都是我时常聆听的歌。只是不知何时起，被生活中的各种琐事困扰，渐渐地，失去了对美好世界的向往，以及静下心来欣赏好电影的热忱。正在迷茫之际，所幸遇到这部电影以及它所传达的救赎之道，又点亮了我内心所向往的那道光。&lt;/
      
    
    </summary>
    
      <category term="心路历程" scheme="http://qianyouyou.cn/categories/%E5%BF%83%E8%B7%AF%E5%8E%86%E7%A8%8B/"/>
    
      <category term="影评" scheme="http://qianyouyou.cn/categories/%E5%BF%83%E8%B7%AF%E5%8E%86%E7%A8%8B/%E5%BD%B1%E8%AF%84/"/>
    
    
  </entry>
  
  <entry>
    <title>中国没有汉尼拔</title>
    <link href="http://qianyouyou.cn/2019/12/09/2019-12-09/"/>
    <id>http://qianyouyou.cn/2019/12/09/2019-12-09/</id>
    <published>2019-12-09T12:01:10.000Z</published>
    <updated>2019-12-09T13:29:00.200Z</updated>
    
    <content type="html"><![CDATA[<p>每个人生下来便是羔羊，由牧民圈养着。牧民们为羊儿们提供丰厚的草料，但当它们的毛丰厚了便拔他们的毛，当它们的肉肥了便割他们的肉。有些羊不断提升自己的生产能力，逃出了羊圈，自力更生，从此遭到牧民以及其他羔羊的唾弃；有些羊努力进化成了野牛，起初野牛会保护羊群，但那些曾经意气风发的野牛们最终收获足够多的羔羊认同时，便会变成野牛比尔，同牧民合作，一起宰羊。而大部分的羊，为了一时安稳，看着同类的种种变化，不理不睬，久而久之便成了沉默的羔羊。</p><p>常常在耳边听到这样的说法：“如果每个人给我一毛，那我就是亿万富翁。”其实说到底，每个人都懂这一点，关键是如何让别人拔毛给你，而且是每个人。每当听到这样的话，我心中的暗自嘲讽，幸好有个如果，因为当你真的能让所有人给你一毛时，你变会想每人给你更多。</p><p>还记得《美国往事》中工人运动的领袖吉米掌权后的腐败嘴脸。那些曾经意气风发的企业家们，用各种福利拉拢用户，挽留用户，就像拼多多……然而不是所有私企都能挽留住用户，就像共享单车……最终收获足够多的用户量时，便同国企合作，让你们离不开他们，还得乖乖拔毛给他们，就像腾讯……</p><p>曾经意气风发的马云说过，他创立阿里巴巴就是让那些坐在移动、银行办公室里的人不得安宁。的确，他做到了，也成为了第一个汉尼拔。然而，伴随着的退休，谁也说不清楚什么情况。那个汉尼拔只剩传说了，每个想成为汉尼拔的人最终却变成了野牛比尔。</p><p>最近移动20周年庆典，然而却是变了花样的让用户交钱。当客服给用户打电话说庆典时，本以为是福利回馈，没想到又是变了花样的敲诈。这就是和某些私企的差别，私企通常庆典上各种福利回馈用户，国企反而再敲用户一下。</p><p>可笑的是每次私企出了问题用户各种骂，国企的话早已麻木了。就像曾经丰巢的1块钱事件。然而因1块钱声讨丰巢，却没人反映移动几十块的敲诈，这不是很讽刺吗。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;每个人生下来便是羔羊，由牧民圈养着。牧民们为羊儿们提供丰厚的草料，但当它们的毛丰厚了便拔他们的毛，当它们的肉肥了便割他们的肉。有些羊不断提升自己的生产能力，逃出了羊圈，自力更生，从此遭到牧民以及其他羔羊的唾弃；有些羊努力进化成了野牛，起初野牛会保护羊群，但那些曾经意气风发的
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>浅谈构造函数</title>
    <link href="http://qianyouyou.cn/2019/10/21/2019-10-21/"/>
    <id>http://qianyouyou.cn/2019/10/21/2019-10-21/</id>
    <published>2019-10-20T23:36:23.000Z</published>
    <updated>2019-10-20T23:57:43.089Z</updated>
    
    <content type="html"><![CDATA[<p>说道构造函数，大家可能都不陌生，但构造函数到底是什么作用呢。这个问题就好像我们大家都会用C++，但没几人敢说自己精通C++一样。我们先来看一看最简单的例子吧。</p><h2 id="question"><a href="#question" class="headerlink" title="question"></a>question</h2><p>已知类a继承类b且包含类c，求a，b，c的构造顺序。</p><h3 id="answer"><a href="#answer" class="headerlink" title="answer"></a>answer</h3><p>b &gt; c &gt; a</p><p>这个答案大家肯定知道，但为什么呢，对于该问题一般那些资深C++开发者一眼就能看出你是有自己的理解还是书本式的记忆，因此不要试图用书本式的解释。</p><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>其实构造函数也没那么神秘，就是用来初始化数据，为对象的创建做准备的。这不废话么。有了这个认识，那为什么上面是bca，而不是其他顺序呢。好像没什么必然的联系。但是，以初始化为主的构造函数，那没有数据的话怎么初始化数据呢。因此，a包含c，那么c就是a数据的一部分，没有c的话a就无法初始化。因此c &gt; a。a继承于b，子类和父类的关系根据名称也知道，子类继承了父类的数据，父类也是子类的一部分，因此b &gt; a。abc这三者的关系就好似儿子、父亲和儿子的细胞。没有父亲，就没有儿子的全部，自然也没有儿子的细胞。所以答案自然而然。</p><h2 id="初始化顺序"><a href="#初始化顺序" class="headerlink" title="初始化顺序"></a>初始化顺序</h2><p>直接初始化&gt;初始化列表&gt;构造函数</p><h2 id="RAII"><a href="#RAII" class="headerlink" title="RAII"></a>RAII</h2><p>在C++11特性中，出现了RAII的思想，就是构造中分配内存，析构中释放内存。这也是智能指针保证安全性的原因。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;说道构造函数，大家可能都不陌生，但构造函数到底是什么作用呢。这个问题就好像我们大家都会用C++，但没几人敢说自己精通C++一样。我们先来看一看最简单的例子吧。&lt;/p&gt;
&lt;h2 id=&quot;question&quot;&gt;&lt;a href=&quot;#question&quot; class=&quot;headerli
      
    
    </summary>
    
      <category term="程序人生" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
      <category term="C/C++" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/C-C/"/>
    
    
      <category term="C/C++" scheme="http://qianyouyou.cn/tags/C-C/"/>
    
      <category term="构造函数" scheme="http://qianyouyou.cn/tags/%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>FastDFS分布式文件系统总结</title>
    <link href="http://qianyouyou.cn/2019/10/03/2019-10-03/"/>
    <id>http://qianyouyou.cn/2019/10/03/2019-10-03/</id>
    <published>2019-10-03T04:36:04.000Z</published>
    <updated>2020-03-09T04:02:26.856Z</updated>
    
    <content type="html"><![CDATA[<h1 id="分布式存储"><a href="#分布式存储" class="headerlink" title="分布式存储"></a>分布式存储</h1><p>首先，什么是分布式存储，简而言之，就是将数据存储到多个存储设备（服务器）上。</p><h2 id="分布式与传统网络存储系统区别"><a href="#分布式与传统网络存储系统区别" class="headerlink" title="分布式与传统网络存储系统区别"></a>分布式与传统网络存储系统区别</h2><p>传统的网络存储系统采用集中的存储服务器存放所有数据，存储服务器成为系统性能的瓶颈，也是可靠性和安全性的焦点，不能满足大规模存储应用的需要。<img src="https://qianyouyou-1258651414.cos.ap-chengdu.myqcloud.com/img/19-10-03-%E4%BC%A0%E7%BB%9F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F.png" alt></p><p>分布式网络存储系统采用可扩展的系统结构，利用多台存储服务器分担存储负荷，利用位置服务器定位存储信息，它不但提高了系统的可靠性、可用性和存取效率，还易于扩展。</p><p><img src="https://qianyouyou-1258651414.cos.ap-chengdu.myqcloud.com/img/19-10-03-%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F.png" alt></p><h1 id="FastDFS"><a href="#FastDFS" class="headerlink" title="FastDFS"></a>FastDFS</h1><p>FastDFS是一款开源的分布式文件系统，通过纯C实现，支持Linux, FreeBSD等Unix系统类Google FS, 不是通用的文件系统，只能够通过专有API访问，目前提供了C，Java和PHP API为互联网应用量身定做，解决大容量文件存储问题，追求高性能和高扩展性 FastDFS可以看做是基于文件的key-value存储系统，称为分布式文件存储服务更为合适。</p><p>功能包括：文件存储、文件同步、文件访问（文件上传、文件下载、文件删除）等，解决了大容量存储和负载均衡的问题。</p><ul><li><p>为互联网量身定制，充分考虑了冗余备份、负载均衡、线性扩容等机制，并注重高可用、高性能等指标</p></li><li><p>可以很容易搭建一套高性能的文件服务器集群提供文件上传、下载等服务。</p><ul><li>图片服务器</li><li>图床</li></ul></li></ul><ol><li><p>fastDFS特点:</p></li><li><ul><li>应用层级的文件系统</li><li>不能挂载和卸载，也就是不能进行mount操作</li></ul></li><li><p>fastDFS框架中的三个角色</p></li><li><ul><li>追踪器 - tracker</li><li>存储节点 - storage</li></ul></li><li><ul><li>客户端 - client</li></ul></li><li><p>fastDFS三个角色之间的关系</p></li><li><ul><li><p>Client和Storage主动连接Tracker。</p></li><li><p>Storage主动向Tracker报告其状态信息</p><ul><li>磁盘剩余空间</li><li>文件同步状况</li><li>文件上传下载次数</li></ul></li><li><p>Storage会启动一个单独的线程来完成对一台Tracker的连接和定时报告。</p></li><li><p>一个组包含的Storage不是通过配置文件设定的，而是通过Tracker获取到的。</p></li></ul></li></ol><h2 id="FastDFS集群"><a href="#FastDFS集群" class="headerlink" title="FastDFS集群"></a>FastDFS集群</h2><p><img src="https://qianyouyou-1258651414.cos.ap-chengdu.myqcloud.com/img/19-10-03-Fast%E9%9B%86%E7%BE%A4.png" alt></p><ol><li><p>Tracker集群</p></li><li><ul><li>Tracker server之间是相互平等关系同时提供服务</li><li>Tracker server不存在单点故障。</li><li>客户端请求Tracker       server采用轮询方式，如果请求的tracker无法提供服务则换另一个tracker。</li></ul></li><li><p>Storage集群</p></li><li><ul><li>Storage集群采用了分组存储方式, 由一个或多个组构成</li><li>集群存储总容量为集群中所有组的存储容量之和</li><li>一个组由一台或多台存储服务器组成，组内的Storage       server之间是平等关系</li><li>不同组的Storage       server之间不会相互通信，同组内的Storage server之间会相互连接进行文件同步，从而保证同组内每个storage上的文件完全一致的。</li><li>一个组的存储容量为该组内存储服务器容量最小的那个</li></ul></li><li><p>FastDFS的扩容分纵向扩容与横向扩容</p></li><li><ul><li>横向 扩容<ul><li>增加容量</li><li>添加group组</li></ul></li><li><p>纵向扩容</p><ul><li>数据备份</li><li><p>当前组的最大容量  </p><ul><li>存储节点中容量最小的那个</li></ul></li><li><p>所有存储节点组名必须一样</p></li></ul></li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;分布式存储&quot;&gt;&lt;a href=&quot;#分布式存储&quot; class=&quot;headerlink&quot; title=&quot;分布式存储&quot;&gt;&lt;/a&gt;分布式存储&lt;/h1&gt;&lt;p&gt;首先，什么是分布式存储，简而言之，就是将数据存储到多个存储设备（服务器）上。&lt;/p&gt;
&lt;h2 id=&quot;分布式与传统网
      
    
    </summary>
    
      <category term="程序人生" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
      <category term="Linux" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/Linux/"/>
    
    
      <category term="操作系统" scheme="http://qianyouyou.cn/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
      <category term="Linux" scheme="http://qianyouyou.cn/tags/Linux/"/>
    
      <category term="大数据" scheme="http://qianyouyou.cn/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="分布式" scheme="http://qianyouyou.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
      <category term="FastDFS" scheme="http://qianyouyou.cn/tags/FastDFS/"/>
    
  </entry>
  
  <entry>
    <title>原创位运算版算法解决24点问题</title>
    <link href="http://qianyouyou.cn/2019/09/26/2019-09-26/"/>
    <id>http://qianyouyou.cn/2019/09/26/2019-09-26/</id>
    <published>2019-09-26T02:21:49.000Z</published>
    <updated>2019-09-26T02:43:18.706Z</updated>
    
    <content type="html"><![CDATA[<p>首先说一下什么是24点吧。随机4个数，这四个数能否通过加减乘除得到24。比如1,2,3,3，就可以通过2 <em> 3 </em> (3 + 1) = 24。再比如3,8,8,3，就可以通过8 / (3 - 3 / 8)得到。而1,1,1,1永远无法得到24点。我们如今需要判断当前4个数能否得到24点（当然求具体步骤也可以的，只需要代码中稍微加点东西）</p><p>我的方法是采用位运算，也就是二进制表示状态，0001表示第1个数，0010表示第2个数，0100表示第3个数，1000表示第4个数，0011表示第1个数和第2个数间所有的操作，同理1111就表示4个数之间所有的操作，1111可以有1100与0011进行加减乘除操作得到，也可以通过1011和0100得到……我们最后只需看1111里面是否有24即可（保存步骤的话需要自定义结构体，既添加字符状态）。</p><p>我们用set容器来存储当前状态下的所有结果（去重），那么set[1]即0001就是保存第一个数，set[2]即0010就是保存第二个数，set[3]即0011就是保存第一个数和第二个数的所有结果……某set可由其他两set的数据得出（例如0011可由0010和0001得到），则每次依次遍历其他两个set中所有元素再将新的结果插入到当前set中，这样从1遍历到15即可。</p><p>通过列真值表，00=0,01=0,10=1,11=0，我们可以得到a与!b即可得到想要的结果c，例如1011与!0010得到1001，当然c必须保证c不等于a且c不为0。而为了剪枝，我们也可以让c小于b。因此可以添加以下条件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int k = (i &amp; (~j));</span><br><span class="line">if(k != 0 &amp;&amp; k != i &amp;&amp; k &lt; j)</span><br></pre></td></tr></table></figure><p>两个数之间加减乘除共有6种结果，a+b,a-b,b-a,a * b, a / b, b / a，因此我们将相应结果存入set（集合为了去重，如果需要详细步骤则可用其他容器，不必用set，因为步骤需要保存状态）。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">for(it = m_set[j].begin(); it != m_set[j].end(); it++)&#123;</span><br><span class="line">    for(it2 = m_set[k].begin(); it2 != m_set[k].end(); it2++)&#123;</span><br><span class="line">        m_set[i].insert((*it) + (*it2));</span><br><span class="line">        m_set[i].insert((*it) * (*it2));</span><br><span class="line">        m_set[i].insert((*it) - (*it2));</span><br><span class="line">        m_set[i].insert((*it2) - (*it));</span><br><span class="line">        if((*it2) != 0) m_set[i].insert((*it) / (*it2));</span><br><span class="line">        if((*it) != 0) m_set[i].insert((*it2) / (*it));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样我们就可以通过4层循环（因为只有4个数嘛，n范围也就是4）完成24点的判断了。以下是详细代码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;bits/stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">set&lt;double&gt;m_set[1 &lt;&lt; 4];</span><br><span class="line">const double ens = 1e-10;</span><br><span class="line">double a[4];</span><br><span class="line">int main()&#123;</span><br><span class="line">    while(cin &gt;&gt; a[0] &gt;&gt; a[1] &gt;&gt; a[2] &gt;&gt; a[3])&#123;</span><br><span class="line">        for(int i = 0; i &lt; 16; ++i)&#123;</span><br><span class="line">            m_set[i].clear();</span><br><span class="line">        &#125;</span><br><span class="line">        for(int i = 0; i &lt; 4; ++i)&#123;</span><br><span class="line">            m_set[1 &lt;&lt; i].insert(a[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        for(int i = 1; i &lt; 16; ++i)&#123;</span><br><span class="line">            for(int j = 1; j &lt; i; ++j)&#123;</span><br><span class="line">                int k = (i &amp; (~j));</span><br><span class="line">                if(k != 0 &amp;&amp; k != i &amp;&amp; k &lt; j)&#123;</span><br><span class="line">                    //cout &lt;&lt; k &lt;&lt; &quot;&amp;~&quot; &lt;&lt; j &lt;&lt; &quot;=&quot; &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">                    set&lt;double&gt;::iterator it, it2;</span><br><span class="line">                    for(it = m_set[j].begin(); it != m_set[j].end(); it++)&#123;</span><br><span class="line">                        for(it2 = m_set[k].begin(); it2 != m_set[k].end(); it2++)&#123;</span><br><span class="line">                            m_set[i].insert((*it) + (*it2));</span><br><span class="line">                            m_set[i].insert((*it) * (*it2));</span><br><span class="line">                            m_set[i].insert((*it) - (*it2));</span><br><span class="line">                            m_set[i].insert((*it2) - (*it));</span><br><span class="line">                            if((*it2) != 0) m_set[i].insert((*it) / (*it2));</span><br><span class="line">                            if((*it) != 0) m_set[i].insert((*it2) / (*it));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        set&lt;double&gt;::iterator it;</span><br><span class="line">        for(it = m_set[15].begin(); it != m_set[15].end(); it++)&#123;</span><br><span class="line">            if(fabs(*it - 24) &lt; ens)&#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(it != m_set[15].end())&#123;</span><br><span class="line">            cout &lt;&lt; &quot;yes&quot; &lt;&lt; endl;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            cout &lt;&lt; &quot;no&quot; &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>另附原始递归代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;bits/stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">const double ins = 0.0000001;</span><br><span class="line">double val[4];</span><br><span class="line">bool dfs(int cur, double res)&#123;</span><br><span class="line">  double ans = res;</span><br><span class="line">  if(fabs(ans - 24) &lt; ins &amp;&amp; cur == 4)&#123;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;else if (cur &gt;= 4)&#123;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line">  if(dfs(cur + 1, ans + val[cur])</span><br><span class="line">     || dfs(cur + 1, ans - val[cur])</span><br><span class="line">     || dfs(cur + 1, -ans + val[cur])</span><br><span class="line">     || (cur &gt; 0 &amp;&amp; dfs(cur + 1, ans * val[cur]))</span><br><span class="line">     || dfs(cur + 1, cur &gt; 0 ? ans / val[cur] : 1 / val[cur])</span><br><span class="line">     || (ans != 0 &amp;&amp; dfs(cur + 1, val[cur] / ans))</span><br><span class="line">    )&#123;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line">  return false;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    double v[4];</span><br><span class="line">    for(int i = 0; i &lt; 4; ++i)&#123;</span><br><span class="line">    cin &gt;&gt; v[i];</span><br><span class="line">    &#125;</span><br><span class="line">    bool flag = false;</span><br><span class="line">    for(int i = 0; i &lt; 4; ++i)&#123;</span><br><span class="line">        for(int j = 0; j &lt; 4; ++j)&#123;</span><br><span class="line">            if(j == i)&#123;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">            for(int k = 0; k &lt; 4; ++k)&#123;</span><br><span class="line">                if(k == i || k == j)&#123;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">                val[0] = v[i];</span><br><span class="line">                val[1] = v[j];</span><br><span class="line">                val[2] = v[k];</span><br><span class="line">                val[3] = v[6 - i - j - k];</span><br><span class="line">                flag = dfs(0, 0);</span><br><span class="line">                if(flag)&#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if(flag)&#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(flag)&#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(flag)&#123;</span><br><span class="line">        cout &lt;&lt; &quot;Yes&quot; &lt;&lt; endl;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        cout &lt;&lt; &quot;No&quot; &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;首先说一下什么是24点吧。随机4个数，这四个数能否通过加减乘除得到24。比如1,2,3,3，就可以通过2 &lt;em&gt; 3 &lt;/em&gt; (3 + 1) = 24。再比如3,8,8,3，就可以通过8 / (3 - 3 / 8)得到。而1,1,1,1永远无法得到24点。我们如今需要
      
    
    </summary>
    
      <category term="程序人生" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
      <category term="算法" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="算法" scheme="http://qianyouyou.cn/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="位运算" scheme="http://qianyouyou.cn/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"/>
    
  </entry>
  
  <entry>
    <title>在任务跳转问题上，C#的委托delegate与工厂方法模式的异曲同工之妙</title>
    <link href="http://qianyouyou.cn/2019/08/28/2019-08-28/"/>
    <id>http://qianyouyou.cn/2019/08/28/2019-08-28/</id>
    <published>2019-08-28T12:56:41.000Z</published>
    <updated>2019-09-07T05:27:59.563Z</updated>
    
    <content type="html"><![CDATA[<p>在玩游戏时，常常会有任务跳转。但当跳转类型过多时，对游戏研发者来说，就是一件头疼的事了。之前在做游戏城镇等级模块时，就遇到了任务跳转过多的问题。刚接到任务跳转这个需求时，由于入门未深，便用if-else写的。可以想象一百多行的if-else或者switch是多么壮观啊。。。</p><p>但是当我们只为了完成当日任务，而不为长远维护考虑，那未来将是一件可怕的事情。而且那样的代码，像我这样的人看着也不舒服。</p><p>最近看了C#高级语法，赫然发现C#中的委托不就是C++中的函数指针嘛。于是，对于上述if-else，便有解了。</p><p>我们只需要写一个委托，对应创建一个数组对象，每个跳转类型封装一个方法，再用委托来回调，这样的代码，主方法里只需1行就搞定。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using UnityEngine.UI;</span><br><span class="line"></span><br><span class="line">public class UICityRichLevelItem : ScreenBaseHandler</span><br><span class="line">&#123;</span><br><span class="line">    //public RawImage imgIcon;</span><br><span class="line">    public Text textProgress;</span><br><span class="line">    public Text textDegreeOfCompletion;</span><br><span class="line">    public Slider slideProgress;</span><br><span class="line">    public GameObject imgBg;</span><br><span class="line">    public GameObject imgCompleteFinish;</span><br><span class="line">    public GameObject imgCompleteGoto;</span><br><span class="line">    public UI_Event btnGoto;</span><br><span class="line">    public GameObject imgCompleteDelivery;</span><br><span class="line">    public UI_Event btnDelivery;</span><br><span class="line">    private int typeId;</span><br><span class="line">    private int taskId;</span><br><span class="line">    private bool isDelivery;</span><br><span class="line"></span><br><span class="line">    private string TaskDescription;</span><br><span class="line">    private int allNum;</span><br><span class="line">    private int submitId;   //需要提交的id</span><br><span class="line">    private const int NumOfTaskTypes = 9;   //任务种类数量</span><br><span class="line">    private const int DeliveryOfGoodsTaskId = 9;    //提交货物类型id</span><br><span class="line"></span><br><span class="line">    private delegate void JumpTask();</span><br><span class="line">    JumpTask [] jumpTask = new JumpTask[NumOfTaskTypes];</span><br><span class="line"></span><br><span class="line">    public override void Init()</span><br><span class="line">    &#123;</span><br><span class="line">        isDelivery = false;</span><br><span class="line">        allNum = 0;</span><br><span class="line">        submitId = 0;</span><br><span class="line">        btnGoto.onClick = (eventData, ev) =&gt; BtnGotoOnClick();</span><br><span class="line">        btnDelivery.onClick = (eventData, ev) =&gt; BtnDeliveryOnClick();</span><br><span class="line"></span><br><span class="line">        jumpTask[0] = new JumpTask(JumpTaskType_0);</span><br><span class="line">        jumpTask[1] = new JumpTask(JumpTaskType_1);</span><br><span class="line">        jumpTask[2] = new JumpTask(JumpTaskType_2);</span><br><span class="line">        jumpTask[3] = new JumpTask(JumpTaskType_3);</span><br><span class="line">        jumpTask[4] = new JumpTask(JumpTaskType_4);</span><br><span class="line">        jumpTask[5] = new JumpTask(JumpTaskType_5);</span><br><span class="line">        jumpTask[6] = new JumpTask(JumpTaskType_6);</span><br><span class="line">        jumpTask[7] = new JumpTask(JumpTaskType_7);</span><br><span class="line">        jumpTask[8] = new JumpTask(JumpTaskType_8);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void SetItem (TableCityRichEvent.Data next)</span><br><span class="line">    &#123;</span><br><span class="line">        taskId = next.mId;</span><br><span class="line">        typeId = next.mFunctionType;</span><br><span class="line">        if (next.mFunctionParameter.Count == 1)</span><br><span class="line">        &#123;</span><br><span class="line">            allNum = next.mFunctionParameter[0];</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            submitId = next.mFunctionParameter[0];</span><br><span class="line">            allNum = next.mFunctionParameter[1];</span><br><span class="line">        &#125;</span><br><span class="line">        TaskDescription = next.mEventsDes;</span><br><span class="line">        textDegreeOfCompletion.text = &quot;0/&quot; + allNum;</span><br><span class="line">        textProgress.text = JointStr(TaskDescription, textDegreeOfCompletion.text);</span><br><span class="line">        slideProgress.maxValue = allNum;</span><br><span class="line">        slideProgress.value = 0;</span><br><span class="line">        if (isDeliveryOfGoodsTask())</span><br><span class="line">        &#123;</span><br><span class="line">            int num = StorageManager.instance.GetAllCommodityUnlockNumById(submitId);</span><br><span class="line">            textDegreeOfCompletion.text = num + &quot;/&quot; + allNum;</span><br><span class="line">            textProgress.text = JointStr(TaskDescription, textDegreeOfCompletion.text);</span><br><span class="line">            slideProgress.value = num &gt; allNum ? allNum : num;</span><br><span class="line">        &#125;</span><br><span class="line">        isCompleted(allNum, (int)slideProgress.value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int GetTypeItem()</span><br><span class="line">    &#123;</span><br><span class="line">        return typeId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public bool HasChecked()</span><br><span class="line">    &#123;</span><br><span class="line">        return isDelivery;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public bool SetCurNum (int curNum)</span><br><span class="line">    &#123;</span><br><span class="line">        if (!isDeliveryOfGoodsTask())</span><br><span class="line">        &#123;</span><br><span class="line">            slideProgress.value = curNum;</span><br><span class="line">            textDegreeOfCompletion.text = curNum + &quot;/&quot; + allNum;</span><br><span class="line">            textProgress.text = JointStr(TaskDescription, textDegreeOfCompletion.text);</span><br><span class="line">        &#125;</span><br><span class="line">        if (curNum &gt;= allNum)</span><br><span class="line">        &#123;</span><br><span class="line">            isDelivery = true;</span><br><span class="line">            slideProgress.value = curNum;</span><br><span class="line">        &#125;</span><br><span class="line">        isCompleted(allNum, curNum);</span><br><span class="line">        return curNum &gt;= allNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private string JointStr(string str1, string str2)</span><br><span class="line">    &#123;</span><br><span class="line">        return str1 + &quot;  &quot; + str2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void isCompleted(int maxx, int cur)</span><br><span class="line">    &#123;</span><br><span class="line">        if (isDeliveryOfGoodsTask())</span><br><span class="line">        &#123;</span><br><span class="line">            imgCompleteDelivery.SetActive(!isDelivery);</span><br><span class="line">            imgCompleteGoto.SetActive(false);</span><br><span class="line">            imgCompleteFinish.SetActive(isDelivery);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            imgCompleteDelivery.SetActive(false);</span><br><span class="line">            imgCompleteGoto.SetActive(maxx &gt; cur);</span><br><span class="line">            imgCompleteFinish.SetActive(maxx &lt;= cur);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public bool isDeliveryOfGoodsTask()</span><br><span class="line">    &#123;</span><br><span class="line">        return TaskHash(typeId) == DeliveryOfGoodsTaskId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void BtnGotoOnClick()</span><br><span class="line">    &#123;</span><br><span class="line">        jumpTask[TaskHash(typeId)]();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void SetBg(bool flag)</span><br><span class="line">    &#123;</span><br><span class="line">        imgBg.SetActive(flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void BtnDeliveryOnClick()</span><br><span class="line">    &#123;</span><br><span class="line">        int num = StorageManager.instance.GetAllCommodityUnlockNumById(submitId);</span><br><span class="line">        if (isDelivery == false &amp;&amp; num &gt;= allNum)</span><br><span class="line">        &#123;</span><br><span class="line">            TCPNetworkAttribute.Instance.ReqRichlevelSubmit(taskId);</span><br><span class="line">            UIPlayerInfo item = MenuManager.instance.FindMenu&lt;UIPlayerInfo&gt;();</span><br><span class="line">            item.Init();</span><br><span class="line">            //isDelivery = true;</span><br><span class="line">            //SetCurNum(allNum);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private int TaskHash(int id)</span><br><span class="line">    &#123;</span><br><span class="line">        return id / 1000;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void JumpTaskType_0()        //默认</span><br><span class="line">    &#123;</span><br><span class="line">        UIPlayerInfo item = MenuManager.instance.FindMenu&lt;UIPlayerInfo&gt;();</span><br><span class="line">        item.Init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void JumpTaskType_1()        //出航</span><br><span class="line">    &#123;</span><br><span class="line">        if (TaskHash(typeId) == 1)</span><br><span class="line">        &#123;</span><br><span class="line">            int[] types = &#123;</span><br><span class="line">                (int)IntentionType.Fishing,</span><br><span class="line">                (int)IntentionType.Fishing,</span><br><span class="line">                (int)IntentionType.Merchant,</span><br><span class="line">                (int)IntentionType.Explore</span><br><span class="line">            &#125;;   //捕鱼，战峙，贸易，探索</span><br><span class="line">            UISetOut_MainPage.intentionType = (IntentionType)types[typeId % 1000 - 1];</span><br><span class="line">        &#125;</span><br><span class="line">        UISetOut_MainPage config = MenuManager.instance.CreateMenu&lt;UISetOut_MainPage&gt;();</span><br><span class="line">        config.OpenScreen();</span><br><span class="line">        UIPlayerInfo item = MenuManager.instance.FindMenu&lt;UIPlayerInfo&gt;();</span><br><span class="line">        item.CloseScreen();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void JumpTaskType_2()        //建造</span><br><span class="line">    &#123;</span><br><span class="line">        UIBuildingHandle config = MenuManager.instance.CreateMenu&lt;UIBuildingHandle&gt;();</span><br><span class="line">        config.OpenScreen();</span><br><span class="line">        UIPlayerInfo item = MenuManager.instance.FindMenu&lt;UIPlayerInfo&gt;();</span><br><span class="line">        item.CloseScreen();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void JumpTaskType_3()        //更路簿</span><br><span class="line">    &#123;</span><br><span class="line">        UILinkDistrict config = MenuManager.instance.CreateMenu&lt;UILinkDistrict&gt;();</span><br><span class="line">        config.OpenScreen();</span><br><span class="line">        UIPlayerInfo item = MenuManager.instance.FindMenu&lt;UIPlayerInfo&gt;();</span><br><span class="line">        item.CloseScreen();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void JumpTaskType_4()        //易市</span><br><span class="line">    &#123;</span><br><span class="line">        UIMarketHandle config = MenuManager.instance.CreateMenu&lt;UIMarketHandle&gt;();</span><br><span class="line">        config.OpenScreen();</span><br><span class="line">        UIPlayerInfo item = MenuManager.instance.FindMenu&lt;UIPlayerInfo&gt;();</span><br><span class="line">        item.CloseScreen();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void JumpTaskType_5()        //区域解锁</span><br><span class="line">    &#123;</span><br><span class="line">        UIUnLockZoneHandle handle = MenuManager.instance.CreateMenu&lt;UIUnLockZoneHandle&gt;();</span><br><span class="line">        TableLockZone.Data mTableData = null;</span><br><span class="line">        List&lt;TableLockZone.Data&gt; lst_zone_table = TableManager.instance.GetLockZoneAll();</span><br><span class="line">        int i = 0;</span><br><span class="line">        for (; i &lt; lst_zone_table.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            mTableData = lst_zone_table[i];</span><br><span class="line">            int id = mTableData.mId;</span><br><span class="line">            if (LockZoneManager.instance.IsReadyZoneUnlock(id))</span><br><span class="line">            &#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (i &lt; lst_zone_table.Count &amp;&amp; mTableData != null)</span><br><span class="line">        &#123;</span><br><span class="line">            handle.SetZone(mTableData);</span><br><span class="line">            handle.OpenScreen();</span><br><span class="line">        &#125;</span><br><span class="line">        UIPlayerInfo item = MenuManager.instance.FindMenu&lt;UIPlayerInfo&gt;();</span><br><span class="line">        item.CloseScreen();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void JumpTaskType_6()        //船坞</span><br><span class="line">    &#123;</span><br><span class="line">        UIShipHouseHandle config = MenuManager.instance.CreateMenu&lt;UIShipHouseHandle&gt;();</span><br><span class="line">        //config.gameObject.transform.Find(&quot;Canvas&quot;).GetComponent&lt;Canvas&gt;().sortingOrder = 3;</span><br><span class="line">        config.OpenScreen();</span><br><span class="line">        UIPlayerInfo item = MenuManager.instance.FindMenu&lt;UIPlayerInfo&gt;();</span><br><span class="line">        item.CloseScreen();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void JumpTaskType_7()        //广场</span><br><span class="line">    &#123;</span><br><span class="line">        UIPiazzaHandle config = MenuManager.instance.CreateMenu&lt;UIPiazzaHandle&gt;();</span><br><span class="line">        BuildingControl control = BuildingManager.instance.GetBuildingControlByTableId(12);</span><br><span class="line">        config.InitFactory(control);</span><br><span class="line">        config.OpenScreen();</span><br><span class="line">        UIPlayerInfo item = MenuManager.instance.FindMenu&lt;UIPlayerInfo&gt;();</span><br><span class="line">        item.CloseScreen();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void JumpTaskType_8()        //人物等级</span><br><span class="line">    &#123;</span><br><span class="line">        UIPlayerInfo item = MenuManager.instance.FindMenu&lt;UIPlayerInfo&gt;();</span><br><span class="line">        item.Init();</span><br><span class="line">        item.OpenScreen(0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有没有发现，和设计模式中的工厂方法模式有异曲同工之妙呢。日后维护起来也方便许多。</p><p>接下来我们详细介绍下C#中的委托吧。</p><h1 id="C-委托（Delegate）"><a href="#C-委托（Delegate）" class="headerlink" title="C# 委托（Delegate）"></a>C# 委托（Delegate）</h1><p>C# 中的委托（Delegate）类似于 C 或 C++ 中函数的指针。<strong>委托（Delegate）</strong> 是存有对某个方法的引用的一种引用类型变量。引用可在运行时被改变。</p><p>委托（Delegate）特别用于实现事件和回调方法。所有的委托（Delegate）都派生自 <strong>System.Delegate</strong> 类。</p><h2 id="声明委托（Delegate）"><a href="#声明委托（Delegate）" class="headerlink" title="声明委托（Delegate）"></a>声明委托（Delegate）</h2><p>委托声明决定了可由该委托引用的方法。委托可指向一个与其具有相同标签的方法。</p><p>例如，假设有一个委托：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public delegate int MyDelegate (string s);</span><br></pre></td></tr></table></figure><p>上面的委托可被用于引用任何一个带有一个单一的 <em>string</em> 参数的方法，并返回一个 <em>int</em> 类型变量。</p><p>声明委托的语法如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delegate &lt;return type&gt; &lt;delegate-name&gt; &lt;parameter list&gt;</span><br></pre></td></tr></table></figure><h2 id="实例化委托（Delegate）"><a href="#实例化委托（Delegate）" class="headerlink" title="实例化委托（Delegate）"></a>实例化委托（Delegate）</h2><p>一旦声明了委托类型，委托对象必须使用 <strong>new</strong> 关键字来创建，且与一个特定的方法有关。当创建委托时，传递到 <strong>new</strong> 语句的参数就像方法调用一样书写，但是不带有参数。例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public delegate void printString(string s);</span><br><span class="line">...</span><br><span class="line">printString ps1 = new printString(WriteToScreen);</span><br><span class="line">printString ps2 = new printString(WriteToFile);</span><br></pre></td></tr></table></figure><p>下面的实例演示了委托的声明、实例化和使用，该委托可用于引用带有一个整型参数的方法，并返回一个整型值。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">delegate int NumberChanger(int n);</span><br><span class="line">namespace DelegateAppl&#123;</span><br><span class="line">   class TestDelegate</span><br><span class="line">   &#123;  </span><br><span class="line">   static int num = 10;  </span><br><span class="line">   public static int AddNum(int p)  &#123; </span><br><span class="line">   num += p; return num;</span><br><span class="line">   &#125;</span><br><span class="line">   public static int MultNum(int q)  &#123;</span><br><span class="line">   num *= q; return num;</span><br><span class="line">   &#125;</span><br><span class="line">   public static int getNum()  &#123;</span><br><span class="line">   return num;</span><br><span class="line">   &#125;</span><br><span class="line">   static void Main(string[] args)  &#123; // 创建委托实例</span><br><span class="line">   NumberChanger nc1 = new NumberChanger(AddNum);</span><br><span class="line">   NumberChanger nc2 = new NumberChanger(MultNum); // 使用委托对象调用方法</span><br><span class="line">   nc1(25);</span><br><span class="line">   Console.WriteLine(&quot;Value of Num: &#123;0&#125;&quot;, getNum());</span><br><span class="line">   nc2(5);</span><br><span class="line">   Console.WriteLine(&quot;Value of Num: &#123;0&#125;&quot;, getNum()); Console.ReadKey();</span><br><span class="line">   &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当上面的代码被编译和执行时，它会产生下列结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Value of Num: 35</span><br><span class="line">Value of Num: 175</span><br></pre></td></tr></table></figure><h2 id="委托的多播（Multicasting-of-a-Delegate）"><a href="#委托的多播（Multicasting-of-a-Delegate）" class="headerlink" title="委托的多播（Multicasting of a Delegate）"></a>委托的多播（Multicasting of a Delegate）</h2><p>委托对象可使用 “+” 运算符进行合并。一个合并委托调用它所合并的两个委托。只有相同类型的委托可被合并。”-“ 运算符可用于从合并的委托中移除组件委托。</p><p>使用委托的这个有用的特点，您可以创建一个委托被调用时要调用的方法的调用列表。这被称为委托的 <strong>多播（multicasting）</strong>，也叫组播。下面的程序演示了委托的多播：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">delegate int NumberChanger(int n); namespace DelegateAppl</span><br><span class="line">&#123;</span><br><span class="line">    class TestDelegate</span><br><span class="line">    &#123;</span><br><span class="line">        static int num = 10; public static int AddNum(int p) &#123; num += p; return num; &#125;</span><br><span class="line">        public static int MultNum(int q) &#123; num *= q; return num; &#125;</span><br><span class="line">        public static int getNum() &#123; return num; &#125;</span><br><span class="line">        static void Main(string[] args)</span><br><span class="line">        &#123; // 创建委托实例</span><br><span class="line">            NumberChanger nc;</span><br><span class="line">            NumberChanger nc1 = new NumberChanger(AddNum);</span><br><span class="line">            NumberChanger nc2 = new NumberChanger(MultNum);</span><br><span class="line">            nc = nc1; nc += nc2; // 调用多播</span><br><span class="line">            nc(5);</span><br><span class="line">            Console.WriteLine(&quot;Value of Num: &#123;0&#125;&quot;, getNum());</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当上面的代码被编译和执行时，它会产生下列结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Value of Num: 75</span><br></pre></td></tr></table></figure><h2 id="委托（Delegate）的用途"><a href="#委托（Delegate）的用途" class="headerlink" title="委托（Delegate）的用途"></a>委托（Delegate）的用途</h2><p>下面的实例演示了委托的用法。委托 <em>printString</em> 可用于引用带有一个字符串作为输入的方法，并不返回任何东西。</p><p>我们使用这个委托来调用两个方法，第一个把字符串打印到控制台，第二个把字符串打印到文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.IO;</span><br><span class="line">namespace DelegateAppl</span><br><span class="line">&#123;</span><br><span class="line">    class PrintString</span><br><span class="line">    &#123;</span><br><span class="line">        static FileStream fs; static StreamWriter sw;  // 委托声明</span><br><span class="line">        public delegate void printString(string s);  // 该方法打印到控制台</span><br><span class="line">        public static void WriteToScreen(string str) &#123;</span><br><span class="line">            Console.WriteLine(&quot;The String is: &#123;0&#125;&quot;, str);</span><br><span class="line">        &#125;  // 该方法打印到文件</span><br><span class="line">        public static void WriteToFile(string s)  &#123;</span><br><span class="line">            fs = new FileStream(&quot;c:\\message.txt&quot;, FileMode.Append, FileAccess.Write);</span><br><span class="line">            sw = new StreamWriter(fs); sw.WriteLine(s); sw.Flush(); sw.Close(); fs.Close();</span><br><span class="line">        &#125;  // 该方法把委托作为参数，并使用它调用方法</span><br><span class="line">        public static void sendString(printString ps)  &#123;</span><br><span class="line">            ps(&quot;Hello World&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        static void Main(string[] args)  &#123;</span><br><span class="line">            printString ps1 = new printString(WriteToScreen);</span><br><span class="line">            printString ps2 = new printString(WriteToFile);</span><br><span class="line">            sendString(ps1); sendString(ps2);</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当上面的代码被编译和执行时，它会产生下列结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The String is: Hello World</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在玩游戏时，常常会有任务跳转。但当跳转类型过多时，对游戏研发者来说，就是一件头疼的事了。之前在做游戏城镇等级模块时，就遇到了任务跳转过多的问题。刚接到任务跳转这个需求时，由于入门未深，便用if-else写的。可以想象一百多行的if-else或者switch是多么壮观啊。。。
      
    
    </summary>
    
      <category term="程序人生" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
      <category term="C#" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/C/"/>
    
    
      <category term="Unity3D" scheme="http://qianyouyou.cn/tags/Unity3D/"/>
    
      <category term="Unity" scheme="http://qianyouyou.cn/tags/Unity/"/>
    
      <category term="C#" scheme="http://qianyouyou.cn/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>宽敞的心态，宽敞的世界</title>
    <link href="http://qianyouyou.cn/2019/07/28/2019-07-28/"/>
    <id>http://qianyouyou.cn/2019/07/28/2019-07-28/</id>
    <published>2019-07-28T06:00:49.000Z</published>
    <updated>2019-08-28T12:56:10.925Z</updated>
    
    <content type="html"><![CDATA[<p>忽然发现，来上海也有一段时间了。</p><p>还记得没来上海时，身边回荡着各种声音，上了年纪的长辈们鼓励我年轻人就应该出去闯一闯；父母则是抱着忧虑的念头，总说大城市生活压力大，骗子多，无时无刻都得防备；朋友们相对而言更担心的是我一个人出远门的安全。那时候，心中荡漾的，不清楚是期待，还是恐惧。</p><p>初来上海时，东奔西跑的找房租房，生活上高昂的消费让自己不得不开始学会记录支出，还有工作上初来乍到的各种不适应，总弄得自己身心疲惫；那时候，为最后一个挤上公交地铁而庆幸，为了早起而不得不早睡的无奈。心中徘徊的，应该是厌倦，还有抱怨吧。</p><p>现在呢，发现人们口中的大城市，并没有像人们所描述的那么繁华，也没有人们所描述的那样让人苦不堪言。渐渐地，我发现自己爱上了这里。</p><p>其实啊，上海没变，世界也没变，只有我们的心态变了。</p><p>就像人们议论程序员这个行业，一提到程序员，最多的话题就是996，也就是朝九晚九，每周6天。听到这词，即使没有工作，也难免会让人感觉疲惫。但是，真的如此吗。就像我，工作一段时间，感觉每天都很充实。每周有两天双休，但每次到了双休，玩一天游戏，或者什么也不干，剩下的只有空虚，所以周末能加班就加班，因为加班使自己感到生活的充实与价值。</p><p>还记得刚来学校时，因为热爱编程，而报了计算机专业。那时候，没日没夜敲代码是我的快乐。快找实习时，也是没日没夜敲代码，只是感觉到的是苦涩。而工作一段时间后，当我又开始忙碌地敲代码时，感觉到的是充实。同样是敲代码，在学校时因为热爱，在找实习时因为迷茫和环境的影响而决定苦涩，现在，是找到了方向。所以，所谓的忙碌，只不过是旁观者的看法。当一个人真正热爱自己的工作时，别人不要求你加班，你也想自己去加班。</p><p>人们都说上海节奏快，但我坚信时代造英雄。</p><p>昨天父亲又给我打了个电话，尽管只是平常地问候，但我却草草结束了话题。我后来发现，渐渐地，我越来越不怎么和父亲说话了。因为每次父亲跟我洽谈，总是告诫我一些关于社会让人多么的无奈，或者大城市节奏太快压力太大，亦或是社会上到处都是坏人，即使同一屋檐下也要上一把锁。这并不是我父亲一个人的想法，而是我们那个小城镇普遍的想法。</p><p>受我父亲的影响，刚上大学时，因为父亲说西安是贼城，当时我坐个公交都得把包背到前面。但久而久之，我发现并不是所有人都是坏人，那些不美好只不过是世界的冰山一角，但更多地是世界的美好，许多人身上都是有光的。只是这冰山一角给人的心理带来了防备，但当我们以这冰山一角来定义世界时，将必定错过整个世界。</p><p>2G时代，将互联网带上中国，成就了搜狐、新浪、网易。3G时代，将互联网带到了生活，成就了百度、阿里、腾讯，号称BAT。4G时代，将互联网带到了人们随身携带的手机，成就了头条、美团、滴滴，号称TMD。如今5G时代的到来，一切皆有可能，如果还停留在旧时代的舒适圈，不肯加快脚步，那么城乡差距就会越来越大。</p><p>放宽心态，多看看世界好的一面，那么哪来那么多烦恼呢。</p><p>如今，我每周周末都会去公寓周围的大超市去逛逛，有时候什么也不买，仅仅是因为里面的音乐让自己舒心。感受了一周的充实，偶尔给自己放个小假，你会发现，生活并不单调。</p><p>追随时代的大步伐，难免会疲惫。偶尔停下脚步，慢下来，感受自己心中所聆听到的声音，你会发现，快节奏的生活，也会有慢下来的情调。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;忽然发现，来上海也有一段时间了。&lt;/p&gt;
&lt;p&gt;还记得没来上海时，身边回荡着各种声音，上了年纪的长辈们鼓励我年轻人就应该出去闯一闯；父母则是抱着忧虑的念头，总说大城市生活压力大，骗子多，无时无刻都得防备；朋友们相对而言更担心的是我一个人出远门的安全。那时候，心中荡漾的，不清
      
    
    </summary>
    
      <category term="心路历程" scheme="http://qianyouyou.cn/categories/%E5%BF%83%E8%B7%AF%E5%8E%86%E7%A8%8B/"/>
    
      <category term="散文" scheme="http://qianyouyou.cn/categories/%E5%BF%83%E8%B7%AF%E5%8E%86%E7%A8%8B/%E6%95%A3%E6%96%87/"/>
    
    
  </entry>
  
  <entry>
    <title>风往何处吹</title>
    <link href="http://qianyouyou.cn/2019/07/08/2019-07-08/"/>
    <id>http://qianyouyou.cn/2019/07/08/2019-07-08/</id>
    <published>2019-07-08T14:07:46.000Z</published>
    <updated>2019-07-08T14:09:51.832Z</updated>
    
    <content type="html"><![CDATA[<p>浅悠悠 7-8</p><p>我不知道，<br>风在往何处吹，<br>吹散了无根的枝叶，<br>还有七月的蔷薇。</p><p>我不知道，<br>风会往何处吹。<br>吹向那紫陌的寂寥，<br>还是霓虹的余辉。</p><p>我不知道，<br>风该往何处吹。<br>吹散那远方的清梦，<br>还是脚下的尘灰。</p><p>我不知道，<br>风向往何处吹。<br>吹向了温存的故事，<br>还有光阴的慈悲。</p><p>我不知道，<br>我什么也不知道。</p><p>也许只有风儿知道方向，<br>那我便化作海浪随风依洄。<br>也许风儿也不知道方向，<br>那我将像那尘埃何处可归。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;浅悠悠 7-8&lt;/p&gt;
&lt;p&gt;我不知道，&lt;br&gt;风在往何处吹，&lt;br&gt;吹散了无根的枝叶，&lt;br&gt;还有七月的蔷薇。&lt;/p&gt;
&lt;p&gt;我不知道，&lt;br&gt;风会往何处吹。&lt;br&gt;吹向那紫陌的寂寥，&lt;br&gt;还是霓虹的余辉。&lt;/p&gt;
&lt;p&gt;我不知道，&lt;br&gt;风该往何处吹。&lt;br&gt;吹散那远
      
    
    </summary>
    
      <category term="诗词歌赋" scheme="http://qianyouyou.cn/categories/%E8%AF%97%E8%AF%8D%E6%AD%8C%E8%B5%8B/"/>
    
      <category term="摘星集" scheme="http://qianyouyou.cn/categories/%E8%AF%97%E8%AF%8D%E6%AD%8C%E8%B5%8B/%E6%91%98%E6%98%9F%E9%9B%86/"/>
    
    
      <category term="诗集" scheme="http://qianyouyou.cn/tags/%E8%AF%97%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>微信数据分析笔记</title>
    <link href="http://qianyouyou.cn/2019/06/24/2019-06-24/"/>
    <id>http://qianyouyou.cn/2019/06/24/2019-06-24/</id>
    <published>2019-06-24T00:48:36.000Z</published>
    <updated>2019-06-26T01:35:41.751Z</updated>
    
    <content type="html"><![CDATA[<h1 id="6月24日"><a href="#6月24日" class="headerlink" title="6月24日"></a>6月24日</h1><h2 id="项目需求分析"><a href="#项目需求分析" class="headerlink" title="项目需求分析"></a>项目需求分析</h2><p>1、男女性别比例</p><p>2、各省好友数量</p><p>3、个性签名云图</p><h2 id="第三方库"><a href="#第三方库" class="headerlink" title="第三方库"></a>第三方库</h2><h3 id="pyecharts"><a href="#pyecharts" class="headerlink" title="pyecharts"></a>pyecharts</h3><p>一个商业级图表，纯Js图表库。用于生成Echarts图表的类库。</p><h3 id="jieba"><a href="#jieba" class="headerlink" title="jieba"></a>jieba</h3><p>中文分词组件。</p><h3 id="scipy"><a href="#scipy" class="headerlink" title="scipy"></a>scipy</h3><p>工程设计的Python工具包。包括统计、优化、整合、线性代数模块、傅里叶变换、信号和图像处理、长积分方程求解器等等。</p><h3 id="wordcloud"><a href="#wordcloud" class="headerlink" title="wordcloud"></a>wordcloud</h3><p>Python词云展示库，在一段文本中提取关键词进行扁平化的展示，更能吸引目标客户的眼球。</p><h3 id="wxpy"><a href="#wxpy" class="headerlink" title="wxpy"></a>wxpy</h3><p>微信个人API</p><h3 id="re"><a href="#re" class="headerlink" title="re"></a>re</h3><p>Python的re模块提供了诸多正则表达式模块，使Python拥有了全部的正则表达式功能，库1方便检查一个字符串是否与某种模式匹配。</p><h2 id="登录并查看相关信息"><a href="#登录并查看相关信息" class="headerlink" title="登录并查看相关信息"></a>登录并查看相关信息</h2><p>1、登录</p><p>bot = Bot() #扫描二维码自动登录</p><p>2、获取登录账号的所有好友</p><p>bot.friends()</p><p>3、获取当前登录账号所关注的公众号</p><p>bot.mps()</p><p>4、获取当前登录账号群聊列表</p><p>bot.groups()</p><p>5、搜索好友：</p><p>bot.friends().search(‘好友备注名’)[0]</p><p>6、搜索好友并发送消息</p><p>bot.friends().search(‘好友备注名’)[0].send(‘str’)</p><p>7、向文件传输助手发送信息</p><p>bot.fle_helper.send(‘str’)</p><h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><p>1、每个键值(key:value)对用冒号分隔</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;s = &#123;&apos;name&apos;:&apos;udbs&apos;, &apos;age&apos;:20&#125;</span><br><span class="line">&gt;&gt;&gt;a[&apos;age&apos;]</span><br><span class="line">20</span><br><span class="line">&gt;&gt;&gt;print(a[&apos;age&apos;])</span><br><span class="line">20</span><br></pre></td></tr></table></figure><h3 id="访问字典"><a href="#访问字典" class="headerlink" title="访问字典"></a>访问字典</h3><p>字典名[‘key’]</p><h3 id="修改字典"><a href="#修改字典" class="headerlink" title="修改字典"></a>修改字典</h3><p>字典名[‘key’] = ‘value’</p><h3 id="删除字典"><a href="#删除字典" class="headerlink" title="删除字典"></a>删除字典</h3><p>1、删除单一元素</p><p>格式：del 字典名[‘key’]</p><p>2、清空所有元素</p><p>格式：字典名.clear()</p><p>3、删除字典</p><p>格式：del 字典名</p><h1 id="6月25日"><a href="#6月25日" class="headerlink" title="6月25日"></a>6月25日</h1><h2 id="读写文件"><a href="#读写文件" class="headerlink" title="读写文件"></a>读写文件</h2><p>open函数，必须先用Python内置的open()函数打开文件，创建一个file对象。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file object = open(file_name[, access_mode][, buffering])</span><br></pre></td></tr></table></figure><h2 id="with-as语句"><a href="#with-as语句" class="headerlink" title="with as语句"></a>with as语句</h2><p>try-finally语句可以处理异常。但较麻烦。</p><p>python提供了with语句语法，来构建对资源创建与释放方法，但功能与try相似。with语句后面跟着open方法，如果有返回值，可以使用as语句赋值给变量，退出时自动调用close。</p><h2 id="re模块"><a href="#re模块" class="headerlink" title="re模块"></a>re模块</h2><p>re.findall()方法</p><p>搜索整个字符串，返回匹配正则表达式的所有内容。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.findall(pattern,string)</span><br></pre></td></tr></table></figure><p>re.compile()方法</p><p>将正则字符串编译成正则表达式对象，以便后期匹配中复用。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.compile(&apos;正则表达式&apos;)</span><br></pre></td></tr></table></figure><h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><ul><li>.匹配除了换行符之外的所有字符。</li><li>d数字</li><li>w字母</li></ul><p>join()方法</p><p>用于将序列中的元素以指定的字符连接生成一个新的字符串</p><h1 id="6月26日"><a href="#6月26日" class="headerlink" title="6月26日"></a>6月26日</h1><h2 id="jieba库"><a href="#jieba库" class="headerlink" title="jieba库"></a>jieba库</h2><ol><li><p>精确模式：jieba.lcut(str)</p><p>试图将语句最精确切分，不存在冗余数据，适合文本分析。</p></li><li><p>全模式：jieba.lcut(str,cut_all=True)</p><p>将与句中所有可能是词的词语都切分出来，速度快，但存在冗余数据</p></li><li><p>搜索引擎模式：jieba.lcut_for_search(str)</p><p>在精确模式的基础上·，对长词再次进行切分。</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; str = &apos;手持两把锟斤拷&apos;</span><br><span class="line">&gt;&gt;&gt; jieba.lcut(str)</span><br><span class="line">[&apos;手持&apos;, &apos;两把&apos;, &apos;锟&apos;, &apos;斤&apos;, &apos;拷&apos;]</span><br><span class="line">&gt;&gt;&gt; str = &apos;手持两把锟斤拷，口中直呼烫烫烫。&apos;</span><br><span class="line">&gt;&gt;&gt; jieba.lcut(str)</span><br><span class="line">[&apos;手持&apos;, &apos;两把&apos;, &apos;锟&apos;, &apos;斤&apos;, &apos;拷&apos;, &apos;，&apos;, &apos;口中&apos;, &apos;直呼&apos;, &apos;烫烫&apos;, &apos;烫&apos;, &apos;。&apos;]</span><br><span class="line">&gt;&gt;&gt; jieba.lcut_for_search(str)</span><br><span class="line">[&apos;手持&apos;, &apos;两把&apos;, &apos;锟&apos;, &apos;斤&apos;, &apos;拷&apos;, &apos;，&apos;, &apos;口中&apos;, &apos;直呼&apos;, &apos;烫烫&apos;, &apos;烫&apos;, &apos;。&apos;]</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure><h2 id="筛选函数isin-函数"><a href="#筛选函数isin-函数" class="headerlink" title="筛选函数isin()函数"></a>筛选函数isin()函数</h2><h3 id="isin"><a href="#isin" class="headerlink" title="isin()"></a>isin()</h3><p>功能：判断该列元素是否在某一个列表中。是True，否False。</p><h2 id="groupby函数和agg函数"><a href="#groupby函数和agg函数" class="headerlink" title="groupby函数和agg函数"></a>groupby函数和agg函数</h2><p>agg基于列的聚合操作</p><p>groupby基于行</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;6月24日&quot;&gt;&lt;a href=&quot;#6月24日&quot; class=&quot;headerlink&quot; title=&quot;6月24日&quot;&gt;&lt;/a&gt;6月24日&lt;/h1&gt;&lt;h2 id=&quot;项目需求分析&quot;&gt;&lt;a href=&quot;#项目需求分析&quot; class=&quot;headerlink&quot; title=&quot;项
      
    
    </summary>
    
      <category term="程序人生" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
      <category term="大数据" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Python" scheme="http://qianyouyou.cn/tags/Python/"/>
    
      <category term="数据分析" scheme="http://qianyouyou.cn/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
      <category term="大数据" scheme="http://qianyouyou.cn/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
  </entry>
  
  <entry>
    <title>JavaWeb网上购物系统的设计与实现</title>
    <link href="http://qianyouyou.cn/2019/06/02/2019-06-02/"/>
    <id>http://qianyouyou.cn/2019/06/02/2019-06-02/</id>
    <published>2019-06-02T02:20:25.000Z</published>
    <updated>2019-06-09T14:23:55.780Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/qian-youyou/ShoppingNet" target="_blank" rel="noopener">GitHub源码</a></p><p>1 课题简介    </p><p>1.1 背景及研究现状</p><p>在互联网高速发展的时代背景下，网络正以一种前所未有的冲击力在影响着人类的活动，包括人类的生产和日常生活。网络的诞生和发展，颠覆了传统的信息传播方式，冲破了存在于传统交流方式中时间和空间的种种壁垒，极大地改变了人类从物质到精神、从形式到内容、从生产到生活的各种活动，并且给人类带来了新的机遇和挑战。网络购物作为电子商务的一种形式正以其高效、低成本的优势，逐步成为新兴的经营模式和理念，人们已经不再满足用途信息的浏览和发布，而是渴望着能够充分享受网络所带来的更加多的便利。网络购物正适应了当今社会快节奏地生活，使顾客足不出户便可以方便快捷轻松地选购自己喜欢的商品。</p><p>本次网上购物系统基于课程设计以专业综合设计I的设计成果，对其进行Web服务器端功能的扩展与开发，将其设计成一个具有服务器端交互功能的完整的Web应用系统，并完成系统的测试、服务器端的部署与发布。</p><p>1.2 设计内容与设计思路    </p><p>网上购物系统主要是对后台管理和前台操作。后台管理是管理员对本网站的维护，通过商品资料(商品添加、商品修改)，等功能达到对网站的管理。前台操作是用户登录到本网站，可以进行用户注册，通过网站的热门商品推荐或商品分类查找功能实现商品搜索，找到自己想要买的商品，装入购物车，提交定单进行购买。</p><p>网上购物平台的特点是客户和电子商品信息量很大，管理员需要整理的信息很多，为让管理员轻松、方便、快捷的管理，该平台采用符合购买电子商品基本的原则，满足广大客户的日益增长的数量，并达到操作过程中的直观、方便、实用、安全等要求。</p><p>1.3 设计目的及意义</p><p>网上购物系统，是在网络上建立一个虚拟的购物商场，使消费者的购物过程变得轻松、快捷、方便，很适合现代人快节奏的生活；同时又有效的控制“商场”运营的成本，开辟了一个新的销售渠道。 </p><p>网上购物相较于实体店铺有着其独特的优势，首先相较于实体店铺网上店铺所需要的成本很小很多，网上购物不需要考虑门店等等的费用其次网上购物系统不存在店铺打样的问题延长了经营的时间无需专人看店节约成本的同时还能使得效益更大化。</p><p>本系统利用现代化的电子及网络技术，为消费者和企业搭建一个良好的互动平台。让用户享受快捷的购物方式，为企业提供不同于传统销售的崭新的销售模式。 该购物系统是一个中小型的电子商务系统，可以为各类用户提供方便的在线购物环境。用户可以在系统中实现注册、登录、修改个人信息、分类查询商品信息、购物、管理购物车、支付等功能。管理员可以通过后台管理模块实现商品的增删改查、种类的增删改查等，从而实现对于该购物系统的管理。</p><p>2 系统分析与设计</p><p>2.1 可行性分析    </p><p>可行性研究是为了弄清楚系统开发的项目是不是可以实现和值得进行研究的过程，实际上是一次大大简化系统分析和系统设计的过程，所以，进行可执行性的分析是非常必要的，也是很重要的，可行性研究阶段通过对系统目标进行市场调研和技术分析，提出了初步的可行性方案并进行了论证。这里主要从技术可行性、经济可行性以及操作可行性三方面进行分析。</p><p>2.1.1 经济可行性</p><p>该系统硬件只需要一台PC机，而且配置要求不高。软件方面用到的MySQL是免费开源的，Eclipse也是免费使用的，所以开发成本并不高。而该系统若投入运行之后不仅减少了人力、物力而且可以推动电影行业的发展，所带来的收益是巨大的，因此在经济上也是可行的。</p><p>2.1.2 技术可行性</p><p>技术可行性要考虑到现有的技术手段和能力能不能完成系统的开发，以免开发到一半出现现有技术无法解决的问题。本系统主要采用的是JAVAWeb和JSP技术。JAVA语言和JSP都是很成熟的技术，也是世界范围内应用最广泛的技术，所以用它们作为后台和前台的语言是没有任何问题的。而且集成开发工具Eclipse可以解决很多方面的问题，创造了良好的开发环境。由于JSP功能强大，而MySQL灵活易维护在开发方面具有方便快捷、使用灵活的特点，以及目前的广泛实际应用，因此使用JAVAWed、MySQL是开发轻平台的最佳组合从而说明本系统在技术方面可行。</p><p>硬件方面，科技飞速发展的今天，硬件更新的速度越来越快，容量越来越大，可靠性越来越高，价格越来越低，其硬件平台完全能满足此系统的需要。</p><p>2.2 需求分析</p><p>2.2.1 系统设计目标</p><p>此网络购物平台系统旨在为用户提供一个简易的具备一些基本功能的购物系统，通过这个系统用户可以轻松的获得自己想要的商品。存在两种类型用户，普通用户和管理员用户。普通用户在这个系统中注册过后进行登陆此时可以在平台中进行自由的选购自己想要的商品，将选购好的商品加入购物车，如果需要修改可以在购物车中更改所需的商品数量，当选择完成过后可以确认购买，也可以让所选物品一直处在购物车中，等待下次登陆时依然有效。管理员用户可以对商品进行管理，包括商品上架，商品下架，商品查询，商品修改等。</p><p>2.2.2 系统功能需求分析</p><p>（1）用户管理：注册会员、登录、管理员用户校验、激活、退出；</p><p>（2）商品显示：按分类查询商品、通过首页推荐查询商品、展示热门商品、展示最新商品、提交商品到购物车中等；</p><p>（3）购物车管理：向购物车中添加商品、修改购物车中商品数量、删除购物车中商品、我的购物车；</p><p>（4）订单管理：通过购物车中商品生成订单、查看我的订单、查看某个订单的详细、订单支付、确认收货。</p><p>（5）管理员：订单查询、商品和类别的增删改查。</p><p>2.2.3 系统性能需求分析</p><p>用户注册部分需要实时检验用户信息是否合格，否则用户提交后才检验，若不合格需重新填写，用户很快会厌倦，因此Ajax是不错的选择。</p><p>商品部份应该给用户提供推荐，比如最新商品和最热商品，给用户提供访问便利。</p><p>此外，分类部分不常改，且使用频繁，但每次若从数据库中读取会影响效率，因此使用redis缓存数据是个不错的选择，因为大大加快了访问效率。</p><p>订单部分由于支付功能需要第三方平台，所以可不必实现。</p><p>管理员部分需要对订单具有全权访问权限。</p><p>2.3 系统总体设计</p><p>2.3.1 系统总体结构设计</p><p>本项目采取MVC设计模式，分为model，view，controler三层。本项目包含dao，domain，service，web，utils五打包。</p><p>其中web包中包含各种servlet类和前端jsp进行交互，及view层。</p><p>Service为业务逻辑层，控制信息的权限以及信息在数据库与前端的交互，及controler层。Dao中主要负责与数据库进行交互，通过各种sql获取或添加信息到数据库，及model层。</p><p>Domain为基本类，共三大层创建对象进行层与层间的信息交互，作为信息载体的集合而存在。</p><p>Utils包中包含各种工具，例如数据库中的date类型需要string进行转换，或者id的生成，这些工具均包含于utils包中。基本模式如下图：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps1.jpg" alt="img"> </p><p>图2-1 系统总体结构设计图</p><p>B/S系统架构，简单点就是用户通过访问浏览器输入域名后，转入对应的前端html或jsp，然后通过http或https协议将信息报文传送给服务端，服务端进行相应之后做出一系列对数据或页面的响应。以下是B/S系统架构图。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps2.jpg" alt="img"> </p><p>图2-2 B/S系统框架图</p><p>2.3.2 系统功能模块设计</p><p>（1）用户注册功能：发送邮件、激活用户、表单的校验、用户的登录功能、自动登录、用户的注销功能</p><p>（2）商品模块：首页热门商品和最新商品功能、商品分类、商品的列表（分页）、商品详细信息、浏览记录功能</p><p>（3）购物车模块：将商品加入购物车、展示购物车功能</p><p>（4）订单模块（多表和事务）：提交订单、展示订单、在线支付</p><p>（5）后台的分类的模块：分类信息的增删改查</p><p>（6）后台的商品模块：商品的信息的增删改查（文件上传）</p><p>（7）后台的订单的模块：所有的订单的信息展示</p><p>2.3.3 主要业务流程</p><p>用户的注册过程：</p><p>是首先进入主界面，点击注册按钮，跳转到注册页面，填写注册信息，ajax判断信息是否合格，然后跳转到注册servlet层，把信息传递给service层，service层通过dao层获取数据库信息，反馈是否成功给servlet层，最终按是否插入成功而跳转到注册成功或失败界面。之后介绍的流程大致如此，及MVC三层模型的传输过程。</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td></td><td><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps3.jpg" alt="img"></td></tr></tbody></table><p>图</p><p>2-3 程序包结构图</p><p>主界面显示：</p><p>首先index.jsp加载head.jsp，然后获取最热商品信息与最新商品信息，并显示在主界面，最后加载footer.jsp。</p><p>Head.jsp界面显示：</p><p>首先加载首页，然后访问redis数据库判断是否有种类信息，有则读取，无则访问MySQL数据库，读取数据后放到redis中。</p><p>用户注册分析：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps4.jpg" alt="img"> </p><p>图2-4 用户注册详情</p><p>商品设计：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps5.jpg" alt="img"> </p><p>图2-5 商品详情</p><p>通过浏览器访问商城，就相当于超市访问商品，因此我们需要购物车来装载商品以便对所需物品增删改查。<img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps6.jpg" alt="img"></p><p>图2-6 购物车设计</p><p>订单业务设计：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps7.jpg" alt="img"> </p><p>图2-7 订单业务设计</p><p>管理员管理流程：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps8.jpg" alt="img"> </p><p>图2-8 管理员管理</p><p>2.4 系统数据库设计</p><p>2.4.1 数据库概念模型设计</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps9.jpg" alt="img"> </p><p>图2-9  E-R图</p><p>2.4.2数据库逻辑结构设计</p><p>表2-1 category表结构</p><table><thead><tr><th>Column Name</th><th>Date Type</th><th>Width</th><th>空值情况</th></tr></thead><tbody><tr><td>Cid</td><td>varChar</td><td>50</td><td>主关键字</td></tr><tr><td>Cname</td><td>varChar</td><td>20</td><td>默认为空</td></tr></tbody></table><p>表2-2 orderitem表结构</p><table><thead><tr><th>Column Name</th><th>Date Type</th><th>Width</th><th>空值情况</th></tr></thead><tbody><tr><td>itemid</td><td>varChar</td><td>50</td><td>主关键字</td></tr><tr><td>count</td><td>int</td><td>11</td><td>可为空</td></tr><tr><td>subtotal</td><td>double</td><td>0</td><td>可为空</td></tr><tr><td>pid</td><td>varchar</td><td>50</td><td>可为空</td></tr><tr><td>oid</td><td>varchar</td><td>50</td><td>可为空</td></tr></tbody></table><p>表2-3 order表</p><table><thead><tr><th>Column Name</th><th>Date Type</th><th>Width</th><th>空值情况</th></tr></thead><tbody><tr><td>oid</td><td>varChar</td><td>50</td><td>主关键字</td></tr><tr><td>ordertime</td><td>datetime</td><td>0</td><td>可为空</td></tr><tr><td>total</td><td>double</td><td>0</td><td>可为空</td></tr><tr><td>state</td><td>int</td><td>11</td><td>可为空</td></tr><tr><td>address</td><td>varchar</td><td>30</td><td>可为空</td></tr><tr><td>name</td><td>varchar</td><td>20</td><td>可为空</td></tr><tr><td>telephone</td><td>varchar</td><td>20</td><td>可为空</td></tr><tr><td>uid</td><td>varchar</td><td>50</td><td>可为空</td></tr></tbody></table><p>表2-4 product表</p><table><thead><tr><th>Column Name</th><th>Date Type</th><th>Width</th><th>空值情况</th></tr></thead><tbody><tr><td>pid</td><td>varChar</td><td>50</td><td>主关键字</td></tr><tr><td>pname</td><td>Varchar</td><td>20</td><td>可为空</td></tr><tr><td>Market_price</td><td>double</td><td>0</td><td>可为空</td></tr><tr><td>Shop_price</td><td>double</td><td>0</td><td>可为空</td></tr><tr><td>pimage</td><td>varchar</td><td>30</td><td>可为空</td></tr><tr><td>pdate</td><td>date</td><td>20</td><td>可为空</td></tr><tr><td>Is_hot</td><td>int</td><td>20</td><td>可为空</td></tr><tr><td>pdesc</td><td>varchar</td><td>255</td><td>可为空</td></tr><tr><td>pflag</td><td>int</td><td>11</td><td>可为空</td></tr><tr><td>cid</td><td>varchar</td><td>50</td><td>可为空</td></tr></tbody></table><p>表2-5 user表</p><table><thead><tr><th>Column Name</th><th>Date Type</th><th>Width</th><th>空值情况</th></tr></thead><tbody><tr><td>uid</td><td>varChar</td><td>50</td><td>主关键字</td></tr><tr><td>username</td><td>Varchar</td><td>20</td><td>可为空</td></tr><tr><td>password</td><td>Varchar</td><td>20</td><td>可为空</td></tr><tr><td>name</td><td>varchar</td><td>20</td><td>可为空</td></tr><tr><td>email</td><td>varchar</td><td>30</td><td>可为空</td></tr><tr><td>telephone</td><td>varchar</td><td>20</td><td>可为空</td></tr><tr><td>birthday</td><td>date</td><td>0</td><td>可为空</td></tr><tr><td>sex</td><td>varchar</td><td>10</td><td>可为空</td></tr><tr><td>state</td><td>int</td><td>11</td><td>可为空</td></tr><tr><td>code</td><td>varchar</td><td>50</td><td>可为空</td></tr></tbody></table><p>2.4.3 数据库关系设计</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps10.jpg" alt="img"> </p><p>图2-10 数据库关系图</p><p>3  系统详细设计</p><p>3.1 系统开发及运行环境</p><p>3.1.1 软件环境    </p><p>运行环境：Windows操作系统下eclipse</p><p>开发语言：JavaWeb</p><p>数据库：MySQL，redis</p><p>3.1.2 硬件环境    </p><p>阿里云服务器。</p><p>3.2 系统采用的关键技术</p><p>3.2.1页面显示逻辑与业务逻辑相分离</p><p><a href="https://baike.baidu.com/item/MVC" target="_blank" rel="noopener">MVC</a>全名是Model View Controller，是模型(model)－视图(view)－控制器(controller)的缩写，一种软件设计典范，用一种业务逻辑、数据、界面显示分离的方法组织代码，将业务逻辑聚集到一个部件里面，在改进和个性化定制界面及用户交互的同时，不需要重新编写业务逻辑。MVC被独特的发展起来用于映射传统的输入、处理和输出功能在一个逻辑的图形化用户界面的结构中。</p><p>3.2.2数据库连接与访问    </p><p>C3P0是一个开源的JDBC<a href="https://baike.baidu.com/item/%E8%BF%9E%E6%8E%A5%E6%B1%A0/1699713" target="_blank" rel="noopener">连接池</a>，它实现了数据源和JNDI绑定，支持JDBC3规范和JDBC2的标准扩展。</p><p>3.2.3 Ajax异步校验</p><p>通过在后台与服务器进行少量数据交换，Ajax 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。传统的网页（不使用 Ajax）如果需要更新内容，必须重载整个网页页面。</p><p>3.3 系统框架的实现</p><p>本项目采取MVC设计模式，分为model，view，controler三层。本项目包含dao，domain，service，web，utils五大包。</p><p>其中web包中包含各种servlet类和前端jsp进行交互，及view层。</p><p>Service为业务逻辑层，控制信息的权限以及信息在数据库与前端的交互，及controler层。Dao中主要负责与数据库进行交互，通过各种sql获取或添加信息到数据库，及model层。</p><p>Domain为基本类，共三大层创建对象进行层与层间的信息交互，作为信息载体的集合而存在。</p><p>Utils包中包含各种工具，例如数据库中的date类型需要string进行转换，或者id的生成，这些工具均包含于utils包中。</p><p>3.3.1 主要的类与接口</p><p>表3-1 JSP清单</p><table><thead><tr><th>Jsp</th><th>说明</th></tr></thead><tbody><tr><td>admin/home.jsp</td><td>管理员界面</td></tr><tr><td>index.jsp</td><td>主界面</td></tr><tr><td>head.jsp</td><td>头界面</td></tr><tr><td>footer.jsp</td><td>尾界面</td></tr><tr><td>Product_list.jsp</td><td>商品栏界面</td></tr><tr><td>Product_info.jsp</td><td>单项商品信息界面</td></tr><tr><td>order_list.jsp</td><td>订单栏界面</td></tr><tr><td>order_info.jsp</td><td>订单项界面</td></tr><tr><td>cart.jsp</td><td>购物车界面</td></tr><tr><td>login.jsp</td><td>登陆界面</td></tr><tr><td>register.jsp</td><td>注册界面</td></tr></tbody></table><p>表3-2 MVC模式清单</p><table><thead><tr><th>Servlet</th><th>Service</th><th>Dao</th><th>Utils</th><th>Domain</th></tr></thead><tbody><tr><td>AutoLoginFilter</td><td>AdminService</td><td>AdminDao</td><td>BeanFactory</td><td>Cart</td></tr><tr><td>ActiveServlet</td><td>ProductService</td><td>ProductDao</td><td>CommonsUtils</td><td>CartItem</td></tr><tr><td>AdminServlet</td><td>UserService</td><td>UserDao</td><td>DataSourceUtils</td><td>Category</td></tr><tr><td>BaseServlet</td><td>AdminServiceImpl</td><td></td><td>JedisPoolUtils</td><td>Order</td></tr><tr><td>CallbackServlet</td><td></td><td></td><td>MailUtils</td><td>OrderItem</td></tr><tr><td>PrdocutServlet</td><td></td><td></td><td>MD5Utils</td><td>PageBean</td></tr><tr><td>RegisterServlet</td><td></td><td></td><td>PaymentUtil</td><td>Product</td></tr><tr><td>UserServlet</td><td></td><td></td><td></td><td>User</td></tr></tbody></table><p>3.3.2 系统主要配置文件</p><p>c3p0-config.xml负责数据库连接配置。</p><p>redis.properties负责redis端口属性配置。</p><p>Bean.xml配置AdminServiceImpl的清单。</p><p>Web.xml配置jsp清单。</p><p>3.4 具体功能模块的实现    </p><p>3.4.1前台分类信息展示</p><p>在head.jsp中有以下js代码：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps11.jpg" alt="img"> </p><p>图3-1 主页head栏</p><p>通过Ajax方式，首先访问CategoryServlet中的findCategory()方法，查询并以json格式返回Category的List集合db.cname即是最终导航栏显示的分类信息。</p><p>点击某一个分类后，会访问ProductServlet中的findPage()方法，传递当前页数：1和分类ID：cid。</p><p>3.4.2分类商品的分页展示</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps12.jpg" alt="img"> </p><p>图3-2 分类商品首页图</p><p>Dao层查询每页显示的数据（select * from product where cid = ? limit ?,?），Service层调用Dao后再进行条数页数的设置并封装进javabean，返回给servlet。</p><p>Servlet中的findPage()方法：</p><p>首先获取分类的ID：String cid = request.getParameter(“cid”);</p><p>然后获取当前页数：</p><p>int pageNumber =Integer.parseInt(request.getParameter(“pageNumber”));</p><p>之后设定每页显示的条数，带着参数调用service。将返回的PageBean对象和分类ID存储，供jsp页面使用。</p><p>Service层的findPage()方法：</p><p>List<product> list = pd.findPage(cid,pageNumber,pageSize);</product></p><p>封装的每页显示数据，按总条数和总页数进行封装。然后pageBean按每页显示的数据封装数据。</p><p>Servlet将pagebean存到request域中后，在jsp页面通过jstl遍历展示商品信息：</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps13.jpg" alt="img"> </p><p>图3-3 产品分类显示</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps14.jpg" alt="img"> </p><p>图3-4 产品分类jsp代码</p><p>3.4.3单个商品详情</p><p>在商品列表页面有：</p><p>&lt;ahref=”${pageContext.request.contextPath}/product?method=productList&amp;cid=${cid }¤tPage=${currentPage}”&gt;</p><p>这是定义在每个商品图片上的超链接，点击后访问ProductServlet中的findBypid()方法，查询单个商品的详情。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps15.jpg" alt="img"> </p><p>图3-5 产品单件商品信息页面</p><p>3.4.4最新和热门商品展示</p><p>首先，每个商品有一个是否热门属性和一个上架时间属性。加载主页面时，会从数据库中读取is_hot为1的所有商品作为热门商品，并加载时间最近的商品作为最新商品。href为${pageContext.request.contextPath}/product?method=productInfo&amp;pid=${hotPro.pid}。项目运行后直接访问ProductServlet中的findByNew()方法，查询最新最热商品信息，然后跳转到/jsp/index.jsp页面进行展示。</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps16.jpg" alt="img"> </p><p>图3-6 热门商品展示</p><p><img src="file:///C:\Users\DELL\AppData\Local\Temp\ksohtml5384\wps17.jpg" alt="img"> </p><p>图3-7 最新商品展示</p><p>4 系统测试 </p><p>4.1 系统测试方法</p><p>测试方法采用了边界值，场景分析，等价类，用jmeter进行接测和压测。</p><p>4.2 系统测试用例</p><p>表4-1 系统测试</p><table><thead><tr><th>测试功能</th><th>测试用例序号</th><th>测试样例</th></tr></thead><tbody><tr><td>按类别查询商品首页</td><td>1</td><td>直接查询</td></tr><tr><td>分页展示分类商品</td><td>2</td><td>按种类添加删除商品信息</td></tr><tr><td>单个商品信息校验</td><td>3</td><td>修改部分商品信息</td></tr><tr><td>最热与最新商品展示</td><td>4</td><td>修改最热属性以及日期</td></tr></tbody></table><p>4.3 系统测试结果</p><p>表4-2 测试结果</p><table><thead><tr><th>测试用例序号</th><th>测试结果</th></tr></thead><tbody><tr><td>1</td><td>成功</td></tr><tr><td>2</td><td>成功</td></tr><tr><td>3</td><td>成功</td></tr><tr><td>4</td><td>成功</td></tr></tbody></table><p>5 总结</p><p>5.1 系统工作总结</p><p>​    我们这次首先应用到了MVC框架一开始使用的时候还有点生疏，但是在熟悉了以后，MVC框架的优点现了出来，它把前后台分开进行处理，我们在写后台逻辑的时候不需要考虑前端网页的布局，在写前端网页的时候也不需要在页面中插入后端的业务逻辑，这样让整个开发的过程变得十分明确，包括在查看源码的时候也不会眼花缭乱，当代码发生错误时，调试起来也能够快速的发现错误点，这是相较于之前没有框架使用的时候所没有的优越之处。同时，我们这次还用了C3P0的数据库池连接，它的优势之处就是比原本单纯的JDBC连接更加快捷，速度更快了。</p><p>5.2 存在的不足及改进</p><p>本系统由于涉及到支付功能，而支付又涉及到现金交易，因此该部分一直没有实现，经查阅资料了解到第三方支付平台的存在，但目前由于第三方支付平台账号问题目前支付功能具体还没有实现。之后会陆续对该部分进行改进。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://github.com/qian-youyou/ShoppingNet&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub源码&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;1 课题简介    &lt;/p&gt;
&lt;p&gt;1.1 背景及研究现状&lt;/p&gt;
      
    
    </summary>
    
      <category term="程序人生" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
      <category term="Java" scheme="http://qianyouyou.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/Java/"/>
    
    
      <category term="Java" scheme="http://qianyouyou.cn/tags/Java/"/>
    
      <category term="MVC" scheme="http://qianyouyou.cn/tags/MVC/"/>
    
      <category term="JavaWeb" scheme="http://qianyouyou.cn/tags/JavaWeb/"/>
    
      <category term="JSP" scheme="http://qianyouyou.cn/tags/JSP/"/>
    
  </entry>
  
</feed>
